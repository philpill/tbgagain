/*! Built with IMPACT - impactjs.com */

!function(t){"use strict";if(Number.prototype.map=function(t,i,e,s){return e+(s-e)*((this-t)/(i-t))},Number.prototype.limit=function(t,i){return Math.min(i,Math.max(t,this))},Number.prototype.round=function(t){return t=Math.pow(10,t||0),Math.round(this*t)/t},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return 0|this},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return 180*this/Math.PI},Object.defineProperty(Array.prototype,"erase",{value:function(t){for(var i=this.length;i--;)this[i]===t&&this.splice(i,1);return this}}),Object.defineProperty(Array.prototype,"random",{value:function(t){return this[Math.floor(Math.random()*this.length)]}}),Function.prototype.bind=Function.prototype.bind||function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),e=this,s=function(){},n=function(){return e.apply(this instanceof s&&t?this:t,i.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,n.prototype=new s,n},t.ig={game:null,debug:null,version:"1.24",global:t,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:t.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(t){return"#"==t.charAt(0)?document.getElementById(t.substr(1)):document.getElementsByTagName(t)},$new:function(t){return document.createElement(t)},copy:function(t){if(!t||"object"!=typeof t||t instanceof HTMLElement||t instanceof ig.Class)return t;if(t instanceof Array){for(var i=[],e=0,s=t.length;s>e;e++)i[e]=ig.copy(t[e]);return i}var i={};for(var e in t)i[e]=ig.copy(t[e]);return i},merge:function(t,i){for(var e in i){var s=i[e];"object"!=typeof s||s instanceof HTMLElement||s instanceof ig.Class||null===s?t[e]=s:(t[e]&&"object"==typeof t[e]||(t[e]=s instanceof Array?[]:{}),ig.merge(t[e],s))}return t},ksort:function(t){if(!t||"object"!=typeof t)return[];var i=[],e=[];for(var s in t)i.push(s);i.sort();for(var s=0;s<i.length;s++)e.push(t[i[s]]);return e},setVendorAttribute:function(t,i,e){var s=i.charAt(0).toUpperCase()+i.substr(1);t[i]=t["ms"+s]=t["moz"+s]=t["webkit"+s]=t["o"+s]=e},getVendorAttribute:function(t,i){var e=i.charAt(0).toUpperCase()+i.substr(1);return t[i]||t["ms"+e]||t["moz"+e]||t["webkit"+e]||t["o"+e]},normalizeVendorAttribute:function(t,i){var e=ig.getVendorAttribute(t,i);!t[i]&&e&&(t[i]=e)},getImagePixels:function(t,i,e,s,n){var a=ig.$new("canvas");a.width=t.width,a.height=t.height;var o=a.getContext("2d");ig.System.SCALE.CRISP(a,o);var h=ig.getVendorAttribute(o,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(o,"getImageDataHD");var r=t.width/h,l=t.height/h;return a.width=Math.ceil(r),a.height=Math.ceil(l),o.drawImage(t,0,0,r,l),1===h?o.getImageData(i,e,s,n):o.getImageDataHD(i,e,s,n)},module:function(t){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[t]&&ig.modules[t].body)throw"Module '"+t+"' is already defined";return ig._current={name:t,requires:[],loaded:!1,body:null},ig.modules[t]=ig._current,ig._loadQueue.push(ig._current),ig},requires:function(){return ig._current.requires=Array.prototype.slice.call(arguments),ig},defines:function(t){ig._current.body=t,ig._current=null,ig._initDOMReady()},addResource:function(t){ig.resources.push(t)},setNocache:function(t){ig.nocache=t?"?"+Date.now():""},log:function(){},assert:function(t,i){},show:function(t,i){},mark:function(t,i){},_loadScript:function(t,i){ig.modules[t]={name:t,requires:[],loaded:!1,body:null},ig._waitForOnload++;var e=ig.prefix+ig.lib+t.replace(/\./g,"/")+".js"+ig.nocache,s=ig.$new("script");s.type="text/javascript",s.src=e,s.onload=function(){ig._waitForOnload--,ig._execModules()},s.onerror=function(){throw"Failed to load module "+t+" at "+e+" required from "+i},ig.$("head")[0].appendChild(s)},_execModules:function(){for(var t=!1,i=0;i<ig._loadQueue.length;i++){for(var e=ig._loadQueue[i],s=!0,n=0;n<e.requires.length;n++){var a=e.requires[n];ig.modules[a]?ig.modules[a].loaded||(s=!1):(s=!1,ig._loadScript(a,e.name))}s&&e.body&&(ig._loadQueue.splice(i,1),e.loaded=!0,e.body(),t=!0,i--)}if(t)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){for(var o=[],i=0;i<ig._loadQueue.length;i++){for(var h=[],r=ig._loadQueue[i].requires,n=0;n<r.length;n++){var e=ig.modules[r[n]];e&&e.loaded||h.push(r[n])}o.push(ig._loadQueue[i].name+" (requires: "+h.join(", ")+")")}throw"Unresolved (or circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules or a previous syntax error prevents a module from loading:\n"+o.join("\n")}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0,ig._waitForOnload--,ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0),ig.ua.pixelRatio=t.devicePixelRatio||1,ig.ua.viewport={width:t.innerWidth,height:t.innerHeight},ig.ua.screen={width:t.screen.availWidth*ig.ua.pixelRatio,height:t.screen.availHeight*ig.ua.pixelRatio},ig.ua.iPhone=/iPhone/i.test(navigator.userAgent),ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio,ig.ua.iPad=/iPad/i.test(navigator.userAgent),ig.ua.android=/android/i.test(navigator.userAgent),ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent),ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad,ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||/mobile/i.test(navigator.userAgent),ig.ua.touchDevice="ontouchstart"in t||t.navigator.msMaxTouchPoints},_initDOMReady:function(){return ig.modules["dom.ready"]?void ig._execModules():(ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,void("complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),t.addEventListener("load",ig._DOMReady,!1))))}},ig.normalizeVendorAttribute(t,"requestAnimationFrame"),t.requestAnimationFrame){var i=1,e={};t.ig.setAnimation=function(s,n){var a=i++;e[a]=!0;var o=function(){e[a]&&(t.requestAnimationFrame(o,n),s())};return t.requestAnimationFrame(o,n),a},t.ig.clearAnimation=function(t){delete e[t]}}else t.ig.setAnimation=function(i,e){return t.setInterval(i,1e3/60)},t.ig.clearAnimation=function(i){t.clearInterval(i)};var s=!1,n=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/,a=0;t.ig.Class=function(){};var o=function(t){var i=this.prototype,e={};for(var s in t)"function"==typeof t[s]&&"function"==typeof i[s]&&n.test(t[s])?(e[s]=i[s],i[s]=function(t,i){return function(){var s=this.parent;this.parent=e[t];var n=i.apply(this,arguments);return this.parent=s,n}}(s,t[s])):i[s]=t[s]};t.ig.Class.extend=function(i){function e(){if(!s){if(this.staticInstantiate){var t=this.staticInstantiate.apply(this,arguments);if(t)return t}for(var i in this)"object"==typeof this[i]&&(this[i]=ig.copy(this[i]));this.init&&this.init.apply(this,arguments)}return this}var h=this.prototype;s=!0;var r=new this;s=!1;for(var l in i)"function"==typeof i[l]&&"function"==typeof h[l]&&n.test(i[l])?r[l]=function(t,i){return function(){var e=this.parent;this.parent=h[t];var s=i.apply(this,arguments);return this.parent=e,s}}(l,i[l]):r[l]=i[l];return e.prototype=r,e.prototype.constructor=e,e.extend=t.ig.Class.extend,e.inject=o,e.classId=r.classId=++a,e},t.ImpactMixin&&ig.merge(ig,t.ImpactMixin)}(window),ig.baked=!0,ig.module("impact.image").defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(t){return ig.Image.cache[t]||null},init:function(t){this.path=t,this.load()},load:function(t){return this.loaded?void(t&&t(this.path,!0)):(!this.loaded&&ig.ready?(this.loadCallback=t||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),void(ig.Image.cache[this.path]=this))},reload:function(){this.loaded=!1,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.src=this.path+"?"+Date.now()},onload:function(t){this.width=this.data.width,this.height=this.data.height,this.loaded=!0,1!=ig.system.scale&&this.resize(ig.system.scale),this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(t){this.failed=!0,this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(t){var i=ig.getImagePixels(this.data,0,0,this.width,this.height),e=this.width*t,s=this.height*t,n=ig.$new("canvas");n.width=e,n.height=s;for(var a=n.getContext("2d"),o=a.getImageData(0,0,e,s),h=0;s>h;h++)for(var r=0;e>r;r++){var l=4*(Math.floor(h/t)*this.width+Math.floor(r/t)),g=4*(h*e+r);o.data[g]=i.data[l],o.data[g+1]=i.data[l+1],o.data[g+2]=i.data[l+2],o.data[g+3]=i.data[l+3]}a.putImageData(o,0,0),this.data=n},draw:function(t,i,e,s,n,a){if(this.loaded){var o=ig.system.scale;e=e?e*o:0,s=s?s*o:0,n=(n?n:this.width)*o,a=(a?a:this.height)*o,ig.system.context.drawImage(this.data,e,s,n,a,ig.system.getDrawPos(t),ig.system.getDrawPos(i),n,a),ig.Image.drawCount++}},drawTile:function(t,i,e,s,n,a,o){if(n=n?n:s,!(!this.loaded||s>this.width||n>this.height)){var h=ig.system.scale,r=Math.floor(s*h),l=Math.floor(n*h),g=a?-1:1,u=o?-1:1;(a||o)&&(ig.system.context.save(),ig.system.context.scale(g,u)),ig.system.context.drawImage(this.data,Math.floor(e*s)%this.width*h,Math.floor(e*s/this.width)*n*h,r,l,ig.system.getDrawPos(t)*g-(a?r:0),ig.system.getDrawPos(i)*u-(o?l:0),r,l),(a||o)&&ig.system.context.restore(),ig.Image.drawCount++}}}),ig.Image.drawCount=0,ig.Image.cache={},ig.Image.reloadCache=function(){for(var t in ig.Image.cache)ig.Image.cache[t].reload()}}),ig.baked=!0,ig.module("impact.font").requires("impact.image").defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(t){this._loadMetrics(this.data),this.parent(t)},widthForString:function(t){if(-1!==t.indexOf("\n")){for(var i=t.split("\n"),e=0,s=0;s<i.length;s++)e=Math.max(e,this._widthForLine(i[s]));return e}return this._widthForLine(t)},_widthForLine:function(t){for(var i=0,e=0;e<t.length;e++)i+=this.widthMap[t.charCodeAt(e)-this.firstChar]+this.letterSpacing;return i},heightForString:function(t){return t.split("\n").length*(this.height+this.lineSpacing)},draw:function(t,i,e,s){if("string"!=typeof t&&(t=t.toString()),-1===t.indexOf("\n")){if(s==ig.Font.ALIGN.RIGHT||s==ig.Font.ALIGN.CENTER){var n=this._widthForLine(t);i-=s==ig.Font.ALIGN.CENTER?n/2:n}1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(var a=0;a<t.length;a++){var o=t.charCodeAt(a);i+=this._drawChar(o-this.firstChar,i,e)}1!==this.alpha&&(ig.system.context.globalAlpha=1),ig.Image.drawCount+=t.length}else for(var h=t.split("\n"),r=this.height+this.lineSpacing,a=0;a<h.length;a++)this.draw(h[a],i,e+a*r,s)},_drawChar:function(t,i,e){if(!this.loaded||0>t||t>=this.indices.length)return 0;var s=ig.system.scale,n=this.indices[t]*s,a=0,o=this.widthMap[t]*s,h=(this.height-2)*s;return ig.system.context.drawImage(this.data,n,a,o,h,ig.system.getDrawPos(i),ig.system.getDrawPos(e),o,h),this.widthMap[t]+this.letterSpacing},_loadMetrics:function(t){this.height=t.height-1,this.widthMap=[],this.indices=[];for(var i=ig.getImagePixels(t,0,t.height-1,t.width,1),e=0,s=0,n=0;n<t.width;n++){var a=4*n+3;i.data[a]>127?s++:i.data[a]<128&&s&&(this.widthMap.push(s),this.indices.push(n-s),e++,s=0)}this.widthMap.push(s),this.indices.push(n-s)}}),ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}}),ig.baked=!0,ig.module("impact.sound").defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio)return void(ig.Sound.enabled=!1);for(var t=new Audio,i=0;i<ig.Sound.use.length;i++){var e=ig.Sound.use[i];if(t.canPlayType(e.mime)){this.format=e;break}}this.format||(ig.Sound.enabled=!1),ig.Sound.enabled&&ig.Sound.useWebAudio&&(this.audioContext=new AudioContext,this.boundWebAudioUnlock=this.unlockWebAudio.bind(this),document.addEventListener("touchstart",this.boundWebAudioUnlock,!1))},unlockWebAudio:function(){document.removeEventListener("touchstart",this.boundWebAudioUnlock,!1);var t=this.audioContext.createBuffer(1,1,22050),i=this.audioContext.createBufferSource();i.buffer=t,i.connect(this.audioContext.destination),i.start(0)},load:function(t,i,e){return i&&ig.Sound.useWebAudio?this.loadWebAudio(t,i,e):this.loadHTML5Audio(t,i,e)},loadWebAudio:function(t,i,e){var s=ig.prefix+t.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[t])return this.clips[t];var n=new ig.Sound.WebAudioSource;this.clips[t]=n;var a=new XMLHttpRequest;a.open("GET",s,!0),a.responseType="arraybuffer";var o=this;return a.onload=function(i){o.audioContext.decodeAudioData(a.response,function(s){n.buffer=s,e(t,!0,i)},function(i){e(t,!1,i)})},a.onerror=function(i){e(t,!1,i)},a.send(),n},loadHTML5Audio:function(t,i,e){var s=ig.prefix+t.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[t]){if(this.clips[t]instanceof ig.Sound.WebAudioSource)return this.clips[t];if(i&&this.clips[t].length<ig.Sound.channels)for(var n=this.clips[t].length;n<ig.Sound.channels;n++){var a=new Audio(s);a.load(),this.clips[t].push(a)}return this.clips[t][0]}var o=new Audio(s);if(e&&(ig.ua.mobile?setTimeout(function(){e(t,!0,null)},0):(o.addEventListener("canplaythrough",function h(i){o.removeEventListener("canplaythrough",h,!1),e(t,!0,i)},!1),o.addEventListener("error",function(i){e(t,!1,i)},!1))),o.preload="auto",o.load(),this.clips[t]=[o],i)for(var n=1;n<ig.Sound.channels;n++){var a=new Audio(s);a.load(),this.clips[t].push(a)}return o},get:function(t){var i=this.clips[t];if(i&&i instanceof ig.Sound.WebAudioSource)return i;for(var e,s=0;e=i[s++];)if(e.paused||e.ended)return e.ended&&(e.currentTime=0),e;return i[0].pause(),i[0].currentTime=0,i[0]}}),ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this),Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})},add:function(t,i){if(ig.Sound.enabled){var e=t instanceof ig.Sound?t.path:t,s=ig.soundManager.load(e,!1);if(s instanceof ig.Sound.WebAudioSource)throw ig.system.stopRunLoop(),"Sound '"+e+"' loaded as Multichannel but used for Music. Set the multiChannel param to false when loading, e.g.: new ig.Sound(path, false)";s.loop=this._loop,s.volume=this._volume,s.addEventListener("ended",this._endedCallbackBound,!1),this.tracks.push(s),i&&(this.namedTracks[i]=s),this.currentTrack||(this.currentTrack=s)}},next:function(){this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play())},pause:function(){this.currentTrack&&this.currentTrack.pause()},stop:function(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0)},play:function(t){if(t&&this.namedTracks[t]){var i=this.namedTracks[t];i!=this.currentTrack&&(this.stop(),this.currentTrack=i)}else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t;for(var i in this.tracks)this.tracks[i].loop=t},getVolume:function(){return this._volume},setVolume:function(t){this._volume=t.limit(0,1);for(var i in this.tracks)this.tracks[i].volume=this._volume},fadeOut:function(t){this.currentTrack&&(clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(t),this._fadeInterval=setInterval(this._fadeStep.bind(this),50))},_fadeStep:function(){var t=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;.01>=t?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=t},_endedCallback:function(){this._loop?this.play():this.next()}}),ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,_loop:!1,init:function(t,i){this.path=t,this.multiChannel=i!==!1,Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)}),this.load()},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t,this.currentClip&&(this.currentClip.loop=t)},load:function(t){return ig.Sound.enabled?void(ig.ready?ig.soundManager.load(this.path,this.multiChannel,t):ig.addResource(this)):void(t&&t(this.path,!0))},play:function(){ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.loop=this._loop,this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play())},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}}),ig.Sound.WebAudioSource=ig.Class.extend({sources:[],gain:null,buffer:null,_loop:!1,init:function(){this.gain=ig.soundManager.audioContext.createGain(),this.gain.connect(ig.soundManager.audioContext.destination),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)}),Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)})},play:function(){if(this.buffer){var t=ig.soundManager.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gain),t.loop=this._loop;var i=this;this.sources.push(t),t.onended=function(){i.sources.erase(t)},t.start(0)}},pause:function(){for(var t=0;t<this.sources.length;t++)try{this.sources[t].stop()}catch(i){}},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t;for(var i=0;i<this.sources.length;i++)this.sources[i].loop=t},getVolume:function(){return this.gain.gain.value},setVolume:function(t){this.gain.gain.value=t}}),ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}},ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3],ig.Sound.channels=4,ig.Sound.enabled=!0,ig.normalizeVendorAttribute(window,"AudioContext"),ig.Sound.useWebAudio=!!window.AudioContext&&!window.nwf}),ig.baked=!0,ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(t,i){this.gameClass=t,this.resources=i,this._loadCallbackBound=this._loadCallback.bind(this);for(var e=0;e<this.resources.length;e++)this._unloaded.push(this.resources[e].path)},load:function(){if(ig.system.clear("#000"),!this.resources.length)return void this.end();for(var t=0;t<this.resources.length;t++)this.loadResource(this.resources[t]);this._intervalId=setInterval(this.draw.bind(this),16)},loadResource:function(t){t.load(this._loadCallbackBound)},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass))},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var t=ig.system.scale,i=.6*ig.system.width,e=.1*ig.system.height,s=.5*ig.system.width-i/2,n=.5*ig.system.height-e/2;ig.system.context.fillStyle="#000",ig.system.context.fillRect(0,0,480,320),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(s*t,n*t,i*t,e*t),ig.system.context.fillStyle="#000",ig.system.context.fillRect(s*t+t,n*t+t,i*t-t-t,e*t-t-t),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(s*t,n*t,i*t*this._drawStatus,e*t)},_loadCallback:function(t,i){if(!i)throw"Failed to load resource: "+t;this._unloaded.erase(t),this.status=1-this._unloaded.length/this.resources.length,0==this._unloaded.length&&setTimeout(this.end.bind(this),250)}})}),ig.baked=!0,ig.module("impact.timer").defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(t){this.base=ig.Timer.time,this.last=ig.Timer.time,this.target=t||0},set:function(t){this.target=t||0,this.base=ig.Timer.time,this.pausedAt=0},reset:function(){this.base=ig.Timer.time,this.pausedAt=0},tick:function(){var t=ig.Timer.time-this.last;return this.last=ig.Timer.time,this.pausedAt?0:t},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}}),ig.Timer._last=0,ig.Timer.time=Number.MIN_VALUE,ig.Timer.timeScale=1,ig.Timer.maxStep=.05,ig.Timer.step=function(){var t=Date.now(),i=(t-ig.Timer._last)/1e3;ig.Timer.time+=Math.min(i,ig.Timer.maxStep)*ig.Timer.timeScale,ig.Timer._last=t}}),ig.baked=!0,ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(t,i,e,s,n){this.fps=i,this.clock=new ig.Timer,this.canvas=ig.$(t),this.resize(e,s,n),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode,1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP),ig.System.scaleMode(this.canvas,this.context)},resize:function(t,i,e){this.width=t,this.height=i,this.scale=e||this.scale,this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight},setGame:function(t){this.running?this.newGameClass=t:this.setGameNow(t)},setGameNow:function(t){ig.game=new t,ig.system.setDelegate(ig.game)},setDelegate:function(t){if("function"!=typeof t.run)throw"System.setDelegate: No run() function in object";this.delegate=t,this.startRunLoop()},stopRunLoop:function(){ig.clearAnimation(this.animationId),this.running=!1},startRunLoop:function(){this.stopRunLoop(),this.animationId=ig.setAnimation(this.run.bind(this),this.canvas),this.running=!0},clear:function(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step(),this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null}),ig.System.DRAW={AUTHENTIC:function(t){return Math.round(t)*this.scale},SMOOTH:function(t){return Math.round(t*this.scale)},SUBPIXEL:function(t){return t*this.scale}},ig.System.drawMode=ig.System.DRAW.SMOOTH,ig.System.SCALE={CRISP:function(t,i){ig.setVendorAttribute(i,"imageSmoothingEnabled",!1),t.style.imageRendering="-moz-crisp-edges",t.style.imageRendering="-o-crisp-edges",t.style.imageRendering="-webkit-optimize-contrast",t.style.imageRendering="crisp-edges",t.style.msInterpolationMode="nearest-neighbor"},SMOOTH:function(t,i){ig.setVendorAttribute(i,"imageSmoothingEnabled",!0),t.style.imageRendering="",t.style.msInterpolationMode=""}},ig.System.scaleMode=ig.System.SCALE.SMOOTH}),ig.baked=!0,ig.module("impact.input").defines(function(){"use strict";ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=!0;var t=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",t,!1),ig.system.canvas.addEventListener("DOMMouseScroll",t,!1),ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none")}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||(this.isUsingAccelerometer=!0,window.addEventListener("devicemotion",this.devicemotion.bind(this),!1))},mousewheel:function(t){var i=t.wheelDelta?t.wheelDelta:-1*t.detail,e=i>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN,s=this.bindings[e];s&&(this.actions[s]=!0,this.presses[s]=!0,this.delayedKeyup[s]=!0,t.stopPropagation(),t.preventDefault())},mousemove:function(t){var i=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,e=ig.system.scale*(i/ig.system.realWidth),s={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(s=ig.system.canvas.getBoundingClientRect());var n=t.touches?t.touches[0]:t;this.mouse.x=(n.clientX-s.left)/e,this.mouse.y=(n.clientY-s.top)/e},contextmenu:function(t){this.bindings[ig.KEY.MOUSE2]&&(t.stopPropagation(),t.preventDefault())},keydown:function(t){var i=t.target.tagName;if("INPUT"!=i&&"TEXTAREA"!=i){var e="keydown"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1;0>e&&!ig.ua.mobile&&window.focus(),("touchstart"==t.type||"mousedown"==t.type)&&this.mousemove(t);var s=this.bindings[e];s&&(this.actions[s]=!0,this.locks[s]||(this.presses[s]=!0,this.locks[s]=!0),t.preventDefault())}},keyup:function(t){var i=t.target.tagName;if("INPUT"!=i&&"TEXTAREA"!=i){var e="keyup"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,s=this.bindings[e];s&&(this.delayedKeyup[s]=!0,t.preventDefault())}},devicemotion:function(t){this.accel=t.accelerationIncludingGravity},bind:function(t,i){0>t?this.initMouse():t>0&&this.initKeyboard(),this.bindings[t]=i},bindTouch:function(t,i){var e=ig.$(t),s=this;e.addEventListener("touchstart",function(t){s.touchStart(t,i)},!1),e.addEventListener("touchend",function(t){s.touchEnd(t,i)},!1),e.addEventListener("MSPointerDown",function(t){s.touchStart(t,i)},!1),e.addEventListener("MSPointerUp",function(t){s.touchEnd(t,i)},!1)},unbind:function(t){var i=this.bindings[t];this.delayedKeyup[i]=!0,this.bindings[t]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup={}},state:function(t){return this.actions[t]},pressed:function(t){return this.presses[t]},released:function(t){return!!this.delayedKeyup[t]},clearPressed:function(){for(var t in this.delayedKeyup)this.actions[t]=!1,this.locks[t]=!1;this.delayedKeyup={},this.presses={}},touchStart:function(t,i){return this.actions[i]=!0,this.presses[i]=!0,t.stopPropagation(),t.preventDefault(),!1},touchEnd:function(t,i){return this.delayedKeyup[i]=!0,t.stopPropagation(),t.preventDefault(),!1}})}),ig.baked=!0,ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){"use strict";ig.main=function(t,i,e,s,n,a,o){ig.system=new ig.System(t,e,s,n,a||1),ig.input=new ig.Input,ig.soundManager=new ig.SoundManager,ig.music=new ig.Music,ig.ready=!0;var h=new(o||ig.Loader)(i,ig.resources);h.load()}}),ig.merge=function(t,i){if(t=t||{},i)for(var e in i){var s=i[e],n=typeof s;"undefined"!==n&&("object"!==n||s instanceof HTMLElement||s instanceof ig.Class?("string"===n&&("true"===s?s=!0:"false"===s&&(s=!1)),t[e]=s):(t[e]&&"object"==typeof t[e]||(t[e]=s instanceof Array?[]:{}),ig.merge(t[e],s)))}return t},ig.baked=!0,ig.module("plusplus.config-user").defines(function(){ig.CONFIG_USER={GAME_HEIGHT:480,GAME_WIDTH:640,GAME_HEIGHT_VIEW:240,GAME_WIDTH_VIEW:320,CHARACTER:{JUMP_FORCE:7,MAX_VEL_GROUNDED_X:50,MAX_VEL_UNGROUNDED_X:50},CAMERA:{KEEP_CENTERED:!1,LERP:.025,BOUNDS_TRAP_AS_PCT:!0,BOUNDS_TRAP_PCT_MINX:-.2,BOUNDS_TRAP_PCT_MINY:-.3,BOUNDS_TRAP_PCT_MAXX:.2,BOUNDS_TRAP_PCT_MAXY:.3,KEEP_INSIDE_LEVEL:!0}}}),ig.baked=!0,ig.module("plusplus.core.config").requires("plusplus.config-user").defines(function(){"use strict";ig.CONFIG={},ig.CONFIG.FORCE_ENTITY_EXTENDED=!0,ig.CONFIG.AUTO_CRISP_SCALING=!0,ig.CONFIG.MIN_TIME_STEP=(ig.ua.mobile?1e3/30:1e3/60)/1e3,ig.CONFIG.PATH_TO_MEDIA="media/",ig.CONFIG.DURATION_THROTTLE=500,ig.CONFIG.DURATION_THROTTLE_MEDIUM=250,ig.CONFIG.DURATION_THROTTLE_SHORT=60,ig.CONFIG.DURATION_TWEEN=500,ig.CONFIG.DURATION_FADE=300,ig.CONFIG.GAME_WIDTH=ig.ua.viewport.width,ig.CONFIG.GAME_HEIGHT=ig.ua.viewport.height,ig.CONFIG.GAME_WIDTH_PCT=0,ig.CONFIG.GAME_HEIGHT_PCT=0,ig.CONFIG.GAME_WIDTH_VIEW=0,ig.CONFIG.GAME_HEIGHT_VIEW=0,ig.CONFIG.TOP_DOWN=!1,ig.CONFIG.FLIP_Y=!1,ig.CONFIG.SCALE=1,ig.CONFIG.SCALE_MIN=1,ig.CONFIG.SCALE_MAX=1/0,ig.CONFIG.RESIZE_DELAY=500,ig.CONFIG.GRAVITY=400,ig.CONFIG.AUTO_SORT_LAYERS=!1,ig.CONFIG.AUTO_SORT_OVERLAY_LAYER=!0,ig.CONFIG.AUTO_SORT_UI_LAYER=!0,ig.CONFIG.PRERENDER_MAPS=!0,ig.CONFIG.PRERENDER_BACKGROUND_LAYER=!0,ig.CONFIG.PRERENDER_FOREGROUND_LAYER=!0,ig.CONFIG.CLEAR_ON_LOAD_UI_LAYER=!1,ig.CONFIG.IGNORE_PAUSE_UI_LAYER=!0,ig.CONFIG.IGNORE_PAUSE_OVERLAY_LAYER=!1,ig.CONFIG.NO_UPDATE_BACKGROUND_LAYER=!0,ig.CONFIG.NO_UPDATE_FOREGROUND_LAYER=!0,ig.CONFIG.BACKGROUNDS_PARALLAX_X=!0,ig.CONFIG.BACKGROUNDS_PARALLAX_Y=!1,ig.CONFIG.LOADER_MAX_WIDTH_PCT=.5,ig.CONFIG.LOADER_MAX_HEIGHT_PCT=.5,ig.CONFIG.LOADER_BG_COLOR="#111111",ig.CONFIG.LOADER_FADE_COLOR="#DDDDDD",ig.CONFIG.LOADER_BAR=!0,ig.CONFIG.LOADER_BAR_COLOR="#DDDDDD",ig.CONFIG.LOADER_BAR_WIDTH_PCT=.25,ig.CONFIG.LOADER_BAR_HEIGHT_PCT=.025,ig.CONFIG.LOADER_BAR_LINE_WIDTH=3,ig.CONFIG.LOADER_BAR_SPACE_PCT=.005,ig.CONFIG.LOADER_SPACE_PCT=.02,ig.CONFIG.LOADER_LOGO_SRC_MAIN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP8AAAAtCAYAAABh/r3uAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUTEQcqYSZEBgAAAVtJREFUeNrt3MGNwjAQBVC8oqPctpxtYevYFiiHm2tiryARKdaMjcHv3UCBOA5f/oGIctqxbdvtBLy9Wmt59vyXqYE1CT8sqqj6sOYlgJUf1H5gqdqv6oOVHxB+QPgB4QeEHxB+QPgB4Qfmds56o+vfz9Pnv38v6YPe29eR/baO8377I8eyt31kzK1zEhln1lxlnZfZ5qd1nJHtsz6TVn5A+IFg7R9ZUSLvkzXOSBXsfSmUNc6suerx2pFzlVXRW7e38gPCD0xY+2cw8leGIxWutVr3GHPWOFc4p+/42bbyA8IPvLD2v6pGZlXuyH5HvnbkvmY4pyuL3BBl5QeEH+hU+3tXlKxvqnuPM1KnZ6u7kbmKHGOP+Wn9BaT12Ge7gcfKDwg/8Mj/9oOVHxB+QPgB4QeEHxB+QPgB4QcmV+4fuOEHPluttVj5Qe0Hlq/9LgHgs6u+lR8QfljVP9Eqv3CR+x/VAAAAAElFTkSuQmCC",ig.CONFIG.LOADER_LOGO_SRC_ALT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUGFCwN01BpQgAAACZpVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVAgb24gYSBNYWOV5F9bAAADT0lEQVR42u3du27UQBiG4VlkUSCuIRU9QhuKpMpFUFOkTcl1bElLTcFFUCUFsai4EwqEEFAkGwkL4zE+zeF5qxw2m43z/+98Y896dmGA/X7/KyBb2rbd/ev7jxyiulEACgA1szPm150JGMAQAAWAejOAMZ8BoACgACZwe9aG27PW0WQAVB0CuxY4vdk7wgyA6qaBTMAAyIRmjV/CCAyAmjJAX+d3YQIGQMkGiDUBIzAASjYAEzAAFMA4U7i6yAAoLQOMzQKyAQOgRAMwwbjjseTfywCV05TQKbIBAyDHDDA1C+SeDVLIQAxgCCgrRad8BvH6cBmuD5cKAGYBRc8Sjl1+/ubdH1/vfs4AqGMWkMq4nPos4Xicvr96G0II4fGHq8VfNwMwQHorglI3Qt8Yv9TxYQCUYYDSTFACDMAA+a0HKNUES2ULBkCaBkjVBDVlAwaoHAUwYKbS35+gAGSAdG4Vm0u3zZUNtkj9DIB0DVCrCWQAMAATMAA2oHEI5jdVnxFSSP0MgHwyQG5ZIMdswAAMkM+mUUuZ4OuPuz64+PRi1M99fPk5hBDC0+ZntiZgAAbIb9u4uU0wtUP7Xs+a6/sZAPUYYC4TzN2R759/CSGE8OzJt2yyAANUThZnAuc+g7ZUJ568Ptx9cD/m9xkrJRMwgAyQ/+bRY7PA0h2Y004pDFA5RRTA6c1+k65K8Z4/DIB8ZwFT0/7RAmtdPUzxnj8MgHwNkGpHpbiShwHgPEBq8/Ecd0VjAAbYzgBrja2xJvjf15PzfogMwADlZoDYDl16TSADgAFiOnKtq3TdtXpL4X0BSJ6q3hv4cK0gXPnPMwBWywBb7Y4VO69P7X0GDAAZYA5iz+hNXUfgDiFggC2Z65pCjfsGMIBZQHpnAvs6uuSVOQwABqh57x4GQD0GAANAAUABQAFAAUABQAFAAaCiAsj19iol3BaGAfBAMqeCh7qq79Lw0OPGPr77uOP3x/780OtI5ZI2A1ROs3XHdzuh23F9n8d24NDiktjOnPp8Y38fA6BsA5RGrKlkADDAkrOHoc6L7eDY5xvKJLGzFAZA3ecB5ppFgAGgAKAAEJcBul+wTLxs2rbdMQAUABQA/pYBZIKyx3wGgAKAAsA9vwE+PY+Xd5MPtQAAAABJRU5ErkJggg==",
ig.CONFIG.CLEAR_COLOR="#000000",ig.CONFIG.STATIC="static",ig.CONFIG.MOVABLE="movable",ig.CONFIG.DYNAMIC="dynamic",ig.CONFIG.AUTO_SPAWN_PLAYER=!0,ig.CONFIG.Z_INDEX_BELOW_ALL=-1,ig.CONFIG.Z_INDEX_BELOW_PLAYER=0,ig.CONFIG.Z_INDEX_PLAYER=100,ig.CONFIG.Z_INDEX_ABOVE_PLAYER=200,ig.CONFIG.Z_INDEX_ABOVE_ALL=9999,ig.CONFIG.TRANSITION_LEVELS=!0,ig.CONFIG.TRANSITIONER_COLOR="#333333",ig.CONFIG.TRANSITIONER_R=51,ig.CONFIG.TRANSITIONER_G=51,ig.CONFIG.TRANSITIONER_B=51,ig.CONFIG.TRANSITIONER_LAYER="ui",ig.CONFIG.Z_INDEX_TRANSITIONER=ig.CONFIG.Z_INDEX_ABOVE_PLAYER,ig.CONFIG.DIMMED_PAUSE=!0,ig.CONFIG.DIMMER_COLOR="#333333",ig.CONFIG.DIMMER_R=51,ig.CONFIG.DIMMER_G=51,ig.CONFIG.DIMMER_B=51,ig.CONFIG.DIMMER_ALPHA=.75,ig.CONFIG.LAYERS_CUSTOM={},ig.CONFIG.LEVEL_MAX=4,ig.CONFIG.RANKS_MAP={NONE:0,EASY:Math.round(.25*ig.CONFIG.LEVEL_MAX),MEDIUM:Math.round(.5*ig.CONFIG.LEVEL_MAX),HARD:Math.round(.75*ig.CONFIG.LEVEL_MAX),IMPOSSIBLE:ig.CONFIG.LEVEL_MAX},ig.CONFIG.PRECISION_ZERO=.01,ig.CONFIG.PRECISION_ZERO_TWEEN=.1,ig.CONFIG.PRECISION_PCT_ONE_SIDED=.01,ig.CONFIG.FONT={},ig.CONFIG.FONT.MAIN_NAME="font_04b03_white_8.png",ig.CONFIG.FONT.ALT_NAME="",ig.CONFIG.FONT.CHAT_NAME="",ig.CONFIG.FONT.SCALE=1,ig.CONFIG.FONT.SCALE_OF_SYSTEM_SCALE=1,ig.CONFIG.FONT.SCALE_MIN=1,ig.CONFIG.FONT.SCALE_MAX=1/0,ig.CONFIG.FONT.IGNORE_SYSTEM_SCALE=!1,ig.CONFIG.UI={},ig.CONFIG.UI.POS_AS_PCT=!0,ig.CONFIG.UI.SCALE=1,ig.CONFIG.UI.SCALE_OF_SYSTEM_SCALE=1,ig.CONFIG.UI.SCALE_MIN=1,ig.CONFIG.UI.SCALE_MAX=1/0,ig.CONFIG.UI.IGNORE_SYSTEM_SCALE=!1,ig.CONFIG.UI.MARGIN_AS_PCT_SMALLEST=!0,ig.CONFIG.UI.MARGIN_SCALELESS=!0,ig.CONFIG.UI.CAN_FLIP_X=!0,ig.CONFIG.UI.CAN_FLIP_Y=!1,ig.CONFIG.GESTURE={RELEASE_DELAY:.3,DIRECTION_SWITCH_PCT:.03,HOLD_DELAY:.15,HOLD_DELAY_BLOCK_TAP:.3,HOLD_DELAY_ACTIVATE:.5,HOLD_ACTIVATE_DISTANCE_PCT:.01,SWIPE_DISTANCE_PCT:.05,SWIPE_DURATION_TRY:.3,SWIPE_DURATION_RESET:.1,TAP_MULTI_DISTANCE_PCT:.05,TARGET_UP:!1,TARGET_DOWN:!1,TARGET_DOWN_START:!0,TARGET_TAP:!0,TARGET_SEARCH_RADIUS:10},ig.CONFIG.CAMERA={AUTO_FOLLOW_PLAYER:!0,SNAP_FIRST_FOLLOW:!0,CENTER_FIRST_FOLLOW:!0,KEEP_CENTERED:!0,KEEP_INSIDE_LEVEL:!1,LERP:1,BOUNDS_TRAP_AS_PCT:!1,BOUNDS_TRAP_MINX:0,BOUNDS_TRAP_MINY:0,BOUNDS_TRAP_MAXX:0,BOUNDS_TRAP_MAXY:0,BOUNDS_TRAP_PCT_MINX:0,BOUNDS_TRAP_PCT_MINY:0,BOUNDS_TRAP_PCT_MAXX:0,BOUNDS_TRAP_PCT_MAXY:0,TRANSITION_DURATION:1,TRANSITION_DURATION_MIN:.2,TRANSITION_DURATION_MAX:2,TRANSITION_DISTANCE:100},ig.CONFIG.ENTITY={},ig.CONFIG.ENTITY.SIZE_X=16,ig.CONFIG.ENTITY.SIZE_Y=16,ig.CONFIG.ENTITY.SIZE_OFFSET_X=0,ig.CONFIG.ENTITY.SIZE_OFFSET_Y=0,ig.CONFIG.ENTITY.SCALE=1,ig.CONFIG.ENTITY.SCALE_OF_SYSTEM_SCALE=1,ig.CONFIG.ENTITY.SCALE_MIN=1,ig.CONFIG.ENTITY.SCALE_MAX=1/0,ig.CONFIG.ENTITY.IGNORE_SYSTEM_SCALE=!1,ig.CONFIG.ENTITY.CAN_FLIP_X=!0,ig.CONFIG.ENTITY.CAN_FLIP_Y=!1,ig.CONFIG.ENTITY.FRICTION_X=0,ig.CONFIG.ENTITY.FRICTION_Y=0,ig.CONFIG.ENTITY.MAX_VEL_X=100,ig.CONFIG.ENTITY.MAX_VEL_Y=100,ig.CONFIG.ENTITY.BOUNCINESS=0,ig.CONFIG.ENTITY.MIN_BOUNCE_VEL=40,ig.CONFIG.ENTITY.NEEDS_BOUNDS=!1,ig.CONFIG.ENTITY.NEEDS_VERTICES=!1,ig.CONFIG.ENTITY.HEALTH=1,ig.CONFIG.ENTITY.SLOPE_STICKING=!1,ig.CONFIG.ENTITY.SLOPE_SPEED_MOD=.75,ig.CONFIG.ENTITY.SLOPE_STANDING_MIN=-136,ig.CONFIG.ENTITY.SLOPE_STANDING_MAX=-44,ig.CONFIG.ENTITY.OPAQUE=!1,ig.CONFIG.ENTITY.OPAQUE_OFFSET={left:0,right:0,top:0,bottom:0},ig.CONFIG.ENTITY.OPAQUE_OFFSET_RIGHT=0,ig.CONFIG.ENTITY.OPAQUE_OFFSET_TOP=0,ig.CONFIG.ENTITY.OPAQUE_OFFSET_BOTTOM=0,ig.CONFIG.ENTITY.OPAQUE_FROM_VERTICES=!1,ig.CONFIG.ENTITY.DIFFUSE=.8,ig.CONFIG.LIGHT={},ig.CONFIG.LIGHT.PIXEL_PERFECT=!1,ig.CONFIG.LIGHT.GRADIENT=!0,ig.CONFIG.LIGHT.CASTS_SHADOWS=!1,ig.CONFIG.LIGHT.CASTS_SHADOWS_MOVABLE=!1,ig.CONFIG.LIGHT.R=1,ig.CONFIG.LIGHT.G=1,ig.CONFIG.LIGHT.B=1,ig.CONFIG.LIGHT.ALPHA=.25,ig.CONFIG.LIGHT.DIFFUSE=.8,ig.CONFIG.LIGHT.SAMPLES=1,ig.CONFIG.CHARACTER={},ig.CONFIG.CHARACTER.ANIM_AUTOMATIC=!0,ig.CONFIG.CHARACTER.SIZE_X=32,ig.CONFIG.CHARACTER.SIZE_Y=32,ig.CONFIG.CHARACTER.SIZE_OFFSET_X=0,ig.CONFIG.CHARACTER.SIZE_OFFSET_Y=0,ig.CONFIG.CHARACTER.MAX_VEL_UNGROUNDED_X=100,ig.CONFIG.CHARACTER.MAX_VEL_UNGROUNDED_Y=200,ig.CONFIG.CHARACTER.MAX_VEL_GROUNDED_X=100,ig.CONFIG.CHARACTER.MAX_VEL_GROUNDED_Y=100,ig.CONFIG.CHARACTER.MAX_VEL_CLIMBING_X=75,ig.CONFIG.CHARACTER.MAX_VEL_CLIMBING_Y=75,ig.CONFIG.CHARACTER.FRICTION_UNGROUNDED_X=0,ig.CONFIG.CHARACTER.FRICTION_UNGROUNDED_Y=0,ig.CONFIG.CHARACTER.FRICTION_GROUNDED_X=1600,ig.CONFIG.CHARACTER.FRICTION_GROUNDED_Y=1600,ig.CONFIG.CHARACTER.SPEED_X=750,ig.CONFIG.CHARACTER.SPEED_Y=750,ig.CONFIG.CHARACTER.CAN_JUMP=!0,ig.CONFIG.CHARACTER.JUMP_STEPS=4,ig.CONFIG.CHARACTER.JUMP_FORCE=10,ig.CONFIG.CHARACTER.JUMP_CONTROL=.75,ig.CONFIG.CHARACTER.CAN_JUMP_REPEATEDLY=!1,ig.CONFIG.CHARACTER.SLOPE_STICKING=!0,ig.CONFIG.CHARACTER.UNGROUNDED_FOR_THRESHOLD=.1,ig.CONFIG.CHARACTER.UNGROUNDED_FOR_AND_FALLING_THRESHOLD=.25,ig.CONFIG.CHARACTER.CAN_CLIMB=!0,ig.CONFIG.CHARACTER.CLIMBING_CONTROL=1,ig.CONFIG.CHARACTER.CAN_PATHFIND=!0,ig.CONFIG.CHARACTER.PATHFINDING_DELAY=1,ig.CONFIG.CHARACTER.PATHFINDING_UPDATE_DELAY=.2,ig.CONFIG.CHARACTER.PATHFINDING_SIMPLE_DELAY=.075,ig.CONFIG.CHARACTER.STUCK_DELAY=.1,ig.CONFIG.CHARACTER.HEALTH=1,ig.CONFIG.CHARACTER.ENERGY=1,ig.CONFIG.CHARACTER.REGEN_RATE_HEALTH=0,ig.CONFIG.CHARACTER.REGEN_RATE_ENERGY=0,ig.CONFIG.CHARACTER.EXPLODING_DAMAGE=!0,ig.CONFIG.CHARACTER.EXPLODING_DAMAGE_PARTICLE_COUNT=3,ig.CONFIG.CHARACTER.EXPLODING_DEATH=!0,ig.CONFIG.CHARACTER.EXPLODING_DEATH_PARTICLE_COUNT=10,ig.CONFIG.PLAYER_MANAGER={},ig.CONFIG.PLAYER_MANAGER.AUTO_MANAGE_PLAYER=!0,ig.CONFIG.PLAYER_MANAGER.HOLD_TO_MOVE=!0,ig.CONFIG.PLAYER_MANAGER.SWIPE_TO_JUMP=!0,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_ENABLED=!1,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_DEAD_ZONE_SIZE=6,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_SIZE=32,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MINX=0,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MINY=0,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MAXX=1,ig.CONFIG.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MAXY=1,ig.CONFIG.CREATURE={},ig.CONFIG.CREATURE.REACTION_DISTANCE=100,ig.CONFIG.CREATURE.REACTION_DELAY=.2,ig.CONFIG.CREATURE.PREDATOR_FROM_DAMAGE=!1,ig.CONFIG.CREATURE.CAN_LEARN_PREDATORS=!1,ig.CONFIG.CREATURE.NEEDS_LINE_OF_SIGHT_PREY=!0,ig.CONFIG.CREATURE.DETECT_HIDDEN_PREY=!1,ig.CONFIG.CREATURE.MOVE_TO_PREY_SETTINGS={avoidEntities:!0,searchDistance:ig.CONFIG.CREATURE.REACTION_DISTANCE},ig.CONFIG.CREATURE.NEEDS_LINE_OF_SIGHT_PREDATOR=!0,ig.CONFIG.CREATURE.DETECT_HIDDEN_PREDATOR=!1,ig.CONFIG.CREATURE.MOVE_TO_PREDATOR_SETTINGS={avoidEntities:!0,searchDistance:ig.CONFIG.CREATURE.REACTION_DISTANCE},ig.CONFIG.CREATURE.CAN_FLEE=!0,ig.CONFIG.CREATURE.FLEE_HEALTH_PCT=.15,ig.CONFIG.CREATURE.CAN_BREAK_TETHER=!1,ig.CONFIG.CREATURE.TETHER_TO_SPAWNER=!1,ig.CONFIG.CREATURE.TETHER_DISTANCE=100,ig.CONFIG.CREATURE.MOVE_TO_TETHER_SETTINGS={avoidEntities:!0},ig.CONFIG.CREATURE.CAN_WANDER_X=!0,ig.CONFIG.CREATURE.CAN_WANDER_Y=!1,ig.CONFIG.CREATURE.WANDER_SWITCH_CHANCE=0,ig.CONFIG.CREATURE.WANDER_SWITCH_CHANCE_STOPPED=0,ig.CONFIG.CREATURE.MOVE_TO_WANDER_SETTINGS={simple:!0,avoidUngrounded:!0,avoidSlopes:!0},ig.CONFIG.PARTICLE={},ig.CONFIG.PARTICLE.ANIM_AUTOMATIC=!0,ig.CONFIG.COLLISION={},ig.CONFIG.COLLISION.ALLOW_FIXED=!1,ig.CONFIG.COLLISION.TILE_SOLID=1,ig.CONFIG.COLLISION.TILE_ONE_WAY_UP=12,ig.CONFIG.COLLISION.TILE_ONE_WAY_DOWN=23,ig.CONFIG.COLLISION.TILE_ONE_WAY_RIGHT=34,ig.CONFIG.COLLISION.TILE_ONE_WAY_LEFT=45,ig.CONFIG.COLLISION.TILE_CLIMBABLE_WITH_TOP=46,ig.CONFIG.COLLISION.TILE_CLIMBABLE=47,ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP=48,ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS=49,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY={},ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_ONE_WAY_UP]=!0,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_ONE_WAY_DOWN]=!0,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_ONE_WAY_RIGHT]=!0,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_ONE_WAY_LEFT]=!0,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_CLIMBABLE_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_ONE_WAY[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE={},ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_ONE_WAY={},ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_ONE_WAY[ig.CONFIG.COLLISION.TILE_CLIMBABLE_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_ONE_WAY[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_STAIRS={},ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_STAIRS[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_CLIMBABLE_STAIRS[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE={0:!0,50:!0,51:!0},ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_ONE_WAY_UP]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_ONE_WAY_DOWN]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_ONE_WAY_RIGHT]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_ONE_WAY_LEFT]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE_STRICT={0:!0,50:!0,51:!0},ig.CONFIG.COLLISION.TILES_HASH_WALKABLE_STRICT[ig.CONFIG.COLLISION.TILE_CLIMBABLE]=!0,ig.CONFIG.COLLISION.TILES_HASH_WALKABLE_STRICT[ig.CONFIG.COLLISION.TILE_CLIMBABLE_STAIRS]=!0,ig.CONFIG.COLLISION.TILES_HASH_SLOPED={2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,13:!0,14:!0,15:!0,16:!0,17:!0,18:!0,19:!0,20:!0,21:!0,22:!0,24:!0,25:!0,26:!0,27:!0,28:!0,29:!0,30:!0,31:!0,32:!0,33:!0,35:!0,36:!0,37:!0,38:!0,39:!0,40:!0,41:!0,42:!0,43:!0,44:!0,52:!0,53:!0,54:!0,55:!0},ig.CONFIG.PATHFINDING={},ig.CONFIG.PATHFINDING.BUILD_WITH_LEVEL=!0,ig.CONFIG.PATHFINDING.WEIGHTED=!0,ig.CONFIG.PATHFINDING.ALLOW_DIAGONAL=!0,ig.CONFIG.PATHFINDING.DIAGONAL_REQUIRES_BOTH_DIRECT=!0,ig.CONFIG.PATHFINDING.AVOID_ENTITIES=!0,ig.CONFIG.PATHFINDING.WEIGHT=10,ig.CONFIG.PATHFINDING.WEIGHT_AWAY_FROM=2,ig.CONFIG.PATHFINDING.AWAY_FROM_DISTANCE=100,ig.CONFIG.PATHFINDING.AWAY_FROM_MIN_DISTANCE_PCT=.4,ig.CONFIG.PATHFINDING.AWAY_FROM_MAX_NODES=40,ig.CONFIG.PATHFINDING.STRICT_SLOPE_CHECK=!1,ig.CONFIG.PATHFINDING.TILE_DEF={0:{weightPct:1},1:{weightPct:0,walkable:!0},2:{weightPct:.25,walkable:!0},3:{weightPct:.75,walkable:!0},4:{walkable:!1}},ig.CONFIG.OVERLAY={},ig.CONFIG.OVERLAY.R=0,ig.CONFIG.OVERLAY.G=0,ig.CONFIG.OVERLAY.B=0,ig.CONFIG.OVERLAY.ALPHA=.8,ig.CONFIG.OVERLAY.PIXEL_PERFECT=!1,ig.CONFIG.TEXT_BUBBLE={},ig.CONFIG.TEXT_BUBBLE.SIZE_X=120,ig.CONFIG.TEXT_BUBBLE.SIZE_Y=70,ig.CONFIG.TEXT_BUBBLE.SIZE_AS_PCT=!0,ig.CONFIG.TEXT_BUBBLE.SIZE_PCT_X=.5,ig.CONFIG.TEXT_BUBBLE.SIZE_PCT_Y=.5,ig.CONFIG.TEXT_BUBBLE.CORNER_RADIUS=5,ig.CONFIG.TEXT_BUBBLE.CORNER_RADIUS_AS_PCT=!1,ig.CONFIG.TEXT_BUBBLE.PIXEL_PERFECT=!1,ig.CONFIG.TEXT_BUBBLE.R=.9,ig.CONFIG.TEXT_BUBBLE.G=.9,ig.CONFIG.TEXT_BUBBLE.B=.9,ig.CONFIG.TEXT_BUBBLE.ALPHA=1,ig.CONFIG.TEXT_BUBBLE.TRIANGLE_LENGTH=10,ig.CONFIG.TEXT_BUBBLE.TRIANGLE_WIDTH=12,ig.CONFIG.TEXT_BUBBLE.PADDING_X=6,ig.CONFIG.TEXT_BUBBLE.PADDING_Y=6,ig.CONFIG.TEXT_BUBBLE.SHRINK_TO_TEXT=!0,ig.merge(ig.CONFIG,ig.CONFIG_USER),ig.CONFIG.ENTITY.CAN_FLIP_Y=ig.CONFIG.ENTITY.CAN_FLIP_Y||ig.CONFIG.FLIP_Y,ig.CONFIG.FONT.MAIN_PATH=ig.CONFIG.FONT.MAIN_NAME?ig.CONFIG.PATH_TO_MEDIA+ig.CONFIG.FONT.MAIN_NAME:"",ig.CONFIG.FONT.ALT_PATH=ig.CONFIG.FONT.ALT_NAME?ig.CONFIG.PATH_TO_MEDIA+ig.CONFIG.FONT.ALT_NAME:"",ig.CONFIG.FONT.CHAT_PATH=ig.CONFIG.FONT.CHAT_NAME?ig.CONFIG.PATH_TO_MEDIA+ig.CONFIG.FONT.CHAT_NAME:"",ig.CONFIG.RANKS=function(){var t=[];for(var i in ig.CONFIG.RANKS_MAP)t.push({name:i,level:ig.CONFIG.RANKS_MAP[i]});return t.sort(function(t,i){return t.level-i.level}),t}(),ig.CONFIG.ENTITY.SIZE_EFFECTIVE_X=ig.CONFIG.ENTITY.SIZE_X-2*ig.CONFIG.ENTITY.SIZE_OFFSET_X,ig.CONFIG.ENTITY.SIZE_EFFECTIVE_Y=ig.CONFIG.ENTITY.SIZE_Y-2*ig.CONFIG.ENTITY.SIZE_OFFSET_Y,ig.CONFIG.ENTITY.SIZE_EFFECTIVE_MIN=Math.min(ig.CONFIG.ENTITY.SIZE_EFFECTIVE_X,ig.CONFIG.ENTITY.SIZE_EFFECTIVE_Y),ig.CONFIG.ENTITY.SIZE_EFFECTIVE_MAX=Math.max(ig.CONFIG.ENTITY.SIZE_EFFECTIVE_X,ig.CONFIG.ENTITY.SIZE_EFFECTIVE_Y),ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_X=ig.CONFIG.CHARACTER.SIZE_X-2*ig.CONFIG.CHARACTER.SIZE_OFFSET_X,ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_Y=ig.CONFIG.CHARACTER.SIZE_Y-2*ig.CONFIG.CHARACTER.SIZE_OFFSET_Y,ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_MIN=Math.min(ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_X,ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_Y),ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_MAX=Math.max(ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_X,ig.CONFIG.CHARACTER.SIZE_EFFECTIVE_Y)}),ig.baked=!0,ig.module("plusplus.helpers.utilsmath").defines(function(){"use strict";ig.utilsmath={},ig.utilsmath.GOLDEN_ANGLE=Math.PI*(3-Math.sqrt(5)),ig.utilsmath.TWOPI=2*Math.PI,ig.utilsmath.HALFPI=.5*Math.PI,ig.utilsmath.clamp=function(t,i,e){return Math.min(Math.max(t,i),e)},ig.utilsmath.map=function(t,i,e,s,n){return s+(n-s)*((t-i)/(e-i))},ig.utilsmath.degreesToRadians=function(t){return t/180*Math.PI},ig.utilsmath.radiansToDegrees=function(t){return 180*t/Math.PI},ig.utilsmath.almostEqual=function(t,i,e){if(t===i)return!0;var s=i-t;return s>0?e>s:s>-e},ig.utilsmath.oppositeSidesOfZero=function(t,i){return 0>t&&i>0||t>0&&0>i},ig.utilsmath.direction=function(t){return 0===t?0:0>t?-1:1},ig.utilsmath.directionChange=function(t,i){return 0===t&&0!==i||0!==t&&0===i||ig.utilsmath.oppositeSidesOfZero(t,i)}}),ig.baked=!0,ig.module("plusplus.core.loader").requires("impact.loader","plusplus.core.config","plusplus.helpers.utilsmath").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utilsmath;ig.LoaderExtended=ig.Loader.extend({_endTime:0,init:function(i,e){this.logoMain=ig.$new("img"),this.logoMain.src=t.LOADER_LOGO_SRC_MAIN,this.logoAlt=ig.$new("img"),this.logoAlt.src=t.LOADER_LOGO_SRC_ALT,this.parent(i,e),i.prototype.resize.call(this)},end:function(){this.parent(),this._endTime=Date.now(),ig.system.setDelegate(this)},run:function(){var e=Date.now()-this._endTime,s=1;if(e<t.DURATION_FADE)this.draw(),s=i.map(e,0,t.DURATION_FADE,0,1);else{if(!(e<2*t.DURATION_FADE))return void ig.system.setDelegate(ig.game);ig.game.run(),s=i.map(e,t.DURATION_FADE,2*t.DURATION_FADE,1,0)}var n=ig.system.context;n.globalAlpha=s,n.fillStyle=t.LOADER_FADE_COLOR,n.fillRect(0,0,ig.system.realWidth,ig.system.realHeight),n.globalAlpha=1},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var i,e,s,n=ig.system.context,a=ig.system.realWidth,o=ig.system.realHeight,h=Math.min(a,o)*t.LOADER_SPACE_PCT;t.LOADER_BAR?(i=a*t.LOADER_BAR_WIDTH_PCT,e=o*t.LOADER_BAR_HEIGHT_PCT,s=Math.min(a,o)*t.LOADER_BAR_SPACE_PCT):i=e=s=0;var r=this.logoMain.width,l=this.logoMain.height,g=this.logoAlt.width,u=this.logoAlt.height,c=Math.max(i,r,g),d=l+h+e+h+u,p=c/a,m=d/o,f=1,y=1;p>t.LOADER_MAX_WIDTH_PCT&&(f=1-(p-t.LOADER_MAX_WIDTH_PCT)),m>t.LOADER_MAX_HEIGHT_PCT&&(y=1-(m-t.LOADER_MAX_HEIGHT_PCT));var E=Math.min(1,f,y),v=(a-c*E)/2,T=(o-d*E)/2;n.fillStyle=t.LOADER_BG_COLOR,n.clearRect(0,0,a,o),n.save(),n.translate(v,T),n.scale(E,E),n.drawImage(this.logoMain,.5*(c-r),0),t.LOADER_BAR&&(n.lineWidth=t.LOADER_BAR_LINE_WIDTH,n.strokeStyle=t.LOADER_BAR_COLOR,n.strokeRect(.5*(c-i),l+h,i,e),n.fillStyle=t.LOADER_BAR_COLOR,n.fillRect(.5*(c-i)+s,l+h+s,Math.max(0,i*this._drawStatus-2*s),e-2*s)),n.drawImage(this.logoAlt,.5*(c-g),d-u),n.restore()}})}),ig.baked=!0,ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(t,i,e){this.width=i,this.height=e,this.image=new ig.Image(t)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(t,i,e,s){this.sheet=t,this.pivot={x:t.width/2,y:t.height/2},this.timer=new ig.Timer,this.frameTime=i,this.sequence=e,this.stop=!!s,this.tile=this.sequence[0]},rewind:function(){return this.timer.set(),this.loopCount=0,this.frame=0,this.tile=this.sequence[0],this},gotoFrame:function(t){this.timer.set(this.frameTime*-t-1e-4),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var t=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(t/this.sequence.length),this.stop&&this.loopCount>0?this.frame=this.sequence.length-1:this.frame=t%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(t,i){var e=Math.max(this.sheet.width,this.sheet.height);t>ig.system.width||i>ig.system.height||0>t+e||0>i+e||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(t,i,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(t+this.pivot.x),ig.system.getDrawPos(i+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})}),ig.baked=!0,ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(t,i,e){this.id=++ig.Entity._lastId,this.pos.x=this.last.x=t,this.pos.y=this.last.y=i,ig.merge(this,e)},reset:function(t,i,e){var s=this.constructor.prototype;this.pos.x=t,this.pos.y=i,this.last.x=t,this.last.y=i,this.vel.x=s.vel.x,this.vel.y=s.vel.y,this.accel.x=s.accel.x,this.accel.y=s.accel.y,this.health=s.health,this._killed=s._killed,this.standing=s.standing,this.type=s.type,this.checkAgainst=s.checkAgainst,this.collides=s.collides,ig.merge(this,e)},addAnim:function(t,i,e,s){if(!this.animSheet)throw"No animSheet to add the animation "+t+" to.";var n=new ig.Animation(this.animSheet,i,e,s);return this.anims[t]=n,this.currentAnim||(this.currentAnim=n),n},update:function(){this.last.x=this.pos.x,this.last.y=this.pos.y,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor,this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var t=this.vel.x*ig.system.tick,i=this.vel.y*ig.system.tick,e=ig.game.collisionMap.trace(this.pos.x,this.pos.y,t,i,this.size.x,this.size.y);this.handleMovementTrace(e),this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(t,i,e,s){if(i)return(t+i*ig.system.tick).limit(-s,s);if(e){var n=e*ig.system.tick;return t-n>0?t-n:0>t+n?t+n:0}return t.limit(-s,s)},handleMovementTrace:function(t){if(this.standing=!1,t.collision.y&&(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(this.vel.y>0&&(this.standing=!0),this.vel.y=0)),t.collision.x&&(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0),t.collision.slope){var i=t.collision.slope;if(this.bounciness>0){var e=this.vel.x*i.nx+this.vel.y*i.ny;this.vel.x=(this.vel.x-i.nx*e*2)*this.bounciness,this.vel.y=(this.vel.y-i.ny*e*2)*this.bounciness}else{var s=i.x*i.x+i.y*i.y,n=(this.vel.x*i.x+this.vel.y*i.y)/s;this.vel.x=i.x*n,this.vel.y=i.y*n;var a=Math.atan2(i.x,i.y);a>this.slopeStanding.min&&a<this.slopeStanding.max&&(this.standing=!0)}}this.pos=t.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(t,i){this.health-=t,this.health<=0&&this.kill()},touches:function(t){return!(this.pos.x>=t.pos.x+t.size.x||this.pos.x+this.size.x<=t.pos.x||this.pos.y>=t.pos.y+t.size.y||this.pos.y+this.size.y<=t.pos.y)},distanceTo:function(t){var i=this.pos.x+this.size.x/2-(t.pos.x+t.size.x/2),e=this.pos.y+this.size.y/2-(t.pos.y+t.size.y/2);return Math.sqrt(i*i+e*e)},angleTo:function(t){return Math.atan2(t.pos.y+t.size.y/2-(this.pos.y+this.size.y/2),t.pos.x+t.size.x/2-(this.pos.x+this.size.x/2))},check:function(t){},collideWith:function(t,i){},ready:function(){},erase:function(){}}),ig.Entity._lastId=0,ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8},ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3},ig.Entity.checkPair=function(t,i){t.checkAgainst&i.type&&t.check(i),i.checkAgainst&t.type&&i.check(t),t.collides&&i.collides&&t.collides+i.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(t,i)},ig.Entity.solveCollision=function(t,i){var e=null;t.collides==ig.Entity.COLLIDES.LITE||i.collides==ig.Entity.COLLIDES.FIXED?e=t:(i.collides==ig.Entity.COLLIDES.LITE||t.collides==ig.Entity.COLLIDES.FIXED)&&(e=i),t.last.x+t.size.x>i.last.x&&t.last.x<i.last.x+i.size.x?(t.last.y<i.last.y?ig.Entity.seperateOnYAxis(t,i,e):ig.Entity.seperateOnYAxis(i,t,e),t.collideWith(i,"y"),i.collideWith(t,"y")):t.last.y+t.size.y>i.last.y&&t.last.y<i.last.y+i.size.y&&(t.last.x<i.last.x?ig.Entity.seperateOnXAxis(t,i,e):ig.Entity.seperateOnXAxis(i,t,e),t.collideWith(i,"x"),i.collideWith(t,"x"))},ig.Entity.seperateOnXAxis=function(t,i,e){var s=t.pos.x+t.size.x-i.pos.x;if(e){var n=t===e?i:t;e.vel.x=-e.vel.x*e.bounciness+n.vel.x;var a=ig.game.collisionMap.trace(e.pos.x,e.pos.y,e==t?-s:s,0,e.size.x,e.size.y);e.pos.x=a.pos.x}else{var o=(t.vel.x-i.vel.x)/2;t.vel.x=-o,i.vel.x=o;var h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,-s/2,0,t.size.x,t.size.y);t.pos.x=Math.floor(h.pos.x);var r=ig.game.collisionMap.trace(i.pos.x,i.pos.y,s/2,0,i.size.x,i.size.y);i.pos.x=Math.ceil(r.pos.x)}},ig.Entity.seperateOnYAxis=function(t,i,e){var s=t.pos.y+t.size.y-i.pos.y;if(e){var n=t===e?i:t;e.vel.y=-e.vel.y*e.bounciness+n.vel.y;var a=0;e==t&&Math.abs(e.vel.y-n.vel.y)<e.minBounceVelocity&&(e.standing=!0,a=n.vel.x*ig.system.tick);var o=ig.game.collisionMap.trace(e.pos.x,e.pos.y,a,e==t?-s:s,e.size.x,e.size.y);e.pos.y=o.pos.y,e.pos.x=o.pos.x}else if(ig.game.gravity&&(i.standing||t.vel.y>0)){var h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,0,-(t.pos.y+t.size.y-i.pos.y),t.size.x,t.size.y);t.pos.y=h.pos.y,t.bounciness>0&&t.vel.y>t.minBounceVelocity?t.vel.y*=-t.bounciness:(t.standing=!0,t.vel.y=0)}else{var r=(t.vel.y-i.vel.y)/2;t.vel.y=-r,i.vel.y=r;var a=i.vel.x*ig.system.tick,h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,a,-s/2,t.size.x,t.size.y);t.pos.y=h.pos.y;var l=ig.game.collisionMap.trace(i.pos.x,i.pos.y,0,s/2,i.size.x,i.size.y);i.pos.y=l.pos.y}}}),ig.baked=!0,ig.module("impact.map").defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(t,i){this.tilesize=t,this.data=i,this.height=i.length,this.width=i[0].length,this.pxWidth=this.width*this.tilesize,this.pxHeight=this.height*this.tilesize},getTile:function(t,i){var e=Math.floor(t/this.tilesize),s=Math.floor(i/this.tilesize);return e>=0&&e<this.width&&s>=0&&s<this.height?this.data[s][e]:0},setTile:function(t,i,e){var s=Math.floor(t/this.tilesize),n=Math.floor(i/this.tilesize);s>=0&&s<this.width&&n>=0&&n<this.height&&(this.data[n][s]=e)}})}),ig.baked=!0,ig.module("impact.collision-map").requires("impact.map").defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(t,i,e){this.parent(t,i),this.tiledef=e||ig.CollisionMap.defaultTileDef;for(var s in this.tiledef)s|0>this.lastSlope&&(this.lastSlope=0|s)},trace:function(t,i,e,s,n,a){var o={collision:{x:!1,y:!1,slope:!1},pos:{x:t,y:i},tile:{x:0,y:0}},h=Math.ceil(Math.max(Math.abs(e),Math.abs(s))/this.tilesize);if(h>1)for(var r=e/h,l=s/h,g=0;h>g&&(r||l)&&(this._traceStep(o,t,i,r,l,n,a,e,s,g),t=o.pos.x,i=o.pos.y,o.collision.x&&(r=0,e=0),o.collision.y&&(l=0,s=0),!o.collision.slope);g++);else this._traceStep(o,t,i,e,s,n,a,e,s,0);return o},_traceStep:function(t,i,e,s,n,a,o,h,r,l){t.pos.x+=s,t.pos.y+=n;var g=0;if(s){var u=s>0?a:0,c=0>s?this.tilesize:0,d=Math.max(Math.floor(e/this.tilesize),0),p=Math.min(Math.ceil((e+o)/this.tilesize),this.height),m=Math.floor((t.pos.x+u)/this.tilesize),f=Math.floor((i+u)/this.tilesize);if((l>0||m==f||0>f||f>=this.width)&&(f=-1),m>=0&&m<this.width)for(var y=d;p>y&&!(-1!=f&&(g=this.data[y][f],g>1&&g<=this.lastSlope&&this._checkTileDef(t,g,i,e,h,r,a,o,f,y)));y++)if(g=this.data[y][m],1==g||g>this.lastSlope||g>1&&this._checkTileDef(t,g,i,e,h,r,a,o,m,y)){if(g>1&&g<=this.lastSlope&&t.collision.slope)break;t.collision.x=!0,t.tile.x=g,i=t.pos.x=m*this.tilesize-u+c,h=0;break}}if(n){var E=n>0?o:0,v=0>n?this.tilesize:0,T=Math.max(Math.floor(t.pos.x/this.tilesize),0),A=Math.min(Math.ceil((t.pos.x+a)/this.tilesize),this.width),y=Math.floor((t.pos.y+E)/this.tilesize),_=Math.floor((e+E)/this.tilesize);if((l>0||y==_||0>_||_>=this.height)&&(_=-1),y>=0&&y<this.height)for(var m=T;A>m&&!(-1!=_&&(g=this.data[_][m],g>1&&g<=this.lastSlope&&this._checkTileDef(t,g,i,e,h,r,a,o,m,_)));m++)if(g=this.data[y][m],1==g||g>this.lastSlope||g>1&&this._checkTileDef(t,g,i,e,h,r,a,o,m,y)){if(g>1&&g<=this.lastSlope&&t.collision.slope)break;t.collision.y=!0,t.tile.y=g,t.pos.y=y*this.tilesize-E+v;break}}},_checkTileDef:function(t,i,e,s,n,a,o,h,r,l){var g=this.tiledef[i];if(!g)return!1;var u=(r+g[0])*this.tilesize,c=(l+g[1])*this.tilesize,d=(g[2]-g[0])*this.tilesize,p=(g[3]-g[1])*this.tilesize,m=g[4],f=e+n+(0>p?o:0)-u,y=s+a+(d>0?h:0)-c;if(d*y-p*f>0){if(0>n*-p+a*d)return m;var E=Math.sqrt(d*d+p*p),v=p/E,T=-d/E,A=f*v+y*T,_=v*A,I=T*A;return _*_+I*I>=n*n+a*a?m||.5>d*(y-a)-p*(f-n):(t.pos.x=e+n-_,t.pos.y=s+a-I,t.collision.slope={x:d,y:p,nx:v,ny:T},!0)}return!1}});var t=.5,i=1/3,e=2/3,s=!0,n=!1;ig.CollisionMap.defaultTileDef={5:[0,1,1,e,s],6:[0,e,1,i,s],7:[0,i,1,0,s],3:[0,1,1,t,s],4:[0,t,1,0,s],2:[0,1,1,0,s],10:[t,1,1,0,s],21:[0,1,t,0,s],32:[e,1,1,0,s],43:[i,1,e,0,s],54:[0,1,i,0,s],27:[0,0,1,i,s],28:[0,i,1,e,s],29:[0,e,1,1,s],25:[0,0,1,t,s],26:[0,t,1,1,s],24:[0,0,1,1,s],11:[0,0,t,1,s],22:[t,0,1,1,s],33:[0,0,i,1,s],44:[i,0,e,1,s],55:[e,0,1,1,s],16:[1,i,0,0,s],17:[1,e,0,i,s],18:[1,1,0,e,s],14:[1,t,0,0,s],15:[1,1,0,t,s],13:[1,1,0,0,s],8:[t,1,0,0,s],19:[1,1,t,0,s],30:[i,1,0,0,s],41:[e,1,i,0,s],52:[1,1,e,0,s],38:[1,e,0,1,s],39:[1,i,0,e,s],40:[1,0,0,i,s],36:[1,t,0,1,s],37:[1,0,0,t,s],35:[1,0,0,1,s],9:[1,0,t,1,s],20:[t,0,0,1,s],31:[1,0,e,1,s],42:[e,0,i,1,s],53:[i,0,0,1,s],12:[0,0,1,0,n],23:[1,1,0,1,n],34:[1,0,1,1,n],45:[0,1,0,0,n]},ig.CollisionMap.staticNoCollision={trace:function(t,i,e,s){return{collision:{x:!1,y:!1,slope:!1},pos:{x:t+e,y:i+s},tile:{x:0,y:0}}}}}),ig.baked=!0,ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(t,i,e){this.parent(t,i),this.setTileset(e)},setTileset:function(t){this.tilesetName=t instanceof ig.Image?t.path:t,this.tiles=new ig.Image(this.tilesetName),this.preRenderedChunks=null},setScreenPos:function(t,i){this.scroll.x=t/this.distance,this.scroll.y=i/this.distance},preRenderMapToChunks:function(){var t=this.width*this.tilesize*ig.system.scale,i=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(t,i),this.chunkSize);var e=Math.ceil(t/this.chunkSize),s=Math.ceil(i/this.chunkSize);this.preRenderedChunks=[];for(var n=0;s>n;n++){this.preRenderedChunks[n]=[];for(var a=0;e>a;a++){var o=a==e-1?t-a*this.chunkSize:this.chunkSize,h=n==s-1?i-n*this.chunkSize:this.chunkSize;this.preRenderedChunks[n][a]=this.preRenderChunk(a,n,o,h)}}},preRenderChunk:function(t,i,e,s){var n=e/this.tilesize/ig.system.scale+1,a=s/this.tilesize/ig.system.scale+1,o=t*this.chunkSize/ig.system.scale%this.tilesize,h=i*this.chunkSize/ig.system.scale%this.tilesize,r=Math.floor(t*this.chunkSize/this.tilesize/ig.system.scale),l=Math.floor(i*this.chunkSize/this.tilesize/ig.system.scale),g=ig.$new("canvas");g.width=e,g.height=s,g.retinaResolutionEnabled=!1;var u=g.getContext("2d");ig.System.scaleMode(g,u);var c=ig.system.context;ig.system.context=u;for(var d=0;n>d;d++)for(var p=0;a>p;p++)if(d+r<this.width&&p+l<this.height){var m=this.data[p+l][d+r];m&&this.tiles.drawTile(d*this.tilesize-o,p*this.tilesize-h,m-1,this.tilesize)}return ig.system.context=c,g},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled())},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var t=ig.system.getDrawPos(this.scroll.x),i=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var e=this.width*this.tilesize*ig.system.scale;t=(t%e+e)%e;var s=this.height*this.tilesize*ig.system.scale;i=(i%s+s)%s}var n=Math.max(Math.floor(t/this.chunkSize),0),a=Math.max(Math.floor(i/this.chunkSize),0),o=Math.ceil((t+ig.system.realWidth)/this.chunkSize),h=Math.ceil((i+ig.system.realHeight)/this.chunkSize),r=this.preRenderedChunks[0].length,l=this.preRenderedChunks.length;this.repeat||(o=Math.min(o,r),h=Math.min(h,l));for(var g=0,u=a;h>u;u++){for(var c=0,d=n;o>d;d++){var p=this.preRenderedChunks[u%l][d%r],m=-t+d*this.chunkSize-c,f=-i+u*this.chunkSize-g;ig.system.context.drawImage(p,m,f),ig.Image.drawCount++,this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(m,f,this.chunkSize,this.chunkSize)),this.repeat&&p.width<this.chunkSize&&m+p.width<ig.system.realWidth&&(c+=this.chunkSize-p.width,o++)}this.repeat&&p.height<this.chunkSize&&f+p.height<ig.system.realHeight&&(g+=this.chunkSize-p.height,h++)}},drawTiled:function(){for(var t=0,i=null,e=(this.scroll.x/this.tilesize).toInt(),s=(this.scroll.y/this.tilesize).toInt(),n=this.scroll.x%this.tilesize,a=this.scroll.y%this.tilesize,o=-n-this.tilesize,h=-a-this.tilesize,r=ig.system.width+this.tilesize-n,l=ig.system.height+this.tilesize-a,g=-1,u=h;l>u;g++,u+=this.tilesize){var c=g+s;if(c>=this.height||0>c){if(!this.repeat)continue;c=(c%this.height+this.height)%this.height}for(var d=-1,p=o;r>p;d++,p+=this.tilesize){var m=d+e;if(m>=this.width||0>m){if(!this.repeat)continue;m=(m%this.width+this.width)%this.width}(t=this.data[c][m])&&((i=this.anims[t-1])?i.draw(p,u):this.tiles.drawTile(p,u,t-1,this.tilesize))}}}})}),ig.baked=!0,ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){return this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX,ig.game=this,null},loadLevel:function(t){this.screen={x:0,y:0},this.entities=[],this.namedEntities={};for(var i=0;i<t.entities.length;i++){var e=t.entities[i];this.spawnEntity(e.type,e.x,e.y,e.settings)}this.sortEntities(),this.collisionMap=ig.CollisionMap.staticNoCollision,this.backgroundMaps=[];for(var i=0;i<t.layer.length;i++){var s=t.layer[i];if("collision"==s.name)this.collisionMap=new ig.CollisionMap(s.tilesize,s.data);else{var n=new ig.BackgroundMap(s.tilesize,s.data,s.tilesetName);n.anims=this.backgroundAnims[s.tilesetName]||{},n.repeat=s.repeat,n.distance=s.distance,
n.foreground=!!s.foreground,n.preRender=!!s.preRender,n.name=s.name,this.backgroundMaps.push(n)}}for(var i=0;i<this.entities.length;i++)this.entities[i].ready()},loadLevelDeferred:function(t){this._levelToLoad=t},getMapByName:function(t){if("collision"==t)return this.collisionMap;for(var i=0;i<this.backgroundMaps.length;i++)if(this.backgroundMaps[i].name==t)return this.backgroundMaps[i];return null},getEntityByName:function(t){return this.namedEntities[t]},getEntitiesByType:function(t){for(var i="string"==typeof t?ig.global[t]:t,e=[],s=0;s<this.entities.length;s++){var n=this.entities[s];n instanceof i&&!n._killed&&e.push(n)}return e},spawnEntity:function(t,i,e,s){var n="string"==typeof t?ig.global[t]:t;if(!n)throw"Can't spawn entity of type "+t;var a=new n(i,e,s||{});return this.entities.push(a),a.name&&(this.namedEntities[a.name]=a),a},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(t){t.name&&delete this.namedEntities[t.name],t._killed=!0,t.type=ig.Entity.TYPE.NONE,t.checkAgainst=ig.Entity.TYPE.NONE,t.collides=ig.Entity.COLLIDES.NEVER,this._deferredKill.push(t)},run:function(){this.update(),this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null),this.updateEntities(),this.checkEntities();for(var t=0;t<this._deferredKill.length;t++)this._deferredKill[t].erase(),this.entities.erase(this._deferredKill[t]);this._deferredKill=[],(this._doSortEntities||this.autoSort)&&(this.sortEntities(),this._doSortEntities=!1);for(var i in this.backgroundAnims){var e=this.backgroundAnims[i];for(var s in e)e[s].update()}},updateEntities:function(){for(var t=0;t<this.entities.length;t++){var i=this.entities[t];i._killed||i.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var t;for(t=0;t<this.backgroundMaps.length;t++){var i=this.backgroundMaps[t];if(i.foreground)break;i.setScreenPos(this.screen.x,this.screen.y),i.draw()}for(this.drawEntities(),t;t<this.backgroundMaps.length;t++){var i=this.backgroundMaps[t];i.setScreenPos(this.screen.x,this.screen.y),i.draw()}},drawEntities:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].draw()},checkEntities:function(){for(var t={},i=0;i<this.entities.length;i++){var e=this.entities[i];if(e.type!=ig.Entity.TYPE.NONE||e.checkAgainst!=ig.Entity.TYPE.NONE||e.collides!=ig.Entity.COLLIDES.NEVER)for(var s={},n=Math.floor(e.pos.x/this.cellSize),a=Math.floor(e.pos.y/this.cellSize),o=Math.floor((e.pos.x+e.size.x)/this.cellSize)+1,h=Math.floor((e.pos.y+e.size.y)/this.cellSize)+1,r=n;o>r;r++)for(var l=a;h>l;l++)if(t[r])if(t[r][l]){for(var g=t[r][l],u=0;u<g.length;u++)e.touches(g[u])&&!s[g[u].id]&&(s[g[u].id]=!0,ig.Entity.checkPair(e,g[u]));g.push(e)}else t[r][l]=[e];else t[r]={},t[r][l]=[e]}}}),ig.Game.SORT={Z_INDEX:function(t,i){return t.zIndex-i.zIndex},POS_X:function(t,i){return t.pos.x+t.size.x-(i.pos.x+i.size.x)},POS_Y:function(t,i){return t.pos.y+t.size.y-(i.pos.y+i.size.y)}}}),ig.baked=!0,ig.module("plusplus.core.timer").requires("impact.timer","plusplus.core.config").defines(function(){"use strict";var t=ig.CONFIG;ig.Timer.minStep=t.MIN_TIME_STEP,ig.Timer.overflow=0,ig.Timer.stepped=!1,ig.Timer.step=function(){var t=Date.now();ig.Timer.overflow+=Math.min((t-ig.Timer._last)/1e3,ig.Timer.maxStep),ig.Timer.overflow>=ig.Timer.minStep?(ig.Timer.overflow-=ig.Timer.minStep,ig.Timer.time+=ig.Timer.minStep*ig.Timer.timeScale,ig.Timer.stepped=!0):ig.Timer.stepped=!1,ig.Timer._last=t}}),ig.baked=!0,ig.module("plusplus.helpers.signals").defines(function(){"use strict";function t(t,i,e,s,n){this._listener=i,this._isOnce=e,this.context=s,this._signal=t,this._priority=n||0}function i(t,i){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",i))}t.prototype={active:!0,params:null,execute:function(t){var i,e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,e),this._isOnce&&this.detach()),i},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},ig.Signal=function(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){ig.Signal.prototype.dispatch.apply(t,arguments)}},ig.Signal.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(i,e,s,n){var a,o=this._indexOfListener(i,s);if(-1!==o){if(a=this._bindings[o],a.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else a=new t(this,i,e,s,n),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(t){var i=this._bindings.length;do--i;while(this._bindings[i]&&t._priority<=this._bindings[i]._priority);this._bindings.splice(i+1,0,t)},_indexOfListener:function(t,i){for(var e,s=this._bindings.length;s--;)if(e=this._bindings[s],e._listener===t&&e.context===i)return s;return-1},has:function(t,i){return-1!==this._indexOfListener(t,i)},add:function(t,e,s){return i(t,"add"),this._registerListener(t,!1,e,s)},addOnce:function(t,e,s){return i(t,"addOnce"),this._registerListener(t,!0,e,s)},remove:function(t,e){i(t,"remove");var s=this._indexOfListener(t,e);return-1!==s&&(this._bindings[s]._destroy(),this._bindings.splice(s,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var i,e=Array.prototype.slice.call(arguments),s=this._bindings.length;if(this.memorize&&(this._prevParams=e),s){i=this._bindings.slice(),this._shouldPropagate=!0;do s--;while(i[s]&&this._shouldPropagate&&i[s].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}}),ig.baked=!0,ig.module("plusplus.core.image").requires("impact.image","plusplus.helpers.signals").defines(function(){"use strict";ig.Image.inject({width:1,height:1,data:null,dataContext:null,dataWidth:1,dataHeight:1,scale:1,scaleOfSystemScale:1,scaleMin:1,scaleMax:1/0,ignoreSystemScale:!1,retainScaledData:!0,scaleCache:null,onLoaded:null,_scale:0,init:function(t,i){ig.merge(this,i),this.onLoaded=new ig.Signal,this.scaleCache={},this.parent(t)},onload:function(t){this.width=Math.max(0|this.data.width,1),this.height=Math.max(0|this.data.height,1),this.loaded=!0;var i=ig.$new("canvas");i.width=this.width,i.height=this.height,i.style.width=this.width+"px",i.style.height=this.height+"px",i.retinaResolutionEnabled=!1;var e=i.getContext("2d");ig.System.scaleMode(i,e),e.drawImage(this.data,0,0),this.data=i,this.dataContext=this.data.getContext("2d"),this.dataWidth=this.data.width,this.dataHeight=this.data.height,this.scaleCache||(this.scaleCache={}),this.scaleCache.x1=this.data,this.loadCallback&&this.loadCallback(this.path,!0),this.onLoaded&&(this.onLoaded.dispatch(this),this.onLoaded.removeAll(),this.onLoaded.forget()),ig.global.wm||!ig.game||ig.game._gameNeedsSetup||ig.game.resizeDeferred(!0)},resize:function(t){var i=this.scaleCache.x1;if(i&&t&&(t=Math.min(Math.max(Math.round(t*this.scaleOfSystemScale),this.scaleMin),this.scaleMax),this._scale!==t))if(this.scale=this._scale=t,this.scaleCache||(this.scaleCache={}),this.data=this.scaleCache["x"+t],this.data)this.dataContext=this.data.getContext("2d"),this.dataWidth=this.data.width,this.dataHeight=this.data.height;else{var e=ig.getImagePixels(i,0,0,this.width,this.height),s=this.width*t|0,n=this.height*t|0,a=this.data=ig.$new("canvas");a.width=s,a.height=n,a.style.width=s+"px",a.style.height=n+"px",a.retinaResolutionEnabled=!1,this.dataWidth=s,this.dataHeight=n;var o=this.dataContext=this.data.getContext("2d");ig.System.scaleMode(a,o);for(var h=o.getImageData(0,0,s,n),r=0;n>r;r++)for(var l=0;s>l;l++){var g=4*(Math.floor(r/t)*this.width+Math.floor(l/t)),u=4*(r*s+l);h.data[u]=e.data[g],h.data[u+1]=e.data[g+1],h.data[u+2]=e.data[g+2],h.data[u+3]=e.data[g+3]}o.putImageData(h,0,0),this.retainScaledData&&(this.scaleCache["x"+t]=this.data)}},draw:function(t,i,e,s,n,a,o){this.data&&(o?this.resize(o):(this.ignoreSystemScale||this._scale===ig.system.scale?this._scale!==this.scale&&this.resize(this.scale):this.resize(ig.system.scale),o=this._scale),n=("undefined"!=typeof n?n:this.width)*o|0,a=("undefined"!=typeof a?a:this.height)*o|0,0!==n&&0!==a&&(e=e?e*o|0:0,s=s?s*o|0:0,ig.system.context.drawImage(this.data,e,s,n,a,ig.system.getDrawPos(t),ig.system.getDrawPos(i),n,a),ig.Image.drawCount++))},drawTile:function(t,i,e,s,n,a,o,h){if(n=n?n:s,!(!this.data||s>this.width||n>this.height)){h?this.resize(h):(this.ignoreSystemScale||this._scale===ig.system.scale?this._scale!==this.scale&&this.resize(this.scale):this.resize(ig.system.scale),h=this._scale);var r,l,g,u,c=Math.floor(s*h),d=Math.floor(n*h);a?(r=-1,g=c):(r=1,g=0),o?(l=-1,u=d):(l=1,u=0),a||o?(ig.system.context.save(),ig.system.context.scale(r,l),ig.system.context.drawImage(this.data,Math.floor(e*s)%this.width*h,Math.floor(e*s/this.width)*n*h,c,d,ig.system.getDrawPos(t)*r-g,ig.system.getDrawPos(i)*l-u,c,d),ig.system.context.restore()):ig.system.context.drawImage(this.data,Math.floor(e*s)%this.width*h,Math.floor(e*s/this.width)*n*h,c,d,ig.system.getDrawPos(t)*r-g,ig.system.getDrawPos(i)*l-u,c,d),ig.Image.drawCount++}}}),ig.global.wm&&ig.Image.inject({resize:function(t){if(t&&this._scale!==t){var i=this.scaleCache.x1;i||(this.scaleCache.x1=this.data),this.parent(t)}},draw:function(t,i,e,s,n,a,o){o||(o=ig.system.scale),this.parent(t,i,e,s,n,a,o)},drawTile:function(t,i,e,s,n,a,o,h){h||(h=ig.system.scale),this.parent(t,i,e,s,n,a,o,h)}})}),ig.baked=!0,ig.module("plusplus.core.font").requires("impact.font","plusplus.core.config","plusplus.core.image").defines(function(){"use strict";var t=ig.CONFIG;ig.Font.inject({scale:t.FONT.SCALE,scaleOfSystemScale:t.FONT.SCALE_OF_SYSTEM_SCALE,scaleMin:t.FONT.SCALE_MIN,scaleMax:t.FONT.SCALE_MAX,ignoreSystemScale:t.FONT.IGNORE_SYSTEM_SCALE,multilineForWidth:function(t,i){t=""+t;var e="",s=0,n=" ",a="",o=t.split(n);t.replace("\n",a);for(var h=0,r=o.length;r>h;h++){var l=o[h]+(h!==r-1?n:a),g=this._widthForLine(l);0!==s&&s+g>i&&(e+="\n",s=0),e+=l,s+=g}return e},overflowForHeight:function(t,i){t=""+t;var e=t,s="",n=t.split("\n"),a=n.length*(this.height+this.lineSpacing);if(a>i){var o=Math.floor(n.length*i/a);e="";for(var h=0,r=n.length;r>h;h++){var l=n[h];o>h?(e+=l,o-1>h&&(e+="\n")):(s+=l,r-1>h&&(s+="\n"))}}return{display:e,overflow:s}},draw:function(t,i,e,s,n,a,o,h){if(this.loaded){if(t=""+t,!h){if(n=n||ig.system.context,a){var r=this.scale;this.resize(a),this.scale=r}else this.ignoreSystemScale||this._scale===ig.system.scale?this._scale!==this.scale&&this.resize(this.scale):this.resize(ig.system.scale),a=this._scale;if(o=n===ig.system.context?a/ig.system.scale:1,-1!==t.indexOf("\n")){for(var l=t.split("\n"),g=(this.height+this.lineSpacing)*o,u=0,c=l.length;c>u;u++)this.draw(l[u],i,e+u*g,s,n,a,o,!0);return}}s===ig.Font.ALIGN.CENTER?i-=.5*this._widthForLine(t):s===ig.Font.ALIGN.RIGHT&&(i-=this._widthForLine(t)),1!==this.alpha&&(n.globalAlpha=this.alpha);for(var u=0;u<t.length;u++){var d=t.charCodeAt(u)-this.firstChar;i+=this._drawChar(d,i,e,n,a)*o}1!==this.alpha&&(n.globalAlpha=1),ig.Image.drawCount+=t.length}},_drawChar:function(t,i,e,s,n){var a=this.widthMap[t],o=this.height-2;return s===ig.system.context?s.drawImage(this.data,this.indices[t]*n,0,a*n,o*n,ig.system.getDrawPos(i),ig.system.getDrawPos(e),a*n,o*n):s.drawImage(this.data,this.indices[t]*n,0,a*n,o*n,i*n,e*n,a*n,o*n),a+this.letterSpacing}}),ig.Font.FONTS={},ig.Font.FONTS.MAIN=t.FONT.MAIN_PATH?new ig.Font(t.FONT.MAIN_PATH):null,ig.Font.FONTS.ALT=t.FONT.ALT_PATH?new ig.Font(t.FONT.ALT_PATH):ig.Font.FONTS.MAIN,ig.Font.FONTS.CHAT=t.FONT.CHAT_PATH?new ig.Font(t.FONT.CHAT_PATH):ig.Font.FONTS.MAIN}),ig.baked=!0,ig.module("plusplus.core.image-drawing").requires("plusplus.core.image").defines(function(){"use strict";ig.ImageDrawing=ig.Image.extend({loaded:!0,init:function(t){ig.merge(this,t),this.data=ig.$new("canvas"),this.dataContext=this.data.getContext("2d"),this.dataWidth=this.width*this.scale|0,this.dataHeight=this.height*this.scale|0,this.data.width=this.dataWidth,this.data.height=this.dataHeight,this.data.style.width=this.dataWidth+"px",this.data.style.height=this.dataHeight+"px",this.data.retinaResolutionEnabled=!1,ig.System.scaleMode(this.data,this.dataContext),this.scaleCache={},this.scaleCache.x1=this.data},load:function(){},reload:function(){},onload:function(){},setWidth:function(t){this.setDimensions(t,this.height)},setHeight:function(t){this.setDimensions(this.width,t)},setDimensions:function(t,i){this.width=Math.max(0|t,1),this.height=Math.max(0|i,1),this.data&&(this.dataWidth=this.data.width=this.width,this.dataHeight=this.data.height=this.height,ig.System.scaleMode(this.data,this.dataContext))},finalize:function(t){this.data&&(t?this.scale=this._scale=Math.min(Math.max(Math.round(t*this.scaleOfSystemScale),this.scaleMin),this.scaleMax):this._scale=t=1,this.scaleCache={},this.scaleCache["x"+t]=this.data,this.dataContext=this.data.getContext("2d"),this.dataWidth=this.data.width,this.dataHeight=this.data.height,this.width=Math.max(this.dataWidth/t|0,1),this.height=Math.max(this.dataHeight/t|0,1))}})}),ig.baked=!0,ig.module("plusplus.helpers.shims").defines(function(){"use strict";"function"!=typeof Date.now&&(Date.now=function(){return+new Date})}),ig.baked=!0,ig.module("plusplus.helpers.utils").requires("plusplus.helpers.shims","plusplus.core.config").defines(function(){"use strict";var t=ig.global,i=ig.CONFIG;ig.utils={},ig.utils.type=function(t){return null==t?t+"":Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},ig.utils.isNumber=function(t){return!isNaN(t)&&isFinite(t)&&"boolean"!=typeof t},ig.utils.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},ig.utils.toArray=function(t){return t?ig.utils.isArray(t)!==!0?[t]:t:[]},ig.utils.toNotArray=function(t,i){return ig.utils.isArray(t)===!0?t[i||0]:t},ig.utils.arrayCautiousAdd=function(t,i){var e=ig.utils.indexOfValue(t,i);return-1===e&&t.push(i),t},ig.utils.arrayCautiousAddMulti=function(t,i){var e,s;i=ig.utils.toArray(i);for(var n=0,a=i.length;a>n;n++)e=i[n],e!==t&&(s=ig.utils.indexOfValue(t,e),-1===s&&t.push(e));return t},ig.utils.arrayCautiousRemove=function(t,i){var e=ig.utils.indexOfValue(t,i);return-1!==e&&t.splice(e,1),t},ig.utils.arrayCautiousRemoveMulti=function(t,i){var e,s;i=ig.utils.toArray(i);for(var n=0,a=i.length;a>n;n++)e=i[n],e!==t&&(s=ig.utils.indexOfValue(t,e),-1!==s&&t.splice(s,1));return t},ig.utils.forEach=function(t,i,e){for(var s=0,n=t.length;n>s;s++)i.apply(t[s],e)},ig.utils.indexOfValue=function(t,i){for(var e=0,s=t.length;s>e;e++)if(i===t[e])return e;return-1},ig.utils.indexOfProperty=function(t,i,e){for(var s=0,n=t.length;n>s;s++)if(e===t[s][i])return s;return-1},ig.utils.indexOfProperties=function(t,i,e){for(var s=0,n=t.length;n>s;s++){for(var a=t[s],o=!1,h=0,r=i.length;r>h;h++)if(e[h]!==a[i[h]]){o=!0;break}if(o!==!0)return s}return-1},ig.utils.throttle=function(e,s,n){function a(){function i(){h=Date.now(),e.apply(a,l)}var a=this,r=Date.now()-h,l=arguments;r>s?(o&&t.clearTimeout(o),i()):n!==!1&&(o&&t.clearTimeout(o),o=t.setTimeout(i,s-r))}var o,h=0;return ig.utils.isNumber(s)!==!0&&(s=i.DURATION_THROTTLE),a},ig.utils.debounce=function(e,s){function n(){var i=this,n=arguments;a&&t.clearTimeout(a),a=t.setTimeout(function(){e.apply(i,n)},s)}var a;return ig.utils.isNumber(s)!==!0&&(s=i.DURATION_THROTTLE),n};var e=Math.pow(2,32);ig.utils.getType=function(t,i,s){s=s||"TYPE";var n,a=t[s],o=s+"_LAST";if(t[o]&&a||(t[o]=1,a=t[s]={}),i=i.toUpperCase(),n=a[i],!n){n=0;for(var h=t[o],r=i.split(" "),l=0,g=r.length;g>l;l++){var u=r[l],c=a[u];if(!c){if(h>=e)throw new TypeError("Bitwise flag out of range / above 32 bits!");c=a[u]=h,t[o]=2*h}n|=c}a[i]=n}return n},ig.utils.addType=function(t,i,e,s,n){i[e]|=ig.utils.getType(t,s,n)}}),ig.baked=!0,ig.module("plusplus.core.background-map").requires("impact.background-map","plusplus.core.config","plusplus.core.image-drawing","plusplus.helpers.utils").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils;ig.BackgroundMapExtended=ig.BackgroundMap.extend({preRenderedScale:0,mergedMaps:[],parallaxX:t.BACKGROUNDS_PARALLAX_X,parallaxY:t.BACKGROUNDS_PARALLAX_Y,setScreenPos:function(t,i){this.scroll.x=this.parallaxX?t/this.distance:t,this.scroll.y=this.parallaxY?i/this.distance:i},setTileset:function(t){t instanceof ig.ImageDrawing?this.tiles=t:(this.tilesetName=t instanceof ig.Image?t.path:t,this.tiles=new ig.Image(this.tilesetName)),this.preRenderedChunks=null},merge:function(t){return this.preRender&&!this.repeat&&t instanceof ig.BackgroundMap&&t.preRender&&!t.repeat&&t.distance===this.distance?(i.arrayCautiousAdd(this.mergedMaps,t),this.preRenderedChunks=null,!0):!1},preRenderMapToChunks:function(){if(this.preRenderedScale=ig.system.scale,this.mergedMaps.length>0){this.preRenderedChunks=[];for(var t=[this].concat(this.mergedMaps),i=0,e=0,s=0,n=0,a=0,o=t.length;o>a;a++){var h=t[a];i=Math.max(i,h.width*h.tilesize*ig.system.scale),e=Math.max(e,h.height*h.tilesize*ig.system.scale),s=Math.max(i,e),n=Math.max(n,Math.min(s,h.chunkSize))}for(var r=Math.ceil(i/n),l=Math.ceil(e/n),g=0;l>g;g++)for(var u=this.preRenderedChunks[g]=this.preRenderedChunks[g]||[],c=0;r>c;c++){var d=c===r-1?i-c*n:n,p=g===l-1?e-g*n:n;u[c]=this.preRenderMergedChunk(t,n,c,g,d,p)}}else this.parent()},preRenderMergedChunk:function(t,i,e,s,n,a){var o=ig.$new("canvas");o.width=n,o.height=a,o.style.width=n+"px",o.style.height=a+"px",o.retinaResolutionEnabled=!1;var h=ig.system.context,r=o.getContext("2d");ig.System.scaleMode(o,r),ig.system.context=r;for(var l=0,g=t.length;g>l;l++)this.preRenderChunk(e,s,n,a,t[l],i,o);return ig.system.context=h,o},preRenderChunk:function(t,i,e,s,n,a,o){n=n||this,a=a||this.chunkSize;var h;if(!o){o=ig.$new("canvas"),o.width=e,o.height=s,o.style.width=e+"px",o.style.height=s+"px",o.retinaResolutionEnabled=!1;var r=o.getContext("2d");ig.System.scaleMode(o,r),h=ig.system.context,ig.system.context=r}for(var l=e/n.tilesize/ig.system.scale+1,g=s/n.tilesize/ig.system.scale+1,u=t*a/ig.system.scale%n.tilesize,c=i*a/ig.system.scale%n.tilesize,d=Math.floor(t*a/n.tilesize/ig.system.scale),p=Math.floor(i*a/n.tilesize/ig.system.scale),m=0;l>m;m++)for(var f=0;g>f;f++)if(m+d<n.width&&f+p<n.height){var y=n.data[f+p][m+d];y&&n.tiles.drawTile(m*n.tilesize-u,f*n.tilesize-c,y-1,n.tilesize)}return h&&(ig.system.context=h),o},draw:function(){this.setScreenPos(ig.game.screen.x,ig.game.screen.y),this.tiles.loaded&&this.enabled&&(this.preRender?(this.preRenderedScale!==ig.system.scale&&(this.preRenderedChunks=null),this.drawPreRendered()):this.drawTiled())}})}),ig.baked=!0,ig.module("plusplus.core.collision-map").requires("impact.collision-map","plusplus.core.config").defines(function(){"use strict";var t=ig.CONFIG;ig.CollisionMap.inject({trace:function(t,i,e,s,n,a,o){o.collision.x=o.collision.y=o.collision.slope=!1,o.pos.x=t,o.pos.y=i,o.tile.x=o.tile.y=0;var h=Math.ceil(Math.max(Math.abs(e),Math.abs(s))/this.tilesize);if(h>1)for(var r=e/h,l=s/h,g=0;h>g&&(r||l)&&(this._traceStep(o,t,i,r,l,n,a,e,s,g),t=o.pos.x,i=o.pos.y,o.collision.x&&(r=0,e=0),o.collision.y&&(l=0,s=0),!o.collision.slope);g++);else this._traceStep(o,t,i,e,s,n,a,e,s,0);return o},_traceStep:function(t,i,e,s,n,a,o,h,r,l){t.pos.x+=s,t.pos.y+=n;var g,u,c,d,p,m=0;if(s){var f=s>0?a:0,y=0>s?this.tilesize:0,E=Math.max(Math.floor(e/this.tilesize),0),v=Math.min(Math.ceil((e+o)/this.tilesize),this.height),T=Math.floor((t.pos.x+f)/this.tilesize),A=Math.floor((i+f)/this.tilesize);if((l>0||T==A||0>A||A>=this.width)&&(A=-1),T>=0&&T<this.width)for(var _=E;v>_&&!(-1!=A&&(m=this.data[_][A],m>1&&m<=this.lastSlope&&this._checkTileDef(t,m,i,e,h,r,a,o,A,_)&&0!==t.slope.ny));_++)if(m=this.data[_][T],1==m||m>this.lastSlope||m>1&&this._checkTileDef(t,m,i,e,h,r,a,o,T,_)){if(t.tile.x=m,t.tile.xPos.x=T,t.tile.xPos.y=_,m>1&&m<=this.lastSlope&&t.collision.slope){g=!0,u=t.slope.x,c=t.slope.y,d=t.slope.nx,p=t.slope.ny;break}t.collision.x=!0,i=t.pos.x=T*this.tilesize-f+y,h=0;break}}if(n){var I=n>0?o:0,x=0>n?this.tilesize:0,C=Math.max(Math.floor(t.pos.x/this.tilesize),0),S=Math.min(Math.ceil((t.pos.x+a)/this.tilesize),this.width),_=Math.floor((t.pos.y+I)/this.tilesize),w=Math.floor((e+I)/this.tilesize);if((l>0||_==w||0>w||w>=this.height)&&(w=-1),_>=0&&_<this.height)for(var T=C;S>T&&!(-1!=w&&(m=this.data[w][T],m>1&&m<=this.lastSlope&&this._checkTileDef(t,m,i,e,h,r,a,o,T,w)&&0!==t.slope.nx));T++)if(m=this.data[_][T],1==m||m>this.lastSlope||m>1&&this._checkTileDef(t,m,i,e,h,r,a,o,T,_)){if(t.tile.y=m,t.tile.yPos.x=T,t.tile.yPos.y=_,m>1&&m<=this.lastSlope&&t.collision.slope)break;t.collision.y=!0,t.pos.y=_*this.tilesize-I+x;break}}g&&(t.slope.x=u,t.slope.y=c,t.slope.nx=d,t.slope.ny=p)},_checkTileDef:function(t,i,e,s,n,a,o,h,r,l){var g=this.tiledef[i];if(!g)return!1;var u=(r+g[0])*this.tilesize,c=(l+g[1])*this.tilesize,d=(g[2]-g[0])*this.tilesize,p=(g[3]-g[1])*this.tilesize,m=g[4],f=e+n+(0>p?o:0)-u,y=s+a+(d>0?h:0)-c;if(d*y-p*f>0){if(0>n*-p+a*d)return m;var E=Math.sqrt(d*d+p*p),v=p/E,T=-d/E,A=f*v+y*T,_=v*A,I=T*A;return _*_+I*I>=n*n+a*a?m||.5>d*(y-a)-p*(f-n):(t.pos.x=e+n-_,t.pos.y=s+a-I,t.collision.slope=!0,t.slope.x=d,t.slope.y=p,t.slope.nx=v,t.slope.ny=T,!0)}}});var i=ig.CollisionMap.defaultTileDef,e=!0,s=!1;for(var n in t.COLLISION.TILES_HASH_WALKABLE_STRICT)i[n]=null;i[t.COLLISION.TILE_SOLID]=[0,0,1,0,e],i[t.COLLISION.TILE_CLIMBABLE_WITH_TOP]=[0,0,1,0,s],i[t.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP]=[0,0,1,0,s]}),ig.baked=!0,ig.module("plusplus.core.pathfinding-map").requires("impact.map","plusplus.core.config","plusplus.core.image").defines(function(){"use strict";var t=ig.CONFIG;ig.PathfindingMap=ig.Map.extend({tiledef:null,init:function(i,e,s){this.parent(i,e),this.tiledef=s||t.PATHFINDING.TILE_DEF}})}),ig.baked=!0,ig.module("plusplus.core.animation").requires("impact.animation","plusplus.core.config","plusplus.core.image","plusplus.core.image-drawing","plusplus.helpers.signals").defines(function(){"use strict";ig.CONFIG,ig.AnimationSheet.inject({init:function(t,i,e){(!i||0>i)&&(i=this.width),(!e||0>e)&&(e=this.height),this.parent(t,i,e)}}),ig.AnimationExtended=ig.Animation.extend({frameTime:1,sequence:[],pivot:null,stop:!1,changed:!1,once:!1,reverse:!1,texturing:null,textureWidth:0,textureHeight:0,opaqueOffset:null,onCompleted:null,_texturingDeferred:!1,init:function(t,i){this.sheet=t,this.pivot={x:.5*t.width,y:.5*t.height},ig.merge(this,i),this.tile=this.sequence[0],this.timer=new ig.Timer,this.onCompleted=new ig.Signal},getDuration:function(){return this.frameTime*this.sequence.length},texturize:function(t){if(this.sheet.image.loaded){var i=this.sheet.image.scaleCache&&this.sheet.image.scaleCache.x1||this.sheet.image.data,e=t.getSizeDrawX(),s=t.getSizeDrawY(),n=this.sheet.width,a=this.sheet.height,o=this.textureWidth!==e||this.textureHeight!==s;if(e>n||s>a){this.texturing=t,this.texturing.textures=this.texturing.textures||{},this.texturing.texturedAnimsCount=(this.texturing.texturedAnimsCount||0)+1;for(var h=0,r=this.sequence.length;r>h;h++){var l,g=this.sequence[h],u=this.texturing.textures[g];if(u?o&&(u.setDimensions(e,s),l=!0):(u=this.texturing.textures[g]=new ig.ImageDrawing({width:e,height:s}),l=!0),l){var c=ig.$new("canvas");c.width=n,c.height=a,c.style.width=n+"px",c.style.height=a+"px",c.retinaResolutionEnabled=!1;var d=c.getContext("2d");ig.System.scaleMode(c,d),d.drawImage(i,-Math.floor(g*n)%i.width,-Math.floor(g*a/i.width)*a),u.dataContext.fillStyle=u.dataContext.createPattern(c,"repeat"),u.dataContext.fillRect(0,0,e,s),u.finalize()}}this.textureWidth=e,this.textureHeight=s}}else this._texturingDeferred=t,this.sheet.image.onLoaded.remove(this._texturizeDeferred,this),this.sheet.image.onLoaded.addOnce(this._texturizeDeferred,this)},_texturizeDeferred:function(){this.texturize(this._texturingDeferred),this._texturingDeferred=void 0},detexturize:function(){this.texturing&&(this.texturing.texturedAnimsCount=Math.max(0,this.texturing.texturedAnimsCount-1),this.texturing.texturedAnimsCount||(this.texturing.textures=void 0),this.sheet.image.onLoaded.remove(this._texturizeDeferred,this),this.texturing=this.textureWidth=this.textureHeight=this._texturingDeferred=void 0)},playFromStart:function(t,i){this.stop=!1,this.rewind(t,i)},rewind:function(t,i){return this.once="undefined"!=typeof t?t:this.once,this.reverse="undefined"!=typeof i?i:this.reverse,this.parent()},gotoFrame:function(t){var i=this.stop;this.stop=!1,this.parent(t),this.stop=i},update:function(){if(!this.stop){var t=this.loopCount,i=this.sequence.length,e=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(e/i),this.reverse?this.frame=this.sequence.length-1-e%i:this.frame=e%i,this.loopCount>t&&(this.once&&(this.once=!1,this.stop=!0,this.frame=i-1),this.onCompleted.dispatch());var s=this.tile;this.tile=this.sequence[this.frame],i>1&&this.tile!==s?this.changed=!0:this.changed=!1}},draw:function(t,i,e,s){if(1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha),s=s||this.texturing){(this.texturing!==s||this.textureWidth!==this.texturing.sizeDraw.x||this.textureHeight!==this.texturing.sizeDraw.y)&&this.texturize(s);var n=this.texturing&&this.texturing.textures&&this.texturing.textures[this.tile];if(!n)return this.draw(t,i,e);n.draw(t,i,void 0,void 0,void 0,void 0,e)}else 0===this.angle?this.sheet.image.drawTile(t,i,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y,e):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(t+this.pivot.x),ig.system.getDrawPos(i+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y,e),ig.system.context.restore());1!==this.alpha&&(ig.system.context.globalAlpha=1)}}),ig.global.wm&&ig.AnimationExtended.inject({computeDrawCount:5,computeDrawCountMax:5,draw:function(t,i){this.texturing&&(this.computeDrawCount>=this.computeDrawCountMax?(this.computeDrawCount=0,this.texturing.recordChanges(!0),(this.textureWidth*ig.system.scale!==this.texturing.getSizeDrawX()*ig.system.scale||this.textureHeight*ig.system.scale!==this.texturing.getSizeDrawY()*ig.system.scale)&&this.texturize(this.texturing)):this.computeDrawCount++),this.parent(t,i)}})}),ig.baked=!0,ig.module("plusplus.helpers.tweens").requires("plusplus.core.config").defines(function(){"use strict";var t=ig.CONFIG,i=i||function(){var t=[],i=!1;return{REVISION:"9",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){i?e.pause():e.unpause(),t.push(e)},remove:function(i){var e=t.indexOf(i);-1!==e&&t.splice(e,1)},pause:function(){if(!i){i=!0;for(var e=0,s=t.length;s>e;e++)t[e].pause()}},unpause:function(){if(i){i=!1;for(var e=0,s=t.length;s>e;e++)t[e].unpause()}},update:function(e){if(0===t.length||i)return!1;var s=0,n=t.length;for(e=void 0!==e?e:void 0!==ig.global.performance&&void 0!==ig.global.performance.now?ig.global.performance.now():Date.now();n>s;){var a=t[s];a.update(e)?s++:(t.splice(s,1),n--)}return!0}}}();i.Tween=function(e){var s=e,n={},a={},o={},h=t.DURATION_TWEEN,r=0,l=0,g=null,u=!1,c=0,d=i.Easing.Linear.None,p=i.Interpolation.Linear,m=[],f=null,y=!1,E=null,v=null;this.to=function(t,i){return void 0!==i&&(h=i),a=t,this},this.start=function(t){i.add(this),y=!1,g=void 0!==t?t:void 0!==ig.global.performance&&void 0!==ig.global.performance.now?ig.global.performance.now():Date.now(),g+=l;for(var e in a)if(e in s!=0&&null!==s[e]){if(a[e]instanceof Array){if(0===a[e].length)continue;a[e]=[s[e]].concat(a[e])}n[e]=s[e],n[e]instanceof Array==0&&(n[e]*=1),o[e]=n[e]}return this},this.stop=function(){return i.remove(this),this},this.pause=function(){return u||(u=!0,c=void 0!==ig.global.performance&&void 0!==ig.global.performance.now?ig.global.performance.now():Date.now()),this},this.unpause=function(){return u&&(u=!1,g+=(void 0!==ig.global.performance&&void 0!==ig.global.performance.now?ig.global.performance.now():Date.now())-c,c=0),this},this.delay=function(t){return l=t,this},this.repeat=function(t){return r=t,this},this.easing=function(t){return"function"==typeof t&&(d=t),this},this.interpolation=function(t){return"function"==typeof easing&&(p=t),this},this.chain=function(){return m=arguments,this},this.onStart=function(t){return f=t,this},this.onUpdate=function(t){return E=t,this},this.onComplete=function(t){return v=t,this},this.update=function(t){if(u||g>t)return!0;y===!1&&(f&&f.call(s),y=!0);var i=(t-g)/h;i=i>1?1:i;var e=d(i);for(var c in n){var T=n[c],A=a[c];A instanceof Array?s[c]=p(A,e):s[c]=T+(A-T)*e}if(E&&E.call(s,e),1==i){if(r>0){isFinite(r)&&r--;for(var c in o)n[c]=o[c];return g=t+l,!0}v&&v.call(s);for(var _=0,I=m.length;I>_;_++)m[_].start(t);return!1}return!0}},i.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=s/4):i=s*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)))},Out:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=s/4):i=s*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/s)+1)},InOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=s/4):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?-.5*(e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)):e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}},Back:{In:function(t){var i=1.70158;return t*t*((i+1)*t-i)},Out:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},InOut:function(t){var i=2.5949095;return(t*=2)<1?.5*(t*t*((i+1)*t-i)):.5*((t-=2)*t*((i+1)*t+i)+2)}},Bounce:{In:function(t){return 1-i.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*i.Easing.Bounce.In(2*t):.5*i.Easing.Bounce.Out(2*t-1)+.5}}},i.Interpolation={Linear:function(t,e){var s=t.length-1,n=s*e,a=Math.floor(n),o=i.Interpolation.Utils.Linear;return 0>e?o(t[0],t[1],n):e>1?o(t[s],t[s-1],s-n):o(t[a],t[a+1>s?s:a+1],n-a);
},Bezier:function(t,e){var s,n=0,a=t.length-1,o=Math.pow,h=i.Interpolation.Utils.Bernstein;for(s=0;a>=s;s++)n+=o(1-e,a-s)*o(e,s)*t[s]*h(a,s);return n},CatmullRom:function(t,e){var s=t.length-1,n=s*e,a=Math.floor(n),o=i.Interpolation.Utils.CatmullRom;return t[0]===t[s]?(0>e&&(a=Math.floor(n=s*(1+e))),o(t[(a-1+s)%s],t[a],t[(a+1)%s],t[(a+2)%s],n-a)):0>e?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[s]-(o(t[s],t[s],t[s-1],t[s-1],n-s)-t[s]):o(t[a?a-1:0],t[a],t[a+1>s?s:a+1],t[a+2>s?s:a+2],n-a)},Utils:{Linear:function(t,i,e){return(i-t)*e+t},Bernstein:function(t,e){var s=i.Interpolation.Utils.Factorial;return s(t)/s(e)/s(t-e)},Factorial:function(){var t=[1];return function(i){var e,s=1;if(t[i])return t[i];for(e=i;e>1;e--)s*=e;return t[i]=s}}(),CatmullRom:function(t,i,e,s,n){var a=.5*(e-t),o=.5*(s-i),h=n*n,r=n*h;return(2*i-2*e+a+o)*r+(-3*i+3*e-2*a-o)*h+a*n+i}}},ig.TWEEN=i,ig.TWEEN.Tween,ig.TWEEN.tween=function(t,i,e){e=e||{},e.tween&&e.tween.stop();var s=new ig.TWEEN.Tween(t).to(i,e.duration).easing(e.easing).onStart(e.onStart).onUpdate(e.onUpdate).onComplete(e.onComplete);return e.stopped||s.start(),s}}),ig.baked=!0,ig.module("plusplus.helpers.utilsvector2").requires("plusplus.core.config","plusplus.helpers.utilsmath").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utilsmath;ig.utilsvector2={},ig.utilsvector2.vector=function(t,i,e){return e=e||{},ig.utilsvector2.set(e,t||0,i||0),e},ig.utilsvector2.set=function(t,i,e){return t.x=i,t.y=e,t},ig.utilsvector2.setScalar=function(t,i){return t.x=i,t.y=i,t},ig.utilsvector2.clone=function(t){return ig.utilsvector2.vector(t.x,t.y)},ig.utilsvector2.copy=function(t,i){return t.x=i.x,t.y=i.y,t},ig.utilsvector2.zero=function(t){return t.x=0,t.y=0,t},ig.utilsvector2.isZero=function(t){return 0===t.x&&0===t.y},ig.utilsvector2.isAlmostZero=function(e){return i.almostEqual(e.x,0,t.PRECISION_ZERO)&&i.almostEqual(e.y,0,t.PRECISION_ZERO)},ig.utilsvector2.equal=function(t,i){return t.x===i.x&&t.y===i.y},ig.utilsvector2.inverse=function(t){return t.x=-t.x,t.y=-t.y,t},ig.utilsvector2.add=function(t,i){return t.x+=i.x,t.y+=i.y,t},ig.utilsvector2.addVectors=function(t,i){return{x:t.x+i.x,y:t.y+i.y}},ig.utilsvector2.addScalar=function(t,i){return t.x+=i,t.y+=i,t},ig.utilsvector2.subtract=function(t,i){return t.x-=i.x,t.y-=i.y,t},ig.utilsvector2.subtractVectors=function(t,i){return{x:t.x-i.x,y:t.y-i.y}},ig.utilsvector2.subtractScalar=function(t,i){return t.x-=i,t.y-=i,t},ig.utilsvector2.multiply=function(t,i){return t.x*=i.x,t.y*=i.y,t},ig.utilsvector2.multiplyVectors=function(t,i){return{x:t.x*i.x,y:t.y*i.y}},ig.utilsvector2.multiplyScalar=function(t,i){return t.x*=i,t.y*=i,t},ig.utilsvector2.divide=function(t,i){return t.x/=i.x,t.y/=i.y,t},ig.utilsvector2.divideVectors=function(t,i){return{x:t.x/i.x,y:t.y/i.y}},ig.utilsvector2.divideScalar=function(t,i){return t.x/=i,t.y/=i,t},ig.utilsvector2.min=function(t,i){return{x:t.x<i.x?t.x:i.x,y:t.y<i.y?t.y:i.y}},ig.utilsvector2.max=function(t,i){return{x:t.x>i.x?t.x:i.x,y:t.y>i.y?t.y:i.y}},ig.utilsvector2.abs=function(t){return t.x<0&&(t.x=-t.x),t.y<0&&(t.y=-t.y),t},ig.utilsvector2.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ig.utilsvector2.lengthSquared=function(t){return t.x*t.x+t.y*t.y},ig.utilsvector2.normalize=function(t){var i=ig.utilsvector2.length(t);if(i>=Number.MIN_VALUE){var e=1/i;t.x*=e,t.y*=e}return t},ig.utilsvector2.dot=function(t,i){return t.x*i.x+t.y*i.y},ig.utilsvector2.cross=function(t,i){return t.x*i.y-t.y*i.x},ig.utilsvector2.crossVF=function(t,i){var e=t.x;return t.x=i*t.y,t.y=-i*e,t},ig.utilsvector2.crossFV=function(t,i){var e=t.x;return t.x=-i*t.y,t.y=i*e,t},ig.utilsvector2.rotate=function(t,i,e,s){var n=Math.sin(i),a=Math.cos(i),o=t.x-e,h=t.y-s;return t.x=e+o*a-h*n,t.y=s+o*n+h*a,t},ig.utilsvector2.projectPoints=function(t,i,e,s,n,a,o,h){i=i||0,e=e||0,s=s||1,n=n||1,a=a||0;var r,l,g,u,c=[];if(0!==a)for(o=o||0,h=h||0,r=0,l=t.length;l>r;r++)g=t[r],u=ig.utilsvector2.rotate(g,a,o,h),c[r]={x:u.x*s+i,y:u.y*n+e};else for(r=0,l=t.length;l>r;r++)g=t[r],c[r]={x:g.x*s+i,y:g.y*n+e};return c},ig.utilsvector2.centerOfPoints=function(t){for(var i,e=0,s=0,n=0,a=t.length;a>n;n++)i=t[n],e+=i.x,s+=i.y;return{x:e/a,y:s/a}},ig.utilsvector2.pointsCW=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(i.y-t.y)*(e.x-t.x)},ig.utilsvector2.radianBetweenPoints=function(t,i,e){var s=i.x-t.x,n=i.y-t.y,a=i.x-e.x,o=i.y-e.y,h=s*a+n*o,r=s*o-n*a,l=Math.atan2(r,h);return l},ig.utilsvector2.pointsToConvexHull=function(t){if(t.length<3)return t;var i,e,s,n=0,a=t[n];for(i=1,e=t.length;e>i;i++)s=t[i],s.y===a.y?s.x<a.x&&(n=i,a=s):s.y<a.y&&(n=i,a=s);var o,h=[];for(i=0,e=t.length;e>i;i++)i!==n&&(s=t[i],o={x:s.x,y:s.y},o.angle=Math.atan((s.y-a.y)/(s.x-a.x)),o.angle<0&&(o.angle+=Math.PI),o.distance=(s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y),o.index=i,h.push(o));h.sort(function(t,i){return t.angle<i.angle?-1:t.angle>i.angle?1:t.distance<i.distance?-1:t.distance>i.distance?1:0}),h.unshift(h[h.length-1],{x:a.x,y:a.y,index:n});var r,l=2;for(i=3,e=t.length;e>=i;i++){for(;ig.utilsvector2.pointsCW(h[l-1],h[l],h[i])<=0;)l--;l++,r=h[i],h[i]=h[l],h[l]=r}var g=[];for(i=0;l>=i;i++)g[i]=t[h[i].index];return g},ig.utilsvector2.Q_1=1,ig.utilsvector2.Q_2=4,ig.utilsvector2.Q_3=8,ig.utilsvector2.Q_4=16,ig.utilsvector2.pointQuadrant=function(t,i,e,s){var n,a=e-t,o=s-i;return 0===a&&0===o?n=ig.utilsvector2.Q_1|ig.utilsvector2.Q_2|ig.utilsvector2.Q_3|ig.utilsvector2.Q_4:0===a?n=0>o?ig.utilsvector2.Q_3|ig.utilsvector2.Q_4:ig.utilsvector2.Q_1|ig.utilsvector2.Q_2:0===o?n=0>a?ig.utilsvector2.Q_2|ig.utilsvector2.Q_4:ig.utilsvector2.Q_1|ig.utilsvector2.Q_3:(n=1,0>a&&(n=2),0>o&&(n+=2),n=1<<n),n},ig.utilsvector2.directionThreshold=function(t,e,s){return e=e||0,s=s||0,e>s?(0!==t.y&&i.almostEqual(t.x,0,e)&&(t.x=0),0!==t.x&&i.almostEqual(t.y,0,s)&&(t.y=0)):(0!==t.x&&i.almostEqual(t.y,0,s)&&(t.y=0),0!==t.y&&i.almostEqual(t.x,0,e)&&(t.x=0)),t},ig.utilsvector2.directionToString=function(t){var e=i.direction(t.x),s=i.direction(t.y);for(var n in ig.utilsvector2.DIRECTION){var a=ig.utilsvector2.DIRECTION[n];if(a.x===e&&a.y===s)return n}return"NONE"},ig.utilsvector2.DIRECTION={NONE:ig.utilsvector2.vector(),LEFT:ig.utilsvector2.vector(-1,0),RIGHT:ig.utilsvector2.vector(1,0),UP:ig.utilsvector2.vector(0,-1),DOWN:ig.utilsvector2.vector(0,1),UPLEFT:ig.utilsvector2.vector(-1,-1),UPRIGHT:ig.utilsvector2.vector(1,-1),DOWNLEFT:ig.utilsvector2.vector(-1,1),DOWNRIGHT:ig.utilsvector2.vector(1,1)}}),ig.baked=!0,ig.module("plusplus.helpers.utilsintersection").requires("plusplus.helpers.utilsmath","plusplus.helpers.utilsvector2").defines(function(){"use strict";var t=ig.utilsmath,i=ig.utilsvector2;ig.utilsintersection={},ig.utilsintersection.bounds=function(t,i,e,s,n){return n=n||{},n.minX=t,n.minY=i,n.maxX=t+e,n.maxY=i+s,n.width=e,n.height=s,n},ig.utilsintersection.boundsMinMax=function(t,i,e,s,n){return n=n||{},n.minX=t,n.minY=i,n.maxX=e,n.maxY=s,n.width=e-t,n.height=s-i,n},ig.utilsintersection.boundsOfPoints=function(t,i){var e,s,n=t[0],a=n.x,o=n.y,h=n.x,r=n.y;for(e=1,s=t.length;s>e;e++)n=t[e],n.x<a?a=n.x:n.x>h&&(h=n.x),n.y<o?o=n.y:n.y>r&&(r=n.y);return i=i||{},i.minX=a,i.minY=o,i.maxX=h,i.maxY=r,i.width=h-a,i.height=r-o,i},ig.utilsintersection.boundsClone=function(t,i,e,s){i=i||0,e=e||0;var n=t.minX+i,a=t.minY+e,o=t.maxX+i,h=t.maxY+e;return s=s||{},s.minX=n,s.minY=a,s.maxX=o,s.maxY=h,s.width=o-n,s.height=h-a,s},ig.utilsintersection.boundsCopy=function(t,i,e,s,n,a){return e=e||0,s=s||0,n=n||1,a=a||1,t.minX=i.minX*n+e,t.maxX=i.maxX*n+e,t.minY=i.minY*a+s,t.maxY=i.maxY*a+s,t.width=t.maxX-t.minX,t.height=t.maxY-t.minY,t},ig.utilsintersection.boundsCopyX=function(t,i,e,s){return e=e||0,s=s||1,t.minX=i.minX*s+e,t.maxX=i.maxX*s+e,t.width=t.maxX-t.minX,t},ig.utilsintersection.boundsCopyY=function(t,i,e,s){return e=e||0,s=s||1,t.minY=i.minY*s+e,t.maxY=i.maxY*s+e,t.height=t.maxY-t.minY,t},ig.utilsintersection.boundsCopyRotated=function(i,e,s){s%=t.TWOPI,s>Math.PI?s-=t.TWOPI:s<-Math.PI&&(s+=t.TWOPI);var n=Math.cos(s),a=Math.sin(s),o=e.width,h=e.height,r=h*n,l=o*n,g=h*a,u=o*a,c=e.minX,d=e.minY,p=c+.5*e.width,m=d+.5*e.height,f=c-p,y=d-m,E=p+f*n-y*a,v=m+f*a+y*n;return s>0?s<t.HALFPI?(i.minY=v,i.maxY=v+r+u,i.minX=E-g,i.maxX=E+l):(i.minY=v+r,i.maxY=v+u,i.minX=E-g+l,i.maxX=E):s<-t.HALFPI?(i.minY=v+u,i.maxY=v+r,i.minX=E,i.maxX=E+l-g):(i.minY=v+u+r,i.maxY=v,i.minX=E+l,i.maxX=E-g),i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i},ig.utilsintersection.AABBContains=function(t,i,e,s,n,a,o,h){return t>=n&&o>=e&&i>=a&&h>=s?!0:!1},ig.utilsintersection.AABBIntersect=function(t,i,e,s,n,a,o,h){return n>e?!1:t>o?!1:a>s?!1:i>h?!1:!0},ig.utilsintersection.boundsIntersect=function(t,i){return t.maxX<i.minX?!1:t.minX>i.maxX?!1:t.maxY<i.minY?!1:t.minY>i.maxY?!1:!0},ig.utilsintersection.boundsAABBIntersect=function(t,i,e,s,n){return t.maxX<i?!1:t.minX>s?!1:t.maxY<e?!1:t.minY>n?!1:!0},ig.utilsintersection.pointInAABB=function(t,i,e,s,n,a){return e>t?!1:t>n?!1:s>i?!1:i>a?!1:!0},ig.utilsintersection.pointInBounds=function(t,i,e){return t<e.minX?!1:t>e.maxX?!1:i<e.minY?!1:i>e.maxY?!1:!0},ig.utilsintersection.pointInCircle=function(t,i,e,s,n){var a=e-t,o=s-i,h=a*a+o*o,r=n*n;return r>h},ig.utilsintersection.pointInPolygon=function(t,i,e){var s,n=e.length-1,a=!1;for(s=0;s<e.length;s++){var o=e[n],h=e[s];if(o.x===t&&o.y===i||h.x===t&&h.y===i){a=!0;break}(h.y<i&&o.y>=i||o.y<i&&h.y>=i)&&(h.x<=t||o.x<=t)&&h.x+(i-h.y)/(o.y-h.y)*(o.x-h.x)<t&&(a=!a),n=s}return a},ig.utilsintersection.entitiesInAABB=function(t,i,e,s,n,a,o){var h,r,l,g=[];if(a){h=ig.game.layersMap[a];var u=n?h.itemsTargetable:h.items;for(r=0,l=u.length;l>r;r++){var c,d=u[r];if(d.fixed){var p=ig.game.screen.x,m=ig.game.screen.y;c=ig.utilsintersection.AABBIntersect(d.pos.x+p,d.pos.y+m,d.pos.x+d.size.x*d.scaleMod+p,d.pos.y+d.size.y*d.scaleMod+m,t,i,e,s)}else c=ig.utilsintersection.AABBIntersect(d.pos.x,d.pos.y,d.pos.x+d.size.x*d.scaleMod,d.pos.y+d.size.y*d.scaleMod,t,i,e,s);c&&g.push(d)}}else for(r=0,l=ig.game.layers.length;l>r;r++)h=ig.game.layers[r],h.name&&h.numEntities&&(!n||h.itemsTargetable.length)&&(g=g.concat(ig.utilsintersection.entitiesInAABB(t,i,e,s,n,h.name,!0)));return g.length>1&&!o&&ig.utilsintersection.sortByDistance(t+.5*(e-t),i+.5*(s-i),g),g},ig.utilsintersection.getIsAABBInScreen=function(t,i,e,s){var n=t-ig.game.screen.x,a=i-ig.game.screen.y;return ig.utilsintersection.AABBIntersect(n,a,n+e,a+s,0,0,ig.system.width,ig.system.height)},ig.utilsintersection.sortByDistance=function(t,e,s){var n=i.set(ig.utilsintersection._utilVec2Sort,t,e);return s.sort(function(t,i){var e=t.distanceSquaredEdgeTo(n),s=i.distanceSquaredEdgeTo(n);return e-s||t.distanceSquaredTo(n)-i.distanceSquaredTo(n)}),s},ig.utilsintersection._utilVec2Sort={x:.1,y:.1}}),ig.baked=!0,ig.module("plusplus.helpers.utilsdraw").requires("plusplus.helpers.utilsintersection").defines(function(){"use strict";var t=ig.utilsintersection;ig.utilsdraw={},ig.utilsdraw.pixelFillPolygon=function(i,e,s,n,a,o,h,r,l,g,u,c,d){e|=0,s|=0;var p,m,f,y;c?(p=0|c.minX,m=0|c.minY,f=Math.ceil(c.maxX),y=Math.ceil(c.maxY)):(p=e,m=s,f=Math.ceil(n),y=Math.ceil(a));var E,v,T,A;d!==!1?(E=p-e-1,v=m-s-1,T=f-p+1,A=y-m+1):(E=p-e,v=m-s,T=f-p,A=y-m);var _=255*h|0,I=255*r|0,x=255*l|0,C=255*g|0,S=i.getImageData(E,v,T,A);if(u===!0){for(var w=0;T>w;w++)for(var N=0;A>N;N++)if(t.pointInPolygon(w+p,N+m,o)){var O=4*(w+N*T);S.data[O]+=_,S.data[O+1]+=I,S.data[O+2]+=x,S.data[O+3]+=C}}else for(var w=0;T>w;w++)for(var N=0;A>N;N++)if(t.pointInPolygon(w+p,N+m,o)){var O=4*(w+N*T);S.data[O]=_,S.data[O+1]=I,S.data[O+2]=x,S.data[O+3]=C}i.putImageData(S,E,v)},ig.utilsdraw.fillPolygon=function(t,i,e,s,n){e=e||0,s=s||0,n=n||1;var a=i[0];t.beginPath(),t.moveTo((a.x+e)*n,(a.y+s)*n);for(var o=1,h=i.length;h>o;o++)a=i[o],t.lineTo((a.x+e)*n,(a.y+s)*n);t.fill()},ig.utilsdraw.fillRoundedRect=function(t,i,e,s,n,a){t.beginPath(),t.moveTo(i+a,e),t.lineTo(i+s-a,e),t.quadraticCurveTo(i+s,e,i+s,e+a),t.lineTo(i+s,e+n-a),t.quadraticCurveTo(i+s,e+n,i+s-a,e+n),t.lineTo(i+a,e+n),t.quadraticCurveTo(i,e+n,i,e+n-a),t.lineTo(i,e+a),t.quadraticCurveTo(i,e,i+a,e),t.closePath(),t.fill()},ig.utilsdraw.pixelFillRoundedRect=function(t,i,e,s,n,a,o,h,r,l,g,u,c,d,p,m,f){"undefined"==typeof p&&(p=Math.round(.25*l));var y=.5*Math.PI/(p+1),E=function(t,i,e){for(var s=0;p>s;s++)e+=y,v.push({x:t+l*Math.cos(e),y:i+l*Math.sin(e)})},v=[];v.push({x:a+l,y:o}),v.push({x:a+h-l,y:o}),p>0&&E(a+h-l,o+l,1.5*Math.PI),v.push({x:a+h,y:o+l}),v.push({x:a+h,y:o+r-l}),p>0&&E(a+h-l,o+r-l,0),v.push({x:a+h-l,y:o+r}),v.push({x:a+l,y:o+r}),p>0&&E(a+l,o+r-l,.5*Math.PI),v.push({x:a,y:o+r-l}),v.push({x:a,y:o+l}),p>0&&E(a+l,o+l,Math.PI),ig.utilsdraw.pixelFillPolygon(t,i,e,s,n,v,g,u,c,d,m,ig.utilsintersection.bounds(a,o,h,r),f)}}),ig.baked=!0,ig.module("plusplus.helpers.utilscolor").defines(function(){"use strict";ig.utilscolor={},ig.utilscolor.hexToRGBA=function(t){t=Math.floor(t);var i={};return i.r=(t>>24&255)/255,i.g=(t>>16&255)/255,i.b=(t>>8&255)/255,i.a=(255&t)/255,i},ig.utilscolor.RGBAToHex=function(t,i,e,s){return 255*t<<24^255*i<<16^255*e<<8^255*s<<0},ig.utilscolor.RGBToHex=function(t,i,e){return 255*t<<16^255*i<<8^255*e<<0},ig.utilscolor.CSSToRGBA=function(){var t=ig.$new("canvas");t.width=t.height=1;var i=t.getContext("2d");return function(t,e){i.clearRect(0,0,1,1),i.fillStyle=t,i.fillRect(0,0,1,1);var s=i.getImageData(0,0,1,1).data,n={};return n.r=s[0]/255,n.g=s[1]/255,n.b=s[2]/255,n.a=e,n}}(),ig.utilscolor.RGBAToCSS=function(t,i,e,s){return"rgba("+(255*t|0)+","+(255*i|0)+","+(255*e|0)+","+s+")"},ig.utilscolor.RGBToCSS=function(t,i,e){return"rgb("+(255*t|0)+","+(255*i|0)+","+(255*e|0)+")"},ig.utilscolor.linearGradient=function(t,i,e,s,n){for(var a=ig.system.context.createLinearGradient(t,i,e,s),o=1/(n.length-1),h=0,r=n.length;r>h;h++){var l,g=n[h];l="object"==typeof g?"undefined"!=typeof g.a?ig.utilscolor.RGBAToCSS(g.r,g.g,g.b,g.a):ig.utilscolor.RGBToCSS(g.r,g.g,g.b):g,a.addColorStop(h*o,l)}return a},ig.utilscolor.radialGradient=function(t,i){for(var e=ig.system.context.createRadialGradient(t,t,0,t,t,t),s=1/(i.length-1),n=0,a=i.length;a>n;n++){var o,h=i[n];o="object"==typeof h?"undefined"!=typeof h.a?ig.utilscolor.RGBAToCSS(h.r,h.g,h.b,h.a):ig.utilscolor.RGBToCSS(h.r,h.g,h.b):h,e.addColorStop(n*s,o)}return e}}),ig.baked=!0,ig.module("plusplus.helpers.utilstile").requires("plusplus.core.config","plusplus.core.collision-map","plusplus.helpers.utils","plusplus.helpers.utilsintersection","plusplus.helpers.utilsvector2").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils,e=ig.utilsintersection,s=ig.utilsvector2,n=(t.COLLISION.TILE_ONE_WAY_UP,t.COLLISION.TILE_ONE_WAY_DOWN),a=t.COLLISION.TILE_ONE_WAY_RIGHT,o=t.COLLISION.TILE_ONE_WAY_LEFT,h=(t.COLLISION.TILE_CLIMBABLE_WITH_TOP,t.COLLISION.TILE_CLIMBABLE,t.COLLISION.TILE_STAIRS_WITH_TOP,t.COLLISION.TILE_STAIRS,t.COLLISION.TILES_HASH_WALKABLE),r=t.COLLISION.TILES_HASH_WALKABLE_STRICT,l=t.COLLISION.TILES_HASH_ONE_WAY,g=t.COLLISION.TILES_HASH_CLIMBABLE,u=t.COLLISION.TILES_HASH_CLIMBABLE_ONE_WAY,c=t.COLLISION.TILES_HASH_CLIMBABLE_STAIRS,d=1,p=2;ig.utilstile={},ig.utilstile.defaultTileVerticesDef={},ig.utilstile.defaultTileSegmentsDef={};var m=null,f=null;ig.utilstile.rebuild=function(t){if(t instanceof ig.CollisionMap&&t.tiledef!==f){ig.utilstile.unload(),m=t,f=m.tiledef||ig.CollisionMap.defaultTileDef;for(var i in f)ig.utilstile.shapeFromTile(i,f);ig.utilstile.shapeFromTile(1,f)}else m=t},ig.utilstile.unload=function(){m=null,f=ig.CollisionMap.defaultTileDef,ig.utilstile.defaultTileVerticesDef={},ig.utilstile.defaultTileSegmentsDef={}},ig.utilstile.isTileWalkable=function(t){return h[t]},ig.utilstile.isTileWalkableStrict=function(t){return r[t]},ig.utilstile.isTileOneWay=function(t){return l[t]},ig.utilstile.isTileClimbable=function(t){return g[t]},ig.utilstile.isTileClimbableStairs=function(t){return c[t]},ig.utilstile.isTileClimbableOneWay=function(t){return u[t]},ig.utilstile.shapesFromCollisionMap=function(t,i){var e={oneWays:[],solids:[],climbables:[]};if(t instanceof ig.CollisionMap){i=i?ig.copy(i,{}):{};var s,h,r,d,p,m,f,y,E,v,T=ig.copy(t.data),A=t.tilesize,_=t.width,I=t.height,x=[],C=[],S=[];for(m=0;I>m;m++)for(p=0;_>p;p++){if(v=ig.utilstile.shapeFromTile(t.data[m][p],t.tiledef),E={id:t.data[m][p],ix:p,iy:m,x:p*A,y:m*A,width:A,height:A,shape:v},v.vertices.length>0){for(h=[],s=v.vertices,r=v.segments,f=0,y=r.length;y>f;f++){d=r[f];var w=s[d.a];h[d.a]={x:E.x+w.x*A,y:E.y+w.y*A}}v.vertices=h,g[E.id]?i.ignoreClimbables||C.push(E):l[E.id]?i.ignoreOneWays||S.push(E):i.ignoreSolids||x.push(E)}T[m][p]=E}var N=i.rectangles;for(e.solids=e.solids.concat(ig.utilstile.shapedTilesToShapes(x,T,i)),"undefined"==typeof i.groupByTileId&&(i.groupByTileId=!0),i.rectangles="undefined"!=typeof N?N:!i.contourClimbables,e.climbables=e.climbables.concat(ig.utilstile.shapedTilesToShapes(C,T,i)),f=0,y=e.climbables.length;y>f;f++)v=e.climbables[f],u[v.id]?v.settings.oneWay=!0:v.settings.sensor=!0,c[v.id]&&(v.settings.climbableStairs=!0);for(i.rectangles="undefined"!=typeof N?N:!i.contourOneWays,e.oneWays=e.oneWays.concat(ig.utilstile.shapedTilesToShapes(S,T,i)),f=0,y=e.oneWays.length;y>f;f++)v=e.oneWays[f],l[v.id]&&(v.settings.oneWay=!0,v.id===n?v.settings.oneWayFacing={x:0,y:1}:v.id===a?v.settings.oneWayFacing={x:1,y:0}:v.id===o&&(v.settings.oneWayFacing={x:-1,y:0}))}return e},ig.utilstile.shapedTilesToShapes=function(t,e,s){s=s||{};var n,a,o,h,r,l=[],g=[],u=[];if(s.groupByTileId){delete s.groupByTileId;var c,d,p=[],m={};for(n=0,a=t.length;a>n;n++){var f=t[n];m[f.id]?m[f.id].push(f):(p.push(f.id),m[f.id]=[f])}for(n=0,a=p.length;a>n;n++)c=p[n],d=m[c],s.id=c,l=l.concat(ig.utilstile.shapedTilesToShapes(d,e,s))}else{if(s.rectangles){for(var y,E,v,T,A=t.slice(0),_=[];A.length>0;){for(y=ig.utilstile.findShapedTileLine(A),i.arrayCautiousRemoveMulti(A,y),E=y.length,T=y,v=!0;v;){v=!1;var I=y[0],x=e[I.iy][I.ix+1];x&&(r=i.indexOfValue(A,x),-1!==r&&(y=ig.utilstile.findShapedTileLine(A,!1,r,E),y.length===E&&(i.arrayCautiousRemoveMulti(A,y),T=T.concat(y),v=!0)))}T.length>0&&_.push(T)}for(o=0,h=_.length;h>o;o++){for(T=_[o],g=[],n=0,a=T.length;a>n;n++)g=g.concat(ig.utilstile.getNonDuplicateSegmentVertices(T[n],e,T));u=u.concat(ig.utilstile.verticesToContours(g,s))}}else{for(n=0,a=t.length;a>n;n++)g=g.concat(ig.utilstile.getNonDuplicateSegmentVertices(t[n],e,t));u=ig.utilstile.verticesToContours(g,s)}for(n=0,a=u.length;a>n;n++){var C=u[n];l.push({id:s.id,x:C.minX,y:C.minY,settings:{size:{x:C.width,y:C.height},vertices:C.vertices}})}}return l},ig.utilstile.findShapedTileLine=function(t,i,e,s){e=e||0,s=s||0;for(var n=t[e],a=[],o=!0;o&&(o=!1,a.push(n),a.length!==s);){var h=i?ig.utilstile.stepShapedTileHorizontally(t,n):ig.utilstile.stepShapedTileVertically(t,n);n!==h&&(o=!0,n=h)}return a},ig.utilstile.stepShapedTileHorizontally=function(t,i){for(var e=0,s=t.length;s>e;e++){var n=t[e];if(i.iy===n.iy&&i.ix+1===n.ix)return n}return i},ig.utilstile.stepShapedTileVertically=function(t,i){for(var e=0,s=t.length;s>e;e++){var n=t[e];if(i.ix===n.ix&&i.iy+1===n.iy)return n}return i},ig.utilstile.verticesToContours=function(t,n){var a=[];if(t.length>1){n=n||{};for(var o,h,r,l,g,u,c,d,p=t.slice(0),m={vertices:[],minX:Number.MAX_VALUE,minY:Number.MAX_VALUE,maxX:-Number.MAX_VALUE,maxY:-Number.MAX_VALUE},f=m.vertices,y=p.pop(),E=p.pop();p.length>-2;){var v=!1;if(r=f[0],l=f[1],f.length<=2||y.x!==r.x||y.y!==r.y)for(g=0,u=p.length;u>g;g+=2)if(o=p[g],h=p[g+1],y.x===o.x&&y.y===o.y){v=!0;break}if(f.push(y),y.x<m.minX&&(m.minX=y.x),y.x>m.maxX&&(m.maxX=y.x),y.y<m.minY&&(m.minY=y.y),y.y>m.maxY&&(m.maxY=y.y),v===!0)p.splice(g,2),E=o,y=h;else{if(m.vertices.length>=3&&a.push(m),!(p.length>0))break;m={vertices:[]},m.minX=m.minY=Number.MAX_VALUE,m.maxX=m.maxY=-Number.MAX_VALUE,f=m.vertices,y=p.pop(),E=p.pop()}}for(g=0,u=a.length;u>g;g++)m=a[g],m.width=m.maxX-m.minX,m.height=m.maxY-m.minY;a.sort(function(t,i){return i.width*i.width+i.height*i.height-(t.width*t.width+t.height*t.height)});var T,A,_=a.slice(0),I=[],x=[];for(m=_.pop();_.length>-1;){if(A=!1,m){for(g=a.length-1;g>-1;g--)if(T=a[g],m!==T&&e.AABBContains(m.minX,m.minY,m.maxX,m.maxY,T.minX,T.minY,T.maxX,T.maxY)){A=!0;break}x.push(m)}if(A)i.arrayCautiousRemove(_,T),m=T;else{if(x.length>1&&I.push(x),!(_.length>0))break;x=[],m=_.pop()}}var C=[],S=[];for(g=0,u=I.length;u>g;g++){x=I[g];var w=x[x.length-1],N=x[x.length-2];for(c=x.length%2===0?0:1,d=x.length;d>c;c+=2)m=x[c],-1===i.indexOfValue(C,m)&&(m.vertices.reverse(),C.push(m));if(n.retainBoundaryOuter||-1!==i.indexOfValue(S,w)||(S.push(w),i.arrayCautiousRemove(a,w)),n.discardBoundaryInner&&-1===i.indexOfValue(S,N)&&(S.push(N),i.arrayCautiousRemove(a,N)),n.discardEdgesInner&&x.length>2){var O=x.slice(0,x.length-2);S=S.concat(O),i.arrayCautiousRemoveMulti(a,O)}}for(g=0,u=a.length;u>g;g++){if(m=a[g],f=m.vertices,!n.discardCollinear){for(r=f[0],c=f.length-1;c>0;c--)E=f[c],y=f[c-1],0===s.pointsCW(r,E,y)?f.splice(c,1):r=E,E=y;0===s.pointsCW(f[c+1],f[c],f[f.length-1])&&f.splice(0,1)}n.reverse&&f.reverse();var b=m.minX,L=m.minY,R=m.width,D=m.height;for(c=0,d=f.length;d>c;c++)E=f[c],E.x-=b+.5*R,E.y-=L+.5*D}}return a},ig.utilstile.shapeFromTile=function(t,i){var e,s,n,a=ig.utilstile.verticesFromTile(t,i);if(a)if(ig.utilstile.defaultTileSegmentsDef[t])n=ig.utilstile.defaultTileSegmentsDef[t];else for(ig.utilstile.defaultTileSegmentsDef[t]=n=[],e=0,s=a.length;s>e;e++){var o,h,r=a[e],l=e===s-1?0:e+1,g=a[l],u=g.x-r.x,c=g.y-r.y,d=Math.sqrt(u*u+c*c);d>0?(o=c/d,h=-u/d):o=h=0,n.push({a:e,b:l,normal:{x:o,y:h}})}return{vertices:a,segments:n||[]}},ig.utilstile.verticesFromTile=function(t,i){"undefined"===i&&(i=f);var e;if(ig.utilstile.defaultTileVerticesDef[t])e=ig.utilstile.defaultTileVerticesDef[t];else{if(1===parseInt(t)||g[t])e=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}];else{e=[];var n=i[t];if(n){var a,o,h,r,l,u,c=e[0]={x:n[0],y:n[1]},d=e[1]={x:n[2],y:n[3]},p=c.x,m=c.y,y=d.x,E=d.y,v=y-p,T=E-m,A=e[2]={x:0>T?1:0,y:v>0?1:0},_=A.x,I=A.y,x=!1;if(Math.abs(v)<1&&Math.abs(T)<1){var C=s.pointQuadrant(p,m,.5,.5),S=s.pointQuadrant(y,E,.5,.5),w=s.pointQuadrant(_,I,.5,.5);C&w||S&w||(x=!0)}x===!0?(_!==I?(h=_,u=I,1==_?(r=1,l=0):(r=0,l=1)):(r=I,l=_,1==_?(h=0,u=0):(h=1,u=1)),a=e[3]={x:h,y:r},o=e[4]={x:l,y:u}):(_!==I?(h=_,u=I,1==_?(r=Math.max(m,E),l=Math.min(p,y)):(r=Math.min(m,E),l=Math.max(p,y))):(r=I,l=_,1==_?(h=Math.min(p,y),u=Math.min(m,E)):(h=Math.max(p,y),u=Math.max(m,E))),h===p&&r===m||h===y&&r===E?l===p&&u===m||l===y&&u===E||(a=e[3]={x:l,y:u}):a=e[3]={x:h,y:r}),e=s.pointsToConvexHull(e)}}ig.utilstile.defaultTileVerticesDef[t]=e}return e},ig.utilstile.getNonDuplicateSegmentVertices=function(t,i,e){var s,n,a,o,h=(t.ix,t.iy,t.shape),r=h.vertices,l=h.segments,g=[];for(s=0,n=l.length;n>s;s++){var u=l[s],c=r[u.a],d=r[u.b],p=u.normal,m=!1;if(0===p.x&&0!==p.y||0!==p.x&&0===p.y){var f=ig.utilstile.getTouchingTilesByDirection(t,p,i,e);for(a=0,o=f.length;o>a;a++){var y=f[a];if(y.shape.vertices.length>0&&(m=ig.utilstile.getSegmentOverlapWithTile(c,d,p,y)))break}}m===!1?g.push(c,d):m.segmentA&&g.push(m.segmentA.va,m.segmentA.vb)}return g},ig.utilstile.getTouchingTilesByDirection=function(t,e,s,n){var a,o,h=t.ix,r=t.iy,l=e.x,g=e.y,u=[];return 0!==l&&(o=s[r],l>0?h<o.length-1&&(a=o[h+1],n&&-1===i.indexOfValue(n,a)||u.push(a)):h>0&&(a=o[h-1],n&&-1===i.indexOfValue(n,a)||u.push(a))),0!==g&&(g>0?r<s.length-1&&(a=s[r+1][h],n&&-1===i.indexOfValue(n,a)||u.push(a)):r>0&&(a=s[r-1][h],n&&-1===i.indexOfValue(n,a)||u.push(a))),u},ig.utilstile.getSegmentOverlapWithTile=function(t,i,e,s){var n,a,o,h,r,l=!1,g=s.shape,u=g.vertices,c=g.segments;for(n=0,a=c.length;a>n;n++)if(o=c[n],h=o.normal,e.x===-h.x&&e.y===-h.y){r=o;break}if(r){var m=u[r.a],f=u[r.b],y=t.x,E=t.y,v=i.x,T=i.y,A=m.x,_=m.y,I=f.x,x=f.y,C=v-y,S=T-E,w=Math.sqrt(C*C+S*S),N=C/w,O=S/w,b=A-I,L=_-x,R=Math.sqrt(b*b+L*L),D=b/R,M=L/R,P=N*M-O*D;if(0===P){var F,k,G,Y,h,z,B,H;if(0!==N?(F=Math.min(y,I),k=Math.max(y,I),G=Math.min(v,A),Y=Math.max(v,A),h=N,z=y,B=v,H="x"):(F=Math.min(E,x),k=Math.max(E,x),G=Math.min(T,_),Y=Math.max(T,_),h=O,z=E,B=T,H="y"),F===k&&G===Y)l=!0;else{var U=0>h?F-Y:G-k;if(U>0){l={segmentA:{va:{x:t.x,y:t.y},vb:{x:i.x,y:i.y}},segmentB:{va:{x:m.x,y:m.y},vb:{x:f.x,y:f.y}}};var X,W,V=!0;0>h?(X=F===k?0:F===z?p:d,W=G===Y?0:Y===B?p:d,X===d?(l.segmentA.vb[H]+=U,V=!1):X===p&&(l.segmentB.va[H]+=U),W===d?(l.segmentA.va[H]-=U,V=!1):W===p&&(l.segmentB.vb[H]-=U),V===!0&&(l=!0)):(X=F===k?0:F===z?d:p,W=G===Y?0:Y===B?d:p,X===d?(l.segmentA.vb[H]-=U,V=!1):X===p&&(l.segmentB.va[H]-=U),W===d?(l.segmentA.va[H]+=U,V=!1):W===p&&(l.segmentB.vb[H]+=U),V===!0&&(l=!0))}}}}return l}}),ig.baked=!0,ig.module("plusplus.core.entity").requires("impact.entity","plusplus.core.config","plusplus.core.image","plusplus.core.background-map","plusplus.core.animation","plusplus.helpers.signals","plusplus.helpers.tweens","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.utilsvector2","plusplus.helpers.utilsintersection","plusplus.helpers.utilsdraw","plusplus.helpers.utilscolor","plusplus.helpers.utilstile").defines(function(){"use strict";var t=ig.CONFIG,i=ig.TWEEN,e=ig.utils,s=ig.utilsmath,n=ig.utilsvector2,a=ig.utilsintersection,o=ig.utilsdraw,h=ig.utilscolor,r=ig.utilstile;ig.EntityExtended=ig.Entity.extend({layerName:"entities",pos:{x:.01,y:.01},size:{x:t.ENTITY.SIZE_EFFECTIVE_X,y:t.ENTITY.SIZE_EFFECTIVE_Y},offset:{x:t.ENTITY.SIZE_OFFSET_X,y:t.ENTITY.SIZE_OFFSET_Y},posDraw:{x:.01,y:.01},sizeDraw:{x:0,y:0},scale:t.ENTITY.SCALE,scaleOfSystemScale:t.ENTITY.SCALE_OF_SYSTEM_SCALE,scaleMin:t.ENTITY.SCALE_MIN,scaleMax:t.ENTITY.SCALE_MAX,scaleMod:1,ignoreSystemScale:t.ENTITY.IGNORE_SYSTEM_SCALE,collides:0,collidesChanges:!1,collisionMapResult:null,checkAgainst:0,type:0,group:0,frozen:!1,controllable:!0,performance:t.STATIC,highPerformance:!1,fixed:!1,facing:{x:1,y:0},canFlipX:t.ENTITY.CAN_FLIP_X,canFlipY:t.ENTITY.CAN_FLIP_Y,friction:{x:t.ENTITY.FRICTION_X,y:t.ENTITY.FRICTION_Y},maxVel:{x:t.ENTITY.MAX_VEL_X,y:t.ENTITY.MAX_VEL_Y},angle:0,bounciness:t.ENTITY.BOUNCINESS,minBounceVelocity:t.ENTITY.MIN_BOUNCE_VEL,currentAnim:null,overridingAnim:null,animSheetPath:"",animSheetWidth:0,animSheetHeight:0,animSettings:null,animationType:0,animationTypes:null,animSequenceCount:1,animTileOffset:0,animFrameTime:1,animInit:"",textured:!1,persistent:!1,targetable:!1,climbable:!1,climbableStairs:!1,oneWay:!1,oneWayFacing:null,opaque:t.ENTITY.OPAQUE,opaqueOffset:t.ENTITY.OPAQUE_OFFSET,opaqueVertices:null,opaqueFromVertices:t.ENTITY.OPAQUE_FROM_VERTICES,diffuse:t.ENTITY.DIFFUSE,hollow:!0,activated:!1,alwaysToggleActivate:!1,activateCallback:null,activateContext:null,deactivateCallback:!1,deactivateContext:!1,alpha:1,hidden:!1,health:t.ENTITY.HEALTH,healthMax:t.ENTITY.HEALTH,invulnerable:!1,rangeInteractableX:0,rangeInteractableY:0,paused:!1,visible:!1,changed:!1,checking:!1,wasChecking:!1,intersecting:!1,added:!1,dieing:!1,dieingSilently:!1,canDieInstantly:!0,flip:{x:!1,y:!1},grounded:t.TOP_DOWN,standing:t.TOP_DOWN,gravityFactor:t.TOP_DOWN?0:1,hasGravity:t.TOP_DOWN?!1:!0,collidingWithMap:!1,collidingWithEntitiesBelow:!1,slope:null,slopeSticking:t.ENTITY.SLOPE_STICKING,slopeSpeedMod:t.ENTITY.SLOPE_SPEED_MOD,slopeStanding:{min:s.degreesToRadians(t.ENTITY.SLOPE_STANDING_MIN),max:s.degreesToRadians(t.ENTITY.SLOPE_STANDING_MAX)},moving:!1,movingX:!1,movingY:!1,movingTo:null,movedTo:!0,movingToOnce:!1,movingToTweening:!1,movingToTweenPct:0,linkedTo:null,managed:!1,tweens:{},resetState:{},needsVertices:t.ENTITY.NEEDS_VERTICES,vertices:null,verticesWorld:null,onAdded:null,onRemoved:null,onMovedTo:null,onRefreshed:null,needsRebuild:!0,_posLast:{x:0,y:0},_sizeLast:{x:0,y:0},_angleLast:0,_changedAdd:!1,_verticesFound:!1,_overridedAnim:!1,_cleanupPersistent:!1,init:function(t,i,e){this.id=++ig.Entity._lastId,this.initTypes(),this.initProperties(),this.reset(t,i,e)},initTypes:function(){},initProperties:function(){this.collisionMapResult={collision:{x:!1,y:!1,slope:!1},pos:{x:0,y:0},slope:{x:0,y:0,nx:0,ny:0},tile:{x:0,y:0,xPos:{x:0,y:0},yPos:{x:0,y:0}}},this.onAdded=new ig.Signal,this.onRemoved=new ig.Signal,this.onMovedTo=new ig.Signal,this.onRefreshed=new ig.Signal},reset:function(t,i,e){this.resetCore(t,i,e),this.resetExtras()},resetCore:function(t,i,s){ig.merge(this,this.resetState),t&&(this.pos.x=t),i&&(this.pos.y=i),s&&!ig.global.wm&&("string"==typeof s.type&&(e.addType(ig.EntityExtended,this,"type",s.type),delete s.type),"string"==typeof s.checkAgainst&&(e.addType(ig.EntityExtended,this,"checkAgainst",s.checkAgainst),delete s.checkAgainst),"string"==typeof s.group&&(e.addType(ig.EntityExtended,this,"group",s.group,"GROUP"),delete s.group)),ig.merge(this,s),this._killed=this.dieing=this.dieingSilently=!1},resetExtras:function(){if(this.healthMax=this.health,this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC&&(this.fixed=!1),this.fixed&&(this.collides=ig.EntityExtended.COLLIDES.NEVER),this.hasGravity||this.setGrounded(!0),this.animSheetPath&&(this.animSheet=new ig.AnimationSheet(t.PATH_TO_MEDIA+this.animSheetPath,this.animSheetWidth,this.animSheetHeight),this.animSheetPath=""),this.animSettings){if(this.anims={},this.resetState.currentAnim=null,this.animSettings===!0)this.createAnim();else for(var i in this.animSettings)this.createAnim(i,this.animSettings[i]);delete this.animSettings}this.recordResetState(),ig.global.wm||ig.system.onResized.add(this.refresh,this),this.refresh(!0),this.frozen?this.changed=this._changedAdd=!1:this.changed=this._changedAdd=!0,this.activated&&(this.activated=!1,this.activate())},recordResetState:function(){var t=this.resetState;t.pos||(t.pos={x:0,y:0}),n.copy(t.pos,this.pos),t.vel||(t.vel={x:0,y:0}),n.copy(t.vel,this.vel),t.accel||(t.accel={x:0,y:0}),n.copy(t.accel,this.accel),t.layerName=this.layerName,t.frozen=this.frozen,t.alpha=this.alpha,t.type=this.type,t.checkAgainst=this.checkAgainst,t.collides=this.collides,t.performance=this.performance,t.health=this.health},createAnim:function(t,i){i=i||{};var s,n,a=i.sequence,o=i.tileOffset||this.animTileOffset;if(!a||!a.length){a=i.sequence=[];var h=i.sequenceCount||this.animSequenceCount,r=0,l=i.type||this.animationType;if(l&&this.animationTypes){var g=e.indexOfValue(this.animationTypes,l);-1!==g&&(r+=h*g)}for(s=0;h>s;s++)a[s]=r+s}if(o)for(s=0,n=a.length;n>s;s++)a[s]+=o;if(i.frameTime=i.frameTime||this.animFrameTime,t)this.addAnim(t,i);else{var u=this.addAnim("idle",i);this.anims.idleX=u,this.anims.idleY=u,this.anims.idleLeft=u,this.anims.idleRight=u,this.anims.idleUp=u,this.anims.idleDown=u}},addAnim:function(t,i){if(!this.animSheet)throw"No animSheet to add the animation "+t+" to.";var e=new ig.AnimationExtended(this.animSheet,i);return this.anims[t]=e,this.currentAnim||(this.currentAnim=e),e},getDirectionalAnimName:function(t){return 0!==this.facing.y?this.canFlipY?t+"Y":this.facing.y<0?t+"Up":t+"Down":this.canFlipX?t+"X":this.facing.x<0?t+"Left":t+"Right"},refresh:function(t){if(!this.ignoreSystemScale){var i=Math.min(Math.max(Math.round(ig.system.scale*this.scaleOfSystemScale),this.scaleMin),this.scaleMax);this.scale!==i&&(this.scale=i,t=!0)}this.needsRebuild&&(t=!0),this.scaleMod=this.scale/ig.system.scale,t=this.resize(t)||t,(t||this.needsRebuild)&&(this.sizeDraw.x=this.getSizeDrawX(),this.sizeDraw.y=this.getSizeDrawY()),t=this.reposition(t)||t,this.recordChanges(t),this.recordLast(),n.copy(this.last,this.pos),(t||this.needsRebuild)&&this.rebuild(),this.movingTo&&this.moveToUpdate(),this.onRefreshed.dispatch(this),this.frozen?(this.changed=this.moving=this.movingX=this.movingY=!1,this.facing.x=this.facing.y=0):this.performance===ig.EntityExtended.PERFORMANCE.STATIC&&this.changed&&(this.moving=this.movingX=this.movingY=!1,this._changedAdd=!0)},resize:function(t){return t},reposition:function(t){return this.movingTo&&(this.movedTo=!1),t},rebuild:function(){this.needsRebuild=!1},adding:function(){this.ready(),this.onAdded.dispatch(this)},ready:function(){if(this.changePerformance(),this.linkedTo){var t=this.linkedTo;this.linkedTo=null,this.link(t,t.added)}var i=this.getDirectionalAnimName("spawn");this.anims[i]?this.animOverride(i,{callback:this.spawn}):this.spawn()},spawn:function(){this.resetToInitAnim()},resetToInitAnim:function(){if(this.animInit instanceof ig.Animation?this.currentAnim=this.animInit:this.animInit?this.currentAnim=this.anims[this.animInit]:this.currentAnim=this.anims.idle||this.currentAnim,
this.currentAnim){this.resetState.currentAnim=this.currentAnim;var t=this.currentAnim.stop;this.currentAnim.playFromStart(),this.currentAnim.stop=t}},setPerformance:function(t){this.performance=t,this.performance!==this.performanceLast&&this.changePerformance()},changePerformance:function(){this.performanceLast=this.performance,this.performance===ig.EntityExtended.PERFORMANCE.MOVABLE?this.changePerformanceMovable():this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC?this.changePerformanceDynamic():this.changePerformanceStatic()},changePerformanceStatic:function(){},changePerformanceMovable:function(){},changePerformanceDynamic:function(){},setControllable:function(t){"undefined"==typeof t&&(t=!0),t?this.addControl():this.removeControl()},addControl:function(){this.controllable=!0},removeControl:function(){this.controllable=!1,this.applyAntiVelocity()},getLayer:function(){return ig.game.layersMap[this.layerName]},getVertices:function(){var t=.5*this.size.x,i=.5*this.size.y;return[{x:-t,y:-i},{x:t,y:-i},{x:t,y:i},{x:-t,y:i}]},getVerticesWorld:function(){return this.vertices||(this.vertices=this.getVertices()),n.projectPoints(this.vertices,this.pos.x+.5*this.size.x,this.pos.y+.5*this.size.y,1,1,this.angle)},getSizeDrawX:function(){return this.size.x+2*this.offset.x},getSizeDrawY:function(){return this.size.y+2*this.offset.y},getPosDrawX:function(){return this.pos.x-this.offset.x},getPosDrawY:function(){return this.pos.y-this.offset.y},getCenterX:function(){return this.pos.x+.5*this.size.x},getCenterY:function(){return this.pos.y+.5*this.size.y},getIsVisible:function(){if(this.alpha<=0)return!1;if(this.fixed)return a.AABBIntersect(this.posDraw.x,this.posDraw.y,this.posDraw.x+this.sizeDraw.x,this.posDraw.y+this.sizeDraw.y,0,0,ig.system.width,ig.system.height);var t=this.posDraw.x-ig.game.screen.x,i=this.posDraw.y-ig.game.screen.y;return a.AABBIntersect(t,i,t+this.sizeDraw.x,i+this.sizeDraw.y,0,0,ig.system.width,ig.system.height)},getNewVelocity:function(t,i,e,n){if(i)return s.clamp(t+i*ig.system.tick,-n,n);if(e){var a=e*ig.system.tick;return t-a>0?Math.min(t-a,n):0>t+a?Math.max(t+a,-n):0}return s.clamp(t,-n,n)},getIsMovingSelf:function(){return this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC||this.movingTo},getIsCollidingWithOneWay:function(i){if(0!==i.oneWayFacing.x)if(i.oneWayFacing.x<0){if(this.pos.x+this.size.x-i.pos.x<=Math.max(i.size.x,this.size.x)*t.PRECISION_PCT_ONE_SIDED+Math.max(this.vel.x*ig.system.tick,0)-Math.min(i.vel.x*ig.system.tick,0))return!0}else if(i.pos.x+i.size.x-this.pos.x<=Math.max(i.size.x,this.size.x)*t.PRECISION_PCT_ONE_SIDED-Math.min(this.vel.x*ig.system.tick,0)+Math.max(i.vel.x*ig.system.tick,0))return!0;if(0!==i.oneWayFacing.y)if(i.oneWayFacing.y<0){if(this.pos.y+this.size.y-i.pos.y<=i.size.y*t.PRECISION_PCT_ONE_SIDED+Math.max(this.vel.y*ig.system.tick,0)-Math.min(i.vel.y*ig.system.tick,0)+(i.slope&&0!==i.accel.x&&i.slope.nx*i.vel.x<=0?i.vel.x*ig.system.tick:0))return!0}else if(i.pos.y+i.size.y-this.pos.y<=Math.max(i.size.y,this.size.y)*t.PRECISION_PCT_ONE_SIDED-Math.min(this.vel.y*ig.system.tick,0)+Math.max(i.vel.y*ig.system.tick,0))return!0},touches:function(t){return a.AABBIntersect(this.pos.x,this.pos.y,this.pos.x+this.size.x,this.pos.y+this.size.y,t.pos.x,t.pos.y,t.pos.x+t.size.x,t.pos.y+t.size.y)},distanceTo:function(t){var i=this.pos.x+.5*this.size.x,e=this.pos.y+.5*this.size.y;this.fixed&&(i+=ig.game.screen.x,e+=ig.game.screen.y);var s,n;if(t instanceof ig.EntityExtended){var a=t.pos.x+.5*t.size.x,o=t.pos.y+.5*t.size.y;t.fixed&&(a+=ig.game.screen.x,o+=ig.game.screen.y),s=i-a,n=e-o}else s=i-t.x,n=e-t.y;return Math.sqrt(s*s+n*n)},distanceSquaredTo:function(t){var i=this.pos.x+.5*this.size.x,e=this.pos.y+.5*this.size.y;this.fixed&&(i+=ig.game.screen.x,e+=ig.game.screen.y);var s,n;if(t instanceof ig.EntityExtended){var a=t.pos.x+.5*t.size.x,o=t.pos.y+.5*t.size.y;t.fixed&&(a+=ig.game.screen.x,o+=ig.game.screen.y),s=i-a,n=e-o}else s=i-t.x,n=e-t.y;return s*s+n*n},distanceEdgeTo:function(t){var i,e,s,n;this.fixed?(i=this.pos.x+ig.game.screen.x,e=i+this.size.x,s=this.pos.y+ig.game.screen.y,n=s+this.size.y):(i=this.pos.x,e=i+this.size.x,s=this.pos.y,n=s+this.size.y);var a,o,h,r;t instanceof ig.EntityExtended?t.fixed?(a=t.pos.x+ig.game.screen.x,o=a+t.size.x,h=t.pos.y+ig.game.screen.y,r=h+t.size.y):(a=t.pos.x,o=a+t.size.x,h=t.pos.y,r=h+t.size.y):(a=o=t.x,h=r=t.y);var l,g;return l=a>e?a-e:i>o?i-o:0,g=h>n?h-n:s>r?s-r:0,Math.sqrt(l*l+g*g)},distanceSquaredEdgeTo:function(t){var i,e,s,n;this.fixed?(i=this.pos.x+ig.game.screen.x,e=i+this.size.x,s=this.pos.y+ig.game.screen.y,n=s+this.size.y):(i=this.pos.x,e=i+this.size.x,s=this.pos.y,n=s+this.size.y);var a,o,h,r;t instanceof ig.EntityExtended?t.fixed?(a=t.pos.x+ig.game.screen.x,o=a+t.size.x,h=t.pos.y+ig.game.screen.y,r=h+t.size.y):(a=t.pos.x,o=a+t.size.x,h=t.pos.y,r=h+t.size.y):(a=o=t.x,h=r=t.y);var l,g;return l=a>e?a-e:i>o?i-o:0,g=h>n?h-n:s>r?s-r:0,l*l+g*g},angleTo:function(t){return t instanceof ig.EntityExtended?Math.atan2(this.pos.x+.5*this.size.x-(t.pos.x+.5*t.size.x),this.pos.y+.5*this.size.y-(t.pos.y+.5*t.size.y)):Math.atan2(this.pos.x+.5*this.size.x-t.x,this.pos.y+.5*this.size.y-t.y)},applyAntiVelocity:function(){this.applyAntiVelocityX(),this.applyAntiVelocityY()},applyAntiVelocityX:function(){this.vel.x=0,this.movingX=!1,this.moving=this.movingY},applyAntiVelocityY:function(){this.vel.y=0,this.movingY=!1,this.moving=this.movingX},applyAntiGravity:function(){0!==this.gravityFactor&&(this.vel.y-=ig.game.gravity*ig.system.tick*this.gravityFactor)},setGrounded:function(i){t.TOP_DOWN?this.standing=this.grounded=!0:(this.standing=this.grounded=this.hasGravity,i||(this.slopeSticking&&this.hasGravity?this.vel.y=this.maxVel.y:this.vel.y=0))},setUngrounded:function(){t.TOP_DOWN||(this.grounded=this.standing=!1)},animOverride:function(t,i){if(this.overridingAnimName!==t&&(i&&i.entity||this).anims[t]){i=i||{};var e=i.entity||this;this.animRelease(),this.overridingAnimName=t,this.overridingAnimCallback=i.callback,this.overridingAnimContext=i.context,this.overridingAnimFrozen=this.frozen,this._overridedAnim=this.currentAnim,this.currentAnim=this.overridingAnim=e.anims[t],i.loop||i.lock||i.stop||this.overridingAnim.onCompleted.addOnce(this.animRelease,this),this.frozen&&(this.frozen=!1),i.frame?(this.overridingAnim.gotoFrame(i.frame),"boolean"==typeof i.reverse&&(this.overridingAnim.reverse=i.reverse)):this.overridingAnim.playFromStart(!i.loop,i.reverse),"boolean"==typeof i.stop&&(this.overridingAnim.stop=i.stop)}else i&&"function"==typeof i.callback&&(this.animRelease(t,!0),i.callback.call(i.context||this))},animRelease:function(t,i){if(!t||this.overridingAnimName===t){var e=this.overridingAnimCallback,s=this.overridingAnimContext;this.overridingAnimFrozen&&(this.frozen=this.overridingAnimFrozen),this.overridingAnim&&(this.overridingAnim.onCompleted.remove(this.animRelease,this),this.currentAnim=this._overridedAnim,this.overridingAnimName=this.overridingAnim=this._overridedAnim=this.overridingAnimCallback=this.overridingAnimContext=void 0),!i&&e&&e.call(s||this)}},initOpaqueVertices:function(){this.opaqueVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},getOpaqueVertices:function(){var t=this.size.x,i=this.size.y,e=this.pos.x,s=this.pos.y,n=this.opaqueOffset;this.currentAnim&&this.currentAnim.opaqueOffset&&(n=this.currentAnim.opaqueOffset.tiles&&this.currentAnim.opaqueOffset.tiles[this.currentAnim.tile]||this.currentAnim.opaqueOffset);var a=e+n.left,o=s+n.top,h=e+t+n.right,r=s+i+n.bottom,l=e+.5*t,g=s+.5*i,u=this.opaqueVertices[0],c=this.opaqueVertices[1],d=this.opaqueVertices[2],p=this.opaqueVertices[3];if(0!==this.angle){var m=Math.cos(this.angle),f=Math.sin(this.angle),y=a-l,E=o-g,v=h-l,T=r-g;u.x=l+y*m-E*f,u.y=g+y*f+E*m,c.x=l+v*m-E*f,c.y=g+v*f+E*m,d.x=l+v*m-T*f,d.y=g+v*f+T*m,p.x=l+y*m-T*f,p.y=g+y*f+T*m}else u.x=a,u.y=o,c.x=h,c.y=o,d.x=h,d.y=r,p.x=a,p.y=r;return this.opaqueVertices},castShadow:function(t,i,e,s,r,l){if(this._contours||(this._utilVec2Cast1={x:0,y:0},this._utilVec2Cast2={x:0,y:0},this._utilVec2Cast3={x:0,y:0},this._utilVec2Cast4={x:0,y:0},this._utilVec2Project1={x:0,y:0},this._utilVec2Project2={x:0,y:0},this._utilVec2Project3={x:0,y:0},this._utilVec2Project4={x:0,y:0},this._contourPool=[],this._contours=[]),this.opaqueFromVertices?this._verticesFound||(this.opaqueVertices=this.verticesWorld=this.getVerticesWorld()):(this.opaqueVertices||this.initOpaqueVertices(),this._verticesFound||this.getOpaqueVertices()),this._verticesFound=!0,this.hollow||!a.pointInPolygon(e.x,e.y,this.opaqueVertices)){var g,u,c,d,p,m,f,y,E,v,T,A,_,I,x,C,S,w,N=this.diffuse>=1||t.diffuse>=1?1:this.diffuse*t.diffuse,O=this.opaqueVertices,b=s+2*l,L=r+2*l,R=!1,D=this._contourPool,M=this._contours,P=O[O.length-1];for(_=0,I=O.length;I>_;_++){v=O[_];var F,k,G,Y;if(P.x<v.x?(F=P.x,G=v.x):(F=v.x,G=P.x),P.y<v.y?(k=P.y,Y=v.y):(k=v.y,Y=P.y),a.AABBIntersect(F,k,G,Y,s,r,b,L)){R=!0;var z=n.copy(this._utilVec2Cast1,v);n.subtract(z,P);var B=n.set(this._utilVec2Cast2,z.y,-z.x),H=n.copy(this._utilVec2Cast3,P);if(n.subtract(H,e),n.dot(B,H)>0){var U=n.copy(this._utilVec2Cast4,v);n.subtract(U,e),D.push({vertices:this.projectShadow(e,l,P,v,H,U,z),verticesActual:[P,v],verticesHollow:[]})}}P=v}if(R){for(_=0,I=D.length;I>_;_++){for(g=D[_],u=g.vertices,E=!1,P=u[0],v=u[1],T=u[u.length-2],A=u[u.length-1],x=_+1;I>x;x++){if(c=D[x],d=c.vertices,p=d[0],m=d[1],f=d[d.length-2],y=d[d.length-1],n.equal(P,y)&&n.equal(v,f)){E=!0,D[x]={vertices:d.slice(0,-1).concat(u.slice(2)),verticesActual:c.verticesActual.slice(0,-1).concat(g.verticesActual),verticesHollow:g.verticesHollow.concat(P,c.verticesHollow)};break}if(n.equal(T,m)&&n.equal(A,p)){E=!0,D[x]={vertices:u.slice(0,-1).concat(d.slice(2)),verticesActual:g.verticesActual.slice(0,-1).concat(c.verticesActual),verticesHollow:c.verticesHollow.concat(A,g.verticesHollow)};break}}E!==!0&&M.push(g)}if(this.hollow)for(_=0,I=M.length;I>_;_++)g=M[_],g.vertices=g.vertices.concat(g.verticesHollow);else{var X=O.slice(0),W={},V=[],q=!1;for(_=0,I=X.length;I>_;_++){var K=X[_],j=!1;for(x=0,C=M.length;C>x;x++){g=M[x];var Z=g.verticesActual;for(S=0,w=Z.length;w>S;S++){var Q=Z[S];if(K.x===Q.x&&K.y===Q.y){j=!0,V&&(W[0===x?C-1:x-1]=V,V=void 0,q=!0);break}}if(j===!0)break}j===!1&&(V||(V=[]),V.push(K))}if(V&&(W[C-1]=V!==W[C-1]?V.concat(W[C-1]||[]):V),q){var J={vertices:[]};for(_=0,I=M.length;I>_;_++)g=M[_],J.vertices=J.vertices.concat(g.vertices,W[_]||[]);M=[J]}else M.push({vertices:X})}if(t.pixelPerfect)for(_=0,I=M.length;I>_;_++)g=M[_],o.pixelFillPolygon(i,s,r,b,L,g.vertices,1,1,1,N,!0,a.boundsOfPoints(g.vertices));else for(i.fillStyle=h.RGBAToCSS(1,1,1,N),_=0,I=M.length;I>_;_++)g=M[_],o.fillPolygon(i,g.vertices,-s,-r,t.scale);D.length=M.length=0}}},projectShadow:function(t,i,e,s,a,o,h){var r=this._utilVec2Project1,l=n.copy(this._utilVec2Project2,a);n.inverse(l);var g=n.dot(h,l)/n.lengthSquared(h);if(0>g)n.copy(r,e);else if(g>1)n.copy(r,s);else{n.copy(r,e);var u=n.copy(this._utilVec2Project3,h);n.multiplyScalar(u,g),n.add(r,u)}var c=n.copy(this._utilVec2Project4,r);n.subtract(c,t),n.normalize(c),n.multiplyScalar(c,i),n.normalize(a),n.multiplyScalar(a,i),n.normalize(o),n.multiplyScalar(o,i);var d=n.clone(e);n.add(d,a);var p=n.clone(s);n.add(p,o);var m,f;return 0>g?(f=n.clone(s),n.add(f,c),[e,d,f,p,s]):g>1?(m=n.clone(e),n.add(m,c),[e,d,m,p,s]):(m=n.clone(e),n.add(m,c),f=n.clone(s),n.add(f,c),[e,d,m,f,p,s])},activate:function(t){this.activated=!0,this.activateCallback&&this.activateCallback.call(this.activateContext||this,t)},deactivate:function(t){this.activated=!1,this.deactivateCallback&&this.deactivateCallback.call(this.deactivateContext||this,t)},toggleActivate:function(t){!this.alwaysToggleActivate&&this.activated?this.deactivate(t):this.activate(t)},setHidden:function(t){t?this.hide():this.unhide()},hide:function(){this.hidden=!0},unhide:function(){this.hidden=!1},fadeTo:function(i,e){return this.alpha!==i?(e=ig.merge({name:"fade",duration:t.DURATION_FADE},e),this.tween({alpha:i||0},e)):void(e&&(e.onUpdate&&e.onUpdate(),e.onComplete&&e.onComplete()))},fadeIn:function(t){return this.fadeTo(1,t)},fadeOut:function(t){return this.fadeTo(0,t)},fadeToDeath:function(t){t=t||{};var i=this,e=t.onComplete;return t.onComplete=function(){ig.game.removeEntity(i),e&&e()},this.fadeTo(0,t)},tween:function(t,e){var s=this;e=e||{};var n=e.name||"tween",a=this.tweens[n];if(a&&a.stop(),!e.noComplete){var o=e.onComplete;e.onComplete=function(){delete s.tweens[n],"function"==typeof o&&o()}}return this.tweens[n]=i.tween(this,t,e)},tweenEnd:function(t){if("string"==typeof t){var i=this.tweens[t];i&&(i.stop(),delete this.tweens[t])}else for(t in this.tweens)this.tweenEnd(t)},moveTo:function(t,i){if(t&&this.movingTo!==t){if(this.moveToStop(),i=i||{},e.isArray(t)){if(0===t.length)return;if(this.movingToSequence=t.slice(0),t=this.movingToSequence.shift(),this.movingTo===t)return;this.movingToOnce=!0}"undefined"!=typeof i.once&&(this.movingToOnce=i.once);var s=!this.fixed&&this.performance===ig.EntityExtended.PERFORMANCE.STATIC;if(t instanceof ig.EntityExtended&&(i.matchPerformance||this.ignoreSystemScale||this.scale!==ig.system.scale)&&this.performance!==ig.EntityExtended.PERFORMANCE.MOVABLE&&(this.setPerformance(ig.EntityExtended.PERFORMANCE.MOVABLE),s=!1),i.randomOffsetPct){i.baseOffsetPct=i.baseOffsetPct||i.offsetPct||{x:0,y:0};var n=i.randomOffsetPct;n.x=n.x||0,n.y=n.y||0,i.offsetPct={x:i.baseOffsetPct.x+(2*Math.random()*n.x-n.x),y:i.baseOffsetPct.y+(2*Math.random()*n.y-n.y)}}if(!s||i.lerp||i.tween){if(this.frozen=!1,this.movingTo=t,this.movedTo=!1,this.movingToSettings=i,i.tween&&this.performance!==ig.EntityExtended.PERFORMANCE.DYNAMIC){this.movingToTweening=!0,this.movingToTweenPct=0,this.movingToTweenX=this.pos.x,this.movingToTweenY=this.pos.y;var a=i.tweenSettings=i.tweenSettings||{};a.name="movingTo",a.onComplete=function(){this.moveToUpdate(),this.moveToComplete()}.bind(this),this.tween({movingToTweenPct:1},a)}return!0}this.moveToPosition(t,i),this.recordChanges()}return!1},moveToSequenceNext:function(){this.movingToSequence&&(this.movingToSequence.length>0?(this.movingTo=null,this.moveTo(this.movingToSequence.shift(),this.movingToSettings)):(this.movingToSequence=void 0,this.moveToComplete(),this.moveToStop()))},moveToUpdate:function(){!this.movingTo||this.movedTo&&!this.movingTo.changed||this.moveToPosition(this.movingTo,this.movingToSettings)},moveToPosition:function(i,e){var n=0,a=0,o=.5,h=.5;if(i instanceof ig.EntityExtended){if(e){var r=e.align;r&&("undefined"!=typeof r.x&&(o=r.x),"undefined"!=typeof r.y&&(h=r.y));var l=e.offset;l&&(n+=l.x*i.scaleMod||0,a+=l.y*i.scaleMod||0);var g=e.offsetPct;if(g){var u=g.x||0,c=g.y||0;n+=u*(.5*i.size.x*i.scaleMod+.5*this.size.x*this.scaleMod)*(i.flip.x?-1:1),a+=c*(.5*i.size.y*i.scaleMod+.5*this.size.y*this.scaleMod)}e.flipWith&&(this.flip.x=i.flip.x,this.flip.y=i.flip.y)}n+=i.pos.x+o*(i.size.x*i.scaleMod-this.size.x*this.scaleMod),a+=i.pos.y+h*(i.size.y*i.scaleMod-this.size.y*this.scaleMod),this.fixed?i.fixed||(n-=ig.game.screen.x,a-=ig.game.screen.y):i.fixed&&(n+=ig.game.screen.x,a+=ig.game.screen.y)}else{if(e){var r=e.align;r&&("undefined"!=typeof r.x&&(o=r.x),"undefined"!=typeof r.y&&(h=r.y));var l=e.offset;l&&(n+=l.x||0,a+=l.y||0);var g=e.offsetPct;if(g){var u=g.x||0,c=g.y||0;n+=u*this.size.x*.5,a+=c*this.size.y*.5}}n+=i.x+o*this.size.x,a+=i.y+h*this.size.y,this.fixed&&(n-=ig.game.screen.x,a-=ig.game.screen.y)}var d=n-this.pos.x,p=a-this.pos.y;this.movingToTweening?(this.pos.x=this.movingToTweenX+(n-this.movingToTweenX)*this.movingToTweenPct,this.pos.y=this.movingToTweenY+(a-this.movingToTweenY)*this.movingToTweenPct):e&&e.lerp?(this.pos.x+=d*e.lerp,this.pos.y+=p*e.lerp):(this.pos.x=n,this.pos.y=a),s.almostEqual(d,0,t.PRECISION_ZERO)&&s.almostEqual(p,0,t.PRECISION_ZERO)&&this.moveToComplete()},moveToComplete:function(){return this.movingToSequence?void this.moveToSequenceNext():(this.movingToOnce&&this.moveToStop(),this.movedTo=!0,this.onMovedTo.dispatch(this),!0)},moveToStop:function(){this.movingTo&&(this.movingToTweening&&(this.tweenEnd("movingTo"),this.movingToTweenPct=this.movingToTweenX=this.movingToTweenY=0),this.movedTo=this.movingToTweening=this.movingToOnce=!1,this.movingTo=this.movingToSettings=this.movingToSequence=null)},moveAllStop:function(){this.moveToStop(),this.applyAntiVelocity()},lookAt:function(i){if(i&&this!==i&&!i.fixed){var e,s,n,a=this.pos.x+.5*this.size.x;if(t.TOP_DOWN){e=this.pos.y+.5*this.size.y,i instanceof ig.EntityExtended?(s=i.pos.x+.5*i.size.x,n=i.pos.y+.5*i.size.y):(s=i.x,n=i.y);var o=a-s,h=e-n;Math.abs(o)>Math.abs(h)?(this.facing.y=0,o>0?(this.flip.x=this.canFlipX,this.facing.x=-1):(this.flip.x=!1,this.facing.x=1)):(this.facing.x=0,h>0?(this.flip.y=this.canFlipY,this.facing.y=-1):(this.flip.y=!1,this.facing.y=1))}else s=i instanceof ig.EntityExtended?i.pos.x+.5*i.size.x:i.x,a>s?(this.flip.x=this.canFlipX,this.facing.x=-1):(this.flip.x=!1,this.facing.x=1)}},lineOfSight:function(t){if(t.hidden)return!1;var i=ig.game.collisionMap,e=i.tilesize,s=(this.pos.x+.5*this.size.x)/e|0,n=(this.pos.y+.5*this.size.y)/e|0,a=(t.pos.x+.5*t.size.x)/e|0,o=(t.pos.y+.5*t.size.y)/e|0,h=a-s,l=o-n,g=Math.sqrt(h*h+l*l),u=h/g,c=l/g;s=Math.round(s+u),n=Math.round(n+c);for(var d=0,p=(0|g)-2;p>d;d++){var m=0|s,f=0|n,y=i.data[f][m];if(!r.isTileWalkableStrict(y))return!1;s+=u,n+=c}return!0},receiveDamage:function(t,i,e){return this.invulnerable&&!e||!t?!1:(this.health-=t,this.health<=0&&this.kill(),!0)},manageStart:function(){this.managed=!0},manageStop:function(){this.managed=!1},pause:function(){this.paused=!0;var t,i,e;for(t in this.anims)i=this.anims[t],i&&i.timer.pause();for(var t in this.tweens)e=this.tweens[t],e&&e.pause()},unpause:function(){this.paused=!1;var t,i,e;for(t in this.anims)i=this.anims[t],i&&i.timer.unpause();for(var t in this.tweens)e=this.tweens[t],e&&e.unpause()},link:function(t,i){t!==this&&(this.unlink(!1),this.linkedTo=t,this.linkedTo&&(ig.system.onResized.remove(this.refresh,this),this._killed||(this.linkedTo.onRefreshed.add(this.refresh,this),this.linkedTo.onRemoved.add(this.unlink,this))),i===!1||this._killed||this.refresh(!0))},unlink:function(t){this.linkedTo&&(this.linkedTo.onRefreshed.remove(this.refresh,this),this.linkedTo.onRemoved.remove(this.unlink,this),this._killed||ig.system.onResized.add(this.refresh,this),this.linkedTo=null),t===!1||this._killed||this.refresh(!0)},kill:function(t){this.dieing||(this.dieing=!0,this.dieingSilently=t||!1,t?this.die():this.death())},death:function(t){t&&this.anims[t]||(t=this.getDirectionalAnimName("death")),this.anims[t]?(ig.game.flagAsKilled(this),this.applyAntiVelocity(),this.animOverride(t,{callback:this.die})):this.die()},die:function(){ig.game.removeEntity(this)},cleanup:function(){if(this._cleanupPersistent&&(this._cleanupPersistent=!1,this.cleanupPersistent()),this.unhide(),this.tweenEnd(),this.moveAllStop(),this.unlink(!1),this.animRelease(),this.currentAnim=null,this.onRemoved.dispatch(this),ig.system.onResized.remove(this.refresh,this),!ig.game.hasLevel){this.onAdded.removeAll(),this.onAdded.forget(),this.onRemoved.removeAll(),this.onRemoved.forget(),this.onMovedTo.removeAll(),this.onMovedTo.forget(),this.onRefreshed.removeAll(),this.onRefreshed.forget();for(var t in this.anims){var i=this.anims[t];i.onCompleted.removeAll(),i.onCompleted.forget()}}},cleanupPersistent:function(){},cleanupCollision:function(){this.wasChecking=this.checking,this.checking=this.intersecting=this.collidingWithEntitiesBelow=!1},intersectWith:function(t){this.intersecting=!0},check:function(t){this.checking=!0},collideWith:function(t,i,e,n,a,o){var h,r;if(o)this===o&&(0!==i?(s.oppositeSidesOfZero(this.vel.x,i)?this.vel.x+=t.vel.x:this.vel.x=-this.vel.x*this.bounciness+t.vel.x,h=ig.game.collisionMap.trace(this.pos.x,this.pos.y,n,0,this.size.x,this.size.y,this.collisionMapResult)):(this.vel.y=-this.vel.y*this.bounciness+t.vel.y,r=0,e>0&&(this.collidingWithEntitiesBelow=!0,(t.collides>=ig.EntityExtended.COLLIDES.FIXED||this.collides===ig.EntityExtended.COLLIDES.LITE)&&Math.abs(this.vel.y-t.vel.y)<this.minBounceVelocity&&(this.setGrounded(),t.moving&&(r=t.pos.x-t.last.x))),h=ig.game.collisionMap.trace(this.pos.x,this.pos.y,r,n,this.size.x,this.size.y,this.collisionMapResult)),(h.pos.x!==this.pos.x||h.pos.y!==this.pos.y)&&(this.pos.x=h.pos.x,this.pos.y=h.pos.y,this.recordChanges(!0)));else{if(0!==i)this.vel.x=a,h=ig.game.collisionMap.trace(this.pos.x,this.pos.y,.5*n,0,this.size.x,this.size.y,this.collisionMapResult);else{var l;if(e>0)this.collidingWithEntitiesBelow=!0,r=t.collides>=ig.EntityExtended.COLLIDES.FIXED||this.collides===ig.EntityExtended.COLLIDES.LITE?t.vel.x*ig.system.tick:0,l=t.grounded&&t.collidingWithMap;else{if(this.grounded&&this.collidingWithMap)return;r=0}l?(h=ig.game.collisionMap.trace(this.pos.x,this.pos.y,r,n,this.size.x,this.size.y,this.collisionMapResult),this.bounciness>0&&this.vel.y>this.minBounceVelocity?this.vel.y*=-this.bounciness:this.setGrounded()):(this.vel.y=a,h=ig.game.collisionMap.trace(this.pos.x,this.pos.y,r,.5*n,this.size.x,this.size.y,this.collisionMapResult))}!h||h.pos.x===this.pos.x&&h.pos.y===this.pos.y||(this.pos.x=h.pos.x,this.pos.y=h.pos.y,this.recordChanges(!0))}},handleMovementTrace:function(t){var i,e,n=this.grounded;if(this.hasGravity&&(this.standing=!1,0===this.vel.y||this.collidingWithEntitiesBelow||(this.grounded=!1)),this.collidingWithMap=!1,t.tile.x&&r.isTileClimbable(t.tile.x)?t.pos.x=this.pos.x+this.vel.x*ig.system.tick:t.collision.x&&(this.collidingWithMap=!0,this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0),t.tile.y&&r.isTileClimbable(t.tile.y))if(this.climbing||!this.hasGravity||this._climbingIntentUp)t.pos.y=this.pos.y+this.vel.y*ig.system.tick,t.collision.y=t.collision.slope=!1;else if(this._climbingIntentDown){i=ig.game.collisionMap;var a=Math.floor((this.pos.y+this.size.y+.5*i.tilesize)/i.tilesize);e=i.data[a];var o=e&&e[Math.floor(this.pos.x/i.tilesize)],h=e&&e[Math.floor((this.pos.x+this.size.x)/i.tilesize)];"undefined"!=typeof o&&!r.isTileWalkable(o)||"undefined"!=typeof h&&!r.isTileWalkable(h)||(t.pos.y=this.pos.y+this.vel.y*ig.system.tick,t.collision.y=t.collision.slope=!1)}if(t.collision.y&&(this.collidingWithMap=!0,this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:this.vel.y<0?this.vel.y=0:this.setGrounded()),t.collision.slope){var l=this.slope=t.slope;this.collidingWithMap=!0,l.angle=Math.atan2(l.ny,l.nx),l.angle>this.slopeStanding.min&&l.angle<this.slopeStanding.max?(this.setGrounded(),0!==this.accel.x&&!s.oppositeSidesOfZero(this.accel.x,this.vel.x)&&l.nx*this.vel.x<=0&&(this.vel.y=0,t.pos.y+=-Math.abs((l.angle+s.HALFPI)*this.vel.x)*this.slopeSpeedMod*ig.system.tick)):this.vel.y<0&&(this.vel.y=0)}else this.slope&&(this.jumping||this.setGrounded(),this.slope=null);if(n&&n!==this.grounded&&!this.jumping){i=ig.game.collisionMap,e=i.data[Math.floor((this.pos.y+this.size.y+1)/i.tilesize)];var g=e&&e[Math.floor((this.pos.x+.5*this.size.x)/i.tilesize)];("undefined"==typeof g||r.isTileWalkableStrict(g))&&(this.vel.y=0,t.pos.y=this.pos.y)}this.slopeSticking&&this.slope&&0===this.vel.x||(this.pos.x=t.pos.x,this.pos.y=t.pos.y)},update:function(){this.paused?ig.game.camera&&!ig.game.camera.paused&&(this.visible=this.getIsVisible()):this.frozen||(this.performance===ig.EntityExtended.PERFORMANCE.STATIC?this._changedAdd&&this.changed&&(this.updateBounds(),this.changed=!1):(this.controllable&&!this._killed&&(this.updateChanges(),this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC&&this.updateDynamics()),this.recordChanges(),this.recordLast()),this.visible=this.getIsVisible(),this.visible?this.updateVisible():this.dieing&&this.canDieInstantly&&this.die(),this.currentAnim&&this.currentAnim.update())},recordLast:function(){n.copy(this.last,this._posLast),n.copy(this._posLast,this.pos),n.copy(this._sizeLast,this.size),this._angleLast=this.angle},recordChanges:function(i){i===!0||this.pos.x!==this.last.x||this.pos.y!==this.last.y||this.size.x!==this._sizeLast.x||this.size.y!==this._sizeLast.y||this.angle!==this._angleLast?(this.changed=!0,0!==this.vel.x?(this.movingX=!0,this.vel.x<0?this.flip.x=this.canFlipX:this.flip.x=!1):this.movingX=!1,0!==this.vel.y?(this.movingY=!this.hasGravity||this.vel.y<0||!this.grounded||!!this.slope&&this.movingX,(t.TOP_DOWN||this.canFlipY)&&(this.vel.y<0?this.flip.y=this.canFlipY:this.flip.y=!1)):this.movingY=!1,this.moving=this.movingX||this.movingY,this.updateBounds()):this.changed=this.moving=this.movingX=this.movingY=!1},updateBounds:function(){this.posDraw.x=this.getPosDrawX(),this.posDraw.y=this.getPosDrawY(),this.sizeDraw.x=this.getSizeDrawX(),this.sizeDraw.y=this.getSizeDrawY(),this.needsVertices?(this._verticesFound=!0,this.verticesWorld=this.getVerticesWorld()):this._verticesFound=!1},updateChanges:function(){this.moveToUpdate()},updateDynamics:function(){0===this.gravityFactor||0===ig.game.gravity?this.hasGravity=!1:(this.hasGravity=!0,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor),this.updateVelocity();var t=ig.game.collisionMap.trace(this.pos.x,this.pos.y,this.vel.x*ig.system.tick,this.vel.y*ig.system.tick,this.size.x,this.size.y,this.collisionMapResult);this.handleMovementTrace(t)},updateVelocity:function(){this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y)},updateVisible:function(){this.overridingAnim&&this.currentAnim!==this.overridingAnim&&(this._overridedAnim=this.currentAnim,this.currentAnim=this.overridingAnim),this._changedAdd&&(this._changedAdd=!1,this.updateBounds())},draw:function(){if(this.currentAnim&&this.visible){var t=this.posDraw.x,i=this.posDraw.y,e=this.currentAnim.alpha,s=this.currentAnim.flip;this.currentAnim.alpha*=this.alpha,this.currentAnim.flip=this.flip;var n;0!==this.angle&&(n=this.currentAnim.angle,this.currentAnim.angle=this.angle,t+=.5*(this.sizeDraw.x-this.currentAnim.sheet.width),i+=.5*(this.sizeDraw.y-this.currentAnim.sheet.height)),this.fixed?this.currentAnim.draw(t,i,this.scale,this.textured?this:void 0):this.currentAnim.draw(t-ig.game.screen.x,i-ig.game.screen.y,this.scale,this.textured?this:void 0),this.currentAnim.alpha=e,this.currentAnim.flip=s,0!==this.angle&&(this.currentAnim.angle=n)}}}),ig.EntityExtended.PERFORMANCE={},ig.EntityExtended.PERFORMANCE.STATIC=t.STATIC||"static",ig.EntityExtended.PERFORMANCE.MOVABLE=t.MOVABLE||"movable",ig.EntityExtended.PERFORMANCE.DYNAMIC=t.DYNAMIC||"dynamic",ig.EntityExtended.TYPE=function(){var t,i,s=[],n=[];for(t in ig.Entity.TYPE)s.push({name:t,flag:ig.Entity.TYPE[t]});s.sort(function(t,i){return t.flag-i.flag});for(var a=0,o=s.length;o>a;a++){var h=s[a];t=h.name,i=h.flag,0===i||0!==(i&i-1)?n.push(h):e.getType(ig.EntityExtended,t)}for(var a=0,o=n.length;o>a;a++){var h=n[a];t=h.name,i=h.flag,ig.EntityExtended.TYPE[t]=i}return ig.EntityExtended.TYPE}(),ig.EntityExtended.TYPE.NONE,ig.EntityExtended.TYPE.A,ig.EntityExtended.TYPE.B,ig.EntityExtended.TYPE.BOTH,e.getType(ig.EntityExtended,"INTERACTIVE"),ig.EntityExtended.TYPE.INTERACTIVE,e.getType(ig.EntityExtended,"DAMAGEABLE"),ig.EntityExtended.TYPE.DAMAGEABLE,e.getType(ig.EntityExtended,"DANGEROUS"),ig.EntityExtended.TYPE.DANGEROUS,ig.EntityExtended.GROUP={},ig.EntityExtended.GROUP.NONE=0,e.getType(ig.EntityExtended,"FRIEND","GROUP"),ig.EntityExtended.GROUP.FRIEND,e.getType(ig.EntityExtended,"ENEMY","GROUP"),ig.EntityExtended.GROUP.ENEMY,ig.EntityExtended.COLLIDES=ig.merge({},ig.Entity.COLLIDES),ig.EntityExtended.COLLIDES.DOUBLEFIXED=ig.EntityExtended.COLLIDES.FIXED+ig.EntityExtended.COLLIDES.FIXED;var l=ig.EntityExtended.COLLIDES.ACTIVE,g=ig.EntityExtended.COLLIDES.DOUBLEFIXED;ig.EntityExtended.checkPair=function(i,e){i.intersectWith(e),e.intersectWith(i),0===(i.group&e.group)&&(i.checkAgainst&e.type&&i.check(e),e.checkAgainst&i.type&&e.check(i),!(i.collides&&e.collides&&i.collides+e.collides>l&&(t.COLLISION.ALLOW_FIXED||i.collides+e.collides<g))||i.oneWay&&!e.getIsCollidingWithOneWay(i)||e.oneWay&&!i.getIsCollidingWithOneWay(e)||ig.EntityExtended.solveCollision(i,e))},ig.EntityExtended.solveCollision=function(t,i){var e=null;t.collides===ig.EntityExtended.COLLIDES.LITE||i.collides===ig.EntityExtended.COLLIDES.FIXED?e=t:(i.collides===ig.EntityExtended.COLLIDES.LITE||t.collides===ig.EntityExtended.COLLIDES.FIXED)&&(e=i);var s,n,a,o,h,r;t.pos.x<i.pos.x?(a=t,o=i,h=t.pos.x+t.size.x-i.pos.x):(a=i,o=t,h=i.pos.x+i.size.x-t.pos.x),t.pos.y<i.pos.y?(s=t,n=i,r=t.pos.y+t.size.y-i.pos.y):(s=i,n=t,r=i.pos.y+i.size.y-t.pos.y);var l;r>h||n.grounded&&s.collides===ig.EntityExtended.COLLIDES.FIXED?a.collides+o.collides>=g?(a.collideWith(o,1,0,-h,0),o.collideWith(a,-1,0,h,0)):(l=.5*(a.vel.x-o.vel.x),a.collideWith(o,1,0,-h,-l,e),o.collideWith(a,-1,0,h,l,e)):s.collides+n.collides>=g?(s.collideWith(n,0,1,-r,0),n.collideWith(s,0,-1,r,0)):(l=.5*(s.vel.y-n.vel.y),s.collideWith(n,0,1,-r,-l,e),n.collideWith(s,0,-1,r,l,e))},ig.global.wm&&ig.EntityExtended.inject({visible:!0,touches:function(t){return a.pointInAABB(t.pos.x,t.pos.y,this.pos.x,this.pos.y,this.pos.x+this.size.x,this.pos.y+this.size.y)},activate:function(){},draw:function(){if(this.refresh(!0),this.updateVisible(),this.textured)for(var t in this.anims)this.anims[t].texturize(this);this.parent()}})}),ig.baked=!0,ig.module("plusplus.entities.light").requires("plusplus.core.entity","plusplus.core.config","plusplus.core.image-drawing","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.utilsvector2","plusplus.helpers.utilsintersection","plusplus.helpers.utilscolor").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils,e=ig.utilsmath,s=ig.utilsvector2,n=ig.utilsintersection,a=ig.utilscolor;ig.EntityLight=ig.global.EntityLight=ig.EntityExtended.extend({_wmScalable:!0,_wmScalableLinked:!0,layerName:"lights",size:{x:10,y:10},radius:10,r:t.LIGHT.R,g:t.LIGHT.G,b:t.LIGHT.B,alpha:t.LIGHT.ALPHA,dynamicColor:!1,pixelPerfect:t.LIGHT.PIXEL_PERFECT,gradient:t.LIGHT.GRADIENT,castsShadows:t.LIGHT.CASTS_SHADOWS,castsShadowsMovable:t.LIGHT.CASTS_SHADOWS_MOVABLE,items:[],diffuse:t.LIGHT.DIFFUSE,samples:t.LIGHT.SAMPLES,image:null,imageBase:null,imageCast:null,imageColor:null,_shadowCastingInitialized:!1,_dirtySize:!1,_dirtyColor:!1,_scaleComputedAt:0,_rLast:0,_gLast:0,_bLast:0,_alphaLast:0,_sizeLast:{x:0,y:0},_radiusLast:0,initTypes:function(){this.parent(),i.addType(ig.EntityExtended,this,"type","LIGHT")},initProperties:function(){this.image=new ig.ImageDrawing,this.imageBase=new ig.ImageDrawing,this.imageCast=new ig.ImageDrawing,this.imageColor=new ig.ImageDrawing,this.parent()},resetCore:function(t,i,e){e&&e.radius&&(this.size.x=this.size.y=2*e.radius),this.parent(t,i,e),this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC&&(this.performance=ig.EntityExtended.PERFORMANCE.MOVABLE)},resize:function(t){return this.recordChanges(),this.changed&&(t=this.needsRebuild=!0),t},rebuild:function(){this.compute(),this.parent()},ready:function(){ig.system.onResized.add(this.resize,this),this.parent()},getRadius:function(){return.5*Math.max(this.size.x,this.size.y)},getSizeDrawX:function(){return 2*this.radius},getSizeDrawY:function(){return 2*this.radius},compute:function(){this.castsShadows&&(this.performance===ig.EntityExtended.PERFORMANCE.MOVABLE||this._changedAdd)&&this.findItems(),(this.changed||this._changedAdd)&&(this.performance===ig.EntityExtended.PERFORMANCE.STATIC&&(this.changed=!1),(this._dirtySize||this.castsShadows&&!this.imageCast)&&(this._dirtySize=!1,this._scaleComputedAt=this.scale,this.resizeCache(),this.drawLight()),this.castsShadows&&this.drawShadows())},resizeCache:function(){var t=2*this.radius;this.pixelPerfect||(t*=this.scale),this.castsShadows?(this.image.setDimensions(t,t),this.imageBase.setDimensions(t,t),this.imageCast.setDimensions(t,t)):(this.image.setDimensions(t,t),(0!==this.imageBase.width||0!==this.imageBase.height)&&this.imageBase.setDimensions(0,0),(0!==this.imageCast.width||0!==this.imageCast.height)&&this.imageCast.setDimensions(0,0)),
this.dynamicColor&&(this.imageColor.setDimensions(t,t),this._dirtyColor=!0)},drawLight:function(){var t,i,s,o,h,r=this.castsShadows?this.imageBase:this.image;if(this.dynamicColor?(s=1,o=1,h=1):(s=this.r,o=this.g,h=this.b),t=r.dataContext,this.pixelPerfect){var l=2*this.radius;i=t.createImageData(l,l);for(var g=0;l>g;g++)for(var u=0;l>u;u++)if(n.pointInCircle(g,u,this.radius,this.radius,this.radius)){var c=4*(g+u*l);if(i.data[c]=255*s|0,i.data[c+1]=255*o|0,i.data[c+2]=255*h|0,this.gradient){var d=this.radius-g,p=this.radius-u,m=1-Math.sqrt(d*d+p*p)/this.radius;i.data[c+3]=255*m|0}else i.data[c+3]=255}t.putImageData(i,0,0),r.finalize(1)}else{var f=this.radius*this.scale;if(this.gradient){var y=2*f,E=a.radialGradient(f,[{r:s,g:o,b:h},{r:s,g:o,b:h,a:0}]);t.fillStyle=E,t.fillRect(0,0,y,y)}else t.fillStyle=a.RGBToCSS(s,o,h),t.arc(f,f,f,0,e.TWOPI,!1),t.fill();r.finalize(this.scale)}},findItems:function(){var t=this.pos.x,i=this.pos.y,e=t+this.size.x,s=i+this.size.y,a=this.items.length;this.items.length=0;for(var o=0,h=ig.game.layers.length;h>o;o++){var r=ig.game.layers[o];if(r.numEntities)for(var l=r.itemsOpaque,g=0,u=l.length;u>g;g++){var c=l[g];if(c._killed!==!0&&(c.performance===ig.EntityExtended.PERFORMANCE.STATIC||this.castsShadowsMovable&&!this.pixelPerfect)&&n.AABBIntersect(t,i,e,s,c.pos.x,c.pos.y,c.pos.x+c.size.x,c.pos.y+c.size.y)){this.items.push(c);var d=c.currentAnim;c.changed?this.changed=!0:d&&(d!==c._animCastShadow&&(d.opaqueOffset||c._animCastShadow&&c._animCastShadow.opaqueOffset)||d.changed&&d.opaqueOffset&&d.opaqueOffset.tiles)&&(this.changed=!0,c.opaqueFromVertices||(c._verticesFound=!1)),c._animCastShadow=d}}}a!==this.items.length&&(this.changed=!0)},_initShadowCasting:function(){this._shadowCastingInitialized||(this._utilVec2Samples1={x:0,y:0},this._utilVec2Samples2={x:0,y:0},this._utilVec2Samples3={x:0,y:0})},drawShadows:function(){this._initShadowCasting();var t=this.imageCast.dataContext,i=2*this.radius;this.pixelPerfect?(t.clearRect(0,0,i,i),this.castShadows(),this.imageCast.finalize(1)):(i*=this.scale,t.clearRect(0,0,i,i),this.castShadows(),this.imageCast.finalize(this.scale));var e=this.image.dataContext,s=e.globalCompositeOperation;e.clearRect(0,0,i,i),e.drawImage(this.imageBase.data,0,0),e.globalCompositeOperation="destination-out",e.drawImage(this.imageCast.data,0,0),e.globalCompositeOperation=s,this.image.finalize(this.pixelPerfect?1:this.scale)},castShadows:function(){var t,i,n=this.imageCast.dataContext,a=this.pos.x,o=this.pos.y,h=this.radius,r=s.set(this._utilVec2Samples1,a+h,o+h);if(1===this.samples)for(t=0,i=this.items.length;i>t;t++)this.items[t].castShadow(this,n,r,a,o,h);else for(var l=0;l<this.samples;++l){var g=l*e.GOLDEN_ANGLE,u=Math.sqrt(l/this.samples)*this.radius,c=s.set(this._utilVec2Samples2,Math.cos(g)*u,Math.sin(g)*u);for(s.copy(this._utilVec2Samples3,r),s.add(this._utilVec2Samples3,c),t=0,i=this.items.length;i>t;t++)this.items[t].castShadow(this,n,this._utilVec2Samples3,a,o,h)}},cleanup:function(){ig.system.onResized.remove(this.resize,this),this.parent()},recordChanges:function(t){if(0===this.alpha)this.visible=!1;else{if(this._dirtySize=this._scaleComputedAt!==this.scale||this.radius-this._radiusLast!==0||this.size.x-this._sizeLast.x!==0|this.size.y-this._sizeLast.y!==0,(this.alpha-this._alphaLast!==0||this._dirtySize)&&(t=!0),this.dynamicColor){var i=this.r-this._rLast,e=this.g-this._gLast,n=this.b-this._bLast;(0!==i||0!==e||0!==n)&&(t=this._dirtyColor=!0),this._rLast=this.r,this._gLast=this.g,this._bLast=this.b}s.copy(this._sizeLast,this.size),this._radiusLast=this.radius,this._alphaLast=this.alpha}this.parent(t)},updateBounds:function(){this.radius=this.getRadius(),this.posDraw.x=this.pos.x,this.posDraw.y=this.pos.y},updateVisible:function(){this.compute(),this.parent()},draw:function(){var t=this.image;if(this.visible&&t){if(this.dynamicColor){if(this._dirtyColor){this._dirtyColor=!1;var i=2*this.radius;this.pixelPerfect||(i*=this.scale);var e=this.imageColor.dataContext;e.fillStyle=a.RGBToCSS(this.r,this.g,this.b),e.fillRect(0,0,i,i),e.globalCompositeOperation="destination-atop",e.drawImage(this.image.data,0,0),this.imageColor.finalize(this.pixelPerfect?1:this.scale)}t=this.imageColor}var s=ig.system.context;1!==this.alpha&&(s.globalAlpha=this.alpha),this.fixed?t.draw(this.posDraw.x,this.posDraw.y,void 0,void 0,void 0,void 0,this.scale):t.draw(this.posDraw.x-ig.game.screen.x,this.posDraw.y-ig.game.screen.y,void 0,void 0,void 0,void 0,this.scale),1!==this.alpha&&(s.globalAlpha=1)}}}),ig.global.wm&&ig.EntityLight.inject({dynamicColor:!0,init:function(t,i,e){this.parent(t,i,e),this.performance=ig.EntityExtended.PERFORMANCE.MOVABLE},findItems:function(){},resizeCache:function(){var t=2*this.radius;this.pixelPerfect||(t*=this.scale),this.imageBase=this.imageCast=this.image,this.image.setDimensions(t,t),this.imageColor.setDimensions(t,t),this._dirtyColor=!0},drawShadows:function(){},draw:function(){this.refresh(),this.parent()}})}),ig.baked=!0,ig.module("plusplus.core.layer").requires("plusplus.core.config","plusplus.core.entity","plusplus.core.background-map","plusplus.entities.light","plusplus.helpers.utils").defines(function(){var t=ig.CONFIG,i=ig.utils;ig.Layer=ig.Class.extend({name:"",zIndex:0,clearOnLoad:!0,noUpdate:!1,noDraw:!1,preRender:t.PRERENDER_MAPS,items:[],itemsTargetable:[],itemsInteractive:[],itemsOpaque:[],itemsLight:[],itemsChecking:[],spatialHash:{},spatialHashCellSize:64,autoSort:t.AUTO_SORT_LAYERS,sortBy:!1,numEntities:0,numBackgroundMaps:0,changed:!0,paused:!1,ignorePause:!1,_dirtySort:!1,_dirtyItems:!1,_itemsToAdd:[],init:function(t,i){this.name=t,ig.merge(this,i),this.reset()},reset:function(){if(this.changed=!0,this.paused=!1,this._dirtySort=!1,this.sortBy=this.sortBy||ig.game.sortBy,this.items.length>0){var t,i,e,s=this.items;if(!this.clearOnLoad)for(this._itemsToAdd=this.items.slice(0),i=0,e=this._itemsToAdd.length;e>i;i++)t=this._itemsToAdd[i],t.linkedTo&&(t._wasLinkedTo=t.linkedTo);for(this.items=[],this.itemsTargetable.length=this.itemsInteractive.length=this.itemsOpaque.length=this.itemsLight.length=this.itemsChecking.length=this.numBackgroundMaps=this.numEntities=0,i=0,e=s.length;e>i;i++)t=s[i],t instanceof ig.EntityExtended?ig.game.removeEntity(t):ig.game.removeItem(t)}},ready:function(){var t,i,e;if(this._itemsToAdd.length>0){for(t=0,i=this._itemsToAdd.length;i>t;t++)e=this._itemsToAdd[t],e._wasLinkedTo?(ig.game.spawnEntity(e,e.pos.x,e.pos.y,{linkedTo:e._wasLinkedTo}),delete e._wasLinkedTo):ig.game.spawnEntity(e,e.pos.x,e.pos.y,e._wasLinkedTo?{linkedTo:e._wasLinkedTo}:void 0);this._itemsToAdd.length=0}if(this.items.length>0){if(this.items.sort(this.sortBy),this.preRender&&this.numBackgroundMaps>1){var s,n,a=[];for(t=0,i=this.items.length;i>t;t++)e=this.items[t],e instanceof ig.BackgroundMap&&(e.preRender&&!e.repeat?(e.distance===n&&s||(s=[]),s.push(e)):s&&s.length>1&&(a.push(s),s=void 0),n=e.distance);for(s&&s.length>1&&a.push(s),t=0,i=a.length;i>t;t++){s=a[t];var o=s[0];o instanceof ig.BackgroundMapExtended||(o=s[0]=new ig.BackgroundMapExtended(o.tilesize,o.data,o.tilesetName));for(var h=1,r=s.length;r>h;h++)e=s[h],o.merge(e)&&this.removeItem(e)}}for(t=0,i=this.items.length;i>t;t++)e=this.items[t],e.adding&&e.adding()}},addItem:function(t){this._dirtyItems=!0,this.items.push(t),t.highPerformance?this._addEntity(t):(t.targetable&&this.itemsTargetable.push(t),t.type&ig.EntityExtended.TYPE.INTERACTIVE&&this.itemsInteractive.push(t),t instanceof ig.EntityLight?this.itemsLight.push(t):t.opaque&&this.itemsOpaque.push(t),t instanceof ig.EntityExtended?this._addEntity(t):t instanceof ig.BackgroundMap&&(this.numBackgroundMaps++,this.preRender&&(t.preRender=!0)),this.autoSort&&this.sort())},removeItem:function(t){var e=this.items.length;e>0&&(this._dirtyItems=!0,i.arrayCautiousRemove(this.items,t),e!==this.items.length&&(t.highPerformance?this._removeEntity(t):(i.arrayCautiousRemove(this.itemsInteractive,t),i.arrayCautiousRemove(this.itemsTargetable,t),i.arrayCautiousRemove(this.itemsOpaque,t),t instanceof ig.EntityLight&&i.arrayCautiousRemove(this.itemsLight,t),t instanceof ig.EntityExtended?this._removeEntity(t):t instanceof ig.BackgroundMap&&(this.numBackgroundMaps=Math.max(0,this.numBackgroundMaps-1)),this.autoSort&&this.sort())))},_addEntity:function(t){this.numEntities++,(t.type!==ig.Entity.TYPE.NONE||t.checkAgainst!==ig.EntityExtended.TYPE.NONE||t.collides!==ig.EntityExtended.COLLIDES.NEVER||t.collidesChanges)&&this.itemsChecking.push(t)},_removeEntity:function(t){this.numEntities=Math.max(0,this.numEntities-1);var e=this.itemsChecking.length;i.arrayCautiousRemove(this.itemsChecking,t),this.itemsChecking.length!==e&&0===this.itemsChecking.length&&(this.spatialHash={})},pause:function(){if(!this.ignorePause){this.paused=!0;for(var t=this.items,i=0,e=t.length;e>i;i++){var s=t[i];s.pause&&s.pause()}}},unpause:function(){this.paused=!1;for(var t=this.items,i=0,e=t.length;e>i;i++){var s=t[i];s.unpause&&s.unpause()}},sort:function(){this._dirtySort=!0},update:function(){var t,i,e;if(this.changed=this.changedLights=!1,this._dirtySort&&(this.items.sort(this.sortBy),this._dirtySort=!1),!this.noUpdate&&this.items.length>0){for(this._dirtyItems&&(this.changed=!0,this._dirtyItems=!1),t=0,i=this.items.length;i>t;t++)e=this.items[t],e.update(),e.highPerformance||e.paused||!(e.changed||e.intersecting||e.checking)||(this.changed=!0,e instanceof ig.EntityLight&&(this.changedLights=!0));this.changed&&(this.itemsChecking.length>0&&this.checkEntities(),this.autoSort&&this.sort())}},draw:function(){if(!this.noDraw&&this.items.length>0)for(var t=0,i=this.items.length;i>t;t++)this.items[t].draw()},checkEntities:function(){for(var t=this.spatialHash={},i=this.spatialHashCellSize,e=0,s=this.itemsChecking.length;s>e;e++){var n=this.itemsChecking[e];n.cleanupCollision();for(var a={},o=Math.floor(n.pos.x/i),h=Math.floor(n.pos.y/i),r=Math.floor((n.pos.x+n.size.x)/i)+1,l=Math.floor((n.pos.y+n.size.y)/i)+1,g=o;r>g;g++)for(var u=h;l>u;u++){var c=t[g];c||(c=t[g]={});var d=c[u];if(d){for(var p=0,m=d.length;m>p;p++){var f=d[p];a[f.id]||(a[f.id]=!0,n.touches(f)&&ig.EntityExtended.checkPair(n,f))}d.push(n)}else c[u]=[n]}}}})}),ig.baked=!0,ig.module("plusplus.core.input").requires("impact.input","plusplus.core.config","plusplus.helpers.utils","plusplus.helpers.utilsintersection").defines(function(){var t=ig.CONFIG,i=t.GESTURE,e=ig.utils,s=ig.utilsintersection;ig.Input.inject({inputPoints:[],initMouse:function(){this.parent(),ig.system.canvas.addEventListener("mouseout",this.keycancel.bind(this),!1),ig.system.canvas.addEventListener("mouseleave",this.keycancel.bind(this),!1),ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchcancel",this.keycancel.bind(this),!1),ig.system.canvas.addEventListener("MSPointerOut",this.keycancel.bind(this),!1),ig.system.canvas.addEventListener("MSPointerLeave",this.keycancel.bind(this),!1))},keydown:function(t){if("mousedown"==t.type||"touchstart"==t.type){var i;if(t.changedTouches)for(var e=0,s=t.changedTouches.length;s>e;e++)i=this.getInputPoint(t.changedTouches[e]),i.touch=!0,i.setDown();else i=this.getInputPoint(t),i.setDown()}this.parent(t)},keyup:function(t){if("mouseup"===t.type||"touchend"===t.type||"mouseout"===t.type||"mouseleave"===t.type||"touchcancel"===t.type){var i;if(t.changedTouches)for(var e=0,s=t.changedTouches.length;s>e;e++)i=this.getInputPoint(t.changedTouches[e]),i.setUp();else i=this.getInputPoint(t),i.setUp();this.mousemove(t,!0)}this.parent(t)},keycancel:function(t){var i=this.bindings[2===t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1];i&&this.actions[i]&&this.keyup(t)},mousemove:function(t){var i,e=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,s=ig.system.scale*(e/ig.system.realWidth);if(ig.system.canvas.getBoundingClientRect&&(i=ig.system.canvas.getBoundingClientRect()),t.changedTouches)for(var n=0,a=t.changedTouches.length;a>n;n++)this.inputPointMove(t.changedTouches[n],s,i);else this.inputPointMove(t,s,i);var o=this.inputPoints[0];ig.input.mouse.x=o.x,ig.input.mouse.y=o.y},inputPointMove:function(t,i,e){var s=t.clientX,n=t.clientY;e&&(s-=e.left,n-=e.top),s/=i,n/=i;var a=this.getInputPoint(t,s,n);a.reposition(s,n)},getInputPointId:function(t){if("string"==typeof t)return t;if(t){if("string"==typeof t.identifier)return t.identifier;if(t.properties&&t.values)return e.indexOfProperties(this.inputPoints,t.properties,t.values)}return 0},getInputPoint:function(t){var i=this.getInputPointId(t),e=this.inputPoints[i];return e||(e=this.inputPoints[i]=new ig.InputPoint(0,0,i)),e},getInputPoints:function(t,i){for(var e=[],s=0,n=this.inputPoints.length;n>s;s++){for(var a,o=this.inputPoints[s],h=0,r=t.length;r>h;h++)if(i[h]!==o[t[h]]){a=!0;break}a!==!0&&e.push(o)}return e},removeInputPoint:function(t){var i=this.getInputPointId(t),e=this.inputPoints[i];e&&(e.setUp(),this.inputPoints.splice(i,1))},inputPressed:function(t){var i=this.bindings[t];i&&(this.actions[i]=!0,this.locks[i]||(this.presses[i]=!0,this.locks[i]=!0))},inputReleased:function(t){var i=this.bindings[t];i&&(this.delayedKeyup[i]=!0)},update:function(){for(var t=0,i=this.inputPoints.length;i>t;t++)this.inputPoints[t].update()}}),ig.InputPoint=ig.Class.extend({id:0,x:0,y:0,lastX:0,lastY:0,worldX:0,worldY:0,deltaX:0,deltaY:0,directionX:0,directionY:0,downDeltaX:0,downDeltaY:0,swipeDistanceX:0,swipeDistanceY:0,swipeTotalDeltaX:0,swipeTotalDeltaY:0,duration:0,targets:null,targetsUp:null,targetsDown:null,targetsDownStart:null,down:!1,tapped:!1,holding:!1,holdingActivate:!1,moved:!1,swipingX:!1,swipingY:!1,swipingLeft:!1,swipingRight:!1,swipingUp:!1,swipingDown:!1,_taps:0,_downTotalDeltaX:0,_downTotalDeltaY:0,_directionDeltaTotalX:0,_directionDeltaTotalY:0,_durationReleased:0,_durationSwipeTry:0,_unpositioned:!0,_movedWithReposition:!1,_holdingActivatable:!0,_downLast:!1,_blockTap:!1,init:function(t,i,e){this.x=t||0,this.y=i||0,this.id=e||0,this.targets=[],this.targetsUp=[],this.targetsDown=[],this.targetsDownStart=[],this.lastX=this.x,this.lastY=this.y,this.worldX=this.x+ig.game.screen.x,this.worldY=this.y+ig.game.screen.y},reset:function(){this._unpositioned=!0,this.lastX=this.x,this.lastY=this.y,this.worldX=this.x+ig.game.screen.x,this.worldY=this.y+ig.game.screen.y,this._taps=this._durationReleased=this.deltaX=this.deltaY=this.directionX=this.directionY=this._directionDeltaTotalX=this._directionDeltaTotalY=0,this.moved=this._movedWithReposition=!1,this.resetTargets(),this.resetDown()},resetTargets:function(){this.targets.length=this.targetsUp.length=this.targetsDown.length=this.targetsDownStart.length=0},resetDown:function(){this.down!==!1&&(this.holding&&ig.input.inputReleased(ig.KEY.HOLD),this.duration=this.downDeltaX=this.downDeltaY=this._downTotalDeltaX=this._downTotalDeltaY=0,this.down=this._downLast=this.holding=this._blockTap=this.holdingActivate=!1,this._holdingActivatable=!0,this.resetSwipe())},resetSwipe:function(){this.swiping!==!1&&(ig.input.inputReleased(ig.KEY.SWIPE),this.releaseSwipeX(),this.releaseSwipeY(),this.swiping=!1,this.resetSwipeValues())},resetSwipeValues:function(){this._durationSwipeTry=this.swipeDistanceX=this.swipeDistanceY=this.swipeTotalDeltaX=this.swipeTotalDeltaY=0},releaseSwipeX:function(){this.swipingX&&(ig.input.inputReleased(ig.KEY.SWIPE_X),this.swipingLeft?(ig.input.inputReleased(ig.KEY.SWIPE_LEFT),this.swipingLeft=!1):this.swipingRight&&(ig.input.inputReleased(ig.KEY.SWIPE_RIGHT),this.swipingRight=!1),this.swipingX=!1)},releaseSwipeY:function(){this.swipingY&&(ig.input.inputReleased(ig.KEY.SWIPE_Y),this.swipingUp?(ig.input.inputReleased(ig.KEY.SWIPE_UP),this.swipingUp=!1):this.swipingDown&&(ig.input.inputReleased(ig.KEY.SWIPE_DOWN),this.swipingDown=!1),this.swipingY=!1)},setDown:function(){this.resetDown(),this.down=!0},setUp:function(){this.down&&(this._blockTap?(this._taps=0,this.tapped=!1):(this.tapped=!0,this._taps++,this._durationReleased=0,ig.input.inputReleased(ig.KEY.TAP),2===this._taps&&this._downTotalDeltaX*this._downTotalDeltaX+this._downTotalDeltaY*this._downTotalDeltaY<=this.screenSize*this.screenSize*i.TAP_MULTI_DISTANCE_PCT&&(this._taps=0,ig.input.inputReleased(ig.KEY.TAP_DOUBLE)),i.TARGET_TAP&&(i.TARGET_DOWN_START?this.targets=this.targetsDownStart:this.targets=this.getTargets())),this.resetDown())},getTargets:function(){var t=i.TARGET_SEARCH_RADIUS/ig.system.scale;return s.entitiesInAABB(this.worldX-t,this.worldY-t,this.worldX+t,this.worldY+t,!0)},reposition:function(t,e){var s,n;if(this.screenSize=Math.min(ig.system.width,ig.system.height),this._unpositioned)this.x=t,this.y=e,this._unpositioned=!1;else{if(this.deltaX=t-this.x,this.deltaY=e-this.y,0!==this.deltaX){var a=this.deltaX<0?-1:1;this.directionX!==a&&(this._directionDeltaTotalX+=this.deltaX*a,this._directionDeltaTotalX>=this.screenSize*i.DIRECTION_SWITCH_PCT&&(s=!0,this._directionDeltaTotalX=0,this.directionX=a))}if(0!==this.deltaY){var o=this.deltaY<0?-1:1;this.directionY!==o&&(this._directionDeltaTotalY+=this.deltaY*o,this._directionDeltaTotalY>=this.screenSize*i.DIRECTION_SWITCH_PCT&&(n=!0,this._directionDeltaTotalY=0,this.directionY=o))}this._movedWithReposition=0!==this.deltaX||0!==this.deltaY,this.x=t,this.y=e}this.worldX=this.x+ig.game.screen.x,this.worldY=this.y+ig.game.screen.y,i.TARGET_UP&&(this.targetsUp=this.getTargets()),this.down&&(i.TARGET_DOWN&&(i.TARGET_UP?this.targetsDown=this.targetsUp:this.targetsDown=this.getTargets()),this._downLast!==this.down&&(this._downLast=this.down,i.TARGET_DOWN_START&&(i.TARGET_DOWN?this.targetsDownStart=this.targetsDown:i.TARGET_UP?this.targetsDownStart=this.targetsUp:this.targetsDownStart=this.getTargets())),this.downDeltaX=this.deltaX,this.downDeltaY=this.deltaY,this._downTotalDeltaX+=this.downDeltaX,this._downTotalDeltaY+=this.downDeltaY,this._holdingActivatable&&this._downTotalDeltaX*this._downTotalDeltaX+this._downTotalDeltaY*this._downTotalDeltaY>=this.screenSize*this.screenSize*i.HOLD_ACTIVATE_DISTANCE_PCT&&(this._holdingActivatable=!1),this.swipeTotalDeltaX+=this.downDeltaX,this.swipeTotalDeltaY+=this.downDeltaY,this.swipeDistanceX=this.swipeTotalDeltaX<0?-this.swipeTotalDeltaX:this.swipeTotalDeltaX,this.swipeDistanceY=this.swipeTotalDeltaY<0?-this.swipeTotalDeltaY:this.swipeTotalDeltaY,this.swiping!==!0&&this._durationSwipeTry>i.SWIPE_DURATION_TRY?this.resetSwipeValues():(this.swipingX!==!0&&this.swipeDistanceX>=this.screenSize*i.SWIPE_DISTANCE_PCT&&(this.swiping=this._blockTap=!0,this._holdingActivatable=!1,ig.input.inputPressed(ig.KEY.SWIPE),this.swipingX=s=!0,ig.input.inputPressed(ig.KEY.SWIPE_X)),this.swipingX&&s&&(-1===this.directionX?(this.swipingRight&&(this.swipingRight=!1,ig.input.inputReleased(ig.KEY.SWIPE_RIGHT)),this.swipingLeft=!0,ig.input.inputPressed(ig.KEY.SWIPE_LEFT)):1===this.directionX&&(this.swipingLeft&&(this.swipingLeft=!1,ig.input.inputReleased(ig.KEY.SWIPE_LEFT)),this.swipingRight=!0,ig.input.inputPressed(ig.KEY.SWIPE_RIGHT))),this.swipingY!==!0&&this.swipeDistanceY>=this.screenSize*i.SWIPE_DISTANCE_PCT&&(this.swiping=this._blockTap=!0,this._holdingActivatable=!1,ig.input.inputPressed(ig.KEY.SWIPE),this.swipingY=n=!0,ig.input.inputPressed(ig.KEY.SWIPE_Y)),this.swipingY&&n&&(-1===this.directionY?(this.swipingDown&&(this.swipingDown=!1,ig.input.inputReleased(ig.KEY.SWIPE_DOWN)),this.swipingUp=!0,ig.input.inputPressed(ig.KEY.SWIPE_UP)):1===this.directionY&&(this.swipingUp&&(this.swipingUp=!1,ig.input.inputReleased(ig.KEY.SWIPE_UP)),this.swipingDown=!0,ig.input.inputPressed(ig.KEY.SWIPE_DOWN)))))},update:function(){this.moved=this.x-this.lastX!==0||this.y-this.lastY!==0,this.lastX=this.x,this.lastY=this.y,this.worldX=this.x+ig.game.screen.x,this.worldY=this.y+ig.game.screen.y,this.down?(this.duration+=ig.system.tick,this._durationSwipeTry+=ig.system.tick,!this.holding&&this.duration>=i.HOLD_DELAY&&(this.holding=!0,ig.input.inputPressed(ig.KEY.HOLD)),!this._blockTap&&this.duration>=i.HOLD_DELAY_BLOCK_TAP&&(this._blockTap=!0),this._holdingActivatable&&!this.holdingActivate&&this.duration>=i.HOLD_DELAY_ACTIVATE&&(this.holdingActivate=!0,ig.input.inputPressed(ig.KEY.HOLD_ACTIVATE)),!this.moved&&this._durationSwipeTry>i.SWIPE_DURATION_RESET&&this.resetSwipe()):this._taps>0&&(this._durationReleased+=ig.system.tick,this._durationReleased>=i.RELEASE_DELAY&&(this.touch?ig.input.removeInputPoint(this.id):this._taps=0))}}),ig.KEY.TAP=-6,ig.KEY.TAP_DOUBLE=-7,ig.KEY.HOLD=-9,ig.KEY.HOLD_ACTIVATE=-10,ig.KEY.SWIPE=-11,ig.KEY.SWIPE_X=-12,ig.KEY.SWIPE_Y=-13,ig.KEY.SWIPE_LEFT=-14,ig.KEY.SWIPE_RIGHT=-15,ig.KEY.SWIPE_UP=-16,ig.KEY.SWIPE_DOWN=-17}),ig.baked=!0,ig.module("plusplus.ui.ui-element").requires("plusplus.core.config","plusplus.core.entity","plusplus.helpers.signals","plusplus.helpers.utils").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils;ig.UIElement=ig.global.UIElement=ig.EntityExtended.extend({layerName:"ui",frozen:!0,visible:!0,fixed:!0,canFlipX:t.UI.CAN_FLIP_X,canFlipY:t.UI.CAN_FLIP_Y,posAsPct:t.UI.POS_AS_PCT,posPct:{x:0,y:0},align:{x:0,y:0},margin:{x:0,y:0},marginAsPct:!0,marginAsPctSmallest:t.UI.MARGIN_AS_PCT_SMALLEST,marginScaleless:t.UI.MARGIN_SCALELESS,totalMarginX:0,totalMarginY:0,scale:t.UI.SCALE,scaleOfSystemScale:t.UI.SCALE_OF_SYSTEM_SCALE,scaleMin:t.UI.SCALE_MIN,scaleMax:t.UI.SCALE_MAX,ignoreSystemScale:t.UI.IGNORE_SYSTEM_SCALE,linkAlign:{x:0,y:0},linkAlignInside:!1,autoDeactivate:!0,initTypes:function(){this.parent(),i.addType(ig.EntityExtended,this,"type","UI")},changePerformanceDynamic:function(){"ui"===this.layerName&&(ig.game.removeItem(this,{layerName:this.layerName}),this.layerName="entities",ig.game.addItem(this))},cleanup:function(){this.autoDeactivate&&this.deactivate(),this.parent()},reposition:function(t){var i=this.linkAlignInside?-1:1;if(!this.getIsMovingSelf()){if(this.linkedTo){var e=this.scale/ig.system.scale,s=this.sizeDraw.x*e,n=this.sizeDraw.y*e,a=this.linkedTo.scale/ig.system.scale,o=this.linkedTo.sizeDraw.x*a,h=this.linkedTo.sizeDraw.y*a,r=.5*(o-s),l=.5*(h-n);this.pos.x=this.linkedTo.posDraw.x+r,this.pos.y=this.linkedTo.posDraw.y+l;var g=.5*(o+s*i),u=.5*(h+n*i);this.pos.x+=this.linkAlign.x*g,this.pos.y+=this.linkAlign.y*u}else this.posAsPct?(this.pos.x=this.posPct.x*ig.system.width,this.pos.y=this.posPct.y*ig.system.height):(this.pos.x=this.resetState.pos.x,this.pos.y=this.resetState.pos.y);this.totalMarginX=Math.round(this.marginAsPct?this.margin.x*(this.marginAsPctSmallest?ig.system.size:ig.system.width):this.margin.x),this.totalMarginY=Math.round(this.marginAsPct?this.margin.y*(this.marginAsPctSmallest?ig.system.size:ig.system.height):this.margin.y),this.marginScaleless&&(this.totalMarginX/=this.scale,this.totalMarginY/=this.scale),this.linkedTo?(this.pos.x+=this.linkAlign.x*this.totalMarginX*i,this.pos.y+=this.linkAlign.y*this.totalMarginY*i):(this.pos.x=this.pos.x-this.align.x*this.sizeDraw.x*this.scaleMod+((1-this.align.x)*this.totalMarginX-this.align.x*this.totalMarginX),this.pos.y=this.pos.y-this.align.y*this.sizeDraw.y*this.scaleMod+((1-this.align.y)*this.totalMarginY-this.align.y*this.totalMarginY))}return this.parent(t)},moveTo:function(t,i){return this.align.x=this.align.y=this.margin.x=this.margin.y=0,this.unlink(!1),this.parent(t,i)},link:function(t,i){this.movingTo?this.unlink(!1):this.parent(t,i)},unlink:function(t){if(this.linkedTo&&!this._killed&&t!==!1){var i=this.pos.x,e=this.pos.y;i+=this.align.x*this.sizeDraw.x*this.scaleMod-((1-this.align.x)*this.totalMarginX-this.align.x*this.totalMarginX),e+=this.align.y*this.sizeDraw.y*this.scaleMod-((1-this.align.y)*this.totalMarginY-this.align.y*this.totalMarginY),this.posAsPct?(this.posPct.x=i/ig.system.width,this.posPct.y=e/ig.system.height):(this.resetState.pos.x=i,this.resetState.pos.y=e)}this.parent(t)}}),i.getType(ig.EntityExtended,"UI"),ig.EntityExtended.TYPE.UI}),ig.baked=!0,ig.module("plusplus.ui.ui-text").requires("plusplus.core.config","plusplus.core.font","plusplus.core.image-drawing","plusplus.ui.ui-element").defines(function(){"use strict";var t=ig.CONFIG;ig.UIText=ig.global.UIText=ig.UIElement.extend({align:{x:0,y:0},linkAlign:{x:0,y:0},font:null,scale:t.FONT.SCALE,scaleOfSystemScale:t.FONT.SCALE_OF_SYSTEM_SCALE,scaleMin:t.FONT.SCALE_MIN,scaleMax:t.FONT.SCALE_MAX,ignoreSystemScale:t.FONT.IGNORE_SYSTEM_SCALE,text:"",textDisplay:"",textOverflow:"",autoRefreshText:!0,changedText:!1,textImage:null,textAlign:ig.Font.ALIGN.CENTER,maxWidth:0,maxHeight:0,_text:"",refresh:function(t){this.font=this.font||ig.Font.FONTS.MAIN,this.text&&this.font?this.textImage||(this.textImage=new ig.ImageDrawing):this.textImage&&(this.textImage=null),this.parent(t)},resize:function(t){if(this._text!==this.text&&(this.changedText=!0,this._text=this.text),this._text&&this.font){var i=this._text,e="",s=this.font.widthForString(i),n=this.font.heightForString(i);if(this.maxWidth>0&&s>this.maxWidth&&(i=this.font.multilineForWidth(i,this.maxWidth),s=this.font.widthForString(i),n=this.font.heightForString(i)),this.maxHeight>0&&n>this.maxHeight){var a=this.font.overflowForHeight(i,this.maxHeight);i=a.display,e=a.overflow,s=this.font.widthForString(i),n=this.font.heightForString(i)}(this.textDisplay!==i||this.textOverflow!==e)&&(this.needsRebuild=this.changedText=!0,this.textDisplay=i,this.textOverflow=e),this.size.x!==s&&(this.size.x=s,t=this.needsRebuild=this.changedText=!0),this.size.y!==n&&(this.size.y=n,t=this.needsRebuild=this.changedText=!0)}return t},rebuild:function(){if(this.parent(),this.textDisplay&&this.font&&this.textImage){this.textImage.setDimensions(this.size.x,this.size.y);var t;t=this.textAlign===ig.Font.ALIGN.CENTER?.5*this.size.x:this.textAlign===ig.Font.ALIGN.RIGHT?this.size.x:0,this.font.draw(this.textDisplay,t,0,this.textAlign,this.textImage.dataContext,1),this.textImage.finalize()}},update:function(){this.autoRefreshText&&this._text!==this.text?this.refresh(!0):this.changedText=!1,this.parent()},draw:function(){this.parent(),this.visible&&this.textImage&&(1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha),this.fixed?this.textImage.draw(this.posDraw.x,this.posDraw.y,void 0,void 0,void 0,void 0,this.scale):this.textImage.draw(this.posDraw.x-ig.game.screen.x,this.posDraw.y-ig.game.screen.y,void 0,void 0,void 0,void 0,this.scale),1!==this.alpha&&(ig.system.context.globalAlpha=1))}})}),ig.baked=!0,ig.module("plusplus.ui.ui-overlay").requires("plusplus.core.font","plusplus.core.config","plusplus.core.image-drawing","plusplus.ui.ui-element","plusplus.ui.ui-text","plusplus.helpers.utilsdraw","plusplus.helpers.utilscolor").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utilsdraw,e=ig.utilscolor;ig.UIOverlay=ig.global.UIOverlay=ig.UIElement.extend({layerName:"overlay",zIndex:t.Z_INDEX_BELOW_ALL,scaleMin:t.ENTITY.SCALE_MIN,scaleMax:t.ENTITY.SCALE_MAX,scaleOfSystemScale:t.ENTITY.SCALE_OF_SYSTEM_SCALE,ignoreSystemScale:!1,sizeAsPct:!0,sizePct:{x:1,y:1},fill:null,filled:!0,r:t.OVERLAY.R,g:t.OVERLAY.G,b:t.OVERLAY.B,alpha:t.OVERLAY.ALPHA,fillStyle:"",fillColors:null,gradientRadial:!1,gradientHorizontal:!1,cover:!1,cornerRadius:0,cornerRadiusAsPct:!1,pixelPerfect:t.OVERLAY.PIXEL_PERFECT,message:null,messageEntity:ig.UIText,textSettings:null,textMoveToSettings:{matchPerformance:!0},resetExtras:function(){this.filled?this.fill=new ig.ImageDrawing:this.fill=null,"string"==typeof this.text&&(this.textSettings=this.textSettings||{},this.textSettings.text=this.text,this.text=void 0),"string"==typeof this.message&&(this.textSettings=this.textSettings||{},this.textSettings.text=this.message,this.message=void 0),!this.message&&this.textSettings&&this.textSettings.text&&this.textSettings.text.length>0&&(this.message=new this.messageEntity(0,0,ig.merge({layerName:this.layerName,fixed:this.fixed,alpha:this.alpha,linkedTo:this,autoRefreshText:!1},this.textSettings))),this.parent()},resize:function(t){if(this.sizeAsPct){var i=ig.system.width*this.sizePct.x,e=ig.system.height*this.sizePct.y;this.size.x!==i&&(this.size.x=i,t=this.needsRebuild=!0),this.size.y!==e&&(this.size.y=e,t=this.needsRebuild=!0)}return t},rebuild:function(){this.refill(),this.fill&&this.fill.finalize(this.pixelPerfect?1:this.scale),this.parent()},refill:function(t,e){if(this.fill){"undefined"==typeof t&&(t=this.sizeDraw.x),"undefined"==typeof e&&(e=this.sizeDraw.y);var s=this.fill.dataContext;this.pixelPerfect?(this.fill.setDimensions(this.sizeDraw.x,this.sizeDraw.y),this.cornerRadius>0?i.pixelFillRoundedRect(s,0,0,this.fill.width,this.fill.height,0,0,t,e,this.cornerRadiusAsPct?Math.min(t,e)*this.cornerRadius:this.cornerRadius,this.r,this.g,this.b,1):(s.fillStyle=this.getFillStyle(),s.fillRect(0,0,t,e))):(this.fill.setDimensions(this.sizeDraw.x*this.scale,this.sizeDraw.y*this.scale),s.fillStyle=this.getFillStyle(),t*=this.scale,e*=this.scale,this.cornerRadius>0?i.fillRoundedRect(s,0,0,t,e,this.cornerRadiusAsPct?Math.min(t,e)*this.cornerRadius:this.cornerRadius):s.fillRect(0,0,t,e))}},getFillStyle:function(){var t;return this.pixelPerfect||(this.fillStyle?t=this.fillStyle:this.fillColors&&(t=this.gradientRadial?e.radialGradient(this.cover?Math.max(this.sizeDraw.x,this.sizeDraw.y):Math.min(this.sizeDraw.x,this.sizeDraw.y),this.fillColors):this.gradientHorizontal?e.linearGradient(0,0,this.sizeDraw.x,0,this.fillColors):e.linearGradient(0,0,0,this.sizeDraw.y,this.fillColors))),t||(t=e.RGBToCSS(this.r,this.g,this.b)),t},ready:function(){this.message&&ig.game.spawnEntity(this.message,this.message.pos.x,this.message.pos.y),this.parent()},moveTo:function(t,i){var e=this.parent(t,i);return this.message&&this.message.moveTo(this,this.textMoveToSettings),e},moveToStop:function(){this.message&&this.message.moveToStop(),this.parent()},pause:function(){this.parent(),this.message&&this.message.pause()},unpause:function(){this.parent(),this.message&&this.message.unpause()},cleanup:function(){this.message&&ig.game.removeEntity(this.message),this.parent()},update:function(){if(this.message){var t=this.textSettings&&this.textSettings.text||this.text;t&&this.message.text!==t&&(this.message.text=t),this.message._text!==this.message.text&&this.refresh(!0)}this.parent()},draw:function(){this.message&&(this.message.alpha=this.alpha),this.visible&&(this.fill&&(1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha),this.fixed?this.fill.draw(this.posDraw.x,this.posDraw.y,void 0,void 0,void 0,void 0,this.scale):this.fill.draw(this.posDraw.x-ig.game.screen.x,this.posDraw.y-ig.game.screen.y,void 0,void 0,void 0,void 0,this.scale),1!==this.alpha&&(ig.system.context.globalAlpha=1)),this.parent())}})}),ig.baked=!0,ig.module("plusplus.core.camera").requires("plusplus.core.config","plusplus.core.timer","plusplus.core.image-drawing","plusplus.ui.ui-overlay","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.utilsvector2","plusplus.helpers.utilsintersection","plusplus.helpers.signals","plusplus.helpers.tweens").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils,e=ig.utilsmath,s=ig.utilsvector2,n=ig.utilsintersection,a=ig.TWEEN;ig.Camera=ig.Class.extend({boundsTrapAsPct:t.CAMERA.BOUNDS_TRAP_AS_PCT,boundsTrap:n.boundsMinMax(t.CAMERA.BOUNDS_TRAP_MINX,t.CAMERA.BOUNDS_TRAP_MINY,t.CAMERA.BOUNDS_TRAP_MAXX,t.CAMERA.BOUNDS_TRAP_MAXY),boundsTrapPct:n.boundsMinMax(t.CAMERA.BOUNDS_TRAP_PCT_MINX,t.CAMERA.BOUNDS_TRAP_PCT_MINY,t.CAMERA.BOUNDS_TRAP_PCT_MAXX,t.CAMERA.BOUNDS_TRAP_PCT_MAXY),keepCentered:t.CAMERA.KEEP_CENTERED,keepInsideLevel:{x:t.CAMERA.KEEP_INSIDE_LEVEL,y:t.CAMERA.KEEP_INSIDE_LEVEL},boundsLevel:n.boundsMinMax(0,0,0,0),paused:!1,changed:!1,entity:null,entityFallback:null,autoFollowPlayer:t.CAMERA.AUTO_FOLLOW_PLAYER,snapFirstFollow:t.CAMERA.SNAP_FIRST_FOLLOW,centerFirstFollow:t.CAMERA.CENTER_FIRST_FOLLOW,lerp:t.CAMERA.LERP,transitionDuration:t.CAMERA.TRANSITION_DURATION,transitionDurationMin:t.CAMERA.TRANSITION_DURATION_MIN,transitionDurationMax:t.CAMERA.TRANSITION_DURATION_MAX,transitionDistance:t.CAMERA.TRANSITION_DISTANCE,transitioning:!1,transitioningInstantly:!1,transitioningCenter:!1,transitionPct:0,screenLast:{x:0,y:0},atmosphere:!1,atmosphereOverlay:null,atmosphereSettings:{r:0,g:0,b:0,alpha:.9},atmosphereFadeDuration:1e3,lightAmplification:3,lightBaseOnly:!0,lightsCutout:!0,onTransitioned:null,
shaking:!1,shakeStrength:8,shakeDuration:2,shakeFunction:!1,shakeOffset:null,shakeTimer:null,_transitionTime:0,_transitionDuration:0,_transitionFrom:{x:0,y:0},_snap:!0,_center:!0,_entityInvulnerable:!1,_entityPaused:!1,_entityAlpha:1,_boundsScreen:n.boundsMinMax(0,0,0,0),_rLast:0,_gLast:0,_bLast:0,_alphaLast:0,init:function(t){ig.merge(this,t),this._snap=this.snapFirstFollow,this._center=this.centerFirstFollow,this.onTransitioned=new ig.Signal,this.shakeTimer=new ig.Timer,ig.system.onResized.add(this.resize,this,-1)},reset:function(){this.screenLast.x=ig.game.screen.x=0,this.screenLast.y=ig.game.screen.y=0,this.shakeStop(),this.removeAtmosphere(0),this.unfollow(),this.unfollowFallback(),this.onTransitioned.removeAll(),this.onTransitioned.forget(),this._snap=this.snapFirstFollow,this._center=this.centerFirstFollow},ready:function(){this.getBoundsLevel(),this.autoFollowPlayer&&this.followPlayer()},pause:function(){this.paused=!0,this.shakeTimer.pause()},unpause:function(){this.paused=!1,this.shakeTimer.unpause()},getBoundsLevel:function(t){t="undefined"!=typeof t?t:ig.game.collisionMap,(this.keepInsideLevel.x||this.keepInsideLevel.y)&&t&&t.width&&t.height&&t.tilesize&&(this.boundsLevel=n.boundsMinMax(0,0,t.width*t.tilesize-ig.system.width,t.height*t.tilesize-ig.system.height,this.boundsLevel),this.boundsLevel.maxX<0&&(this.boundsLevel.minX=this.boundsLevel.maxX=.5*this.boundsLevel.maxX),this.boundsLevel.maxY<0&&(this.boundsLevel.minY=this.boundsLevel.maxY=.5*this.boundsLevel.maxY))},shake:function(t,i,e){this.shaking||(this.shaking=!0,this.shakeDuration=t||this.shakeDuration,this.shakeStrength=i||this.shakeStrength,this.shakeFunction=e||this.shakeFunction,this.shakeOffset?s.zero(this.shakeOffset):this.shakeOffset={x:0,y:0},this.shakeTimer.set(this.shakeDuration))},shakeStop:function(){this.shaking&&(this.shaking=!1,ig.game.screen.x-=this.shakeOffset.x,ig.game.screen.y-=this.shakeOffset.y)},updateShake:function(){if(this.shaking){ig.game.screen.x-=this.shakeOffset.x,ig.game.screen.y-=this.shakeOffset.y;var t=this.shakeTimer.delta();if(t>=0)this.shakeStop();else{var i=-t/this.shakeDuration,n=this.shakeFunction?this.shakeFunction():this.shakeStrength*Math.pow(i,2);n>.5&&(this.shakeOffset.x+=e.map(Math.random(),0,1,-n,n),this.shakeOffset.y+=e.map(Math.random(),0,1,-n,n)),s.multiplyScalar(this.shakeOffset,i)}}},toggleAtmosphere:function(t,i){this.atmosphere?this.removeAtmosphere(t):this.addAtmosphere(t,i)},addAtmosphere:function(t,e){(!this.atmosphere||e)&&(this.atmosphere&&this.removeAtmosphere(t),this.atmosphere=!0,this.atmosphereFadeDuration=i.isNumber(t)?t:this.atmosphereFadeDuration,this.atmosphereOverlay=ig.game.spawnEntity(ig.UIOverlay,0,0,e?ig.merge(ig.merge({},this.atmosphereSettings),e):this.atmosphereSettings),this.atmosphereOverlay.added?this._showAtmosphere():this.atmosphereOverlay.onAdded.addOnce(this._showAtmosphere,this))},_showAtmosphere:function(){this.atmosphereOverlay&&(this.atmosphereOverlay.alpha=0,this.atmosphereOverlay.fadeTo(this.atmosphereOverlay.resetState.alpha,{duration:this.atmosphereFadeDuration}),this.changed=!0,this.updateAtmosphere())},removeAtmosphere:function(t){this.atmosphere=!1,this.atmosphereOverlay&&(this.atmosphereOverlay.added?this.atmosphereOverlay.fadeToDeath({duration:i.isNumber(t)?t:this.atmosphereFadeDuration}):(this.atmosphereOverlay.onAdded.remove(this._showAtmosphere,this),ig.game.removeEntity(this.atmosphereOverlay)),this.atmosphereOverlay=void 0)},updateAtmosphere:function(){if(this.atmosphere&&(this.changed||this.lightsCutout&&(ig.game.dirtyLights||ig.game.changedLights))){this.atmosphereOverlay.refresh(!0);var t=this.atmosphereOverlay.fill.dataContext;if(this.lightsCutout){t.globalCompositeOperation="destination-out";var i,e,s=ig.game.lights;for(i=0,e=s.length;e>i;i++){var n=s[i];n.visible&&n.image&&(t.globalAlpha=Math.min(1,n.alpha*this.lightAmplification),t.drawImage(this.lightBaseOnly&&n.castsShadows?n.imageBase.data:n.image.data,ig.system.getDrawPos(n.posDraw.x-ig.game.screen.x),ig.system.getDrawPos(n.posDraw.y-ig.game.screen.y)))}t.globalCompositeOperation="source-over"}}},follow:function(t,i,e){i=i||this._snap,e=e||this._center,(this.entity!==t||i||e)&&(this._snap=this._center=!1,this.unfollow(),this.entity=t,this.entity&&(this.transitioning=!0,this.transitioningInstantly=i,this.transitioningCenter=e,this._transitionTime=0,s.copy(this._transitionFrom,ig.game.screen),this.transitioningCenter?n.bounds(ig.game.screen.x,ig.game.screen.y,0,0,this._boundsScreen):n.boundsCopy(this._boundsScreen,this.boundsTrap,ig.game.screen.x,ig.game.screen.y))),this.transitioning?this.transitioningInstantly&&this.updateFollow():this.entity&&this.transitionComplete()},followFallback:function(t,i,e){this.entityFallback!==t&&(this.entityFallback=t,this.entity||this.follow(this.entityFallback,i,e))},followRespawnable:function(t){this.followFallback(t),this.transitioning&&(t.invulnerable||(t.invulnerable=this._entityInvulnerable=!0),t.paused||(this._entityPaused=!0,t.pause(),this._entityAlpha=t.alpha,t.alpha=0))},followPlayer:function(t,i){var e=ig.game.getPlayer();e&&(this.unfollow(),this.followFallback(e,t,i),e.onRemoved.add(this.unfollowFallback,this),e.onAdded.add(this.followRespawnable,this))},unfollow:function(){this.entity&&(this.entity=void 0),this.transitioning&&(this.transitioning=!1,this._transitionTime=0,n.boundsCopy(this._boundsScreen,this.boundsTrap,ig.game.screen.x,ig.game.screen.y))},unfollowFallback:function(){this.entityFallback&&(this.entityFallback===this.entity&&this.unfollow(),this.entityFallback=void 0),this.transitioning&&(this.transitioning=!1,n.boundsCopy(this._boundsScreen,this.boundsTrap,ig.game.screen.x,ig.game.screen.y))},transitionComplete:function(){this.transitioning=this.transitioningInstantly=this.transitioningCenter=!1,this._entityInvulnerable&&this.entity.invulnerable&&(this.entity.invulnerable=this._entityInvulnerable=!1),this._entityPaused&&this.entity.paused&&(this._entityPaused=!1,this.entity.unpause(),this.entity.alpha=this._entityAlpha),this.onTransitioned.dispatch()},updateFollow:function(){var t=ig.game.screen;if(!this.entity&&this.entityFallback&&this.follow(this.entityFallback),this.entity){s.copy(this.screenLast,t);var i,o,h=this.entity.pos.x+.5*this.entity.size.x-.5*ig.system.width,r=this.entity.pos.y+.5*this.entity.size.y-.5*ig.system.height;if(this.transitioning){if(this.changed=!0,this.transitioningInstantly)this.transitionPct=1;else{if(0===this._transitionTime)if(this.transitionDistance>0){var l=h-this._boundsScreen.minX,g=r-this._boundsScreen.minY,u=Math.sqrt(l*l+g*g);this._transitionDuration=e.clamp(this.transitionDuration*(u/this.transitionDistance),this.transitionDurationMin,this.transitionDurationMax)}else this._transitionDuration=this.transitionDuration;this._transitionTime+=ig.system.tick,this.transitionPct=this._transitionTime/this._transitionDuration}var c=a.Easing.Quadratic.InOut(this.transitionPct);h<this._boundsScreen.minX?t.x=this._transitionFrom.x+(h-(this._boundsScreen.minX+(this.transitioningCenter?.5*this._boundsScreen.width:0)))*c:h>this._boundsScreen.maxX?t.x=this._transitionFrom.x+(h-(this._boundsScreen.maxX-(this.transitioningCenter?.5*this._boundsScreen.width:0)))*c:i=!0,r<this._boundsScreen.minY?t.y=this._transitionFrom.y+(r-(this._boundsScreen.minY+(this.transitioningCenter?.5*this._boundsScreen.height:0)))*c:r>this._boundsScreen.maxY?t.y=this._transitionFrom.y+(r-(this._boundsScreen.maxY-(this.transitioningCenter?.5*this._boundsScreen.height:0)))*c:o=!0,(this.transitionPct>=1||i&&o)&&this.transitionComplete()}else this.keepCentered?(t.x+=(h-t.x)*this.lerp,t.y+=(r-t.y)*this.lerp):(h<this._boundsScreen.minX?t.x+=h-this._boundsScreen.minX:h>this._boundsScreen.maxX&&(t.x+=h-this._boundsScreen.maxX),r<this._boundsScreen.minY?t.y+=r-this._boundsScreen.minY:r>this._boundsScreen.maxY&&(t.y+=r-this._boundsScreen.maxY)),(t.x-this.screenLast.x!==0||t.y-this.screenLast.y!==0)&&(this.changed=!0)}this.changed&&(this.keepInsideLevel.x?this.screenLast.x=t.x=e.clamp(t.x,this.boundsLevel.minX,this.boundsLevel.maxX):this.screenLast.x=t.x,this.keepInsideLevel.y?this.screenLast.y=t.y=e.clamp(t.y,this.boundsLevel.minY,this.boundsLevel.maxY):this.screenLast.y=t.y,this.transitioning||n.boundsCopy(this._boundsScreen,this.boundsTrap,t.x,t.y)),this.shaking&&(t.x+=this.shakeOffset.x,t.y+=this.shakeOffset.y,this.changed=!0)},update:function(){this.changed=!1,this.paused||(this.updateShake(),this.updateFollow(),this.updateAtmosphere())},resize:function(){this.changed=!0,this.getBoundsLevel(),this.boundsTrapAsPct&&n.boundsCopy(this.boundsTrap,this.boundsTrapPct,0,0,.5*ig.system.width,.5*ig.system.height),this.entity&&this.follow(this.entity,!0,!0),this.updateAtmosphere()}})}),ig.baked=!0,ig.module("plusplus.ui.ui-dpad").requires("plusplus.ui.ui-element","plusplus.helpers.utilsvector2").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utilsvector2;ig.UIDpad=ig.global.UIDpad=ig.UIElement.extend({size:{x:t.PLAYER_MANAGER.TOUCH_DPAD_SIZE,y:t.PLAYER_MANAGER.TOUCH_DPAD_SIZE},zIndex:5,animSheet:new ig.AnimationSheet(t.PATH_TO_MEDIA+"dpad_"+t.PLAYER_MANAGER.TOUCH_DPAD_SIZE+".png",t.PLAYER_MANAGER.TOUCH_DPAD_SIZE,t.PLAYER_MANAGER.TOUCH_DPAD_SIZE),align:{x:.5,y:.5},posAsPct:!1,pos:{x:0,y:0},inputPoint:null,direction:null,deadZoneSize:t.PLAYER_MANAGER.TOUCH_DPAD_DEAD_ZONE_SIZE,animInit:"none",layerName:"overlay",animSettings:{none:{sequence:[0]},left:{sequence:[1]},right:{sequence:[2]},up:{sequence:[3]},down:{sequence:[4]},upleft:{sequence:[5]},upright:{sequence:[6]},downleft:{sequence:[7]},downright:{sequence:[8]}},setDirection:function(){null==this.inputPoint?this.direction={x:0,y:0}:this.direction={x:this.inputPoint._downTotalDeltaX>this.deadZoneSize||this.inputPoint._downTotalDeltaX<-this.deadZoneSize?this.inputPoint._downTotalDeltaX:0,y:this.inputPoint._downTotalDeltaY>this.deadZoneSize||this.inputPoint._downTotalDeltaY<-this.deadZoneSize?this.inputPoint._downTotalDeltaY:0},this.directionName=i.directionToString(this.direction).toLowerCase(),this.currentAnim=this.anims[this.directionName]},update:function(){this.parent(),this.inputPoint&&!this.inputPoint.holding&&(ig.game.playerManager.touchDpad=null,this.kill())}})}),ig.baked=!0,ig.module("plusplus.core.player-manager").requires("plusplus.core.config","plusplus.core.entity","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.utilsintersection","plusplus.ui.ui-dpad").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils,e=ig.utilsmath,s=ig.utilsintersection;ig.PlayerManager=ig.global.PlayerManager=ig.Class.extend({autoManagePlayer:t.PLAYER_MANAGER.AUTO_MANAGE_PLAYER,entity:null,entityFallback:null,zIndex:0,type:"",group:"",holdToMove:t.PLAYER_MANAGER.HOLD_TO_MOVE,swipeToJump:t.PLAYER_MANAGER.SWIPE_TO_JUMP,touchDpadEnabled:t.PLAYER_MANAGER.TOUCH_DPAD_ENABLED,touchDpadDeadZoneSize:t.PLAYER_MANAGER.TOUCH_DPAD_DEAD_ZONE_SIZE,touchDpadBoundsPctMinX:t.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MINX,touchDpadBoundsPctMinY:t.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MINY,touchDpadBoundsPctMaxX:t.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MAXX,touchDpadBoundsPctMaxY:t.PLAYER_MANAGER.TOUCH_DPAD_BOUNDS_PCT_MAXY,touchDpad:null,onManageStarted:null,onManageStopped:null,_zIndex:0,_type:ig.EntityExtended.TYPE.NONE,_group:ig.EntityExtended.GROUP.NONE,init:function(t){ig.merge(this,t),this.onManageStarted=new ig.Signal,this.onManageStopped=new ig.Signal},ready:function(){this.autoManagePlayer&&this.managePlayer()},reset:function(){this.onManageStarted.removeAll(),this.onManageStarted.forget(),this.onManageStopped.removeAll(),this.onManageStopped.forget(),this.manageReleaseFallback(),this.manageRelease()},manage:function(t){this.entity!==t&&(this.manageRelease(),t instanceof ig.EntityExtended&&this.manageStart(t))},manageFallback:function(t){this.entityFallback!==t&&(this.entityFallback=t,this.entity||this.manage(t))},managePlayer:function(){var t=ig.game.getPlayer();t&&this.entity!==t&&(this.manageRelease(),this.manageFallback(t),t.onRemoved.add(this.manageReleaseFallback,this),t.onAdded.add(this.managePlayer,this))},manageStart:function(t){this.entity=t,this.entity.onRemoved.addOnce(this.manageRelease,this),this.zIndex&&t.zIndex!==this.zIndex&&(this._zIndex=t.zIndex,t.zIndex=this.zIndex,ig.game.sortEntitiesDeferred(t.layerName)),this.type&&(this._type=t.type,i.addType(ig.EntityExtended,t,"type",this.type)),this.group&&(this._group=t.group,i.addType(ig.EntityExtended,t,"group",this.group,"GROUP")),ig.game.camera&&ig.game.camera.autoFollowPlayer&&ig.game.camera.entity!==t?(t===ig.game.getPlayer()?ig.game.camera.followPlayer():ig.game.camera.follow(t),ig.game.camera.onTransitioned.addOnce(this.highlightManaged,this)):this.highlightManaged(),"function"==typeof t.manageStart&&t.manageStart(),this.onManageStarted.dispatch(t)},manageRelease:function(t){(!t&&this.entity||t&&this.entity===t)&&this.manageStop()},manageReleaseFallback:function(t){(!t&&this.entityFallback||t&&this.entityFallback===t)&&(this.entity===this.entityFallback&&this.manageRelease(),this.entityFallback=null)},manageStop:function(){var t=this.entity;ig.game.camera&&ig.game.camera.onTransitioned.remove(this.highlightManaged,this),t.onRemoved.remove(this.manageRelease,this),this.zIndex&&t.zIndex!==this._zIndex&&(t.zIndex=this._zIndex,ig.game.sortEntitiesDeferred(t.layerName)),this.type&&(t.type=this._type),this.group&&(t.group=this._group),this.entity=null,"function"==typeof t.manageStop&&t.manageStop(),this.onManageStopped.dispatch(t)},highlightManaged:function(){this.entity&&!this.entity._killed&&this.entity.currentAnim==this.entity.anims[this.entity.getDirectionalAnimName("idle")]&&this.entity.animOverride(this.entity.getDirectionalAnimName("highlight"))},update:function(){!this.entity&&this.entityFallback&&this.manage(this.entityFallback),this.isManagedControllable()&&this.handleInput()},isManagedControllable:function(){return this.entity&&!this.entity.paused&&this.entity.controllable},handleInput:function(){var t,i,n,a;if(this.entity.movingTo||(this.entity.jumping?this.entity.moveToHereHorizontal():this.entity.moveToHere()),this.entity.handleInput&&this.entity.handleInput(),ig.input.state("right")?this.entity.moveToRight():ig.input.state("left")&&this.entity.moveToLeft(),ig.input.state("up")?this.entity.hasGravity?this.entity.climbUp():this.entity.moveToUp():ig.input.state("down")&&(this.entity.hasGravity?this.entity.climbDown():this.entity.moveToDown()),this.holdToMove&&ig.input.state("hold"))for(n=ig.input.getInputPoints(["holding"],[!0]),t=0,i=n.length;i>t;t++)if(a=n[t],!a.targetsDownStart.length){var o=.5*this.entity.size.x,h=.5*this.entity.size.y,r=a.worldX-this.entity.pos.x+o,l=a.worldY-this.entity.pos.y+h;e.almostEqual(r,0,o)!==!0&&(r>0?this.entity.moveToRight():this.entity.moveToLeft()),e.almostEqual(l,0,h)!==!0&&(l>0?this.entity.hasGravity?this.entity.climbDown():this.entity.moveToDown():this.entity.hasGravity?this.entity.climbUp():this.entity.moveToUp())}if(!this.holdToMove&&this.touchDpadEnabled&&ig.input.state("hold")){for(n=ig.input.getInputPoints(["holding"],[!0]),t=0,i=n.length;i>t;t++)if(a=n[t],!a.targetsDownStart.length){var g=s.pointInAABB(a.x,a.y,ig.system.width*this.touchDpadBoundsPctMinX,ig.system.height*this.touchDpadBoundsPctMinY,ig.system.width*this.touchDpadBoundsPctMaxX,ig.system.height*this.touchDpadBoundsPctMaxY);!g||this.touchDpad||0==a._downTotalDeltaX&&0==a._downTotalDeltaY||(this.touchDpad=ig.game.spawnEntity(ig.global.UIDpad,0,0,{pos:{x:a.x,y:a.y}}),this.touchDpad.inputPoint=a)}this.touchDpad&&this.touchDpad.inputPoint&&this.touchDpad.inputPoint.holding&&(this.touchDpad.setDirection(),a._downTotalDeltaX>this.touchDpadDeadZoneSize?this.entity.moveToRight():a._downTotalDeltaX<-this.touchDpadDeadZoneSize&&this.entity.moveToLeft(),a._downTotalDeltaY>this.touchDpadDeadZoneSize?this.entity.hasGravity?this.entity.climbDown():this.entity.moveToDown():a._downTotalDeltaY<-this.touchDpadDeadZoneSize&&(this.entity.hasGravity?this.entity.climbUp():this.entity.moveToUp()))}if(ig.input.pressed("jump"))this.entity.jump();else if(this.swipeToJump&&ig.input.state("swipe"))for(n=ig.input.getInputPoints(["swiping"],[!0]),t=0,i=n.length;i>t;t++)n[t].swipingUp&&this.entity.jump()}})}),ig.baked=!0,ig.module("plusplus.entities.trigger").requires("plusplus.core.timer","plusplus.core.entity","plusplus.helpers.utils","plusplus.helpers.signals").defines(function(){"use strict";var t=ig.utils;ig.EntityTrigger=ig.global.EntityTrigger=ig.EntityExtended.extend({_wmScalable:!0,_wmDrawBox:!0,_wmBoxColor:"rgba( 255, 255, 0, 0.7 )",frozen:!0,target:{},sortTargetsBy:null,targetSequence:[],wait:0,delay:0,triggerAfterDelay:!1,once:!0,suicidal:!0,triggerable:!0,useCheckingAsTarget:!1,triggering:!1,autoComplete:!0,autoToggle:!1,teardownWhenComplete:!0,waitTimer:null,delayTimer:null,onCompleted:null,_delaying:!1,initTypes:function(){this.parent(),t.addType(ig.EntityExtended,this,"type","TRIGGER"),t.addType(ig.EntityExtended,this,"checkAgainst","PLAYER")},initProperties:function(){this.parent(),this.waitTimer=new ig.Timer,this.delayTimer=new ig.Timer,this.onCompleted=new ig.Signal},resetExtras:function(){var t=this.activated;this.activated=!1,this.parent(),t&&this.trigger()},check:function(t){this.parent(t),this.triggerable&&this.trigger(t,!0,!0)},trigger:function(i,e,s){if(this.getCanTrigger(i)){if(this.delay>0&&!this._delaying){this._delaying=!0;var n=this.delayTimer.pausedAt;this.delayTimer.set(this.delay),this.delayTimer.pausedAt=n}if(this.delayTimer.delta()>=0){this._delaying=!1,this.triggering=!0,this.targetSequence.length=0;for(var a in this.target){var o=ig.game.namedEntities[this.target[a]];o&&!o.triggering&&this.targetSequence.push(o)}s&&this.useCheckingAsTarget&&t.arrayCautiousAdd(this.targetSequence,i),this.sortTargetsBy&&this.targetSequence.sort(this.sortTargetsBy),this.handleTargets(i,e),this.wait&&this.waitTimer.set(this.wait),this.triggering=!1,this.autoComplete&&this.complete()}}},getCanTrigger:function(t){return!(this.triggering||this.once&&this.activated||this.wait&&!(this.waitTimer.delta()>=0))},handleTargets:function(t,i){i!==!1&&this.activate(t);for(var e=0,s=this.targetSequence.length;s>e;e++){var n=this.targetSequence[e];n instanceof ig.EntityTrigger?n.trigger(t):n.activate&&n.activate(t)}},activate:function(t){this.needsTeardown||this.setup(),this.triggering||this.trigger(t,!1),this.parent(t)},deactivate:function(t){this.needsTeardown&&this.teardown(),this.parent(t)},complete:function(){this.onCompleted.dispatch(),this.targetSequence.length=0,this.suicidal?this.kill(!0):!this.checking&&this.autoToggle&&this.activated?this.deactivate():this.teardownWhenComplete&&this.needsTeardown&&this.teardown()},setup:function(){this.needsTeardown=!0},teardown:function(){this.needsTeardown=!1},pause:function(){this.parent(),this.delayTimer.pause(),this.waitTimer.pause()},unpause:function(){this.parent(),this.delayTimer.unpause(),this.waitTimer.unpause()},kill:function(t){this.triggerable=!1,this.parent(t)},cleanup:function(){ig.game.hasLevel||(this.onCompleted.removeAll(),this.onCompleted.forget()),this.needsTeardown&&this.teardown(),this.parent()},update:function(){this.checking||this.wasChecking===this.checking||(this.triggerAfterDelay||(this._delaying=!1),this.autoToggle&&this.activated&&this.deactivate()),this._delaying&&this.triggerAfterDelay&&this.delayTimer.delta()>=0&&this.trigger(this),this.parent()}}),ig.global.wm&&(delete ig.EntityExtended.prototype.staticInstantiate,ig.EntityTrigger.inject({trigger:function(){}}))}),ig.baked=!0,ig.module("plusplus.abstractities.spawner").requires("plusplus.core.timer","plusplus.entities.trigger","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.signals").defines(function(){"use strict";var t=ig.utils,i=ig.utilsmath;ig.Spawner=ig.EntityTrigger.extend({_wmBoxColor:"rgba( 0, 100, 255, 0.7)",triggerable:!1,autoComplete:!1,triggerAfterDelay:!0,spawningEntity:"",spawnSettings:null,spawnCountMax:1,spawnCount:0,spawnedCount:0,spawning:!1,pool:[],entities:[],duration:0,durationTimer:null,respawnDelay:0,respawnTimer:null,spawnDelay:-1,spawnAt:!1,spawnTarget:{},spawnTargetSequence:[],spawnAtRandomPosition:!0,spawnAtSide:null,spawnAtRandomTarget:!1,spawnAtFirstTarget:!1,spawnAndMoveTo:!1,spawnAndMoveToSettings:null,spawnedDieWith:!1,unspawnSilently:!0,spawnTimer:null,onSpawned:null,onSpawnedAll:null,onUnspawned:null,onUnspawnedAll:null,_spawnedAtTargetIndex:0,_spawningComplete:!1,_reactivate:!1,initProperties:function(){this.parent(),this.durationTimer=new ig.Timer,this.respawnTimer=new ig.Timer,this.spawnTimer=new ig.Timer,this.onSpawned=new ig.Signal,this.onSpawnedAll=new ig.Signal,this.onUnspawned=new ig.Signal,this.onUnspawnedAll=new ig.Signal},resetExtras:function(){this.spawnAt=this.spawnAt||this,-1===this.duration&&(this.suicidal=!1),this.parent()},activate:function(t){if(this.parent(t),!this.spawning&&this.spawnedCount<this.spawnCountMax&&(this.spawningEntity||this.pool.length>0)){this._spawningComplete=!1,this.spawning=!0,this.spawnedCount=this.spawnCount,this.spawnDelay<0&&(this.spawnDelay=this.duration>0?this.duration/this.spawnCountMax:0),this.spawnTargetSequence.length=0;for(var i in this.spawnTarget){var e=ig.game.namedEntities[this.spawnTarget[i]];e&&this.spawnTargetSequence.push(e)}if(0===this.duration||0===this.spawnDelay){for(var s=!0;this.spawnedCount<this.spawnCountMax&&s;)s=this.spawnNext();this.complete()}else this.durationTimer.set(this.duration),this.spawnTimer.set(0)}},deactivate:function(t,i){this.spawning=this._spawningComplete=this._reactivate=!1,this.spawnedCount=this.spawnTargetSequence.length=this._spawnedAtTargetIndex=0,this.parent(t);for(var e=this.entities.length-1;e>=0;e--){var s=this.entities[e];this.unspawn(s,i)}},spawnNext:function(i){return this.spawnTargetSequence.length>0?this.spawnAtRandomTarget?this.spawnAt=this.spawnTargetSequence[Math.round(Math.random()*(this.spawnTargetSequence.length-1))]:this.spawnAtFirstTarget?this.spawnAt=this.spawnTargetSequence[0]:(this.spawnAt=this.spawnTargetSequence[this._spawnedAtTargetIndex],this._spawnedAtTargetIndex=(this._spawnedAtTargetIndex+1)%this.spawnTargetSequence.length):this.spawnAt=this,i?((!i.added||i._killed)&&(i=ig.game.spawnEntity(i,0,0,this.spawnSettings)),t.arrayCautiousRemove(this.pool,i),t.arrayCautiousAdd(this.entities,i)):this.pool.length>0?(i=this.pool.pop(),i&&(i=ig.game.spawnEntity(i,0,0,this.spawnSettings),this.entities.push(i))):this.spawningEntity&&this.spawnedCount<this.spawnCountMax&&(i=ig.game.spawnEntity(this.spawningEntity,0,0,this.spawnSettings),this.entities.push(i)),i&&(this.spawnCount=Math.min(this.spawnCountMax,this.spawnCount+1),this.spawnedCount=Math.min(this.spawnCountMax,this.spawnedCount+1),this.spawned(i),this.onSpawned.dispatch(i),this.spawnedCount===this.spawnCountMax&&this.onSpawnedAll.dispatch(this)),i},unspawn:function(i,e){i._killed?(i.spawner&&i.spawner.unlinkSpawned(i),this.spawnCount=Math.max(0,this.spawnCount-1),this._killed||(t.arrayCautiousRemove(this.entities,i),t.arrayCautiousAdd(this.pool,i),this.onUnspawned.dispatch(i),0===this.spawnCount&&this.onUnspawnedAll.dispatch(this),this.activated&&-1===this.duration&&!this.spawning&&(this.spawnDelay>0||0===this.spawnCount)&&(this.spawnedCount=this.spawnCount,this.respawnTimer.set(this.respawnDelay),this._reactivate=!0))):i.kill("boolean"==typeof e?e:this.unspawnSilently)},spawned:function(t){this.linkSpawned(t);var e=t.size.x,s=t.size.y,n=.5*e,a=.5*s,o=this.spawnAt.size.x,h=this.spawnAt.size.y,r=this.spawnAt.pos.x,l=this.spawnAt.pos.y,g=r+o,u=l+h;this.spawnAtRandomPosition?(t.pos.x=i.map(Math.random(),0,1,r+n,g-n),t.pos.y=i.map(Math.random(),0,1,l+a,u-a)):(t.pos.x=r+.5*o,t.pos.y=l+.5*h),t.pos.x-=n,t.pos.y-=a,this.spawnAtSide&&(this.spawnAtSide.x>0?t.pos.x=g-e-.5*o*(1-this.spawnAtSide.x):this.spawnAtSide.x<0&&(t.pos.x=r+.5*o*(1+this.spawnAtSide.x)),this.spawnAtSide.y>0?t.pos.y=u-s-.5*h*(1-this.spawnAtSide.y):this.spawnAtSide.y<0&&(t.pos.y=l+.5*h*(1+this.spawnAtSide.y))),this.spawnAndMoveTo&&this.spawnTargetSequence.length>0&&t.moveTo(this.spawnTargetSequence,this.spawnAndMoveToSettings)},linkSpawned:function(t){t.spawner&&t.spawner.unlinkSpawned(t),t.onRemoved.add(this.unspawn,this),t.spawner=this},unlinkSpawned:function(t){t.onRemoved.remove(this.unspawn,this),t.spawner=void 0},complete:function(){this._spawningComplete=!0,this.spawning=!1,this.parent()},pause:function(){this.parent(),this.respawnTimer.pause(),this.spawnTimer.pause(),this.durationTimer.pause()},unpause:function(){this.parent(),this.respawnTimer.unpause(),this.spawnTimer.unpause(),this.durationTimer.unpause()},cleanup:function(){if(ig.game.hasLevel||(this.onSpawned.removeAll(),this.onSpawned.forget(),this.onSpawnedAll.removeAll(),this.onSpawnedAll.forget(),this.onUnspawned.removeAll(),this.onUnspawned.forget(),this.onUnspawnedAll.removeAll(),this.onUnspawnedAll.forget()),this.spawnedDieWith)for(var t=this.entities.length-1;t>=0;t--)this.unspawn(this.entities[t]);if(this.entities.length){for(var t=this.entities.length-1;t>=0;t--)this.unlinkSpawned(this.entities[t]);this.entities.length=0}if(this.pool.length){for(var t=this.pool.length-1;t>=0;t--)this.unlinkSpawned(this.pool[t]);this.pool.length=0}this.spawning=this._spawningComplete=this._reactivate=!1,this.spawnCount=this.spawnedCount=this.spawnTargetSequence.length=this._spawnedAtTargetIndex=0,this.parent()},update:function(){if(this.parent(),this.spawning&&!this._spawningComplete&&this.spawnTimer.delta()>=0){this.spawnTimer.set(this.spawnDelay);var t=this.spawnNext();(this.spawnedCount>=this.spawnCountMax||!t)&&this.complete()}else this._reactivate===!0&&this.respawnTimer.delta()>=0&&(this._reactivate=!1,this.activate())}})}),ig.baked=!0,ig.module("plusplus.abstractities.shape").requires("plusplus.core.entity","plusplus.helpers.utils").defines(function(){"use strict";var t=ig.utils;ig.Shape=ig.EntityExtended.extend({_wmScalable:!0,_wmDrawBox:!0,_wmBoxColor:"rgba( 0, 255, 255, 0.7)",frozen:!0,opaqueFromVertices:!0,initTypes:function(){this.parent(),t.addType(ig.EntityExtended,this,"type","SHAPE")}})}),ig.baked=!0,ig.module("plusplus.entities.shape-solid").requires("plusplus.abstractities.shape").defines(function(){"use strict";ig.EntityShapeSolid=ig.global.EntityShapeSolid=ig.Shape.extend({opaque:!0,diffuse:1,hollow:!0})}),ig.baked=!0,ig.module("plusplus.entities.shape-climbable").requires("plusplus.abstractities.shape").defines(function(){"use strict";ig.EntityShapeClimbable=ig.global.EntityShapeClimbable=ig.Shape.extend({climbable:!0})}),ig.baked=!0,ig.module("plusplus.entities.shape-climbable-one-way").requires("plusplus.entities.shape-climbable").defines(function(){"use strict";ig.EntityShapeClimbableOneWay=ig.global.EntityShapeClimbableOneWay=ig.EntityShapeClimbable.extend({collides:ig.EntityExtended.COLLIDES.FIXED,oneWay:!0,oneWayFacing:{x:0,y:-1}})}),ig.baked=!0,ig.module("plusplus.ui.ui-overlay-pause").requires("plusplus.ui.ui-overlay").defines(function(){"use strict";ig.UIOverlayPause=ig.global.UIOverlayPause=ig.UIOverlay.extend({layerName:"ui",textSettings:{text:"PAUSED"}})}),ig.baked=!0,ig.module("plusplus.helpers.pathfinding").requires("plusplus.core.config","plusplus.core.collision-map","plusplus.core.pathfinding-map","plusplus.helpers.utilsmath","plusplus.helpers.utilstile","plusplus.helpers.utilsintersection").defines(function(){"use strict";function t(){var t,i;for(t=0,i=L.length;i>t;t++)L[t].cleanup();for(t=0,i=R.length;i>t;t++)R[t].cleanup();L.length=R.length=0}var i=ig.CONFIG,e=ig.utilsmath,s=ig.utilstile,n=ig.utilsintersection,a=i.COLLISION.TILE_ONE_WAY_UP,o=i.COLLISION.TILE_ONE_WAY_DOWN,h=i.COLLISION.TILE_ONE_WAY_RIGHT,r=i.COLLISION.TILE_ONE_WAY_LEFT,l=i.COLLISION.TILE_CLIMBABLE_WITH_TOP,g=i.COLLISION.TILE_CLIMBABLE_STAIRS_WITH_TOP,u=i.COLLISION.TILES_HASH_WALKABLE,c=i.COLLISION.TILES_HASH_SLOPED,d=i.COLLISION.TILES_HASH_CLIMBABLE,p=i.COLLISION.TILES_HASH_ONE_WAY,m=i.PATHFINDING.WEIGHTED,f=i.PATHFINDING.WEIGHT,y=i.PATHFINDING.WEIGHT_AWAY_FROM,E=i.PATHFINDING.ALLOW_DIAGONAL,v=i.PATHFINDING.DIAGONAL_REQUIRES_BOTH_DIRECT,T=i.PATHFINDING.AWAY_FROM_DISTANCE,A=i.PATHFINDING.AWAY_FROM_MAX_NODES,_=i.PATHFINDING.STRICT_SLOPE_CHECK;ig.pathfinding={};var I=null,x=null,C=null,S=null,w=ig.pathfinding.tilesize=1,N=1,O={from:{x:.1,y:.1},target:{x:.1,y:.1}},b=[],L=[],R=[],D=ig.pathfinding.HEURISTIC={MANHATTAN:function(t,i){return t+i},EUCLIDEAN:function(t,i){return Math.sqrt(t*t+i*i)},CHEBYSHEV:function(t,i){return Math.max(t,i)}};ig.PathNode=ig.Class.extend({x:0,y:0,gridX:0,gridY:0,size:0,walkable:!0,ungrounded:!0,insideLevel:!0,tile:0,sloped:!1,slopeNormal:{x:0,y:0},slopedAlong:!1,slopesAlongMap:{},slopedNeighbor:!1,slopedNeighborMap:{},climbable:!1,oneWay:!1,oneWayFacing:{x:0,y:0},weightPct:1,weight:0,neighbors:null,directNeighbors:null,neighborMap:{},corner:!1,cornerMap:{},closed:!1,opened:!1,openIndex:0,prevNode:null,g:0,w:0,h:0,f:0,init:function(t,i,e,u,m,f){var y,E;if(this.x=t||0,this.y=i||0,this.gridX=e||0,this.gridY=u||0,this.walkable="undefined"!=typeof m?m:!0,this.tile=f||0,this.climbable=!!d[this.tile],this.oneWay=!!p[this.tile],this.sloped=!!c[this.tile],this.sloped){var v=s.defaultTileSegmentsDef[this.tile];if(v)for(y=0,E=v.length;E>y;y++){var T=v[y].normal;if(T.x&&T.y){this.slopeNormal=T;break}}}if(this.oneWay&&(this.tile===a||this.tile===l||this.tile===g?this.oneWayFacing.y=-1:this.tile===o&&(this.oneWayFacing.y=1),this.tile===r?this.oneWayFacing.x=-1:this.tile===h&&(this.oneWayFacing.x=1)),this.walkable){if(ig.game.shapesLevel.length)for(this.insideLevel=!1,y=0,E=ig.game.shapesLevel.length;E>y;y++){var A=ig.game.shapesLevel[y];if(n.pointInAABB(t,i,A.x,A.y,A.x+A.size.x,A.y+A.size.y)&&n.pointInPolygon(t-(A.x+.5*A.size.x),i-(A.y+.5*A.size.y),A.vertices)){this.insideLevel=!0;break}}}else this.insideLevel=!1},cleanup:function(){this.g=this.h=this.f=this.w=this.openIndex=0,this.prevNode=null,this.closed=this.opened=!1}}),ig.pathfinding.rebuild=function(t,i){if(ig.pathfinding.unload(),I=t,C=i,I&&C&&C.tilesize!==I.tilesize)throw new Error("Maps tilesize mismatch: pathfinding map and collision map must have the same tilesize!");I&&(x=I.data,w=ig.pathfinding.tilesize=I.tilesize,N=1/I.tilesize),C&&(S=C.data,w=ig.pathfinding.tilesize=C.tilesize,N=1/C.tilesize),ig.pathfinding.rebuildGrid()},ig.pathfinding.unload=function(){b.length=0,I=x=C=S=null,w=ig.pathfinding.tilesize=0},ig.pathfinding.rebuildGrid=function(){var t,i,e,s,n,a,o,h,r,l;if(I&&x)for(n=0,a=x.length;a>n;n++)for(t=x[n],e=b[n],e||(e=b[n]=[]),o=0,h=t.length;h>o;o++)i=t[o],r=o*w+.5*w,l=n*w+.5*w,e[o]=new ig.PathNode(r,l,o,n,!!u[i],i);if(C&&S)for(n=0,a=S.length;a>n;n++)for(t=S[n],e=b[n],e||(e=b[n]=[]),o=0,h=!I||!x[0]||t.length>=x[0].length?t.length:x[0].length;h>o;o++){i=t[o]||0;var g=C.tiledef[i];s=e[o],s||(r=o*w+.5*w,l=n*w+.5*w,s=e[o]=new ig.PathNode(r,l,o,n,g&&"undefined"!=typeof g.walkable?g.walkable:!0,i)),ig.merge(s,g)}for(n=0,a=b.length;a>n;n++)for(t=b[n],o=0,h=t.length;h>o;o++){s=t[o],s.size=w;var c=s.neighborMap,d=b[n-1],p=b[n+1];d&&(c.top=d[o],o>0&&(c.topleft=d[o-1]),h-1>o&&(c.topright=d[o+1])),o>0&&(c.left=t[o-1]),h-1>o&&(c.right=t[o+1]),p&&(c.bottom=p[o],o>0&&(c.bottomleft=p[o-1]),h-1>o&&(c.bottomright=p[o+1])),s.ungrounded=!c.bottom||c.bottom.walkable&&c.bottom.oneWayFacing.y>=0,c.top&&c.top.walkable&&(c.top.climbable||c.top.oneWayFacing.y<=0)&&c.left&&c.left.walkable&&(c.left.climbable||c.left.oneWayFacing.x<=0)&&(!c.topleft||!c.topleft.walkable&&!c.topleft.sloped)&&(s.corner=s.cornerMap.topleft=!0),c.top&&c.top.walkable&&(c.top.climbable||c.top.oneWayFacing.y<=0)&&c.right&&c.right.walkable&&(c.right.climbable||c.right.oneWayFacing.x>=0)&&(!c.topright||!c.topright.walkable&&!c.topright.sloped)&&(s.corner=s.cornerMap.topright=!0),c.bottom&&c.bottom.walkable&&(c.bottom.climbable||c.bottom.oneWayFacing.y>=0)&&c.left&&c.left.walkable&&(c.left.climbable||c.left.oneWayFacing.x<=0)&&(!c.bottomleft||!c.bottomleft.walkable&&!c.bottomleft.sloped)&&(s.corner=s.cornerMap.bottomleft=!0),c.bottom&&c.bottom.walkable&&(c.bottom.climbable||c.bottom.oneWayFacing.y>=0)&&c.right&&c.right.walkable&&(c.right.climbable||c.right.oneWayFacing.x>=0)&&(!c.bottomright||!c.bottomright.walkable&&!c.bottomright.sloped)&&(s.corner=s.cornerMap.bottomright=!0),
c.top&&c.top.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.top=!0),c.bottom&&c.bottom.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.bottom=!0),c.right&&c.right.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.right=!0),c.left&&c.left.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.left=!0),c.topleft&&c.topleft.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.topleft=!0),c.topright&&c.topright.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.topright=!0),c.bottomleft&&c.bottomleft.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.bottomleft=!0),c.bottomright&&c.bottomright.sloped&&(s.slopedNeighbor=s.slopedNeighborMap.bottomright=!0),s.slopesAlongMap.top=!1,s.slopesAlongMap.bottom=s.walkable&&!s.oneWay&&c.bottom&&c.bottom.sloped,ig.pathfinding.getIsAlongSlope(s,-1,0)&&(s.slopesAlongMap.left=s.slopedAlong=!0),ig.pathfinding.getIsAlongSlope(s,1,0)&&(s.slopesAlongMap.right=s.slopedAlong=!0),ig.pathfinding.getIsAlongSlope(s,-1,-1)&&(s.slopesAlongMap.topleft=s.slopedAlong=!0),ig.pathfinding.getIsAlongSlope(s,1,-1)&&(s.slopesAlongMap.topright=s.slopedAlong=!0),ig.pathfinding.getIsAlongSlope(s,-1,1)&&(s.slopesAlongMap.bottomleft=s.slopedAlong=!0),ig.pathfinding.getIsAlongSlope(s,1,1)&&(s.slopesAlongMap.bottomright=s.slopedAlong=!0),s.directNeighbors=ig.pathfinding.getDirectNeighbors(s),s.neighbors=[].concat(s.directNeighbors,ig.pathfinding.getDiagonalNeighbors(s))}},ig.pathfinding.getPathToEntity=function(t,i,e,s,n){var a=ig.pathfinding.getPositionPathfindingEntities(t,i,O);return ig.pathfinding.getPathTo(a.from.x,a.from.y,a.target.x,a.target.y,e,s,t,i,n)},ig.pathfinding.getPathToPoint=function(t,i,e,s,n,a,o){var h=ig.pathfinding.getPositionPathfindingPoint(t,i,e,O.from);return ig.pathfinding.getPathTo(h.x,h.y,i,e,s,n,t,a,o)},ig.pathfinding.getPathTo=function(i,e,s,n,a,o,h,r,l){var g;h&&h.path?(g=h.path,g.length=0):g=[];var u=b;if(0===u.length)return g;var c=Math.floor(i*N),d=Math.floor(e*N),p=Math.floor(s*N),y=Math.floor(n*N),T=u[d]&&u[d][c],A=u[y]&&u[y][p];if(!T||!A||T===A)return g;var _,I,x,C,S,O,M,P,F,k,G,Y,z,B,H,U,X,W=L,V=R,q=D[l||"MANHATTAN"],K=Math.abs,j=Math.SQRT2,Z=w,Q=Z;h&&(Q=Math.max(h.size.x,h.size.y),F=E&&v,a&&(P=!0,k=ig.pathfinding.nodeHasCollidingEntities));var J;for(r&&o>0?(J=!0,o*=N,o*=o):J=!1,W.push(T);W.length>0;){var $=W.pop(),tt=$.gridX,it=$.gridY;if(V.push($),$.closed=!0,$===A){for(;$;)g.push($),$=$.prevNode;return t(),g}for(_=$.neighbors,S=_.length,F&&(Q>Z&&8>S&&!$.slopedNeighbor?(_=$.directNeighbors,S=_.length,X=-1,Y=!1):(G=$.neighborMap,z=B=H=U=Y=!1,X=.5*S|1)),C=0;S>C;C++)if(I=_[C],!I.closed){var et=I.gridX,st=I.gridY;if(I!==A){if(J){var nt=et-p,at=st-y;if(nt*nt+at*at>o)continue}if(P){if(Y&&(z&&I===G.topleft||B&&I===G.topright||H&&I===G.bottomleft||U&&I===G.bottomright))continue;if(k(I,$,h,r)){F&&X>C&&(I===G.top&&(Y=z=B=!0),I===G.bottom&&(Y=H=U=!0),I===G.left&&(Y=z=H=!0),I===G.right&&(Y=B=U=!0));continue}}}var ot,ht=et-tt===0||st-it===0?1:j,rt=$.g+ht;if(ot=m?$.w+ht+I.weight+f*I.weightPct:rt,!I.opened||ot<I.w)if(I.g=rt,I.w=ot,I.h=I.h||q(K(et-p),K(st-y)),I.f=I.w+I.h,I.prevNode=$,I.opened){var lt;for(O=I.openIndex,M=W.length-1;M>O;O++){if(x=W[O+1],x.f<=I.f){lt=!0;break}x.openIndex=O,W[O]=x}lt||(O=W.length),I.openIndex=O,W[O]=I}else{for(I.opened=!0,O=W.length;O>0&&(x=W[O-1],!(I.f<=x.f));O--)x.openIndex=O,W[O]=x;I.openIndex=O,W[O]=I}}}return t(),g},ig.pathfinding.getPathAwayFromEntity=function(t,i,e,s,n){return ig.pathfinding.getPathAwayFrom(t.pos.x+.5*t.size.x,t.pos.y+.5*t.size.y,i.pos.x+.5*i.size.x,i.pos.y+.5*i.size.y,e,s,t,n)},ig.pathfinding.getPathAwayFromPoint=function(t,i,e,s,n,a){return ig.pathfinding.getPathAwayFrom(t.pos.x+.5*t.size.x,t.pos.y+.5*t.size.y,i,e,s,n,t,a)},ig.pathfinding.getPathAwayFrom=function(i,e,s,n,a,o,h,r){var l;h&&h.path?(l=h.path,l.length=0):l=[];var g=b;if(0===g.length)return l;var u=Math.floor(i*N),c=Math.floor(e*N),d=Math.floor(s*N),p=Math.floor(n*N),_=g[c]&&g[c][u],I=g[p]&&g[p][d];if(!_||!I)return l;var x,C,S,O,M,P,F,k,G,Y,z,B,H,U,X,W,V,q=L,K=R,j=D[r||"MANHATTAN"],Z=Math.abs,Q=Math.SQRT2,J=w,$=J;h&&($=Math.max(h.size.x,h.size.y),G=E&&v,a&&(k=!0,Y=ig.pathfinding.nodeHasCollidingEntities)),o>0?o*=N:o=T*N,o*=o,q.push(_);for(var tt,it,et=1/0,st=-(1/0),nt=u-d,at=c-p,ot=nt*nt+at*at;q.length>0;){var ht=q.pop(),rt=ht.gridX,lt=ht.gridY;K.push(ht),ht.closed=!0,nt=rt-d,at=lt-p;var gt=nt*nt+at*at-ot;if(gt>0&&ht.g>1&&gt>st&&.5*ht.w<et&&(tt=ht,et=ht.w,st=gt),K.length>=A&&(it=tt),it){for(;it;)l.push(it),it=it.prevNode;return t(),l}for(x=ht.neighbors,M=x.length,G&&($>J&&!ht.slopedNeighbor&&8>M?(x=ht.directNeighbors,M=x.length,V=-1,B=!1):(z=ht.neighborMap,H=U=X=W=B=!1,V=.5*M|1)),O=0;M>O;O++)if(C=x[O],!C.closed){if(k){if(B&&(H&&C===z.topleft||U&&C===z.topright||X&&C===z.bottomleft||W&&C===z.bottomright))continue;if(Y(C,ht,h)){G&&V>O&&(C===z.top&&(B=H=U=!0),C===z.bottom&&(B=X=W=!0),C===z.left&&(B=H=X=!0),C===z.right&&(B=U=W=!0));continue}}var ut,ct=C.gridX,dt=C.gridY,pt=ct-rt,mt=dt-lt,ft=0===pt||0===mt?1:Q,yt=ht.g+ft;ut=m?ft+C.weight+f*C.weightPct:ft,(nt>0&&nt>nt+pt||0>nt&&nt+pt>nt)&&(ut+=y),(at>0&&at>at+mt||0>at&&at+mt>at)&&(ut+=y);var Et=ht.w+ut;if(!C.opened||Et<C.w)if(C.g=yt,C.w=Et,C.h=C.h||j(Z(ct-d),Z(dt-p)),C.f=C.w+C.h,C.prevNode=ht,C.opened){var vt;for(P=C.openIndex,F=q.length-1;F>P;P++){if(S=q[P+1],S.f<=C.f){vt=!0;break}S.openIndex=P,q[P]=S}vt||(P=q.length),C.openIndex=P,q[P]=C}else{for(C.opened=!0,P=q.length;P>0&&(S=q[P-1],!(C.f<=S.f));P--)S.openIndex=P,q[P]=S;C.openIndex=P,q[P]=C}}}return t(),l},ig.pathfinding.getNeighbors=function(t){var i,e=[],s=t.gridX,n=t.gridY,a=b,o=a[n],h=a[n-1],r=a[n+1];return i=h&&h[s],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,0,-1,t)&&e.push(i),i=o&&o[s+1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,1,0,t)&&e.push(i),i=r&&r[s],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,0,1,t)&&e.push(i),i=o&&o[s-1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,-1,0,t)&&e.push(i),i=h&&h[s-1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,-1,-1,t)&&e.push(i),i=h&&h[s+1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,1,-1,t)&&e.push(i),i=r&&r[s+1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,1,1,t)&&e.push(i),i=r&&r[s-1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,-1,1,t)&&e.push(i),e},ig.pathfinding.getDirectNeighbors=function(t){var i,e=[],s=t.gridX,n=t.gridY,a=b,o=a[n],h=a[n-1],r=a[n+1];return i=h&&h[s],i&&(i.walkable||t.slopesAlongMap.left)&&ig.pathfinding.isDirectionWalkable(i,0,-1,t)&&e.push(i),i=o&&o[s+1],i&&(i.walkable||t.slopesAlongMap.right)&&ig.pathfinding.isDirectionWalkable(i,1,0,t)&&e.push(i),i=r&&r[s],i&&(i.walkable||t.slopesAlongMap.bottom)&&ig.pathfinding.isDirectionWalkable(i,0,1,t)&&e.push(i),i=o&&o[s-1],i&&i.walkable&&ig.pathfinding.isDirectionWalkable(i,-1,0,t)&&e.push(i),e},ig.pathfinding.getDiagonalNeighbors=function(t){var i,e=[],s=t.gridX,n=t.gridY,a=b,o=(a[n],a[n-1]),h=a[n+1];return i=o&&o[s-1],i&&(i.walkable||t.slopesAlongMap.topleft)&&ig.pathfinding.isDirectionWalkable(i,-1,-1,t)&&e.push(i),i=o&&o[s+1],i&&(i.walkable||t.slopesAlongMap.topright)&&ig.pathfinding.isDirectionWalkable(i,1,-1,t)&&e.push(i),i=h&&h[s+1],i&&(i.walkable||t.slopesAlongMap.bottomright)&&ig.pathfinding.isDirectionWalkable(i,1,1,t)&&e.push(i),i=h&&h[s-1],i&&(i.walkable||t.slopesAlongMap.bottomleft)&&ig.pathfinding.isDirectionWalkable(i,-1,1,t)&&e.push(i),e},ig.pathfinding.nodeHasCollidingEntities=function(t,i,e,s){var a=ig.game.layersMap[e.layerName];if(a&&a.spatialHash){var o=a.spatialHash,h=a.spatialHashCellSize,r=t.x,l=t.y,g=r/h|0,u=l/h|0,c=o[g];if(c){var d=c[u];if(d&&d.length>0)for(var p=.45*e.size.x,m=.45*e.size.y,f=r-p,y=l-m,E=r+p,v=l+m,T=t.gridX-i.gridX,A=t.gridY-i.gridY,_=0,I=d.length;I>_;_++){var x=d[_];if(x!==e&&!(x.group&e.group)&&(!s||x!==s)&&!x.hidden&&!x._killed&&(x.collides!==ig.EntityExtended.COLLIDES.NEVER||x.type&ig.EntityExtended.TYPE.DANGEROUS&&x.checkAgainst&e.type)&&n.AABBIntersect(f,y,E,v,x.pos.x,x.pos.y,x.pos.x+x.size.x,x.pos.y+x.size.y)&&(!x.oneWay||(!x.climbable||!e.canClimb&&0!==e.gravityFactor&&0!==ig.game.gravity)&&(0>A&&x.oneWayFacing.y>0||A>0&&x.oneWayFacing.y<0||0>T&&x.oneWayFacing.x>0||T>0&&x.oneWayFacing.x<0)))return!0}}}return!1},ig.pathfinding.getGridNode=function(t,i){return b[i]&&b[i][t]},ig.pathfinding.getNode=function(t,i,e,s){var n=Math.floor(t*N)+(e||0),a=Math.floor(i*N)+(s||0);return ig.pathfinding.getGridNode(n,a)},ig.pathfinding.getGridWalkableNode=function(t,i,e,s,n,a){var o=t+(e||0),h=i+(s||0),r=b[h]&&b[h][o],l=b[i]&&b[i][t];if(r&&r.walkable&&(!e&&!s||ig.pathfinding.isDirectionWalkable(r,e,s,l))){if(!n||!a)return r;if(!l||!ig.pathfinding.nodeHasCollidingEntities(r,l,a))return r}},ig.pathfinding.getWalkableNode=function(t,i,e,s,n,a){return ig.pathfinding.getGridWalkableNode(Math.floor(t*N),Math.floor(i*N),e,s,n,a)},ig.pathfinding.getWalkableNodeChain=function(t,i,e,s,n,a,o,h){var r=Math.floor(t*N),l=Math.floor(i*N);n=n||2,h?h.length=0:h=[];for(var g=1;n>=g;g++){var u=ig.pathfinding.getGridWalkableNode(r+e*g,l+s*g,e,s,a,o);if(!u)break;h.push(u)}return h},ig.pathfinding.isGridWalkable=function(t,i,e,s,n,a){var o=t+(e||0),h=i+(s||0),r=b[h]&&b[h][o],l=b[i]&&b[i][t];if(r&&r.walkable&&(!e&&!s||ig.pathfinding.isDirectionWalkable(r,e,s,l))){if(!n||!a)return!0;if(l&&!ig.pathfinding.nodeHasCollidingEntities(r,l,a))return!0}return!1},ig.pathfinding.isWalkable=function(t,i,e,s,n,a){return ig.pathfinding.isGridWalkable(Math.floor(t*N),Math.floor(i*N),e,s,n,a)},ig.pathfinding.isDirectionWalkable=function(t,i,e,s){if(0!==i&&0!==e&&s){if(!E)return!1;var n=s.neighborMap;if(v)if(i>0){if(!n.right||!n.right.walkable&&!n.right.sloped)return!1;if(e>0){if(!n.bottom||!n.bottom.walkable&&!n.bottom.sloped)return!1}else if(!n.top||!n.top.walkable&&!n.top.sloped)return!1}else{if(!n.left||!n.left.walkable&&!n.left.sloped)return!1;if(e>0){if(!n.bottom||!n.bottom.walkable&&!n.bottom.sloped)return!1}else if(!n.top||!n.top.walkable&&!n.top.sloped)return!1}else if(i>0){if(e>0){if(!(n.right&&(n.right.walkable||n.right.sloped)||n.bottom&&(n.bottom.walkable||n.bottom.sloped)))return!1}else if(!(n.right&&(n.right.walkable||n.right.sloped)||n.top&&(n.top.walkable||n.top.sloped)))return!1}else if(e>0){if(!(n.left&&(n.left.walkable||n.left.sloped)||n.bottom&&(n.bottom.walkable||n.bottom.sloped)))return!1}else if(!(n.left&&(n.left.walkable||n.left.sloped)||n.top&&(n.top.walkable||n.top.sloped)))return!1}return t.oneWay&&!t.climbable&&(0>e&&t.oneWayFacing.y>0||e>0&&t.oneWayFacing.y<0||0>i&&t.oneWayFacing.x>0||i>0&&t.oneWayFacing.x<0)?!1:!0},ig.pathfinding.isGridPointInGrid=function(t,i){return b[i]&&b[i][t]instanceof Node},ig.pathfinding.isPointInGrid=function(t,i,e,s){var n=Math.floor(t*N)+(e||0),a=Math.floor(i*N)+(s||0);return b[a]&&b[a][n]instanceof Node},ig.pathfinding.getPositionPathfindingEntities=function(t,i,e){e||(e={from:{x:.1,y:.1},target:{x:.1,y:.1}});var s=t.size.x,n=t.size.y,a=t.pos.x,o=a+s,h=t.pos.y,r=h+n,l=a+.5*s,g=h+.5*n,u=i.size.x,c=i.size.y,d=i.pos.x,p=d+u,m=i.pos.y,f=m+c,y=d+.5*u,E=m+.5*c,v=.25*w;return l>y?(e.from.x=a+v,e.target.x=p-v):y>l?(e.from.x=o-v,e.target.x=d+v):(e.from.x=a+.5*s,e.target.x=d+.5*u),g>E?(e.from.y=t.hasGravity?r-v:h+v,e.target.y=f-v):E>g?(e.from.y=r-v,e.target.y=i.hasGravity?f-v:m+v):(e.from.y=t.hasGravity?r-v:h+.5*n,e.target.y=i.hasGravity?f-v:m+.5*c),e},ig.pathfinding.getPositionPathfindingPoint=function(t,i,e,s){return s||(s={}),s.x=t.pos.x+.5*t.size.x,s.y=t.pos.y+.5*t.size.y,s.x>i?s.x=t.pos.x+.25*w:s.x<i&&(s.x=t.pos.x+t.size.x-.25*w),t.hasGravity||s.y<e?s.y=t.pos.y+t.size.y-.25*w:s.y>e&&(s.y=t.pos.y+.25*w),s},ig.pathfinding.getBoundsPathfollowing=function(t,i,e,s,n,a,o){o||(o={});var h=Math.min(.5*w,.5*e),r=Math.min(.5*w,.5*s);return n.corner?n.cornerMap.bottomleft?(o.minX=t,o.maxX=o.minX+h,o.maxY=i+s,o.minY=o.maxY-r):n.cornerMap.bottomright?(o.maxX=t+e,o.minX=o.maxX-h,o.maxY=i+s,o.minY=o.maxY-r):n.cornerMap.topleft?(o.minX=t,o.maxX=o.minX+h,o.minY=i,o.maxY=o.minY+r):n.cornerMap.topright&&(o.maxX=t+e,o.minX=o.maxX-h,o.minY=i,o.maxY=o.minY+r):(o.ignoreCornerX?(o.minX=t+.5*e-.5*h,o.maxX=o.minX+h):(o.minX=t+.5*e,o.maxX=o.minX),o.maxY=i+s,o.minY=o.maxY-r,n.x>o.maxX?(o.minX=t,o.maxX=o.minX+h):n.x<o.minX&&(o.maxX=t+e,o.minX=o.maxX-h),!o.ignoreCornerX&&n.x>=o.minX-1&&n.x<=o.maxX+1&&(o.ignoreCornerX=!0),a&&(o.ignoreCornerY?(o.minY=i+.5*s-.5*r,o.maxY=o.minY+r):(o.minY=i+.5*s,o.maxY=o.minY),n.y>o.maxY?(o.minY=i,o.maxY=o.minY+r):n.y<o.minY&&(o.maxY=i+s,o.minY=o.maxY-r),!o.ignoreCornerY&&n.y>=o.minY-1&&n.y<=o.maxY+1&&(o.ignoreCornerY=!0))),o.width=h,o.height=r,o},ig.pathfinding.getEntityNeighborPositionX=function(t,i,e){return 0!==e?0>e?t-w:t+i+w:t+.5*i},ig.pathfinding.getEntityNeighborPositionY=function(t,i,e,s){return 0!==e?0>e?t-w:t+i+w:s?t+.5*i:t+i-.25*w},ig.pathfinding.getEntityOnSmoothSlope=function(t,i,e){var s,n=.25*w;if(s=0>i?ig.pathfinding.getNode(t.pos.x+n,t.pos.y+t.size.y-n):ig.pathfinding.getNode(t.pos.x+t.size.x-n,t.pos.y+t.size.y-n)){if(_){var a;return a=0>i?"left":"right",s.slopesAlongMap[a]||e&&s.slopesAlongMap[(0>e?"top":"bottom")+a]||!e&&(s.slopesAlongMap["top"+a]||s.slopesAlongMap["bottom"+a])}return s.slopedAlong}return!1},ig.pathfinding.getSlopeDirectionY=function(t,i){var s,n=.25*w;return s=0>i?ig.pathfinding.getNode(t.pos.x+n,t.pos.y+t.size.y-n):ig.pathfinding.getNode(t.pos.x+t.size.x-n,t.pos.y+t.size.y-n),s&&s.sloped&&s.slopeNormal?e.direction(-s.slopeNormal.x*(0>i?1:-1)):0},ig.pathfinding.getIsAlongSlope=function(t,i,e){var s,n,a;0>i?(s="left",n=1,a=3):(s="right",n=3,a=1);var o,h,r;if("undefined"!=typeof e?0!==e?0>e?(o=t.neighborMap["top"+s],h=0,r=1):(o=t.neighborMap["bottom"+s],h=0,r=-1):(o=t.neighborMap[s],h=1,r=0):t.sloped?(o=t.neighborMap["top"+s],h=0,r=1):(o=t.neighborMap[s],h=1,r=0),o&&o.sloped){var l=ig.game.collisionMap&&ig.game.collisionMap.tiledef||ig.CollisionMap.defaultTileDef,g=l[t.tile],u=l[o.tile];if(!u||!g&&u[a]===h||g&&g[n]+r===u[a])return!0}return!1}}),ig.baked=!0,ig.module("plusplus.core.game").requires("impact.game","plusplus.core.config","plusplus.core.timer","plusplus.core.font","plusplus.core.image","plusplus.core.background-map","plusplus.core.collision-map","plusplus.core.pathfinding-map","plusplus.core.animation","plusplus.core.layer","plusplus.core.input","plusplus.core.entity","plusplus.core.camera","plusplus.core.player-manager","plusplus.abstractities.spawner","plusplus.entities.light","plusplus.entities.shape-solid","plusplus.entities.shape-climbable","plusplus.entities.shape-climbable-one-way","plusplus.ui.ui-overlay-pause","plusplus.helpers.signals","plusplus.helpers.tweens","plusplus.helpers.pathfinding","plusplus.helpers.utils","plusplus.helpers.utilstile","plusplus.helpers.utilsintersection").defines(function(){"use strict";var t=ig.CONFIG,i=ig.pathfinding,e=ig.utils,s=ig.utilstile,n=ig.utilsintersection;ig.GameExtended=ig.Game.extend({shapesPasses:{level:{retainBoundaryOuter:!1,discardEdgesInner:!0,ignoreClimbables:!0,ignoreOneWays:!0},climbables:{ignoreSolids:!0,ignoreOneWays:!0}},shapesLevel:[],layers:[],layersMap:{},sortLayersBy:null,paused:!1,pauseLocked:!1,changed:!1,changedLights:!1,dirtyEntities:!0,dirtyLights:!0,deferring:!1,hasLevel:!1,entities:[],namedEntities:{},persistentEntities:{},autoSpawnPlayer:t.AUTO_SPAWN_PLAYER,playerClass:null,canSearchForPlayerByClass:!0,canSearchForPlayerByType:!0,lights:[],gravity:t.TOP_DOWN?0:t.GRAVITY,cameraClass:ig.Camera,cameraSettings:null,camera:null,playerManagerClass:ig.PlayerManager,playerManagerSettings:null,playerManager:null,pathfindingMap:null,onPaused:null,onUnpaused:null,clearColor:t.CLEAR_COLOR,_gameNeedsSetup:!0,_gameNeedsResize:!1,_gameForceResize:!1,_levelBuilding:!1,_levelToBuild:null,_levelNeedsBuild:!1,_levelNeedsUnload:!1,_playerSpawnerName:"",_layersToChange:[],_layersToAdd:[],_layersToRemove:[],_itemsToAdd:[],_itemsToAddNext:[],_itemsToRemove:[],_itemsToRemoveNext:[],init:function(){this._gameNeedsSetup&&this.setup()},setup:function(){this._gameNeedsSetup=!1,this.onPaused=new ig.Signal,this.onUnpaused=new ig.Signal,this.cameraClass&&(this.camera=new this.cameraClass(this.cameraSettings)),this.playerManagerClass&&(this.playerManager=new this.playerManagerClass(this.playerManagerSettings)),this.sortLayersBy=this.sortLayersBy||ig.Game.SORT.Z_INDEX,this.addLayer(new ig.Layer("backgroundMaps",{preRender:t.PRERENDER_BACKGROUND_LAYER,noUpdate:t.NO_UPDATE_BACKGROUND_LAYER})),this.addLayer(new ig.Layer("lights")),this.addLayer(new ig.Layer("entities")),this.addLayer(new ig.Layer("foregroundMaps",{preRender:t.PRERENDER_FOREGROUND_LAYER,noUpdate:t.NO_UPDATE_FOREGROUND_LAYER})),this.addLayer(new ig.Layer("overlay",{zIndex:1,ignorePause:t.IGNORE_PAUSE_OVERLAY_LAYER,autoSort:t.AUTO_SORT_OVERLAY_LAYER})),this.addLayer(new ig.Layer("ui",{zIndex:2,clearOnLoad:t.CLEAR_ON_LOAD_UI_LAYER,ignorePause:t.IGNORE_PAUSE_UI_LAYER,autoSort:t.AUTO_SORT_UI_LAYER}));for(var i in t.LAYERS_CUSTOM){var s=t.LAYERS_CUSTOM[i];this.addLayer(new ig.Layer(i,s))}this._addDeferredLayers(),ig.global.addEventListener("resize",e.debounce(this.resize.bind(this),t.RESIZE_DELAY),!1),this.resize(),this.inputStart()},loadLevelDeferred:function(t,i){this.resetLoadLevel(),this._levelToLoad=t,this._playerSpawnerName=i},loadLevel:function(i,e){if(this._gameNeedsSetup&&this.setup(),i=i||this._levelToLoad,this._levelToLoad=void 0,"string"==typeof i){var s=i.replace(/^(Level)?(\w)(\w*)/,function(t,i,e,s){return e.toUpperCase()+s});s=s.replace(/[-|\s?)](.)/g,function(t,i){return i.toUpperCase()}),i=ig.global["Level"+s]}if(i)if(this._levelToBuild=i,this.hasLevel&&t.TRANSITION_LEVELS&&this.layersMap[t.TRANSITIONER_LAYER]&&this.layersMap[t.TRANSITIONER_LAYER].ignorePause){var n=this;this.transitioner||(this.transitioner=this.spawnEntity(ig.UIOverlay,0,0,{name:"transitioner",layerName:t.TRANSITIONER_LAYER,zIndex:t.Z_INDEX_TRANSITIONER,fillStyle:t.TRANSITIONER_COLOR,r:t.TRANSITIONER_R,g:t.TRANSITIONER_G,b:t.TRANSITIONER_B}),this.transitioner.alpha=0),this.transitioner.fadeTo(1,{onComplete:function(){n.removeEntity(n.transitioner),n.buildLevelDeferred()}}),this.pause(!0)}else this.buildLevel()},buildLevelDeferred:function(){this._levelToBuild&&(this._levelNeedsBuild=!0)},buildLevel:function(){this._gameNeedsSetup&&this.setup();var e,n,a,o,h,r=this._levelToBuild,l=this._playerSpawnerName;if(r){for(this._levelBuilding=!0,this.unloadLevel(),this.collisionMap=ig.CollisionMap.staticNoCollision,o=0;o<r.layer.length;o++)n=r.layer[o],"collision"===n.name?this.collisionMap=new ig.CollisionMap(n.tilesize,n.data):"pathfinding"===n.name?this.pathfindingMap=new ig.PathfindingMap(n.tilesize,n.data):(a=new ig.BackgroundMapExtended(n.tilesize,n.data,n.tilesetName),a.anims=this.backgroundAnims[n.tilesetName]||{},a.repeat=n.repeat,a.distance=n.distance,a.foreground=!!n.foreground,a.preRender=!!n.preRender,a.name=n.name,!a.layerName&&a.foreground?a.layerName="foregroundMaps":a.layerName||(a.layerName="backgroundMaps"),this.addItem(a));for(s.rebuild(this.collisionMap),this.createShapes(),t.PATHFINDING.BUILD_WITH_LEVEL&&i.rebuild(this.collisionMap,this.pathfindingMap),this.namedEntities={},o=0,h=r.entities.length;h>o;o++)e=r.entities[o],this.spawnEntity(e.type,e.x,e.y,e.settings);var g=this.getPlayer();for(!g&&this.autoSpawnPlayer&&(g=this.persistentEntities.player||this.playerClass,g&&this.spawnEntity(g,0,0)),this.transitioner&&(this.transitioner._layerNameAdd?this.transitioner.alpha=1:this.spawnEntity(this.transitioner,0,0,{alpha:1}),this.transitioner.fadeToDeath(),this.transitioner=void 0),o=0,h=this.layers.length;h>o;o++){var u=this.layers[o];u.items.sort(u.sortBy)}for(this._levelBuilding=!1,this.hasLevel=!0,o=0,h=this.layers.length;h>o;o++)this.layers[o].ready();if(g&&l){var c=this.namedEntities[l];c&&(c instanceof ig.Spawner?c.spawnNext(g):g.moveToPosition(c))}this.unpause(!0),this.camera&&this.camera.ready(),this.playerManager&&this.playerManager.ready(),this.resize(!0),this.dirtyEntities=this.dirtyLights=!0}},unloadLevelDeferred:function(){this._levelNeedsUnload=!0},unloadLevel:function(){if(this.hasLevel){this.hasLevel=!1,this.shapesLevel.length=0,this.playerManager&&this.playerManager.reset(),this.camera&&this.camera.reset(),this._removeDeferredItems(),this._addDeferredItems(),this.resetLoadLevel(),i.unload();for(var t=0,e=this.layers.length;e>t;t++)this.layers[t].reset()}},resetLoadLevel:function(){this._levelToLoad=this._levelToBuild=void 0,this._levelNeedsBuild=this._levelNeedsUnload=!1,this._playerSpawnerName=""},createShapes:function(){var t,i,e,n;if(this.shapesPasses&&this.collisionMap)for(var a in this.shapesPasses){for(e=this.shapesPasses[a],n=s.shapesFromCollisionMap(this.collisionMap,e),t=0,i=n.solids.length;i>t;t++){var o=n.solids[t];"level"===a?(o.size=o.settings.size,o.vertices=o.settings.vertices,delete o.id,delete o.settings,this.shapesLevel.push(o)):this.spawnEntity(ig.EntityShapeSolid,o.x,o.y,o.settings)}for(t=0,i=n.oneWays.length;i>t;t++){var o=n.oneWays[t];this.spawnEntity(ig.EntityShapeSolid,o.x,o.y,o.settings)}for(t=0,i=n.climbables.length;i>t;t++){var o=n.climbables[t];this.spawnEntity(o.settings.oneWay?ig.EntityShapeClimbableOneWay:ig.EntityShapeClimbable,o.x,o.y,o.settings)}}},addLayer:function(t){return this._layersToAdd.push(t),t},_addDeferredLayers:function(t){if(t=t||this._layersToAdd,t.length>0){for(var i=0,e=t.length;e>i;i++){var s=t[i];this.layersMap[s.name]!==s&&(this.layersMap[s.name]&&this.removeLayer(this.layersMap[s.name]),this.layersMap[s.name]=s,this.layers.push(s),this.sortLayersBy&&this.layers.sort(this.sortLayersBy))}t===this._layersToAdd&&(this._layersToAdd.length=0)}},removeLayer:function(t){this._layersToRemove.push(t)},_removeDeferredLayers:function(t){if(t=t||this._layersToRemove,t.length>0){for(var i=0,s=t.length;s>i;i++){var n=t[i];e.arrayCautiousRemove(this.layers,n),this.layersMap[n.name]===n&&delete this.layersMap[n.name],n.reset()}t===this._layersToRemove&&(this._layersToRemove.length=0)}},changeLayer:function(t,i){this._layersToChange.push({name:t,settings:i})},_changeDeferredLayers:function(){if(this._layersToChange.length>0){for(var t=0,i=this._layersToChange.length;i>t;t++){var e=this._layersToChange[t],s=e.name,n=e.settings,a=this.layersMap[s];a&&ig.merge(a,n)}this._layersToChange.length=0}},spawnEntity:function(i,e,s,n){var a="string"==typeof i?ig[i]||ig.global[i]:i;if(!a)throw new Error("Can't spawn entity of type: "+i+". It does not exist in namespace 'ig' or 'ig.global'/'window'.");var o;if(a instanceof ig.EntityExtended){if(o=a,o._layerNameAdd)return o;o.reset(e,s,n)}else o=new a(e,s,n);if(o.name&&(o.persistent&&(this.persistentEntities[o.name]instanceof ig.EntityExtended?(o=this.persistentEntities[o.name],o.reset(e,s,n)):this.persistentEntities[o.name]=o),this.namedEntities[o.name]=o),t.FORCE_ENTITY_EXTENDED&&!(o instanceof ig.EntityExtended))throw new Error("You are trying to spawn an entity that does not inherit or extend ig.EntityExtended. Although it is not recommended (seriously), if you wish to allow this, see ig.CONFIG.FORCE_ENTITY_EXTENDED.");return this.addItem(o),o},removeEntity:function(t,i){t instanceof ig.EntityExtended&&!t._killed&&this.flagAsKilled(t),this.removeItem(t,i)},clearPersistentEntity:function(t){var i=ig.game.persistentEntities[t];i&&(i.added?i._cleanupPersistent=!0:i.cleanupPersistent(),delete ig.game.persistentEntities[t])},clearPersistentEntities:function(){for(var t in ig.game.persistentEntities)this.clearPersistentEntity(t)},flagAsKilled:function(t){t.name&&delete this.namedEntities[t.name],t._killed=!0,t.type=ig.EntityExtended.TYPE.NONE,t.checkAgainst=ig.EntityExtended.TYPE.NONE,t.collides=ig.EntityExtended.COLLIDES.NEVER},addItem:function(t,i){if(!t._killed){var e;i?(t._layerChange=i.forChange||!1,e=i.layerName||t.layerName||"entities"):(t._layerChange=!1,e=t.layerName||"entities"),(t._layerChange||!t._layerNameAdd)&&(t._layerNameAdd=e,this._levelBuilding?this._addDeferredItem(t):this.deferring?this._itemsToAdd.push(t):this._itemsToAddNext.push(t))}},_addDeferredItems:function(){if(this._itemsToAdd.length>0){for(var t=0,i=this._itemsToAdd.length;i>t;t++)this._addDeferredItem(this._itemsToAdd[t]);this._itemsToAdd.length=0}},_addDeferredItem:function(t){this._gameNeedsSetup&&this.setup(),t.layerName=t._layerNameAdd,t._layerNameAdd=void 0;var i=this.layersMap[t.layerName];if(!i)throw new Error("Attempting to add item/entity to layer named "+t.layerName+" and that layer doesn't exist. Your item needs a 'layerName' property with a value matching one of the existing game layer names: ",this.layersMap);i.addItem(t),t.added=!0,t._layerChange||this._levelBuilding||(i.paused?t.pause&&t.pause():t.paused&&t.unpause&&t.unpause(),t.adding&&t.adding()),t._layerChange=!1,this.dirtyEntities=!0,t instanceof ig.EntityLight&&(this.dirtyLights=!0)},removeItem:function(t,i){i?(t._layerNameRemove=i.layerName||t.layerName,t._layerChange=i.forChange||!1):(t._layerNameRemove=t.layerName,t._layerChange=!1),t._layerChange||(t.cleanup&&t.cleanup(),t.added=!1),this._levelBuilding?this._removeDeferredItem(t):(t._layerNameAdd&&(t._layerNameAdd=void 0,e.arrayCautiousRemove(this._itemsToAddNext,t),e.arrayCautiousRemove(this._itemsToAdd,t)),this.deferring?this._itemsToRemove.push(t):this._itemsToRemoveNext.push(t))},_removeDeferredItems:function(){if(this._itemsToRemove.length>0){for(var t=0,i=this._itemsToRemove.length;i>t;t++)this._removeDeferredItem(this._itemsToRemove[t]);this._itemsToRemove.length=0}},_removeDeferredItem:function(t){var i=this.layersMap[t._layerNameRemove];t._layerNameRemove=void 0,i&&i.removeItem(t),this.dirtyEntities=!0,t instanceof ig.EntityLight&&(this.dirtyLights=!0)},_advanceDeferredNext:function(){this._itemsToAddNext.length>0&&(this._itemsToAdd=this._itemsToAddNext,this._itemsToAddNext=[]),this._itemsToRemoveNext.length>0&&(this._itemsToRemove=this._itemsToRemoveNext,this._itemsToRemoveNext=[])},layerChangeItem:function(t,i){t&&(!i&&t.resetState&&(i=t.resetState.layerName),i&&t.layerName!==i&&(this.removeItem(t,{layerName:t.layerName,forChange:!0}),this.addItem(t,{layerName:i,forChange:!0})))},sortEntitiesDeferred:function(t){if("string"==typeof t)this.sortEntitiesOnLayerDeferred(this.layersMap[t]);else for(var i=0,e=this.layers.length;e>i;i++)this.sortEntitiesOnLayerDeferred(this.layers[i])},sortEntitiesOnLayerDeferred:function(t){t&&t.sort()},sortEntities:function(t){this.sortEntitiesDeferred(t)},sortEntitiesOnLayer:function(t){this.sortEntitiesOnLayerDeferred(t)},isInsideLevel:function(t,e){if(i.tilesize){var n=i.getNode(t,e);return n&&n.insideLevel}return this.collisionMap?s.isTileWalkableStrict(this.collisionMap.getTile(t,e)):!0},getPlayer:function(t){return this.namedEntities.player||this.canSearchForPlayerByClass&&this.getEntitiesByClass("Player",t||{first:!0})[0]||this.canSearchForPlayerByType&&this.getEntitiesByType(ig.EntityExtended.TYPE.PLAYER,t||{first:!0})[0]},getEntitiesByClass:function(t,i){var e="string"==typeof t?ig.global[t]:t;return e?this.getEntitiesMatching(function(t){return t instanceof e},i):[]},getEntitiesByType:function(t,i){var s="string"==typeof t?e.getType(ig.EntityExtended,t):t;return this.getEntitiesMatching(function(t){return t.type&s},i)},getEntitiesByGroup:function(t,i){var s="string"==typeof t?e.getType(ig.EntityExtended,t):t;return this.getEntitiesMatching(function(t){return t.group&s},i)},getCharactersByGroup:function(t,i){var s="string"==typeof t?e.getType(ig.EntityExtended,t):t;return this.getEntitiesMatching(function(t){return t.group&s&&t instanceof ig.Character},i)},getEntitiesMatching:function(t,i){var e,s,a,o,h,r,l,g,u,c,d,p,m,f,y,E,v=[];if(i&&i.layerName){if(i&&(s=i.layerName,a=i.unsorted,o=i.distanceSquared,h=i.byDistance,r=i.lineOfSight,l=i.nonHidden,g=i.from,f=i.first,"undefined"!=typeof i.minX&&(u=!0,c=i.minX,d=i.minY,p=i.maxX,m=i.maxY)),e=this.layersMap[s]){var T=e.items;for(y=0,E=T.length;E>y;y++){var A=T[y];if(!A._killed&&t(A)&&(!l||!A.hidden)&&(!o||A.distanceSquaredTo(g)<=o)&&(!u||n.AABBIntersect(c,d,p,m,A.pos.x,A.pos.y,A.pos.x+A.width,A.pos.y+A.height))&&(!r||g.lineOfSight(A))&&(v.push(A),f))break}}}else for(i=i||{},i.unsorted=!0,y=0,E=this.layers.length;E>y;y++)if(e=this.layers[y],e.numEntities){i.layerName=e.name;var _=this.getEntitiesMatching(t,i);if(_.length&&(v=v.concat(_),i.first))break}return v.length>1&&!a&&(h?g instanceof ig.EntityExtended?n.sortByDistance(g.pos.x+.5*g.size.x,g.pos.y+.5*g.size.y,v):n.sortByDistance(g.x,g.y,v):v.sort(this.sortBy)),v},getMapByName:function(t){var i,e,s,n,a,o;if("collision"===t)return this.collisionMap;for(i=0,e=this.layers.length;e>i;i++)if(o=this.layers[i],a=o.items,o.numBackgroundMaps)for(s=0,n=a.length;n>s;s++){var h=a[s];if(h.name===t)return h}},pause:function(i){if(!this.pauseLocked&&!this._levelBuilding){for(var e=0,s=this.layers.length;s>e;e++)this.layers[e].pause();this.paused||(this.paused=!0,this.pauseLocked=i,this.camera&&this.camera.pause(),!this.pauseLocked&&t.DIMMED_PAUSE&&(this.dimmer||(this.dimmer=this.spawnEntity(ig.UIOverlayPause,0,0,{fillStyle:t.DIMMER_COLOR,r:t.DIMMER_R,g:t.DIMMER_G,b:t.DIMMER_B,alpha:0})),this.dimmer.fadeTo(t.DIMMER_ALPHA)),this.onPaused.dispatch(this))}},unpause:function(t){if(t&&(this.pauseLocked=!1),!this.pauseLocked&&!this._levelBuilding){for(var i=0,e=this.layers.length;e>i;i++)this.layers[i].unpause();this.paused&&(this.paused=!1,this.camera&&this.camera.unpause(),this.dimmer&&(this.dimmer.fadeToDeath(),this.dimmer=void 0),this.onUnpaused.dispatch(this))}},inputStart:function(){ig.input.bind(ig.KEY.MOUSE1,"touch"),ig.input.bind(ig.KEY.MOUSE2,"touch"),ig.input.bind(ig.KEY.TAP,"tap"),ig.input.bind(ig.KEY.TAP_DOUBLE,"tapDouble"),ig.input.bind(ig.KEY.HOLD,"hold"),ig.input.bind(ig.KEY.HOLD_ACTIVATE,"holdActivate"),ig.input.bind(ig.KEY.SWIPE,"swipe"),ig.input.bind(ig.KEY.SWIPE_X,"swipeX"),ig.input.bind(ig.KEY.SWIPE_Y,"swipeY"),ig.input.bind(ig.KEY.SWIPE_LEFT,"swipeLeft"),ig.input.bind(ig.KEY.SWIPE_RIGHT,"swipeRight"),ig.input.bind(ig.KEY.SWIPE_UP,"swipeUp"),ig.input.bind(ig.KEY.SWIPE_DOWN,"swipeDown"),ig.input.bind(ig.KEY.LEFT_ARROW,"left"),ig.input.bind(ig.KEY.RIGHT_ARROW,"right"),ig.input.bind(ig.KEY.UP_ARROW,"up"),ig.input.bind(ig.KEY.DOWN_ARROW,"down"),ig.input.bind(ig.KEY.A,"left"),ig.input.bind(ig.KEY.D,"right"),ig.input.bind(ig.KEY.W,"up"),ig.input.bind(ig.KEY.S,"down"),ig.input.bind(ig.KEY.SPACE,"jump")},inputEnd:function(){ig.input.unbind(ig.KEY.MOUSE1,"touch"),ig.input.unbind(ig.KEY.MOUSE2,"touch"),ig.input.unbind(ig.KEY.TAP,"tap"),ig.input.unbind(ig.KEY.TAP_DOUBLE,"tapDouble"),ig.input.unbind(ig.KEY.HOLD,"hold"),ig.input.unbind(ig.KEY.HOLD_ACTIVATE,"holdActivate"),ig.input.unbind(ig.KEY.SWIPE,"swipe"),ig.input.unbind(ig.KEY.SWIPE_X,"swipeX"),ig.input.unbind(ig.KEY.SWIPE_Y,"swipeY"),ig.input.unbind(ig.KEY.SWIPE_LEFT,"swipeLeft"),ig.input.unbind(ig.KEY.SWIPE_RIGHT,"swipeRight"),ig.input.unbind(ig.KEY.SWIPE_UP,"swipeUp"),ig.input.unbind(ig.KEY.SWIPE_DOWN,"swipeDown"),ig.input.unbind(ig.KEY.LEFT_ARROW,"left"),ig.input.unbind(ig.KEY.RIGHT_ARROW,"right"),ig.input.unbind(ig.KEY.UP_ARROW,"up"),ig.input.unbind(ig.KEY.DOWN_ARROW,"down"),ig.input.unbind(ig.KEY.A,"left"),ig.input.unbind(ig.KEY.D,"right"),ig.input.unbind(ig.KEY.W,"up"),ig.input.unbind(ig.KEY.S,"down"),ig.input.unbind(ig.KEY.SPACE,"jump")},handleInput:function(){var t,i,e,s,n,a,o,h;if(ig.input.released("tap"))for(n=ig.input.getInputPoints(["tapped"],[!0]),t=0,i=n.length;i>t;t++)if(a=n[t],o=a.targets,o.length>0)for(e=0,s=o.length;s>e;e++)if(h=o[e],h.type&ig.EntityExtended.TYPE.UI&&h.fixed){h.toggleActivate(),a.tapped=!1,1===i&&(ig.input.delayedKeyup.tap=!1);break}},update:function(){var t,i,e;if(this.deferring=!1,this._removeDeferredLayers(),this._addDeferredLayers(),this._changeDeferredLayers(),this._removeDeferredItems(),this._addDeferredItems(),this._advanceDeferredNext(),this._levelToLoad?this.loadLevel():this._levelNeedsBuild?this.buildLevel():this._levelNeedsUnload&&this.unloadLevel(),this._gameNeedsResize&&this.resize(this._gameForceResize),this.deferring=!0,this.dirtyEntities!==!1)for(this.entities.length=this.lights.length=0,t=0,i=this.layers.length;i>t;t++)e=this.layers[t],e.numEntities&&e.items.length>0&&(this.entities=this.entities.concat(e.items),this.lights=this.lights.concat(e.itemsLight));for(ig.TWEEN.update(),ig.input.update(),
this.handleInput(),this.playerManager&&this.playerManager.update(),this.changed=this.changedLights=!1,t=0,i=this.layers.length;i>t;t++){var e=this.layers[t];e.update(),this.changed|=e.changed,this.changedLights|=e.changedLights}for(var s in this.backgroundAnims){var n=this.backgroundAnims[s];for(t in n)n[t].update()}this.camera&&this.camera.update(),this.dirtyEntities=this.dirtyLights=!1},updateEntities:function(t){var i=this.layersMap[t];if(i)for(var e=i.items,s=0,n=e.length;n>s;s++){var a=e[s];a.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;for(var t=0,i=this.layers.length;i>t;t++)this.layers[t].draw()},drawEntities:function(t){var i=this.layersMap[t];if(i)for(var e=i.items,s=0,n=e.length;n>s;s++)e[s].draw()},resize:function(i){var e=t.GAME_WIDTH_PCT?ig.global.innerWidth*t.GAME_WIDTH_PCT:t.GAME_WIDTH,s=t.GAME_HEIGHT_PCT?ig.global.innerHeight*t.GAME_HEIGHT_PCT:t.GAME_HEIGHT,n=t.SCALE;if(t.GAME_WIDTH_VIEW||t.GAME_HEIGHT_VIEW){var a=t.GAME_WIDTH_VIEW||1,o=t.GAME_HEIGHT_VIEW||1;n=Math.floor(Math.max(Math.min(e/a,s/o),1))}n=Math.min(Math.max(n,t.SCALE_MIN),t.SCALE_MAX);var h=1/n;ig.system.resize(e*h,s*h,n,i||this._gameForceResize),this._gameNeedsResize=this._gameForceResize=!1},resizeDeferred:function(t){this._gameNeedsResize=!0,this._gameForceResize=t||!1}}),ig.Game.SORT.Z_INDEX=function(t,i){return(t.zIndex||0)-(i.zIndex||0)},ig.Game.SORT.POS_X=function(t,i){return(t.pos&&t.size&&t.pos.x+t.size.x||0)-(i.pos&&i.size&&i.pos.x+i.size.x||0)},ig.Game.SORT.POS_Y=function(t,i){return(t.pos&&t.size&&t.pos.y+t.size.y||0)-(i.pos&&i.size&&i.pos.y+i.size.y||0)},ig.GameExtended.SORT=ig.Game.SORT}),ig.baked=!0,ig.module("plusplus.core.plusplus").requires("plusplus.core.config","plusplus.core.loader","plusplus.core.game","plusplus.helpers.signals").defines(function(){"use strict";var t=ig.CONFIG;ig.System.inject({size:240,onResized:null,init:function(t,i,e,s,n){this.onResized=new ig.Signal,this.fps=i,this.clock=new ig.Timer,this.canvas=ig.$(t),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode,this.resize(e,s,n)},run:function(){ig.Timer.step(),ig.Timer.stepped&&(this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null))},resize:function(i,e,s,n){var a;a=ig.ua.pixelRatio>1&&(!this.context.webkitBackingStorePixelRatio||this.context.webkitBackingStorePixelRatio>1)?ig.ua.pixelRatio:1,this.width=i*a,this.height=e*a,"undefined"!=typeof s&&null!==s&&(this.scale=s),this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight,this.canvas.style.width=Math.round(this.realWidth/a)+"px",this.canvas.style.height=Math.round(this.realHeight/a)+"px",this.size=Math.min(this.width,this.height),1!==this.scale&&t.AUTO_CRISP_SCALING&&(ig.System.scaleMode=ig.System.SCALE.CRISP),ig.System.scaleMode(this.canvas,this.context),this.onResized.dispatch(n)}})}),ig.baked=!0,ig.module("game.managers.connection").requires("impact.impact","impact.game").defines(function(){ig.connectionManager=ig.Class.extend({onInitialisePlayer:function(t){console.log("ws: initialisePlayer"),console.log(t);for(var i in t.otherPlayers){var e=t.otherPlayers[i];console.log(e),this.game.spawnOtherPlayer(e)}var i=this.game.getPlayer();i.playerNumber=t.playerNumber,i.playerName="bloody"+t.playerNumber,console.log(i)},onDisconnectPlayer:function(){console.log("ws: disconnectPlayer");var t=this.game.getPlayer();t&&t.kill(),this.game.end()},onPlayerDisconnect:function(t){console.log("ws: playerDisconnect"),console.log(t),this.game.removeOtherPlayer(t.id)},onPlayerMove:function(t){this.game.moveOtherPlayer(t)},onNewPlayer:function(t){console.log("ws: newPlayer"),console.log(t),this.game.spawnOtherPlayer(t)},onConnectError:function(t){console.log("ws: connectError"),console.log(t),this.game.end(),this.game.socket.disconnect()},init:function(){this.game=ig.game;var t=io();return t.on("initialisePlayer",this.onInitialisePlayer.bind(this)),t.on("disconnectPlayer",this.onDisconnectPlayer.bind(this)),t.on("playerDisconnect",this.onPlayerDisconnect.bind(this)),t.on("playerMove",this.onPlayerMove.bind(this)),t.on("newPlayer",this.onNewPlayer.bind(this)),t.on("connect_error",this.onConnectError.bind(this)),t}})}),ig.baked=!0,ig.module("game.levels.start").requires("impact.image").defines(function(){LevelStart={entities:[],layer:[]}}),ig.baked=!0,ig.module("game.entities.trigger").requires("plusplus.entities.trigger").defines(function(){ig.EntityTrigger=ig.global.EntityTrigger=ig.EntityTrigger.extend({check:function(t){for(var i in this.target){var e=ig.game.getEntityByName(this.target[i]);e&&e instanceof EntityLevelchange&&ig.game.success()}}})}),ig.baked=!0,ig.module("plusplus.entities.levelchange").requires("plusplus.entities.trigger").defines(function(){ig.EntityLevelchange=ig.global.EntityLevelchange=ig.EntityTrigger.extend({_wmBoxColor:"rgba(0, 0, 255, 0.7)",levelName:"",playerSpawnerName:"",clearPersistentPlayer:!1,clearPersistentEntities:!1,activate:function(t){if(this.parent(t),this.clearPersistentEntities)ig.game.clearPersistentEntities();else if(this.clearPersistentPlayer){var i=ig.game.getPlayer(),e="player";i&&(e=i.name||e),ig.game.clearPersistentEntity(e)}ig.game.loadLevelDeferred(this.levelName,this.playerSpawnerName)}})}),ig.baked=!0,ig.module("game.entities.water").requires("impact.entity","plusplus.core.entity").defines(function(){EntityWater=ig.EntityExtended.extend({size:{x:32,y:32},checkAgainst:ig.Entity.TYPE.BOTH,init:function(t,i,e){this.parent(t,i,e)},update:function(){this.parent()},check:function(t){console.log("check()"),console.log(t),this.parent(),"player"===t.name&&(t.kill(),window.setTimeout(function(){ig.game.end()},1e3))}})}),ig.baked=!0,ig.module("plusplus.entities.void").requires("plusplus.core.entity").defines(function(){ig.EntityVoid=ig.global.EntityVoid=ig.EntityExtended.extend({_wmScalable:!0,_wmDrawBox:!0,_wmBoxColor:"rgba(100, 100, 100, 0.7)",frozen:!0,update:function(){}})}),ig.baked=!0,ig.module("game.levels.1").requires("impact.image","game.entities.trigger","plusplus.entities.levelchange","game.entities.water","plusplus.entities.void").defines(function(){Level1={entities:[{type:"EntityTrigger",x:484,y:148,settings:{target:{1:"exit"}}},{type:"EntityLevelchange",x:484,y:124,settings:{name:"exit"}},{type:"EntityWater",x:320,y:176},{type:"EntityVoid",x:8,y:120,settings:{name:"spawn"}}],layer:[{name:"collision",width:64,height:32,linkWithCollision:!1,visible:1,tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:8,foreground:!1,data:[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,25,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,27,28,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,39,0,0,0,0,0,0,0,0,0,1,1,1,1,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,27,28,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,7,1,1,27,28,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,7,1,0,0,0,0,0,3,4,1,25,26,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,7,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,27,28,29,0,0,2,24,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,26,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,27,28,29,0,0,0,0,5,6,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]},{name:"sky",width:64,height:32,linkWithCollision:!1,visible:1,tilesetName:"media/tbga_spritesheet_sky.png",repeat:!1,preRender:!1,distance:"1",tilesize:8,foreground:!1,data:[[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,17,17,17,17,17,17,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,19,19,18,18,18,18,18,18,17,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,19,18,18,18,18,18,18,18,18,18,17,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,19,17,18,18,18,18,18,18,18,19,19,19,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,18,18,17,17,17,18,18,19,19,18,18,18,17,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,18,18,18,18,18,18,17,19,18,18,18,18,18,18,17,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,18,18,18,18,18,18,19,17,18,18,18,18,18,18,20,17,18,17,9,9,9,9,9,9,9,9,9,9,9,9,9],[17,17,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,19,19,18,18,18,18,18,18,18,18,20,20,18,18,18,18,18,18,20,18,18,17,9,9,9,9,9,9,9,9,9,9,9,9],[19,20,17,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,17,17,17,19,19,18,18,18,18,18,18,18,18,18,18,20,20,18,18,18,18,18,18,20,18,17,9,9,9,9,9,9,9,19,19,9,9,9],[19,18,20,17,9,9,9,9,17,17,17,17,9,9,9,9,9,9,9,9,9,9,9,19,19,19,19,18,20,17,19,19,19,18,18,18,18,18,18,18,18,18,20,18,18,18,18,18,18,18,18,18,19,17,20,9,9,9,19,18,18,19,19,9],[18,18,18,20,17,17,9,19,19,19,18,18,17,9,9,9,9,9,9,9,9,19,19,19,19,18,18,18,18,20,17,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,17,17,17,17,18,18,18,18,18,18],[18,18,18,18,18,20,17,19,19,18,18,18,18,17,9,9,9,9,9,9,19,19,19,19,18,18,18,18,18,18,20,17,19,19,19,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,18,18,18,18,18,18,18,17,18,18,18,18,18],[18,18,18,18,18,18,20,17,19,18,18,18,18,20,17,9,9,9,9,17,17,19,19,18,18,18,18,18,18,18,18,18,20,19,19,19,18,18,18,18,18,18,18,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,18,17,18,18,18,18],[18,18,18,18,18,18,18,20,18,18,18,18,18,18,20,19,19,19,20,18,18,17,19,18,18,18,18,18,18,18,18,18,18,18,19,19,19,18,18,18,18,18,19,19,18,18,18,18,18,18,18,18,19,18,18,18,18,18,18,18,17,18,18,18],[18,18,18,18,18,18,18,20,18,18,18,18,18,18,19,19,18,18,18,18,18,18,17,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,18,18,18,19,18,18,18,18,18,18,18,19,18,19,18,18,18,18,18,18,18,18,20,18,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,18,18,18,18,18,18,18,18,20,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,18,19,18,18,18,18,18,18,18,18,18,19,18,18,18,18,18,18,18,18,18,18,20,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,19,18,18,18,18,18,18,18,18,18,18,18,20,18,18,18,18,18,18,18,18,18,18,18,19,18,19,19,18,18,18,18,18,18,18,18,18,18,18,19,18,18,18,18,18,18,18,18,18,18,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18],[18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,18,19,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18],[9,9,9,9,9,9,9,9,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,9,9,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,9,9,9,9,18,18,18,18,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,18,18,18,18,18,18,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]]},{name:"background",width:64,height:32,linkWithCollision:!0,visible:1,tilesetName:"media/tbga_spritesheet_background.png",repeat:!1,preRender:!1,distance:"1",tilesize:8,foreground:!1,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{name:"water",width:64,height:32,linkWithCollision:!1,visible:1,tilesetName:"media/tbga_spritesheet_water.png",repeat:!1,preRender:!1,distance:"1",tilesize:8,foreground:!1,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{name:"ground",width:64,height:32,linkWithCollision:!0,visible:1,tilesetName:"media/tbga_spritesheet_ground.png",repeat:!1,preRender:!1,distance:"1",tilesize:8,foreground:!1,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,74,0,0,7,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,43,44,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,31,10,67,15,21,39,51,52,3,0,0,0,0,1,60,61,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,10,22,10,20,28,28,28,28,37,0,0,0,0,36,68,69,70,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,28,28,72,0,0,0,0,0,0,0,0,0,0,29,28,28,63,33,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,51,52,60,61,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,13,68,69,70,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,71,28,28,28,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57,58,59,46,2,60,61,62,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,65,66,67,13,10,68,69,70,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,28,28,28,28,28,28,28,28,37,0,0,0,0,0,0,0,0,12,0,57,58,59,3,0,0,0,0,0,41,42,47,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57,58,59,46,45,65,66,67,40,0,0,0,0,1,49,50,10,51,52,60,61,62,5,0,76,77,0,0,7,0,0,7,0],[2,2,2,2,2,46,2,2,2,2,2,2,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,65,66,67,22,14,10,10,13,48,0,0,0,0,36,10,10,10,31,10,68,69,70,2,45,2,2,2,2,2,47,2,2,2],[13,22,10,10,10,13,10,10,10,22,10,10,33,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,2,34,14,13,10,10,10,10,14,10,32,0,0,0,0,36,14,10,22,10,10,10,10,10,13,10,10,10,10,10,10,10,10,10,10],[10,10,21,10,10,10,10,10,10,10,10,10,15,33,43,44,0,0,0,0,0,0,0,0,0,0,41,42,34,38,10,10,10,23,10,10,10,10,10,10,0,0,0,0,19,10,10,10,10,10,13,10,10,10,10,10,10,10,10,10,10,10,23,10],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,51,52,60,61,62,75,0,4,0,57,58,59,49,50,14,10,39,30,30,30,30,30,30,30,10,48,0,0,0,0,10,10,30,30,30,38,10,10,10,10,10,10,10,10,10,10,10,10,10,10],[10,10,10,10,10,10,10,23,10,10,10,10,10,10,10,10,68,69,70,2,2,45,2,65,66,67,10,10,10,39,30,30,30,30,30,30,30,30,10,10,0,0,0,0,10,23,30,30,30,30,30,30,21,10,10,10,10,10,10,24,10,10,10,10],[30,30,30,30,30,30,30,30,30,30,30,30,30,38,10,10,10,10,10,10,10,10,13,10,10,10,39,10,39,30,30,30,30,30,30,30,30,30,30,40,0,0,0,0,36,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[30,30,30,30,30,30,30,30,30,30,30,30,30,30,38,10,23,10,39,10,10,10,10,10,10,10,10,39,30,30,30,30,30,30,30,30,30,30,30,48,0,0,0,0,36,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,38,10,10,10,10,10,10,10,24,10,10,39,30,30,30,30,30,30,30,30,30,30,30,30,30,0,0,0,0,27,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,48,0,0,0,0,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,48,0,0,0,0,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,0,0,0,0,36,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]]}]},Level1Resources=[new ig.Image("media/tbga_spritesheet_sky.png"),new ig.Image("media/tbga_spritesheet_background.png"),new ig.Image("media/tbga_spritesheet_water.png"),new ig.Image("media/tbga_spritesheet_ground.png")]}),ig.baked=!0,ig.module("game.managers.level").requires("impact.impact","impact.game","game.levels.start","game.levels.1").defines(function(){ig.levelManager=ig.Class.extend({levels:[LevelStart,Level1],init:function(){this.current=0,this.load()},next:function(){return this.current++,this.current=this.current<this.levels.length?this.current:0,this.load(),this.current},load:function(t){t="undefined"!=typeof t?t:this.current,ig.game.loadLevel(this.levels[t])},reset:function(){this.current=0,this.load()}})}),ig.baked=!0,ig.module("game.managers.ui").requires("impact.impact","impact.game").defines(function(){var t=3e3;ig.uiManager=ig.Class.extend({getVariableTimeout:function(i){return t-100*i},clearLogs:function(){this.logs=[]},log:function(t){this.logs.push(t),this.displayLogs()},processLogs:function(){window.setTimeout(function(){this.logs=this.logs.splice(1,1),this.displayLogs(),this.processLogs()}.bind(this),this.getVariableTimeout(this.logs.length))},displayLogs:function(){this.messages.text=this.logs.length?this.logs.join("\n"):""},init:function(){this.game=ig.game,this.messages=ig.game.spawnEntity(ig.UIText,0,0,{font:this.game.font,textAlign:"left",text:""}),this.logs=[],this.processLogs()}})}),ig.baked=!0,ig.module("plusplus.core.hierarchy").requires("plusplus.helpers.utils").defines(function(){"use strict";var t=ig.utils,i=0;ig.Hierarchy=ig.Class.extend({id:i++,name:"",descendants:[],descendantsMap:{},ancestor:null,sortBy:null,init:function(t){this.id=i++,this.sortBy=ig.Hierarchy.SORT.PRIORITY,ig.merge(this,t)},setAncestor:function(t){this.ancestor=t},setName:function(t){this.name!==t&&(this.ancestor instanceof ig.Hierarchy&&this.ancestor.unmapDescendant(this),this.name=t,this.ancestor instanceof ig.Hierarchy&&this.ancestor.mapDescendant(this))},setFallback:function(t){this.fallback=t},addDescendants:function(i){
i=t.toArray(i);for(var e=0,s=i.length;s>e;e++)this.addDescendant(i[e])},addDescendant:function(t){if(t instanceof ig.Hierarchy){if(this.isAncestor(t)===!0)return;void 0!==t.ancestor&&t.ancestor.removeDescendant(t),t.setAncestor(this)}this.mapDescendant(t),this.descendants.push(t),this.sortDescendants()},removeDescendants:function(i){i=t.toArray(i);for(var e=0,s=i.length;s>e;e++)this.removeDescendant(i[e])},removeDescendant:function(i){var e=t.indexOfValue(this.descendants,i);if(-1!==e)i instanceof ig.Hierarchy&&i.setAncestor(),this.descendants.splice(e,1),this.unmapDescendant(i);else for(var s=0,n=this.descendants.length;n>s;s++){var a=this.descendants[s];a instanceof ig.Hierarchy&&a.removeDescendant(i)}},clearDescendants:function(){for(var t=this.descendants.length-1;t>=0;t--){var i=this.descendants[t];i instanceof ig.Hierarchy&&i.setAncestor(),this.descendants.length--,this.unmapDescendant(i)}},sortDescendants:function(){this.descendants.sort(this.sortBy)},mapDescendant:function(t){if(t.name){var i=this.descendantsMap[t.name];i instanceof ig.Hierarchy&&i.ancestor.removeDescendant(i),this.descendantsMap[t.name]=t}},unmapDescendant:function(t){if(t.name){var i=this.descendantsMap[t.name];t===i&&delete this.descendantsMap[t.name]}},getDescendantByName:function(t,i){var e=this._getDescendantByName(t,i);return!e&&this.fallback&&(e=this.fallback._getDescendantByName(t,i)),e},_getDescendantByName:function(t,i){var e=this.descendantsMap[t];if(i===!0&&!e)for(var s=0,n=this.descendants.length;n>s;s++){var a=this.descendants[s];if(a instanceof ig.Hierarchy&&(e=a.getDescendantByName(t,i)))break}return e},getDescendantsByType:function(t,i){var e=this._getDescendantsByType(t,i,[]);return!e.length&&this.fallback&&(e=this.fallback._getDescendantsByType(t,i,e)),e},_getDescendantsByType:function(t,i,e){for(var s=0,n=this.descendants.length;n>s;s++){var a=this.descendants[s];a.type&t&&e.push(a),i===!0&&a instanceof ig.Hierarchy&&a._getDescendantsByType(name,i,e)}return e},getDescendants:function(i){i=t.toArray(i).concat(this.descendants);for(var e=0,s=this.descendants.length;s>e;e++){var n=this.descendants[e];n instanceof ig.Hierarchy&&(i=n.getDescendants(i))}return i},getRoot:function(){for(var t,i=this;i;)t=i,i=i.ancestor;return t},isAncestor:function(t){for(var i=this.ancestor;i;){if(i===t)return!0;i=i.ancestor}return!1},forAll:function(t){var i=Array.prototype.slice.call(arguments,1);t.apply(this,i),this.forAllDescendants.apply(this,arguments)},forAllDescendants:function(t){for(var i=Array.prototype.slice.call(arguments,1),e=0,s=this.descendants.length;s>e;e++){var n=this.descendants[e];t.apply(n,i),n instanceof ig.Hierarchy&&n.forAllDescendants.apply(n,arguments)}},forAllWithCallback:function(t){var i=this[t];if("function"==typeof i){var e=Array.prototype.slice.call(arguments,1);i.apply(this,e)}this.forAllDescendantsWithCallback.apply(this,arguments)},forAllDescendantsWithCallback:function(t){for(var i=Array.prototype.slice.call(arguments,1),e=0,s=this.descendants.length;s>e;e++){var n=this.descendants[e],a=n[t];"function"==typeof a&&a.apply(n,i),n instanceof ig.Hierarchy&&n.forAllWithCallback.apply(n,arguments)}},forImmediate:function(t){var i=Array.prototype.slice.call(arguments,1);t.apply(this,i);for(var e=0,s=this.descendants.length;s>e;e++)t.apply(this.descendants[e],i)},forImmediateWithCallback:function(t){var i=this[t];if("function"==typeof i){var e=Array.prototype.slice.call(arguments,1);i.apply(this,e)}for(var s=0,n=this.descendants.length;n>s;s++){var a=this.descendants[s];i=a[t],"function"==typeof i&&i.apply(a,e)}},activate:function(){for(var t=!1,i=!1,e="activate",s=0,n=this.descendants.length;n>s;s++){var a=this.descendants[s];a[e].apply(a,arguments),i||!a.activated&&!a.getUsing()||(t=!0,a.blocking&&(i=!0,e="cleanup"))}return this.fallback&&(t=this.fallback[e].apply(a,arguments)||t),t},deactivate:function(){for(var t=0,i=this.descendants.length;i>t;t++)this.descendants[t].deactivate();this.fallback&&this.fallback.deactivate()},update:function(){for(var t=0,i=this.descendants.length;i>t;t++)this.descendants[t].update();this.fallback&&this.fallback.update()},cleanup:function(){for(var t=0,i=this.descendants.length;i>t;t++)this.descendants[t].cleanup();this.fallback&&this.fallback.cleanup()},setEntity:function(t){for(var i=0,e=this.descendants.length;e>i;i++)this.descendants[i].setEntity(t);this.fallback&&this.fallback.setEntity(t)},setEntityTarget:function(t){for(var i=0,e=this.descendants.length;e>i;i++)this.descendants[i].setEntityTarget(t);this.fallback&&this.fallback.setEntityTarget(t)},setEntityTargetFirst:function(t){for(var i=0,e=this.descendants.length;e>i;i++)this.descendants[i].setEntityTargetFirst(t);this.fallback&&this.fallback.setEntityTargetFirst(t)},setEntityOptions:function(t){for(var i=0,e=this.descendants.length;e>i;i++)this.descendants[i].setEntityOptions(t);this.fallback&&this.fallback.setEntityOptions(t)},getUsing:function(){for(var t=0,i=this.descendants.length;i>t;t++)if(this.descendants[t].getUsing())return!0;return this.fallback?this.fallback.getUsing():!1},pause:function(){for(var t=0,i=this.descendants.length;i>t;t++)this.descendants[t].pause();this.fallback&&this.fallback.pause()},unpause:function(){for(var t=0,i=this.descendants.length;i>t;t++)this.descendants[t].unpause();this.fallback&&this.fallback.unpause()},clone:function(t){t instanceof ig.Hierarchy!=1&&(t=new ig.Hierarchy),t.name=this.name;for(var i=0,e=this.descendants.length;e>i;i++){var s=this.descendants[i];"function"==typeof s.clone&&t.addDescendant(s.clone())}return t}}),ig.Hierarchy.SORT={PRIORITY:function(t,i){return i.priority-t.priority},Z_INDEX:function(t,i){return i.zIndex-t.zIndex}}}),ig.baked=!0,ig.module("plusplus.abstractities.spawner-fast").requires("plusplus.abstractities.spawner","plusplus.helpers.utils","plusplus.helpers.utilsmath").defines(function(){var t=ig.utils,i=ig.utilsmath;ig.SpawnerFast=ig.global.SpawnerFast=ig.Spawner.extend({spawnNext:function(t){return this.pool.length>0?(t=this.pool.pop(),t&&(t=ig.game.spawnEntity(t,0,0,this.spawnSettings),this.entities.push(t))):this.spawningEntity&&this.spawnedCount<this.spawnCountMax&&(t=ig.game.spawnEntity(this.spawningEntity,0,0,this.spawnSettings),this.entities.push(t),this.linkSpawned(t)),t&&(this.spawnCount=Math.min(this.spawnCountMax,this.spawnCount+1),this.spawnedCount=Math.min(this.spawnCountMax,this.spawnedCount+1),this.spawned(t)),t},unspawn:function(i){i._killed?(this.spawnCount=Math.max(0,this.spawnCount-1),t.arrayCautiousRemove(this.entities,i),this.pool.push(i),this.activated&&-1===this.duration&&!this.spawning&&(this.spawnDelay>0||0===this.spawnCount)&&(this.spawnedCount=this.spawnCount,this.respawnTimer.set(this.respawnDelay),this._reactivate=!0)):i.kill(!0)},spawned:function(t){var e=t.size.x,s=t.size.y,n=this.size.x,a=this.size.y,o=this.pos.x,h=this.pos.y,r=o+n,l=h+a;t.pos.x=i.map(Math.random(),0,1,o,r-e)-.5*e,t.pos.y=i.map(Math.random(),0,1,h,l-s)-.5*s}})}),ig.baked=!0,ig.module("plusplus.abstractities.particle").requires("plusplus.core.config","plusplus.core.timer","plusplus.core.entity").defines(function(){"use strict";var t=ig.CONFIG;ig.Particle=ig.EntityExtended.extend({animAutomatic:t.PARTICLE.ANIM_AUTOMATIC,animsExpected:["move"],zIndex:t.Z_INDEX_ABOVE_ALL,performance:ig.EntityExtended.PERFORMANCE.DYNAMIC,size:{x:1,y:1},maxVel:{x:150,y:150},friction:{x:20,y:0},minBounceVelocity:0,bounciness:.6,lifeDuration:1,fadeAfterSpawnDuration:0,fadeBeforeDeathDuration:.5,collisionKills:!1,collisionSticky:!1,randomVel:!0,randomDoubleVel:!0,randomFlip:!0,velocityFlip:!0,lifeTimer:null,_fadeAfterInv:0,_fadeBeforeDiff:0,_fadeBeforeInv:0,initProperties:function(){this.parent(),this.lifeTimer=new ig.Timer},resetExtras:function(){this.parent(),this.animAutomatic&&!this._animsPlaceheld&&(this._animsPlaceheld=!0,this.placeholdAnims()),this.fadeAfterSpawnDuration&&(this._fadeAfterInv=1/this.fadeAfterSpawnDuration),this.fadeBeforeDeathDuration&&(this._fadeBeforeInv=1/this.fadeBeforeDeathDuration,this._fadeBeforeDiff=this.lifeDuration-this.fadeBeforeDeathDuration)},placeholdAnims:function(){if(this.animsExpected.length>0){var t,i=this.anims;t=this.animInit instanceof ig.Animation?animInit:this.animInit&&i[this.animInit]?i[this.animInit]:i.idle||this.currentAnim;for(var e=0,s=this.animsExpected.length;s>e;e++){var n=this.animsExpected[e],a=i[n]||t;a&&(i[n+"X"]||(i[n+"X"]=a),i[n+"Right"]||(i[n+"Right"]=i[n+"X"]),i[n+"Left"]||(i[n+"Left"]=i[n+"X"]),i[n+"Y"]||(i[n+"Y"]=a),i[n+"Down"]||(i[n+"Down"]=i[n+"Y"]),i[n+"Up"]||(i[n+"Up"]=i[n+"Y"]))}}},ready:function(){this.lifeTimer.set(this.lifeDuration),this.randomVel&&(this.randomDoubleVel?(this.vel.x=(2*Math.random()-1)*this.vel.x,this.vel.y=(2*Math.random()-1)*this.vel.y):(this.vel.x*=Math.random(),this.vel.y*=Math.random())),this.currentAnim&&(this.randomFlip?(this.flip.x=Math.random()>.5,this.flip.y=Math.random()>.5):this.velocityFlip&&(this.canFlipX&&(this.flip.x=this.vel.x<0?!0:!1),this.canFlipY&&(this.flip.y=this.vel.y<0?!0:!1))),this.parent()},pause:function(){this.parent(),this.lifeTimer.pause()},unpause:function(){this.parent(),this.lifeTimer.unpause()},collideWith:function(t,i,e,s,n,a){this.parent(t,i,e,s,n,a),this.collisionKills?this.kill():!this.collisionSticky||t instanceof ig.Particle||(this.collides=ig.EntityExtended.COLLIDES.NEVER,this.performance=ig.EntityExtended.PERFORMANCE.MOVABLE,this.moveTo(t,{offset:{x:this.pos.x+.5*this.size.x-(t.pos.x+.5*t.size.x),y:this.pos.y+.5*this.size.y-(t.pos.y+.5*t.size.y)}}))},handleMovementTrace:function(t){this.parent(t),this.collidingWithMap&&(this.collisionKills?this.kill():this.collisionSticky&&(this.applyAntiVelocity(),this.collides=ig.EntityExtended.COLLIDES.NEVER,this.performance=ig.EntityExtended.PERFORMANCE.STATIC))},update:function(){var t=this.lifeTimer.delta();if(t>=0)this.kill();else{var i=t+this.lifeDuration;this.alpha=(0!==this.fadeAfterSpawnDuration?Math.min(1,i*this._fadeAfterInv):1)-(0!==this.fadeBeforeDeathDuration?Math.max(0,(i-this._fadeBeforeDiff)*this._fadeBeforeInv):0)}this.parent()},recordChanges:function(i){this.parent(i),this.changed&&(t.TOP_DOWN||this.canFlipY?this.movingX?(this.facing.x=this.vel.x<0?-1:1,this.movingY?this.facing.y=this.vel.y<0?-1:1:this.facing.y=0):this.movingY&&(this.facing.x=0,this.facing.y=this.vel.y<0?-1:1):this.movingX&&(this.facing.x=this.vel.x<0?-1:1))},updateVisible:function(){this.animAutomatic&&!this._killed&&this.updateCurrentAnim(),this.parent()},updateCurrentAnim:function(){this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC&&(this.currentAnim=this.anims[this.getDirectionalAnimName("move")])}})}),ig.baked=!0,ig.module("plusplus.abstractities.particle-fast").requires("plusplus.core.config","plusplus.abstractities.particle").defines(function(){"use strict";ig.CONFIG,ig.ParticleFast=ig.Particle.extend({type:ig.EntityExtended.TYPE.NONE,collides:ig.EntityExtended.COLLIDES.NEVER,checkAgainst:ig.EntityExtended.TYPE.NONE,performance:ig.EntityExtended.PERFORMANCE.DYNAMIC,highPerformance:!0,init:function(t,i,e){this.id=++ig.Entity._lastId,this.lifeTimer=new ig.Timer,this.onAdded=new ig.Signal,this.onRemoved=new ig.Signal,this.onMovedTo=new ig.Signal,this.reset(t,i,e)},reset:function(t,i,e){if(this.pos.x=t,this.pos.y=i,this.posDraw=this.pos,this.sizeDraw=this.size,ig.merge(this,e),this._killed=!1,this.changed=!0,this.moving=this.movingX=this.movingY=!0,!this.ignoreSystemScale){var s=Math.min(Math.max(Math.round(ig.system.scale*this.scaleOfSystemScale),this.scaleMin),this.scaleMax);this.scale!==s&&(this.scale=s)}this.scaleMod=this.scale/ig.system.scale,this.fadeAfterSpawnDuration&&(this._fadeAfterInv=1/this.fadeAfterSpawnDuration),this.fadeBeforeDeathDuration&&(this._fadeBeforeInv=1/this.fadeBeforeDeathDuration,this._fadeBeforeDiff=this.lifeDuration-this.fadeBeforeDeathDuration)},refresh:function(){},resetCore:function(){},resetExtras:function(){},recordResetState:function(){},ready:function(){this.lifeTimer.set(this.lifeDuration),this.randomVel&&(this.randomDoubleVel?(this.vel.x=(2*Math.random()-1)*this.vel.x,this.vel.y=(2*Math.random()-1)*this.vel.y):(this.vel.x*=Math.random(),this.vel.y*=Math.random())),this.currentAnim&&(this.randomFlip?(this.flip.x=Math.random()>.5,this.flip.y=Math.random()>.5):(this.canFlipX&&(this.flip.x=this.vel.x<0?!0:!1),this.canFlipY&&(this.flip.y=this.vel.y<0?!0:!1)))},spawn:function(){},tween:function(){throw new Error("Attempting to TWEEN fast particle but fast particle does not tween!")},collideWith:function(){throw new Error("Attempting to COLLIDE fast particle but fast particle does not collide!")},handleMovementTrace:function(){throw new Error("Attempting to TRACE COLLISION MAP fast particle but fast particle ignore collision map!")},kill:function(){this._killed||ig.game.removeEntity(this)},die:function(){},cleanup:function(){if(this.moveToStop(),this.onRemoved.dispatch(this),!ig.game.hasLevel){this.onAdded.removeAll(),this.onAdded.forget(),this.onRemoved.removeAll(),this.onRemoved.forget(),this.onMovedTo.removeAll(),this.onMovedTo.forget();for(var t in this.anims){var i=this.anims[t];i.onCompleted.removeAll(),i.onCompleted.forget()}}},update:function(){if(this.paused)ig.game.camera&&!ig.game.camera.paused&&(this.visible=this.getIsVisible());else if(!this._killed){var t=this.lifeTimer.delta();if(t>=0)return this.kill();var i=t+this.lifeDuration;this.alpha=(0!==this.fadeAfterSpawnDuration?Math.min(1,i*this._fadeAfterInv):1)-(0!==this.fadeBeforeDeathDuration?Math.max(0,(i-this._fadeBeforeDiff)*this._fadeBeforeInv):0),this.movingTo?this.moveToUpdate():(this.pos.x+=this.vel.x*ig.system.tick,this.pos.y+=this.vel.y*ig.system.tick),this.getIsVisible()?(this.visible=!0,this.currentAnim.update()):this.visible=!1}},getIsVisible:function(){if(this.alpha<=0)return!1;var t=this.posDraw.x-ig.game.screen.x,i=this.posDraw.y-ig.game.screen.y;return 0>t||0>i||t+this.sizeDraw.x>ig.system.width||i+this.sizeDraw.y>ig.system.height?!1:!0},recordChanges:function(){throw new Error("Attempting to RECORD CHANGES in fast particle but fast particle is always changed!")},recordLast:function(){throw new Error("Attempting to RECORD LAST of fast particle but fast particle doesn't record last!")},updateBounds:function(){throw new Error("Attempting to UPDATE BOUNDS of fast particle but fast particle does not update bounds!")},draw:function(){if(this.visible){var t=this.currentAnim,i=t.sheet,e=i.image;if(e.loaded){e._scale!==this.scale&&e.resize(this.scale);var s=this.scale,n=i.width,a=i.height,o=Math.floor(n*s),h=Math.floor(a*s);1!==this.alpha?(ig.system.context.globalAlpha=this.alpha,ig.system.context.drawImage(e.data,Math.floor(t.tile*n)%e.width*s,Math.floor(t.tile*n/e.width)*a*s,o,h,ig.system.getDrawPos(this.posDraw.x-ig.game.screen.x),ig.system.getDrawPos(this.posDraw.y-ig.game.screen.y),o,h),ig.system.context.globalAlpha=1):ig.system.context.drawImage(e.data,Math.floor(t.tile*n)%e.width*s,Math.floor(t.tile*n/e.width)*a*s,o,h,ig.system.getDrawPos(this.posDraw.x-ig.game.screen.x),ig.system.getDrawPos(this.posDraw.y-ig.game.screen.y),o,h),ig.Image.drawCount++}}}})}),ig.baked=!0,ig.module("plusplus.entities.particle-color").requires("plusplus.core.config","plusplus.abstractities.particle-fast").defines(function(){"use strict";var t=ig.CONFIG;ig.EntityParticleColor=ig.global.EntityParticleColor=ig.ParticleFast.extend({size:{x:2,y:2},animSheet:new ig.AnimationSheet(t.PATH_TO_MEDIA+"particles.png",2,2),animTileOffset:0,animSequenceCount:7,vel:{x:50,y:50},lifeDuration:.35,fadeBeforeDeathDuration:.15,_animTileOffsetLast:-1,reset:function(t,i,e){this.parent(t,i,e),this._animTileOffsetLast!==this.animTileOffset&&(this._animTileOffsetLast=this.animTileOffset,this.addAnim("move",{sequence:[Math.round(Math.random()*this.animSequenceCount)+this.animTileOffset*(this.animSequenceCount+1)],frameTime:1,stop:!0}))}}),ig.EntityParticleColor.colorOffsets={RED:0,YELLOW:4,GREEN:8,BLUE:12,PURPLE:16,BROWN:20,GRAY:24,WHITE:28}}),ig.baked=!0,ig.module("plusplus.entities.explosion").requires("plusplus.abstractities.spawner-fast","plusplus.entities.particle-color").defines(function(){"use strict";ig.EntityExplosion=ig.global.EntityExplosion=ig.SpawnerFast.extend({spawningEntity:ig.EntityParticleColor,spawnCountMax:3,spawnSettings:{vel:{x:100,y:100},animTileOffset:ig.EntityParticleColor.colorOffsets.YELLOW},activated:!0,frozen:!1})}),ig.baked=!0,ig.module("plusplus.abstractities.character").requires("plusplus.core.config","plusplus.core.timer","plusplus.core.entity","plusplus.core.hierarchy","plusplus.entities.explosion","plusplus.helpers.utils","plusplus.helpers.utilsmath","plusplus.helpers.utilsintersection","plusplus.helpers.utilsvector2","plusplus.helpers.tweens","plusplus.helpers.pathfinding").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils,e=ig.utilsmath,s=ig.utilsintersection,n=ig.utilsvector2,a=ig.pathfinding;ig.Character=ig.EntityExtended.extend({performance:ig.EntityExtended.PERFORMANCE.MOVABLE,targetable:!0,animAutomatic:t.CHARACTER.ANIM_AUTOMATIC,animsExpected:["idle","move","stairs","climb","jump","fall"],size:{x:t.CHARACTER.SIZE_EFFECTIVE_X,y:t.CHARACTER.SIZE_EFFECTIVE_Y},offset:{x:t.CHARACTER.SIZE_OFFSET_X,y:t.CHARACTER.SIZE_OFFSET_Y},maxVelUngrounded:{x:t.CHARACTER.MAX_VEL_UNGROUNDED_X,y:t.CHARACTER.MAX_VEL_UNGROUNDED_Y},maxVelGrounded:{x:t.CHARACTER.MAX_VEL_GROUNDED_X,y:t.CHARACTER.MAX_VEL_GROUNDED_Y},maxVelClimbing:{x:t.CHARACTER.MAX_VEL_CLIMBING_X,y:t.CHARACTER.MAX_VEL_CLIMBING_Y},frictionUngrounded:{x:t.CHARACTER.FRICTION_UNGROUNDED_X,y:t.CHARACTER.FRICTION_UNGROUNDED_Y},frictionGrounded:{x:t.CHARACTER.FRICTION_GROUNDED_X,y:t.CHARACTER.FRICTION_GROUNDED_Y},speed:{x:t.CHARACTER.SPEED_X,y:t.CHARACTER.SPEED_Y},canJump:t.CHARACTER.CAN_JUMP&&!t.TOP_DOWN,jumpSteps:t.CHARACTER.JUMP_STEPS,jumpForce:t.CHARACTER.JUMP_FORCE,jumpControl:t.CHARACTER.JUMP_CONTROL,canJumpRepeatedly:t.CHARACTER.CAN_JUMP_REPEATEDLY,additionalJumps:1,canClimb:t.CHARACTER.CAN_CLIMB&&!t.TOP_DOWN,climbingControl:t.CHARACTER.CLIMBING_CONTROL,movingFrom:!1,moveToUnsafe:!1,canPathfind:t.CHARACTER.CAN_PATHFIND,path:[],pathfindingDelay:t.CHARACTER.PATHFINDING_DELAY,pathfindingUpdateDelay:t.CHARACTER.PATHFINDING_UPDATE_DELAY,pathfindingSimpleDelay:t.CHARACTER.PATHFINDING_SIMPLE_DELAY,pathingTimer:null,stuck:!1,stuckDelay:t.CHARACTER.STUCK_DELAY,stuckTimer:null,health:t.CHARACTER.HEALTH,healthMax:t.CHARACTER.HEALTH,energy:t.CHARACTER.ENERGY,energyMax:t.CHARACTER.ENERGY,damageDelay:0,damageTimer:null,temporaryInvulnerabilityPulses:2,temporaryInvulnerabilityAlpha:.5,regen:!1,regenDelay:0,regenTimer:null,regenRateHealth:t.CHARACTER.REGEN_RATE_HEALTH,regenAsPctHealth:!1,regenRateEnergy:t.CHARACTER.REGEN_RATE_ENERGY,regenAsPctEnergy:!1,regenHealth:!0,regenEnergy:!0,mimicLevel:t.RANKS_MAP.NONE,explodingDamage:t.CHARACTER.EXPLODING_DAMAGE,damageSettings:{spawnCountMax:t.CHARACTER.EXPLODING_DAMAGE_PARTICLE_COUNT,spawnSettings:{animTileOffset:ig.EntityParticleColor.colorOffsets.WHITE}},explodingDeath:t.CHARACTER.EXPLODING_DEATH,deathSettings:{spawnCountMax:t.CHARACTER.EXPLODING_DEATH_PARTICLE_COUNT,spawnSettings:{animTileOffset:ig.EntityParticleColor.colorOffsets.WHITE}},abilities:null,abilitiesOriginal:null,slopeSticking:t.CHARACTER.SLOPE_STICKING,falling:!1,ungroundedFor:0,ungroundedForThreshold:t.CHARACTER.UNGROUNDED_FOR_THRESHOLD,ungroundedForAndFallingThreshold:t.CHARACTER.UNGROUNDED_FOR_AND_FALLING_THRESHOLD,withinClimbables:!1,withinClimbablesAbove:!1,withinStairs:!1,withinOneWay:!1,jumping:!1,jumpAscend:!1,climbing:!1,needsNewPath:!1,_jumpPushing:!1,_jumpWhileClimbing:!1,_jumpCounter:0,_canUseAdditionalJump:!1,_climbingIntentDown:!1,_climbingIntentUp:!1,_cleanIntentDown:!1,_cleanIntentUp:!1,_temporarilyInvulnerable:!1,_temporarilyInvulnerablePulsing:!1,_positionsPathfinding:{from:{x:.1,y:.1},target:{x:.1,y:.1}},_boundsPathfollow:{},initTypes:function(){this.parent(),i.addType(ig.EntityExtended,this,"type","CHARACTER")},initProperties:function(){this.parent(),this.regenTimer=new ig.Timer,this.damageTimer=new ig.Timer,this.pathingTimer=new ig.Timer,this.stuckTimer=new ig.Timer,this.abilities=this.abilitiesOriginal=new ig.Hierarchy},resetExtras:function(){this.parent(),this.energyMax=this.energy,this.moveToStop(),this.applyAntiVelocity(),this.animAutomatic&&this.animsExpected.length>0&&(this._animsPlaceheld=!0,this.placeholdAnims())},placeholdAnims:function(){var t,i=this.anims;t=this.animInit instanceof ig.Animation?this.animInit:this.animInit&&i[this.animInit]?i[this.animInit]:i.idle||this.currentAnim;for(var e=0,s=this.animsExpected.length;s>e;e++){var n=this.animsExpected[e],a=i[n]||t;a&&(i[n+"X"]||(i[n+"X"]=a),i[n+"Right"]||(i[n+"Right"]=i[n+"X"]),i[n+"Left"]||(i[n+"Left"]=i[n+"X"]),i[n+"Y"]||(i[n+"Y"]=a),i[n+"Down"]||(i[n+"Down"]=i[n+"Y"]),i[n+"Up"]||(i[n+"Up"]=i[n+"Y"]))}},recordResetState:function(){this.parent(),this.resetState.controllable=this.controllable,this.resetState.energy=this.energy},ready:function(){var t=this;this.abilities.forAllDescendants(function(){this.setEntity(t)}),this.temporaryInvulnerability(),this.removeControl(),this.parent()},spawn:function(){this.parent(),this.resetState.controllable&&this.addControl()},removeControl:function(){this.parent(),this.moveToStop(),this.jumpEnd(),this.climbEnd()},pause:function(){this.parent(),this.regenTimer.pause(),this.damageTimer.pause(),this.pathingTimer.pause(),this.stuckTimer.pause(),this.abilities.pause()},unpause:function(){this.parent(),this.regenTimer.unpause(),this.damageTimer.unpause(),this.pathingTimer.unpause(),this.stuckTimer.unpause(),this.abilities.unpause()},setGrounded:function(i){t.TOP_DOWN?(this.standing=this.grounded=!0,this.falling=!1):(this.standing=this.grounded=this.hasGravity,this.falling=!1,this.climbing||i||(this.slopeSticking&&this.hasGravity?this.vel.y=this.maxVelGrounded.y:this.vel.y=0))},setUngrounded:function(){t.TOP_DOWN||(this.grounded=this.standing=this.falling=!1)},moveTo:function(t,i){var e=this.parent(t,i);return e&&(this.needsNewPath=!0,this.pathingTimer&&this.pathingTimer.set(0)),e},moveFrom:function(t,i){var e=this.moveTo(t,i);return e&&(this.movingFrom=!0),e},moveToUpdate:function(){this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC?this.movingTo&&(this.canPathfind?(this.needsNewPath=this.movingTo.changed||this.changed||this.moveToUnsafe||this.needsNewPath,(!this.movedTo||this.needsNewPath)&&(this.findMoveToPath(),this.moveToPath())):this.lookAt(this.movingTo)):this.parent()},findMoveToPath:function(t){if(this.pathingTimer.delta()>=0&&(0===this.path.length||this.needsNewPath)){this.needsNewPath=this.movedTo=this.moveToUnsafe=!1,t=t||this.movingToSettings;var i,s,n,o,h,r;if(t&&(i=t.simple,s=t.avoidEntities,n=t.unsafe,o=t.avoidSlopes,h=t.searchDistance,r=t.alwaysKeepFirst),i){var l,g;if(this.movingTo instanceof ig.EntityExtended){var u=ig.pathfinding.getPositionPathfindingEntities(this,this.movingTo,this._positionsPathfinding);l=u.from,g=u.target}else g=this.movingTo,l=a.getPositionPathfindingPoint(this,this.movingTo.x,this.movingTo.y,this._positionsPathfinding.from);var c=g.x-l.x,d=g.y-l.y;if(this.movingFrom&&(c=-c,d=-d),0!==c&&(c=c*c<this.size.x*this.size.x*.25?0:e.direction(c)),0!==d&&(d=d*d<this.size.y*this.size.y*.25?0:e.direction(d)),this.hasGravity&&(0!==c&&0!==d&&c*c*2>d*d&&(d=0),!o)){var p=a.getEntityOnSmoothSlope(this,c);p&&0===d&&(d=a.getSlopeDirectionY(this,c))}var m=n||p?a.getNode(l.x,l.y,c,d):a.getWalkableNode(l.x,l.y,c,d,s,this);m?this.path[0]=m:(this.clearPath(),this.moveToUnsafe=!0),this.pathingTimer.set(this.pathfindingSimpleDelay)}else if(this.movingFrom?this.movingTo instanceof ig.EntityExtended?this.path=a.getPathAwayFromEntity(this,this.movingTo,s,h):this.path=a.getPathAwayFromPoint(this,this.movingTo.x,this.movingTo.y,s,h):this.movingTo instanceof ig.EntityExtended?this.path=a.getPathToEntity(this,this.movingTo,s,h):this.path=a.getPathToPoint(this,this.movingTo.x,this.movingTo.y,s,h),0===this.path.length)this.clearPath(),this.pathingTimer.set(this.pathfindingDelay);else if(this.pathingTimer.set(this.pathfindingUpdateDelay),this.path.length>1&&!r){var m=this.path[this.path.length-1];if(!m.corner||this._lastCornerNode===m)return void this.path.length--;var f=this.path[this.path.length-2],y=this.pos.x+.5*this.size.x,E=this.pos.y+.5*this.size.y;(m.x<y&&f.x>y||m.x>y&&f.x<y||m.y<E&&f.y>E||m.y>E&&f.y<E)&&this.path.length--,this.path.length&&this._lastNode!==this.path[this.path.length-1]&&(this._boundsPathfollow.ignoreCornerX=this._boundsPathfollow.ignoreCornerY=!1)}}},moveToPath:function(t,i){if(t=t||this.path)if(0===t.length||this.stuck&&this.stuckTimer.delta()>=0)this.moveToComplete();else{this.changed?this.stuck=!1:this.stuck||(this.stuckTimer.set(this.stuckDelay),this.stuck=!0),i=i||this.movingToSettings;var e,n;i&&(e=i.unsafe,n=i.avoidUngrounded);var o,h=t.length,r=this._lastNode=t[h-1],l=r.x,g=r.y,u=this.size.x,c=this.size.y,d=this.pos.x,p=this.pos.y,m=a.getBoundsPathfollowing(d,p,u,c,r,!this.hasGravity,this._boundsPathfollow),f=Math.round(m.minX),y=Math.round(m.maxX),E=Math.round(m.minY),v=Math.round(m.maxY);if(o=r.corner?s.pointInAABB(l,g,f,E,y,v):this.jumping&&r.ungrounded&&h>1?l>=d&&d+u>=l:s.pointInAABB(l,g,d,p,d+u,p+c))return r.corner?this._lastCornerNode=r:this._lastCornerNode=null,this._boundsPathfollow.ignoreCornerX=this._boundsPathfollow.ignoreCornerY=!1,1===t.length?this.moveToComplete():(t.length--,this.moveToPath(t));u=m.width,c=m.height;var T=Math.round(f+.5*u),A=Math.round(E+.5*c);if(this.hasGravity){var _,I=l>=f&&y>=l;if(!this.jumping&&(g>=E&&v>=g?this.moveToHereVertical():g>A?(this.canClimb&&this.climbDown(),this.climbing||this.moveToDown()):A>g&&(this.moveToUnsafe=!e&&r.ungrounded,this.withinClimbables&&this.canClimb?(this.moveToUnsafe=!1,this.climbUp()):this.canJump&&(this.moveToUnsafe=!1,this.jump())),!e&&r.ungrounded&&(!r.oneWay||r.oneWayFacing.y>=0)&&n&&(this.grounded||this.climbing)))for(_=r.neighborMap.bottom;_&&(_=_.neighborMap.bottom,_.walkable&&!(_.oneWay&&_.oneWayFacing.y<0));)if(_.y>this.pos.y+this.size.y){this.moveToUnsafe=!0;break}if(this.moveToUnsafe)return this.moveToComplete();I?(this.moveToHereHorizontal(),!this.jumping||r.ungrounded&&r.x!==t[0].x||(l>T?this.moveToRight():T>l&&this.moveToLeft())):l>T?this.moveToRight():T>l&&this.moveToLeft()}else g>=E&&v>=g?this.moveToHereVertical():g>A?this.moveToDown():A>g&&this.moveToUp(),l>=f&&y>=l?this.moveToHereHorizontal():l>T?this.moveToRight():T>l&&this.moveToLeft()}},clearPath:function(){this.stuck=!1,this.path.length>0&&(this.path.length=0)},moveToLeft:function(t){t?this.accel.x=-this.speed.x*t:this.accel.x=-this.speed.x,this.flip.x=this.canFlipX,this.moving&&(this.movingY||(this.facing.y=0),this.facing.x=-1)},moveToRight:function(t){t?this.accel.x=this.speed.x*t:this.accel.x=this.speed.x,this.flip.x=!1,this.moving&&(this.movingY||(this.facing.y=0),this.facing.x=1)},moveToUp:function(i){i?this.accel.y=-this.speed.y*i:this.accel.y=-this.speed.y,this.flip.y=this.canFlipY,this.moving&&(t.TOP_DOWN||this.canFlipY)&&(this.movingX||(this.facing.x=0),this.facing.y=-1)},moveToDown:function(i){i?this.accel.y=this.speed.y*i:this.accel.y=this.speed.y,this.flip.y=!1,this.moving&&(t.TOP_DOWN||this.canFlipY)&&(this.movingX||(this.facing.x=0),this.facing.y=1)},moveToHereHorizontal:function(){this.accel.x=0},moveToHereVertical:function(){this.accel.y=0},moveToHere:function(){this.clearPath(),this.moveToHereHorizontal(),this.moveToHereVertical()},moveToSequenceNext:function(){this.movingToSequence&&(this.movingToSequence.length>0?this.movingFrom?(this.movingTo=null,this.movingFrom=!1,this.moveFrom(this.movingToSequence.shift(),this.movingToSettings)):(this.movingTo=null,this.moveTo(this.movingToSequence.shift(),this.movingToSettings)):(this.movingToSequence=void 0,this.moveToComplete(),this.moveToStop()))},moveToComplete:function(){this.pathingTimer&&this.pathingTimer.set(0),this.moveToHere(),this.parent()},moveToStop:function(){this.moveToHere(),this.movingFrom=!1,this.parent()},manageStart:function(){this.parent(),this.moveToStop()},jump:function(){this.canJump&&(this.climbing&&(this._jumpWhileClimbing=!0,this.climbEnd()),this.canJumpRepeatedly&&(this._canUseAdditionalJump=this.additionalJumps>=this._jumpCounter),((this.grounded||this.canClimb&&this.withinClimbables||this.ungroundedFor<this.ungroundedForThreshold)&&this.jumping!==!0||this._canUseAdditionalJump)&&(this.jumping=this._jumpPushing=!0,this.jumpStepsRemaining=this.jumpSteps,this._jumpCounter++))},jumpUpdate:function(){this.jumping===!0&&(this._jumpPushing&&this.jumpPush(),this.vel.y>=0&&(this.jumpAscend=!1),this._jumpPushing||this.jumpAscend||!(this.grounded||this._jumpWhileClimbing&&this.withinClimbables)||this.jumpEnd())},jumpPush:function(){this.jumpStepsRemaining>0&&(this.jumpStepsRemaining===this.jumpSteps&&(this.setUngrounded(),this.applyAntiVelocityY()),this.jumpAscend=!0,this.jumpStepsRemaining--,this.moveToUp(this.jumpForce),this.jumpStepsRemaining<=0&&(this._jumpPushing=!1,this.moveToHereVertical()))},jumpEnd:function(){this.jumping=this._jumpPushing=!1,this.jumpStepsRemaining=0,this._jumpCounter=0,this._canUseAdditionalJump=this.canJumpRepeatedly,this._jumpWhileClimbing&&(this._jumpWhileClimbing=!1,this.climb())},climb:function(){this.canClimb&&this.withinClimbables&&(this.jumping&&this.jumpEnd(),this.climbing!==!0&&(this._climbingIntentUp&&this.withinClimbablesAbove||this._climbingIntentDown&&!this.grounded)&&(this.setUngrounded(),this.climbing=!0,this.jumping||this.applyAntiVelocityY()))},climbUp:function(){this._climbingIntentUp=!0,this._cleanIntentUp=!1,this.climb(),this.climbing&&this.moveToUp()},climbDown:function(){this._climbingIntentDown=!0,this._cleanIntentDown=!1,this.climb(),this.climbing&&this.moveToDown()},climbUpdate:function(){this.climbing&&(this.applyAntiGravity(),(!this.withinClimbables||this.grounded&&this.vel.y>=0)&&this.climbEnd()),this._climbingIntentDown&&(this._cleanIntentDown?this._cleanIntentDown=this._climbingIntentDown=!1:this._cleanIntentDown=!0),this._climbingIntentUp&&(this._cleanIntentUp?this._cleanIntentUp=this._climbingIntentUp=!1:this._cleanIntentUp=!0)},climbEnd:function(){this.climbing!==!1&&(this.climbing=!1,!this.jumping&&this.vel.y<0&&this.applyAntiVelocityY())},receiveDamage:function(t,i,e){var s=this.parent(t,i,e);return s&&!this._killed&&(this.explodingDamage&&this.explode(),e||this.temporaryInvulnerability()),s},explode:function(t){ig.game.spawnEntity(ig.EntityExplosion,this.pos.x,this.pos.y,ig.merge({size:{x:this.size.x,y:this.size.y}},t||this.damageSettings))},receiveHealing:function(t,i){this.health=Math.min(this.healthMax,this.health+t)},drainEnergy:function(t,i,e){return!this.invulnerable||e?(this.energy=Math.max(0,this.energy-t),!0):!1},receiveEnergy:function(t,i){this.energy=Math.min(this.energyMax,this.energy+t)},restoreStats:function(t){this.receiveHealing(this.healthMax-this.health,t),this.receiveEnergy(this.energyMax-this.energy,t)},regenerate:function(){this.regenHealth&&this.receiveHealing(this.regenRateHealth*(this.regenAsPctHealth?this.healthMax:1),this),this.regenEnergy&&this.receiveEnergy(this.regenRateEnergy*(this.regenAsPctEnergy?this.energyMax:1),this)},temporaryInvulnerability:function(t){if("undefined"==typeof t&&(t=this.damageDelay),!this.invulnerable&&t>0&&(this.damageTimer.set(t),this.invulnerable=this._temporarilyInvulnerable=!0,1===this.alpha&&this.temporaryInvulnerabilityAlpha<1&&this.temporaryInvulnerabilityPulses>0)){this._temporarilyInvulnerablePulsing=!0;var i=this.tween({alpha:this.temporaryInvulnerabilityAlpha},{name:"invulnerableHide",duration:1e3*t/(2*this.temporaryInvulnerabilityPulses),noComplete:!0,stopped:!0}),e=this.tween({alpha:1},{name:"invulnerableShow",duration:1e3*t/(2*this.temporaryInvulnerabilityPulses),noComplete:!0,stopped:!0});i.chain(e),e.chain(i),i.start()}},temporaryInvulnerabilityEnd:function(){this._temporarilyInvulnerable&&(this._temporarilyInvulnerablePulsing&&(this.tweenEnd("invulnerableHide"),this.tweenEnd("invulnerableShow"),this._temporarilyInvulnerablePulsing=!1,this.alpha=1),this.invulnerable=this._temporarilyInvulnerable=!1)},kill:function(t){this.controllable=!1,
this.parent(t)},die:function(){this.temporaryInvulnerabilityEnd(),!this.dieingSilently&&this.explodingDeath&&this.explode(this.deathSettings),this.parent()},cleanup:function(){this.moveToUnsafe=!1,this._lastNode=this._lastCornerNode=null,this.parent()},cleanupCollision:function(){this.parent(),this.withinOneWay=this.withinClimbables=this.withinClimbablesAbove=this.withinStairs=!1},intersectWith:function(t){this.parent(),t.oneWay&&(this.withinOneWay=!0),t.climbable&&(this.withinClimbables=!0,this.withinStairs=t.climbableStairs,t.pos.y<Math.round(this.pos.y+.9*this.size.y)&&(this.withinClimbablesAbove=!0))},getIsCollidingWithOneWay:function(t){var i=this.parent(t);if(i&&t.climbable){if(this._climbingIntentDown&&t.oneWayFacing.y<0)return this.withinClimbables=!0,this.withinStairs=t.climbableStairs,this.grounded=!1,this.climbDown(),!1;if(this._climbingIntentUp&&t.oneWayFacing.y>0)return this.withinClimbables=this.withinClimbablesAbove=!0,this.withinStairs=t.climbableStairs,this.climbUp(),!1}return i},collideWith:function(t,i,e,s,n,a){this.parent(t,i,e,s,n,a),a&&this!==a||(0>e&&this.jumping&&this.jumpEnd(),this.changed&&this.updateVisible())},updateChanges:function(){this.parent(),this._temporarilyInvulnerable&&this.invulnerable&&this.damageTimer.delta()>=0&&this.temporaryInvulnerabilityEnd(),this.regen&&this.regenTimer.delta()>=0&&(this.regenTimer.set(this.regenDelay),this.regenerate()),this.abilities.update(),this.jumpUpdate(),this.climbUpdate(),!this.hasGravity||this.grounded||this.climbing?this.ungroundedFor=0:(this.ungroundedFor+=ig.system.tick,this.ungroundedFor>this.ungroundedForAndFallingThreshold&&(this.falling=!0))},updateVelocity:function(){var t;this.climbing?(n.copy(this.maxVel,this.maxVelClimbing),t=this.climbingControl):this.grounded?(n.copy(this.maxVel,this.maxVelGrounded),t=1):(n.copy(this.maxVel,this.maxVelUngrounded),t=this.jumpControl),this.standing||this.climbing?n.copy(this.friction,this.frictionGrounded):n.copy(this.friction,this.frictionUngrounded),this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x*t,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y*t,this.friction.y,this.maxVel.y)},updateVisible:function(){this.animAutomatic&&!this._killed&&this.updateCurrentAnim(),this.parent()},updateCurrentAnim:function(){var t,i=this.anims;if(this.performance===ig.EntityExtended.PERFORMANCE.DYNAMIC){if(this.climbing===!0){if(!this.withinStairs)return this.currentAnim=i[this.getDirectionalAnimName("climb")],this.currentAnim.stop=!this.moving,this.currentAnim.reverse=this.vel.y>0,!0;if(this.moving)return this.currentAnim=i[this.getDirectionalAnimName("stairs")],!0}else if(!this.grounded){if(this.jumping)return t=i[this.getDirectionalAnimName("jump")],this.currentAnim!==t&&(this.currentAnim=t,this.currentAnim.playFromStart(!0)),!0;if(this.falling)return this.currentAnim=i[this.getDirectionalAnimName("fall")],!0}if(this.moving)return this.currentAnim=i[this.getDirectionalAnimName("move")],!0}t=i[this.getDirectionalAnimName("idle")],this.currentAnim!==t&&(this.currentAnim=t,this.currentAnim&&this.currentAnim.playFromStart())}})}),ig.baked=!0,ig.module("plusplus.abilities.ability").requires("plusplus.core.timer","plusplus.core.entity","plusplus.abstractities.particle","plusplus.helpers.utils","plusplus.helpers.utilsintersection","plusplus.helpers.signals").defines(function(){"use strict";var t=ig.utils,i=ig.utilsintersection,e=0;ig.Ability=ig.Class.extend({id:e++,name:"",type:0,paused:!1,blocking:!0,priority:0,enabled:!0,entity:null,entityOptions:null,entityTarget:null,movable:!1,autoStopMoving:!0,once:!1,activated:!1,needsDeactivate:!1,activateToggle:!1,activateStrict:!0,channelled:!1,channelling:!1,costActivate:0,costChannel:0,cooldownDelay:0,cooldownTimer:null,castTimer:null,requiresTarget:!1,canFindTarget:!1,canTargetSelf:!0,canTargetOthers:!0,canTargetFixed:!1,rangeX:0,rangeY:0,typeTargetable:0,groupTargetable:0,faceTarget:!0,retainTarget:!1,regenBlocking:!0,rank:0,upgrades:[],casting:!1,activateCastSettings:null,activatePassCastSettings:null,activateSetupCastSettings:null,deactivateCastSettings:null,deactivateSetupCastSettings:null,failCastSettings:null,failReason:"",onActivated:null,onDeactivated:null,onFailed:null,_activating:!1,_deactivating:!1,_regenBlocked:!1,_entityTargetRetained:!1,init:function(i,s){this.id=e++,s&&!ig.global.wm&&("string"==typeof s.typeTargetable&&(t.addType(ig.EntityExtended,this,"typeTargetable",s.typeTargetable),delete s.typeTargetable),"string"==typeof s.groupTargetable&&(t.addType(ig.EntityExtended,this,"groupTargetable",s.groupTargetable,"GROUP"),delete s.groupTargetable),ig.merge(this,s)),this.initTypes(),this.initProperties(),this.initUpgrades(),this.setEntity(i)},initTypes:function(){},initProperties:function(){this.castTimer=new ig.Timer,this.cooldownTimer=new ig.Timer,this.onActivated=new ig.Signal,this.onDeactivated=new ig.Signal,this.onFailed=new ig.Signal},initUpgrades:function(){},activate:function(){if(this.enabled){if(this.activateToggle&&(this.needsDeactivate||this.activated))return this.deactivate.apply(this,arguments);if(!this._activating&&!this.channelling&&(this.activated=!1,this.assert(this.cooledDown(),ig.Ability.FAIL.COOLDOWN)))return this.activateSetup.apply(this,arguments)}},activatePlain:function(){return this.activate()},execute:function(){return console.warn("DEPRECATED: ig.Ability.execute has been replaced by ig.Ability.activate, and ig.Ability.activate's previous functionality is now handled by ig.Ability.activateComplete."),this.activate.apply(arguments,this)},activateSetup:function(){if(!this._activating){if(this.castEnd(),this._deactivating=!1,this.needsDeactivate=this._activating=!0,this.faceTarget&&this.entity.lookAt(this.entityTarget),!this.activateSetupCastSettings)return this.activateTry.apply(this,arguments);this.cast(this.activateSetupCastSettings,this.activateTry,arguments)}},activateTry:function(){if(0===this.costActivate){if(this.assert(this.hasTarget(),ig.Ability.FAIL.TARGET)&&this.assert(this.closeEnough(),ig.Ability.FAIL.DISTANCE)){if(!this.activatePassCastSettings)return this.activatePass.apply(this,arguments);this.cast(this.activatePassCastSettings,this.activatePass,arguments)}}else if(this.assert(this.hasTarget(),ig.Ability.FAIL.TARGET)&&this.assert(this.canPayCost(this.costActivate),ig.Ability.FAIL.COST)&&this.assert(this.closeEnough(),ig.Ability.FAIL.DISTANCE)){if(this.extractCost(this.costActivate),!this.activatePassCastSettings)return this.activatePass.apply(this,arguments);this.cast(this.activatePassCastSettings,this.activatePass,arguments)}},activatePass:function(){return this.activatePassCastSettings&&this.activateStrict&&!this.assert(this.closeEnough(),ig.Ability.FAIL.DISTANCE)?void 0:this.activateComplete.apply(this,arguments)},activateComplete:function(){this._activating=this._deactivating=!1,this.needsDeactivate=!0,this.activated=this.once||this.channelled,this.onActivated.dispatch(this),this.cooldownDelay>0&&this.cooldownTimer.set(this.cooldownDelay),this.activateCastSettings?this.cast(this.activateCastSettings,this.channelled?this.channelTry:null):(this.castEnd(),this.channelled&&this.channelTry()),this.dropEntityTarget()},deactivate:function(){return this.deactivateSetup.apply(this,arguments)},deactivateSetup:function(){if(this.needsDeactivate&&!this._deactivating){if(this._deactivating=!0,this.activated=this._activating=this.needsDeactivate=!1,this.channelling&&this.channelStop(),this.castEnd(),!this.deactivateSetupCastSettings||this.entity._killed)return this.deactivateComplete.apply(this,arguments);this.cast(this.deactivateSetupCastSettings,this.deactivateComplete,arguments)}},deactivateComplete:function(){this._deactivating=!1,this.onDeactivated.dispatch(this),this.deactivateCastSettings&&!this.entity._killed?this.cast(this.deactivateCastSettings):this.castEnd(),this.dropEntityTarget()},cleanup:function(){this.castEnd();var t=this.deactivateSetupCastSettings,i=this.deactivateCastSettings;this.deactivateCastSettings=this.deactivateSetupCastSettings=null;var e=this.deactivate.apply(this,arguments);return this.deactivateSetupCastSettings=t,this.deactivateCastSettings=i,ig.game.hasLevel||(this.onActivated.removeAll(),this.onActivated.forget(),this.onDeactivated.removeAll(),this.onDeactivated.forget(),this.onFailed.removeAll(),this.onFailed.forget()),e},cleanupPlain:function(){return this.cleanup()},pause:function(){this.paused=!0,this.castTimer.pause(),this.cooldownTimer.pause()},unpause:function(){this.paused=!1,this.castTimer.unpause(),this.cooldownTimer.unpause()},setEnabled:function(t){"undefined"==typeof t&&(t=!0),t?this.enable():this.disable()},enable:function(){this.enabled=!0},disable:function(){return this.enabled=!1,this.needsDeactivate||this.activated?this.deactivateSetup(arguments):void 0},cooledDown:function(){return this.cooldownDelay<=0||this.cooldownTimer.delta()>=0},cast:function(t,i,e){if(t){var s,n;t.async||(s=i,n=e);var a=t.animName;a&&!t.animOmniDirectional&&(a=this.entity.getDirectionalAnimName(a));var o=t.animSettings||{};if(a&&!t.delay&&(o.loop||o.lock||o.stop||o.frame&&this.entity.anims[a]&&this.entity.anims[a].stop)&&(t.delay=1),t.delay)this.castStart(t,s,n),this.castTimer.set(t.delay),a&&("undefined"==typeof o.loop&&(o.loop=!0),this.entity.animOverride(a,o));else if(a){this.castStart(t,s,n);var h=o.callback,r=o.context;o.callback=function(){this.castComplete(),h&&h.call(r||this)},o.context=this,this.entity.animOverride(a,o)}else this.castEffects(t.effects),s&&s.apply(this,n);t.async&&i&&i.apply(this,e)}else i&&i.apply(this,e)},castStart:function(t,i,e){this.castEnd(),this.casting=!0,this.castSettings=t,this.castInternalCallback=i,this.castInternalArgs=e,this.autoStopMoving&&this.getInterrupted()&&this.entity.moveAllStop(),this.castEffects(t.effects)},castUpdate:function(){this.castSettings&&this.castSettings.delay&&this.castTimer.delta()>=0?this.castComplete():this.failReason||this.assert(!this.getInterrupted(),ig.Ability.FAIL.INTERRUPT)},castComplete:function(){var t=this.castSettings,i=this.castInternalCallback,e=this.castInternalArgs;this.castEnd(),this.failReason="",t&&t.callback&&t.callback.apply(t.context||this,t.settings),i&&i.apply(this,e)},castEnd:function(){if(this.casting||this.castSettings){if(this.casting=!1,this.castSettings){var t=this.castSettings.effects;if(t)for(var i=0,e=t.length;e>i;i++)this.effectEnd(t[i]);var s=this.castSettings.animName;s&&(this.castSettings.animOmniDirectional||(s=this.entity.getDirectionalAnimName(s)),this.entity.animRelease(s,!0))}this.castSettings=this.castInternalCallback=this.castInternalArgs=void 0}},castEffects:function(t){if(t&&t.length)for(var i=0,e=t.length;e>i;i++)this.effectStart(t[i])},effectStart:function(t){var i=t.settings||{};if(!t.ignoreDuration){if(this.castSettings)if(this.castSettings.delay)i.lifeDuration=this.castSettings.delay;else if(this.castSettings.animName){var e=this.entity.anims[this.castSettings.animName];e&&(i.lifeDuration=e.frameTime*e.sequence.length)}t.fade&&(i.fadeBeforeDeathDuration=i.fadeBeforeDeathDuration||0)}if(!t.followTarget||this.entityTarget){var s=t.entity=ig.game.spawnEntity(t.entityClass,0,0,i);t.followSettings?("undefined"==typeof t.followSettings.flipWith&&(t.followSettings.flipWith=!0),t.followTarget?this.entityTarget&&s.moveTo(this.entityTarget,t.followSettings):s.moveTo(this.entity,t.followSettings)):t.center!==!1&&(s.pos.x=this.entity.pos.x+.5*(this.entity.size.x-s.size.x),s.pos.y=this.entity.pos.y+.5*(this.entity.size.y-s.size.y))}},effectEnd:function(t){!t.entity||t.entity._killed||this.failReason!==ig.Ability.FAIL.INTERRUPT&&t.entity instanceof ig.Particle||(t.entity.kill(),t.entity=void 0)},update:function(){this.enabled&&!this.paused&&(this.casting&&this.castUpdate(),this.activated&&this.channelled&&this.channelTry(arguments))},channelTry:function(t){if(!this.channelling&&this.autoStopMoving&&this.getInterrupted()&&this.entity.moveAllStop(),0===this.costChannel){if(this.assert(!this.getInterrupted(),ig.Ability.FAIL.INTERRUPT)&&this.assert(this.closeEnough(),ig.Ability.FAIL.DISTANCE))return this.channel.apply(this,t)}else if(this.assert(this.canPayCost(this.costChannel),ig.Ability.FAIL.COST)&&this.assert(!this.getInterrupted(),ig.Ability.FAIL.INTERRUPT)&&this.assert(this.closeEnough(),ig.Ability.FAIL.DISTANCE))return this.extractCost(this.costChannel),this.channel.apply(this,t);return this.deactivate.apply(this,t)},channel:function(){!this.channelling&&this.regenBlocking&&(this.channelling=!0,this.blockRegen(this.entity)),this.faceTarget&&this.entity.lookAt(this.entityTarget)},channelStop:function(){this.channelling=!1,this.unblockRegen(this.entity)},getUsing:function(){return this.casting||this.channelling},getActivelyUsing:function(){return this.activated||this.getUsing()},getInterrupted:function(){return this.entity.moving&&!(this.movable||this.castSettings&&this.castSettings.movable)},blockRegen:function(t){t.regenEnergy&&(this._regenBlocked=!0,t.regenEnergy=!1)},unblockRegen:function(t){this._regenBlocked&&(t.regenEnergy=!0,this._regenBlocked=!1)},setEntity:function(t){this.entity&&(this.entity.onRemoved.remove(this.cleanupPlain,this),this.entity.onAdded.remove(this.activatePlain,this),this.cleanup()),this.entity=t,this.entity&&(this.entity.onRemoved.add(this.cleanupPlain,this),this.type&ig.Ability.TYPE.PASSIVE&&(this.entity.added?this.activatePlain():this.entity.onAdded.addOnce(this.activatePlain,this)))},setEntityOptions:function(t){this.entityOptions=t},setEntityTarget:function(t){(!t||this.entityTarget!==t&&this.isEntityTargetable(t))&&(this.entityTarget=t,this._entityTargetRetained=!1)},isEntityTargetable:function(t){return(!t.fixed||this.canTargetFixed)&&(!this.typeTargetable||(t.type&this.typeTargetable)===this.typeTargetable&&!(this.entity.group&t.group))&&(!this.groupTargetable||(t.group&this.groupTargetable)===this.groupTargetable)&&(this.canTargetOthers&&this.entity!==t||this.canTargetSelf&&this.entity===t)},setEntityTargetFirst:function(t){if(t&&t.length)for(var i=0,e=t.length;e>i&&(this.setEntityTarget(t[i]),!this.entityTarget);i++);else this.setEntityTarget()},setClosestEntityTarget:function(){if(this.rangeX>0||this.rangeY>0){this.entityTarget&&this.setEntityTarget();var t=i.entitiesInAABB(this.entity.pos.x-this.rangeX,this.entity.pos.y-this.rangeY,this.entity.pos.x+this.entity.size.x+this.rangeX,this.entity.pos.y+this.entity.size.y+this.rangeY,!0);this.setEntityTargetFirst(t)}},dropEntityTarget:function(){this.entityTarget&&(this.isEntityTargetDroppable()?this.setEntityTarget():this._entityTargetRetained=!0)},isEntityTargetDroppable:function(){return!(this.activated&&this.channelled||this.retainTarget)},hasTarget:function(){return this.requiresTarget?(this.canFindTarget&&!this.entityTarget&&this.setClosestEntityTarget(),this.entityTarget?!0:!1):!0},hasValidTarget:function(){return!this.requiresTarget||this.entityTarget},closeEnough:function(){if(this.requiresTarget){if(this.entityTarget){var t=this.entityTarget.type&ig.EntityExtended.TYPE.INTERACTIVE;if(0===this.rangeX&&0===this.rangeY||t&&0===this.entityTarget.rangeInteractableX&&0===this.entityTarget.rangeInteractableY)return!0;var e,s;t?(e=Math.max(this.rangeX,this.entityTarget.rangeInteractableX),s=Math.max(this.rangeY,this.entityTarget.rangeInteractableY)):(e=this.rangeX,s=this.rangeY);var n=i.AABBIntersect(this.entityTarget.pos.x,this.entityTarget.pos.y,this.entityTarget.pos.x+this.entityTarget.size.x,this.entityTarget.pos.y+this.entityTarget.size.y,this.entity.pos.x-e,this.entity.pos.y-s,this.entity.pos.x+this.entity.size.x+e,this.entity.pos.y+this.entity.size.y+s);return this.faceTarget&&this.entity.lookAt(this.entityTarget),n}return!1}return!0},assert:function(t,i){return t?this.failReason="":this.fail(i),t},fail:function(t){if(this.failReason=t||ig.Ability.FAIL.UNKNOWN,this._activating=this._deactivating=!1,this.failReason===ig.Ability.FAIL.INTERRUPT)this.castEnd();else{var i=this.failCastSettings;if(i){if(i.effects)for(var e=0,s=i.effects.length;s>e;e++){var n=i.effects[e];n.settings=n.settings||{},n.settings.animInit=this.failReason}this.failCastSettings?this.cast(this.failCastSettings):this.castEnd()}}this.onFailed.dispatch(this),this.dropEntityTarget()},canPayCost:function(t){return!this.entity.hasOwnProperty("energy")||this.entity.invulnerable||this.entity.energy>=t},extractCost:function(t){this.entity.drainEnergy&&this.entity.drainEnergy(t,this)},addUpgrades:function(i){t.arrayCautiousAddMulti(this.upgrades,i)},upgrade:function(i){i===!0?i=this.upgrades.length:t.isNumber(i)||(i=this.rank+1),this.changegrade(i)},downgrade:function(i){i===!0?i=0:t.isNumber(i)||(i=this.rank-1),this.changegrade(i)},changegrade:function(t){var i=this.upgrades.length,e=t<this.rank?-1:1,s=this.rank+e;for(this.rank!==t&&this.cleanup();this.rank!==t&&i>s&&s>=0;){this.rank=s;var n=this.upgrades[s],a=this.entity,o=this.entityOptions||a;"function"==typeof n?n.call(this,a,o):ig.merge(this,n),s+=e}},clone:function(t){return t instanceof ig.Ability!=1&&(t=new ig.Ability),t.name=this.name,t.type=this.type,t.enabled=this.enabled,t.costActivate=this.costActivate,t.costDeactivate=this.costDeactivate,t.costChannel=this.costChannel,t.requiresTarget=this.requiresTarget,t.canFindTarget=this.canFindTarget,t.canTargetSelf=this.canTargetSelf,t.canTargetOthers=this.canTargetOthers,t.typeTargetable=this.typeTargetable,t.rangeX=this.rangeX,t.rangeY=this.rangeY,t.retainTarget=this.retainTarget,t.rank=this.rank,t.upgrades=this.upgrades.slice(0),t.regenBlocking=this.regenBlocking,t.setEntityOptions(this.entityOptions),t.setEntity(this.entity),t}}),ig.Ability.TYPE,t.getType(ig.Ability,"PASSIVE"),t.getType(ig.Ability,"SPAMMABLE"),t.getType(ig.Ability,"TOGGLEABLE"),ig.Ability.FAIL={UNKNOWN:"unknown",COST:"cost",TARGET:"target",DISTANCE:"distance",COOLDOWN:"cooldown",INTERRUPT:"interrupt"}}),ig.baked=!0,ig.module("plusplus.abilities.interact").requires("plusplus.core.config","plusplus.abilities.ability","plusplus.helpers.utils").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils;ig.AbilityInteract=ig.Ability.extend({rangeX:t.CHARACTER.SIZE_EFFECTIVE_X,rangeY:.5*t.CHARACTER.SIZE_EFFECTIVE_Y,requiresTarget:!0,canFindTarget:!1,canTargetSelf:!1,initTypes:function(){this.parent(),i.addType(ig.Ability,this,"type","INTERACT"),i.addType(ig.EntityExtended,this,"typeTargetable","INTERACTIVE")},activateComplete:function(){this.entityTarget.toggleActivate(this.entity),this.parent()}})}),ig.baked=!0,ig.module("plusplus.abstractities.player").requires("plusplus.core.config","plusplus.abstractities.character","plusplus.abilities.interact","plusplus.helpers.utils","plusplus.helpers.utilsmath").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utils;ig.Player=ig.Character.extend({name:"player",zIndex:t.Z_INDEX_PLAYER,performance:ig.EntityExtended.PERFORMANCE.DYNAMIC,collides:ig.EntityExtended.COLLIDES.LITE,persistent:!0,damageDelay:1,initTypes:function(){this.parent(),i.addType(ig.EntityExtended,this,"type","PLAYER DAMAGEABLE MIMICABLE"),i.addType(ig.EntityExtended,this,"group","PLAYER FRIEND","GROUP")},initProperties:function(){this.parent(),ig.global.wm||(this.abilityInteract=new ig.AbilityInteract(this),this.abilities.addDescendant(this.abilityInteract))},spawn:function(){this.parent(),this.checkAutomaticUtilities()},checkAutomaticUtilities:function(){ig.game.playerManager&&!ig.game.playerManager.entity&&ig.game.playerManager.autoManagePlayer&&ig.game.playerManager.managePlayer(),ig.game.camera&&!ig.game.camera.entity&&ig.game.camera.autoFollowPlayer&&ig.game.camera.followPlayer()},handleInput:function(){var t,i,e,s;if(!this.jumping&&ig.input.released("tap"))for(e=ig.input.getInputPoints(["tapped"],[!0]),t=0,i=e.length;i>t;t++)s=e[t],this.abilityInteract.setEntityTargetFirst(s.targets),!this.abilityInteract.entityTarget||this.abilityInteract.entityTarget.type&ig.EntityExtended.TYPE.UI&&this.abilityInteract.entityTarget.fixed||this.abilityInteract.activate()}})}),ig.baked=!0,ig.module("game.managers.animation").requires("impact.impact","impact.game").defines(function(){var t=[{path:"media/player-black.png",width:10,height:16,anims:{idleX:{sequence:[0],frameTime:1},jumpX:{sequence:[4],frameTime:.2},fallX:{sequence:[4],frameTime:.2},moveX:{sequence:[3,5,6,2],frameTime:.05}}},{path:"media/player-red.png",width:10,height:16,anims:{idleX:{sequence:[0],frameTime:1},jumpX:{sequence:[4],frameTime:.2},fallX:{sequence:[4],frameTime:.2},moveX:{sequence:[3,5,6,2],frameTime:.05}}},{path:"media/player-blue.png",width:10,height:16,anims:{idleX:{sequence:[0],frameTime:1},jumpX:{sequence:[4],frameTime:.2},fallX:{sequence:[4],frameTime:.2},moveX:{sequence:[3,5,6,2],frameTime:.05}}},{path:"media/player-green.png",width:10,height:16,anims:{idleX:{sequence:[0],frameTime:1},jumpX:{sequence:[4],frameTime:.2},fallX:{sequence:[4],frameTime:.2},moveX:{sequence:[3,5,6,2],frameTime:.05}}}];ig.animationManager=ig.Class.extend({getAnimations:function(i){var e=t[i],s=new ig.AnimationSheet(e.path,e.width,e.height),n=new ig.AnimationExtended(s,{sequence:e.anims.idleX.sequence,frameTime:e.anims.idleX.frameTime}),a=new ig.AnimationExtended(s,{sequence:e.anims.jumpX.sequence,frameTime:e.anims.jumpX.frameTime}),o=new ig.AnimationExtended(s,{sequence:e.anims.fallX.sequence,frameTime:e.anims.fallX.frameTime}),h=new ig.AnimationExtended(s,{sequence:e.anims.moveX.sequence,frameTime:e.anims.moveX.frameTime});return{idleX:n,jumpX:a,fallX:o,moveX:h}}})}),ig.baked=!0,ig.module("game.entities.otherPlayer").requires("plusplus.abstractities.player","game.managers.animation","plusplus.helpers.utils").defines(function(){var t=ig.utils;ig.EntityOtherPlayer=ig.global.EntityOtherPlayer=ig.Player.extend({name:"player",size:{x:10,y:16},collides:ig.EntityExtended.COLLIDES.PASSIVE,setAnimations:function(){this.animationManager=new ig.animationManager;var t=this.animationManager.getAnimations(this.playerNumber);this.anims.idleX=t.idleX,this.anims.jumpX=t.jumpX,this.anims.fallX=t.fallX,this.anims.moveX=t.moveX,this.animationManager=null},animate:function(t){this.vel=t.vel,this.pos=t.pos},init:function(t,i,e){this.parent(t,i,e),this.playerNumber=e.playerNumber,this.setAnimations()},check:function(t){console.log("otherPlayer.check()"),console.log(t),this.parent()},initTypes:function(){t.addType(ig.EntityExtended,this,"type","OTHERPLAYER"),t.addType(ig.EntityExtended,this,"checkAgainst","PLAYER")}})}),ig.baked=!0,ig.module("plusplus.ui.ui-text-bubble").requires("plusplus.core.config","plusplus.ui.ui-overlay","plusplus.helpers.utilsvector2","plusplus.helpers.utilsdraw","plusplus.helpers.utilsintersection").defines(function(){"use strict";var t=ig.CONFIG,i=ig.utilsvector2,e=ig.utilsdraw;ig.UITextBubble=ig.global.UITextBubble=ig.UIOverlay.extend({layerName:"ui",size:{x:t.TEXT_BUBBLE.SIZE_X,y:t.TEXT_BUBBLE.SIZE_Y},sizeAsPct:t.TEXT_BUBBLE.SIZE_AS_PCT,sizePct:{x:t.TEXT_BUBBLE.SIZE_PCT_X,y:t.TEXT_BUBBLE.SIZE_PCT_Y},cornerRadius:t.TEXT_BUBBLE.CORNER_RADIUS,cornerRadiusAsPct:t.TEXT_BUBBLE.CORNER_RADIUS_AS_PCT,r:t.TEXT_BUBBLE.R,g:t.TEXT_BUBBLE.G,b:t.TEXT_BUBBLE.B,alpha:t.TEXT_BUBBLE.ALPHA,pixelPerfect:t.TEXT_BUBBLE.PIXEL_PERFECT,shrinkToText:t.TEXT_BUBBLE.SHRINK_TO_TEXT,triangleLength:t.TEXT_BUBBLE.TRIANGLE_LENGTH,triangleWidth:t.TEXT_BUBBLE.TRIANGLE_WIDTH,padding:{x:t.TEXT_BUBBLE.PADDING_X,y:t.TEXT_BUBBLE.PADDING_Y},resetExtras:function(){this.textSettings&&(this.textSettings.font=this.textSettings.font||ig.Font.FONTS.CHAT,this.textSettings.margin={x:0,y:this.padding.y-this.triangleLength},this.textSettings.marginAsPct=!1),this.textMoveToSettings=ig.merge(this.textMoveToSettings,{offset:{x:0,y:this.padding.y-this.triangleLength}}),this.sizeAsPct||(this.resetState.size=this.resetState.size||{x:0,y:0},i.copy(this.resetState.size,this.size)),this.parent()},recordResetState:function(){this.parent(),this.resetState.size=this.resetState.size||{x:0,y:0},i.copy(this.resetState.size,this.size),this.resetState.sizePct=this.resetState.sizePct||{x:0,y:0},i.copy(this.resetState.sizePct,this.sizePct)},refresh:function(t){this.sizeAsPct||i.copy(this.size,this.resetState.size),this.message&&this.message.added&&this.added&&(this.message.maxWidth=this.message.maxHeight=0,this.message.refresh(t)),this.parent(t),this.message&&this.message.linkedTo!==this&&this.message.refresh(t)},resize:function(t){var t=this.parent(t);if(this.message){var i=this.message.scale/this.scale,e=this.getSizeDrawX()-2*this.padding.x,s=this.getSizeDrawY()-2*this.padding.y-this.triangleLength,n=this.message.getSizeDrawX()*i;n>e&&(this.message.maxWidth=e*(1/i),this.message.resize(!0),n=this.message.getSizeDrawX()*i);var a=this.message.getSizeDrawY()*i;a>s&&(this.message.maxHeight=s*(1/i),this.message.resize(!0),a=this.message.getSizeDrawY()*i),this.shrinkToText&&(e>n&&(this.size.x=n+2*this.padding.x,t=this.needsRebuild=!0),s>a&&(this.size.y=a+2*this.padding.y+this.triangleLength,t=this.needsRebuild=!0))}return t},refill:function(){if(this.fill&&this.triangleLength>0){var t=this.triangleLength,i=this.triangleWidth,s=this.sizeDraw.x,n=this.sizeDraw.y-t;this.parent(s,n),this.pixelPerfect||(s*=this.scale,n*=this.scale,t*=this.scale,i*=this.scale);var a=[{x:.5*s-.5*i,y:n},{x:.5*s+.5*i,y:n},{x:.5*s,y:n+t}],o=this.fill.dataContext;this.pixelPerfect?e.pixelFillPolygon(o,0,0,this.fill.width,this.fill.height,a,this.r,this.g,this.b,this.alpha):(o.fillStyle=this.getFillStyle(),e.fillPolygon(o,a))}else this.parent()}})}),ig.baked=!0,ig.module("plusplus.entities.conversation").requires("plusplus.core.timer","plusplus.ui.ui-text","plusplus.ui.ui-text-bubble","plusplus.entities.trigger","plusplus.helpers.utils").defines(function(){"use strict";var t=ig.utils;ig.EntityConversation=ig.global.EntityConversation=ig.EntityTrigger.extend({_wmBoxColor:"rgba(200, 200, 200, 0.7)",steps:{},stepsSorted:[],stepsUnused:[],stepsUsed:[],step:null,message:null,messageEntity:ig.UIText,messageContainer:null,messageContainerEntity:ig.UITextBubble,messageSettings:{},messageFollowsSpeaker:!0,messageMoveToSettings:{matchPerformance:!0,offsetPct:{x:0,y:-1.3}},speaker:null,speakerLast:null,participate:{},participating:[],looking:!0,pausing:!1,locking:!1,lockingPlayer:!1,interrupting:!0,animNameTalk:"talk",animNameListen:"listen",cameraFollows:!0,cameraCentered:!1,autoAdvance:!0,advanceTimer:null,durationPerLetter:.1,durationPerStepMin:1,action:"tap",triggerAfterDelay:!0,autoComplete:!1,_order:0,_step:null,_speakersModified:[],_cameraWasFollowing:null,initProperties:function(){this.parent(),this.advanceTimer=new ig.Timer},resetExtras:function(){this.stepsSorted.length=0;for(var i in this.steps){var e=this.steps[i],s=parseInt(e.order);t.isNumber(s)||(s=e.order=parseInt(i)),t.isNumber(s)?s>this._order&&(this._order=s):s=e.order=++this._order,this._addStep(e)}this.parent()},addStep:function(i,e,s,n){if(i&&i.length>0){t.isNumber(s)?s>this._order&&(this._order=s):s=++this._order;var a=this.steps[s]={name:e,text:i,order:s,settings:n};this._addStep(a)}},_addStep:function(t){this.stepsSorted.push(t),this.stepsSorted.sort(function(t,i){return t.order-i.order}),this.activated&&(this._addUnusedStep(t),this.stepsUnused.sort(function(t,i){return t.order-i.order}))},setup:function(){var i,e;if(this.pausing&&!this.action&&(this.pausing=!1,this.autoAdvance=!0),this.interrupting){var s={};for(i=0,e=this.stepsSorted.length;e>i;i++){var n=this.stepsSorted[i],a=ig.game.namedEntities[n.name],o=a&&a.conversation;o&&o!==this&&!s[o.id]&&o instanceof ig.EntityConversation&&o.activated&&(s[o.id]=!0,o.deactivate())}}if(this.pausing&&(ig.game.pause(!0),ig.game.camera&&ig.game.camera.unpause(),this.unpause()),this.lockingPlayer){var h=ig.game.getPlayer();h&&h.removeControl()}for(this.stepsUnused.length=this.stepsUsed.length=this.participating.length=this._speakersModified.length=0,i=0,e=this.stepsSorted.length;e>i;i++)this._addUnusedStep(this.stepsSorted[i]);this._speakersModified.length=0;for(var r in this.participate){var l=ig.game.namedEntities[this.participate[r]];l&&t.arrayCautiousAdd(this.participating,l)}this.nextStep(),this.parent()},teardown:function(){this.hideStep(),this.speakerLast=null,this.stepsUnused.length=this.stepsUsed.length=this.participating.length=this._speakersModified.length=0;for(var i in this.steps){var e=this.steps[i],s=ig.game.namedEntities[e.name];s&&-1===t.indexOfValue(this._speakersModified,e.name)&&(this._speakersModified.push(e.name),s.conversation=void 0,(e.locking||this.locking)&&s.addControl(),s.animRelease(s.getDirectionalAnimName(e.animNameTalk||this.animNameTalk)),s.animRelease(s.getDirectionalAnimName(e.animNameListen||this.animNameListen)))}if(this._speakersModified.length=0,ig.game.camera&&(ig.game.camera.onTransitioned.remove(this.complete,this),this._cameraWasFollowing=null),this.lockingPlayer){var n=ig.game.getPlayer();n&&n.addControl()}this.pausing&&ig.game.unpause(!0),this.parent()},_addUnusedStep:function(i){this.stepsUnused.push(i);var e=i.name,s=ig.game.namedEntities[e];if(s&&-1===t.indexOfValue(this._speakersModified,i.name)&&(this._speakersModified.push(e),this.participating.push(s),s.conversation=this,this.pausing&&s.unpause(),i.locking||this.locking)){s.removeControl();var n;n="undefined"!=typeof i.animNameListen?i.animNameListen:this.animNameListen,n&&s.animOverride(s.getDirectionalAnimName(n),{loop:!0})}},nextStep:function(){if(this.hideStep(),this.stepsUnused.length>0)if(this._step=this.stepsUnused.shift(),this.stepsUsed.push(this._step),this._step.name){if(this.speaker=ig.game.namedEntities[this._step.name],this.speaker){var t=this._step.locking||this.locking;if(t){var i;i="undefined"!=typeof this._step.animNameTalk?this._step.animNameTalk:this.animNameTalk,i&&this.speaker.animOverride(this.speaker.getDirectionalAnimName(i),{loop:!0})}if(this.looking)for(var e=0,s=this.participating.length;s>e;e++){var n=this.participating[e];n!==this.speaker&&n.lookAt(this.speaker)}(this.pausing||this.lockingPlayer||t)&&ig.game.camera&&this.cameraFollows&&this.speaker!==this.speakerLast?(this._cameraWasFollowing||(this._cameraWasFollowing=ig.game.camera.entity),this._cameraFollowing=this.speaker,ig.game.camera.onTransitioned.addOnce(this.showStep,this),ig.game.camera.follow(this.speaker,!1,this.cameraCentered)):this.showStep()}}else this.showStep();else ig.game.camera&&this.cameraFollows&&this._cameraWasFollowing?(ig.game.camera.onTransitioned.addOnce(this.complete,this),ig.game.camera.follow(this._cameraWasFollowing,!1,!0),this._cameraWasFollowing=null):this.complete()},showStep:function(){if(this._step&&this._step.text){var t=this.messageSettings;this.speaker&&this.messageFollowsSpeaker&&(t.fixed=t.fixed||!1);var i;this.messageContainerEntity?(t.textSettings={text:this._step.text},i=this.messageContainer=ig.game.spawnEntity(this.messageContainer||this.messageContainerEntity,0,0,ig.merge(t,this._step.settings))):(t.text=this._step.text,i=this.message=ig.game.spawnEntity(this.message||this.messageEntity,0,0,ig.merge(t,this._step.settings))),i.added?this.activateStep():i.onAdded.addOnce(this.activateStep,this)}else this.activateStep()},activateStep:function(){if(this._step){this.step=this._step,this._step=void 0;var t,i;if(this.messageContainer?(t=this.messageContainer,i=this.message=t.message):t=i=this.message,i){if(i.textOverflow){var e=i.textOverflow;i.text=i.textDisplay||i.text,i.textOverflow="";var s=ig.merge({},this.step);this.step.text=i.text,s.text=e,this._addStep(s)}this.speaker&&this.messageFollowsSpeaker&&(t.unpause(),t.moveTo(this.speaker,this.messageMoveToSettings),(this.pausing||this.locking||this.lockingPlayer||this.step.locking)&&ig.game.camera&&this.cameraFollows&&!t.fixed&&(this._cameraWasFollowing||(this._cameraWasFollowing=ig.game.camera.entity),this._cameraFollowing=t,ig.game.camera.follow(t,!1,this.cameraCentered))),this.autoAdvance&&this.advanceTimer.set(Math.max(this.step.text.length*this.durationPerLetter,this.durationPerStepMin))}else this.advanceTimer.set(this.durationPerStepMin)}},hideStep:function(){if(this.messageContainer&&(this.messageContainer.onAdded.remove(this.activateStep,this),this.messageContainer._killed||ig.game.removeEntity(this.messageContainer),
this.messageContainer=null),this.message&&(this.message.onAdded.remove(this.activateStep,this),this.message._killed||ig.game.removeEntity(this.message),this.message=null),this.speaker){if(this.stepsUnused.length>0){if(this.locking||this.step&&this.step.locking){var t;t=this.step&&"undefined"!=typeof this.step.animNameListen?this.step.animNameListen:this.animNameListen,t&&this.speaker.animOverride(this.speaker.getDirectionalAnimName(t),{loop:!0})}this.speakerLast=this.speaker}else this.speaker.animRelease(this.speaker.getDirectionalAnimName(this.step.animNameTalk||this.animNameTalk)),this.speaker.animRelease(this.speaker.getDirectionalAnimName(this.step.animNameListen||this.animNameListen));this.speaker=null}ig.game.camera&&this.cameraFollows&&(ig.game.camera.onTransitioned.remove(this.showStep,this),ig.game.camera&&this._cameraFollowing&&ig.game.camera.entity===this._cameraFollowing&&ig.game.camera.unfollow(),this._cameraFollowing=null),this.step=this._step=null},pause:function(){this.parent(),this.advanceTimer.pause()},unpause:function(){this.parent(),this.advanceTimer.unpause()},update:function(){this.step&&(this.speaker&&this.speaker._killed?this.nextStep():(this.autoAdvance||this.step&&!this.step.text)&&this.advanceTimer.delta()>=0?this.nextStep():ig.input.released(this.action)&&this.nextStep()),this.parent()}})}),ig.baked=!0,ig.module("game.entities.player").requires("plusplus.abstractities.player","plusplus.entities.conversation","game.managers.animation","plusplus.helpers.utils").defines(function(){var t=ig.utils;ig.EntityPlayer=ig.global.EntityPlayer=ig.Player.extend({name:"player",collides:ig.EntityExtended.COLLIDES.PASSIVE,size:{x:10,y:16},setAnimations:function(){this.animationManager=new ig.animationManager;var t=this.animationManager.getAnimations(this.playerNumber);this.anims.idleX=t.idleX,this.anims.jumpX=t.jumpX,this.anims.fallX=t.fallX,this.anims.moveX=t.moveX,this.animationManager=null},speak:function(t){ig.game.getEntitiesByClass(ig.EntityConversation)[0]&&ig.game.getEntitiesByClass(ig.EntityConversation)[0].kill();var i=ig.game.spawnEntity(ig.EntityConversation,0,0);i.durationPerStepMin=5,i.addStep(t,this.name,1),i.activate()},init:function(t,i,e){this.parent(t,i,e),this.playerNumber=e.playerNumber,this.setAnimations()},kill:function(){this.parent(),console.log("kill()")},update:function(){(this.pos.x!==this.last.x||this.pos.y!==this.last.y)&&ig.game.socket.emit("playerMove",{playerId:ig.game.playerId,pos:this.pos,vel:this.vel}),this.parent()},check:function(t){console.log("player.check()"),console.log(t),this.parent()},initTypes:function(){t.addType(ig.EntityExtended,this,"type","PLAYER"),t.addType(ig.EntityExtended,this,"checkAgainst","OTHERPLAYER")},check:function(t){console.log("player.check()"),console.log(t),this.parent()}})}),ig.baked=!0,ig.module("plusplus.debug.menu").requires("dom.ready","impact.system","plusplus.core.plusplus").defines(function(){"use strict";ig.System.inject({run:function(){ig.debug.beforeRun(),this.parent(),ig.debug.afterRun()},setGameNow:function(t){this.parent(t),ig.debug.ready()}}),ig.Debug=ig.Class.extend({options:{},panels:{},numbers:{},container:null,panelMenu:null,activePanel:null,debugTime:0,debugTickAvg:.016,debugRealTime:Date.now(),init:function(){var t=ig.$new("link");t.rel="stylesheet",t.type="text/css",t.href=ig.prefix+"lib/impact/debug/debug.css",ig.$("body")[0].appendChild(t),this.container=ig.$new("div"),this.container.className="ig_debug",ig.$("body")[0].appendChild(this.container),this.panelMenu=ig.$new("div"),this.panelMenu.innerHTML='<div class="ig_debug_head">Impact.Debug:</div>',this.panelMenu.className="ig_debug_panel_menu",this.container.appendChild(this.panelMenu),this.numberContainer=ig.$new("div"),this.numberContainer.className="ig_debug_stats",this.panelMenu.appendChild(this.numberContainer),window.console&&window.console.log&&window.console.assert&&(ig.log=console.log.bind?console.log.bind(console):console.log,ig.assert=console.assert.bind?console.assert.bind(console):console.assert),ig.show=this.showNumber.bind(this)},addNumber:function(t,i){var e=ig.$new("span");this.numberContainer.appendChild(e),this.numberContainer.appendChild(document.createTextNode(t)),this.numbers[t]=e},showNumber:function(t,i,e){this.numbers[t]||this.addNumber(t,e),this.numbers[t].textContent=i},addPanel:function(t){var i=new t.type(t.name,t.label);if(t.options)for(var e=0;e<t.options.length;e++){var s=t.options[e];i.addOption(new ig.DebugOption(s.name,s.object,s.property))}this.panels[i.name]=i,i.container.style.display="none",this.container.appendChild(i.container);var n=ig.$new("div");n.className="ig_debug_menu_item",n.textContent=i.label,n.addEventListener("click",function(t){this.togglePanel(i)}.bind(this),!1),i.menuItem=n;for(var a=!1,e=1;e<this.panelMenu.childNodes.length;e++){var o=this.panelMenu.childNodes[e];if(o.textContent>i.label){this.panelMenu.insertBefore(n,o),a=!0;break}}a||this.panelMenu.appendChild(n)},showPanel:function(t){this.togglePanel(this.panels[t])},togglePanel:function(t){t!=this.activePanel&&this.activePanel&&(this.activePanel.toggle(!1),this.activePanel.menuItem.className="ig_debug_menu_item",this.activePanel=null);var i=t.container.style.display,e="block"!=i;t.toggle(e),t.menuItem.className="ig_debug_menu_item"+(e?" active":""),e&&(this.activePanel=t)},ready:function(){for(var t in this.panels)this.panels[t].ready()},beforeRun:function(){var t=Date.now();this.debugTickAvg=.8*this.debugTickAvg+.2*(t-this.debugRealTime),this.debugRealTime=t,this.activePanel&&this.activePanel.beforeRun()},afterRun:function(){var t=Date.now()-this.debugRealTime;1e3/ig.system.fps-t,this.debugTime=.8*this.debugTime+.2*t,this.activePanel&&this.activePanel.afterRun(),this.showNumber("ms",this.debugTime.toFixed(2)),this.showNumber("fps",Math.round(1e3/this.debugTickAvg)),this.showNumber("draws",ig.Image.drawCount),ig.game&&ig.game.entities&&this.showNumber("entities",ig.game.entities.length),ig.Image.drawCount=0}}),ig.DebugPanel=ig.Class.extend({active:!1,container:null,options:[],panels:[],label:"",name:"",init:function(t,i){this.name=t,this.label=i,this.container=ig.$new("div"),this.container.className="ig_debug_panel "+this.name},toggle:function(t){this.active=t,this.container.style.display=t?"block":"none"},addPanel:function(t){this.panels.push(t),this.container.appendChild(t.container)},addOption:function(t){this.options.push(t),this.container.appendChild(t.container)},ready:function(){},beforeRun:function(){},afterRun:function(){}}),ig.DebugOption=ig.Class.extend({name:"",labelName:"",className:"ig_debug_option",label:null,mark:null,container:null,active:!1,colors:{enabled:"#fff",disabled:"#444"},init:function(t,i,e){this.name=t,this.object=i,this.property=e,this.active=this.object[this.property],this.container=ig.$new("div"),this.container.className="ig_debug_option",this.label=ig.$new("span"),this.label.className="ig_debug_label",this.label.textContent=this.name,this.mark=ig.$new("span"),this.mark.className="ig_debug_label_mark",this.container.appendChild(this.mark),this.container.appendChild(this.label),this.container.addEventListener("click",this.click.bind(this),!1),this.setLabel()},setLabel:function(){this.mark.style.backgroundColor=this.active?this.colors.enabled:this.colors.disabled},click:function(t){return this.active=!this.active,this.object[this.property]=this.active,this.setLabel(),t.stopPropagation(),t.preventDefault(),!1}}),ig.debug=new ig.Debug}),ig.baked=!0,ig.module("plusplus.debug.pathfinding-panel").requires("plusplus.debug.menu","plusplus.abstractities.character","plusplus.helpers.utilsmath","plusplus.helpers.pathfinding").defines(function(){"use strict";var t=ig.utilsmath;ig.pathfinding,ig.Character.inject({draw:function(){if(this.parent(),ig.Character._debugShowPaths&&this.path&&this.path.length>0){var i,e=ig.system,s=ig.game.screen,n=e.context,a=(ig.game.collisionMap.tilesize,"rgba( 255, 0, 0, 0.5 )"),o=2*ig.system.scale;n.strokeStyle=a,n.lineWidth=1*e.scale,n.beginPath();var h=this._boundsPathfollow;for(n.moveTo(e.getDrawPos(h.minX+.5*h.width-s.x),e.getDrawPos(h.minY+.5*h.height-s.y)),i=this.path.length-1;i>=0;i--)n.lineTo(e.getDrawPos(this.path[i].x-s.x),e.getDrawPos(this.path[i].y-s.y));for(n.stroke(),n.closePath(),n.fillStyle=a,n.beginPath(),n.arc(e.getDrawPos(h.minX+.5*h.width-s.x),e.getDrawPos(h.minY+.5*h.height-s.y),o,0,t.TWOPI),n.fill(),i=this.path.length-1;i>=0;i--)n.beginPath(),n.arc(e.getDrawPos(this.path[i].x-s.x),e.getDrawPos(this.path[i].y-s.y),o,0,t.TWOPI),n.fill()}}}),ig.Character._debugShowPaths=!1,ig.debug.addPanel({type:ig.DebugPanel,name:"pathfinding-debug",label:"A*",options:[{name:"Show paths",object:ig.Character,property:"_debugShowPaths"}]})}),ig.baked=!0,ig.module("plusplus.debug.entities-panel").requires("plusplus.core.game","plusplus.core.entity","plusplus.debug.menu").defines(function(){"use strict";ig.EntityExtended.inject({handleMovementTrace:function(t){this.parent(t),this._res=t}}),ig.GameExtended.inject({draw:function(){this.parent(),this._debugDraw()},_debugDraw:function(){for(var t=0,i=this.layers.length;i>t;t++)for(var e=this.layers[t],s=e.items,n=0,a=s.length;a>n;n++){var o,h,r,l,g=s[n],u=ig.system.context;g.fixed?(r=0,l=0):(r=this.screen.x,l=this.screen.y);var c,d,p;if(g.pos&&g.size?(c=g.pos.x+.5*g.size.x,d=g.pos.y+.5*g.size.y):c=d=0,ig.EntityExtended._debugShowCollisionMapRes&&g._res){var m=g._res,f=ig.game.collisionMap&&ig.game.collisionMap.tilesize;if(m.tile.x&&(p=ig.utilstile.defaultTileVerticesDef[m.tile.x],p&&f))for(o=0,h=p.length;h>o;o++)this._debugDrawLine(!1,this._debugColors.collisionMap,(m.tile.xPos.x+p[o].x)*f,(m.tile.xPos.y+p[o].y)*f,(m.tile.xPos.x+p[o===h-1?0:o+1].x)*f,(m.tile.xPos.y+p[o===h-1?0:o+1].y)*f);if(m.tile.y&&(p=ig.utilstile.defaultTileVerticesDef[m.tile.y],p&&f))for(o=0,h=p.length;h>o;o++)this._debugDrawLine(!1,this._debugColors.collisionMap,(m.tile.yPos.x+p[o].x)*f,(m.tile.yPos.y+p[o].y)*f,(m.tile.yPos.x+p[o===h-1?0:o+1].x)*f,(m.tile.yPos.y+p[o===h-1?0:o+1].y)*f)}if(ig.EntityExtended._debugShowVertices&&g.vertices)for(p=g.vertices,o=0,h=p.length;h>o;o++)this._debugDrawLine(g.fixed,this._debugColors.vertices,c+p[o].x,d+p[o].y,c+p[o===h-1?0:o+1].x,d+p[o===h-1?0:o+1].y);if(ig.EntityExtended._debugShowBounds&&g.pos&&(u.strokeStyle=this._debugColors.boxes,u.lineWidth=1,u.strokeRect(ig.system.getDrawPos(g.pos.x-r)-.5,ig.system.getDrawPos(g.pos.y-l)-.5,g.size.x*(g.scale||ig.system.scale),g.size.y*(g.scale||ig.system.scale))),ig.EntityExtended._debugShowBoundsDraw&&g.posDraw&&(u.strokeStyle=this._debugColors.boxesDraw,u.lineWidth=1,u.strokeRect(ig.system.getDrawPos(g.posDraw.x-r)-.5,ig.system.getDrawPos(g.posDraw.y-l)-.5,g.sizeDraw.x*(g.scale||ig.system.scale),g.sizeDraw.y*(g.scale||ig.system.scale))),ig.EntityExtended._debugShowVelocities&&g.pos&&g.size&&this._debugDrawLine(g.fixed,this._debugColors.velocities,c,d,c+g.vel.x,d+g.vel.y),ig.EntityExtended._debugShowNames&&g.pos&&g.size&&(u.fillStyle=this._debugColors.names,u.fillText("[ "+g.layerName+" | "+g.id+" ]"+(g.name?" "+g.name:""),ig.system.getDrawPos(g.pos.x-r),ig.system.getDrawPos(g.pos.y-l)),"object"==typeof g.target))for(var y in g.target){var E=ig.game.namedEntities[g.target[y]];E&&this._debugDrawLine(g.fixed,this._debugColors.names,c,d,E.pos.x+.5*E.size.x,E.pos.y+.5*E.size.y)}}},_debugColors:{names:"#fff",velocities:"#0f0",boxes:"#0066FF",boxesDraw:"#00FF77",vertices:"#00f",collisionMap:"#f00"},_debugDrawLine:function(t,i,e,s,n,a){var o,h;t?(o=0,h=0):(o=this.screen.x,h=this.screen.y),ig.system.context.strokeStyle=i,ig.system.context.lineWidth=1,ig.system.context.beginPath(),ig.system.context.moveTo(ig.system.getDrawPos(e-o),ig.system.getDrawPos(s-h)),ig.system.context.lineTo(ig.system.getDrawPos(n-o),ig.system.getDrawPos(a-h)),ig.system.context.stroke(),ig.system.context.closePath()}}),ig.EntityExtended._debugEnableChecks=!0,ig.EntityExtended._debugShowVelocities=!1,ig.EntityExtended._debugShowNames=!1,ig.EntityExtended._debugShowVertices=!1,ig.EntityExtended._debugShowBounds=!1,ig.EntityExtended._debugShowBoundsDraw=!1,ig.EntityExtended._debugShowCollisionMapRes=!1,ig.EntityExtended.oldCheckPair=ig.EntityExtended.checkPair,ig.EntityExtended.checkPair=function(t,i){ig.EntityExtended._debugEnableChecks&&ig.EntityExtended.oldCheckPair(t,i)},ig.debug.addPanel({type:ig.DebugPanel,name:"entities",label:"Entities",options:[{name:"Show Names & Targets",object:ig.EntityExtended,property:"_debugShowNames"},{name:"Checks & Collisions",object:ig.EntityExtended,property:"_debugEnableChecks"},{name:"Show Collision Map Result",object:ig.EntityExtended,property:"_debugShowCollisionMapRes"},{name:"Show Velocities",object:ig.EntityExtended,property:"_debugShowVelocities"},{name:"Show Collision Boxes",object:ig.EntityExtended,property:"_debugShowBounds"},{name:"Show Drawing Boxes",object:ig.EntityExtended,property:"_debugShowBoundsDraw"},{name:"Show Vertex Boxes",object:ig.EntityExtended,property:"_debugShowVertices"}]})}),ig.baked=!0,ig.module("plusplus.debug.maps-panel").requires("plusplus.debug.menu","plusplus.core.game","plusplus.core.background-map").defines(function(){"use strict";ig.GameExtended.inject({buildLevel:function(){this.parent.apply(this,arguments),ig.debug.panels.maps.load(this)},unloadLevel:function(){this.parent.apply(this,arguments),ig.debug.panels.maps.maps=[]}}),ig.DebugMapsPanel=ig.DebugPanel.extend({maps:[],mapScreens:[],init:function(t,i){this.parent(t,i),this.load()},load:function(t){if(this.options=[],this.panels=[],!t)return void(this.container.innerHTML="<em>No Maps Loaded</em>");this.maps=[];for(var i=0,e=t.layers.length;e>i;i++){var s=t.layers[i];if(s.numBackgroundMaps>0)for(var n=0,a=s.items.length;a>n;n++){var o=s.items[n];o instanceof ig.BackgroundMap&&this.maps.push(o)}}if(0===this.maps.length)return void(this.container.innerHTML="<em>No Maps Loaded</em>");this.mapScreens=[],this.container.innerHTML="";for(var h=0;h<this.maps.length;h++){var r=this.maps[h],l=new ig.DebugPanel(h,"Layer "+h),g=ig.$new("strong");g.textContent=h+": "+r.tiles.path,l.container.appendChild(g),l.addOption(new ig.DebugOption("Enabled",r,"enabled")),l.addOption(new ig.DebugOption("Pre Rendered",r,"preRender")),l.addOption(new ig.DebugOption("Show Chunks",r,"debugChunks")),this.generateMiniMap(l,r,h),this.addPanel(l)}},generateMiniMap:function(t,i,e){var s=ig.system.scale,n=[i];i.mergedMaps&&(n=n.concat(i.mergedMaps));for(var a=0,o=0,h=0,r=n.length;r>h;h++){var l=n[h];a=Math.max(a,l.width),o=Math.max(o,l.height)}var g=ig.$new("canvas");g.width=a*s,g.height=o*s;var u=g.getContext("2d");ig.game.clearColor&&(u.fillStyle=ig.game.clearColor,u.fillRect(0,0,g.width,g.height));for(var h=0,r=n.length;r>h;h++){var l=n[h];l.tiles.ignoreSystemScale||l.tiles._scale===s||l.tiles.resize(s);var c=ig.$new("canvas"),d=c.getContext("2d"),p=l.tiles.width*s,m=l.tiles.height*s,f=p/l.tilesize,y=m/l.tilesize;c.width=f,c.height=y,d.drawImage(l.tiles.data,0,0,p,m,0,0,f,y);for(var E=0,v=0;v<l.width;v++)for(var T=0;T<l.height;T++)(E=l.data[T][v])&&u.drawImage(c,Math.floor((E-1)*s%f),Math.floor((E-1)*s/f)*s,s,s,v*s,T*s,s,s)}var A=ig.$new("div");A.className="ig_debug_map_container",A.style.width=l.width*s+"px",A.style.height=l.height*s+"px";var _=ig.$new("div");_.className="ig_debug_map_screen",_.style.width=ig.system.width/l.tilesize*s-2+"px",_.style.height=ig.system.height/l.tilesize*s-2+"px",this.mapScreens[e]=_,A.appendChild(g),A.appendChild(_),t.container.appendChild(A)},afterRun:function(){for(var t=ig.system.scale,i=0;i<this.maps.length;i++){var e=this.maps[i],s=this.mapScreens[i];if(e&&s){var n=e.scroll.x/e.tilesize,a=e.scroll.y/e.tilesize;e.repeat&&(n%=e.width,a%=e.height),s.style.left=n*t+"px",s.style.top=a*t+"px"}}}}),ig.debug.addPanel({type:ig.DebugMapsPanel,name:"maps",label:"Background Maps"})}),ig.baked=!0,ig.module("plusplus.debug.graph-panel").requires("plusplus.debug.menu","impact.system","plusplus.core.game","impact.image").defines(function(){"use strict";ig.GameExtended.inject({draw:function(){ig.graph.beginClock("draw"),this.parent(),ig.graph.endClock("draw")},update:function(){ig.graph.beginClock("update"),this.parent(),ig.graph.endClock("update")},checkEntities:function(){ig.graph.beginClock("checks"),this.parent(),ig.graph.endClock("checks")}}),ig.DebugGraphPanel=ig.DebugPanel.extend({clocks:{},marks:[],textY:0,height:128,ms:64,timeBeforeRun:0,init:function(t,i){this.parent(t,i),this.mark16ms=(this.height-this.height/this.ms*16).round(),this.mark33ms=(this.height-this.height/this.ms*33).round(),this.msHeight=this.height/this.ms,this.graph=ig.$new("canvas"),this.graph.width=window.innerWidth,this.graph.height=this.height,this.container.appendChild(this.graph),this.ctx=this.graph.getContext("2d"),this.ctx.fillStyle="#444",this.ctx.fillRect(0,this.mark16ms,this.graph.width,1),this.ctx.fillRect(0,this.mark33ms,this.graph.width,1),this.addGraphMark("16ms",this.mark16ms),this.addGraphMark("33ms",this.mark33ms),this.addClock("draw","Draw","#13baff"),this.addClock("update","Entity Update","#bb0fff"),this.addClock("checks","Entity Checks & Collisions","#a2e908"),this.addClock("lag","System Lag","#f26900"),ig.mark=this.mark.bind(this),ig.graph=this},addGraphMark:function(t,i){var e=ig.$new("span");e.className="ig_debug_graph_mark",e.textContent=t,e.style.top=i.round()+"px",this.container.appendChild(e)},addClock:function(t,i,e){var s=ig.$new("span");s.className="ig_debug_legend_color",s.style.backgroundColor=e;var n=ig.$new("span");n.className="ig_debug_legend_number",n.appendChild(document.createTextNode("0"));var a=ig.$new("span");a.className="ig_debug_legend",a.appendChild(s),a.appendChild(document.createTextNode(i+" (")),a.appendChild(n),a.appendChild(document.createTextNode("ms)")),this.container.appendChild(a),this.clocks[t]={description:i,color:e,current:0,start:Date.now(),avg:0,html:n}},beginClock:function(t,i){this.clocks[t].start=Date.now()+(i||0)},endClock:function(t){var i=this.clocks[t];i.current=Math.round(Date.now()-i.start),i.avg=.8*i.avg+.2*i.current},mark:function(t,i){this.active&&this.marks.push({msg:t,color:i||"#fff"})},beforeRun:function(){this.endClock("lag"),this.timeBeforeRun=Date.now()},afterRun:function(){var t=Date.now()-this.timeBeforeRun,i=1e3/ig.system.fps-t;this.beginClock("lag",Math.max(i,0));var e=this.graph.width-1,s=this.height;this.ctx.drawImage(this.graph,-1,0),this.ctx.fillStyle="#000",this.ctx.fillRect(e,0,1,this.height),this.ctx.fillStyle="#444",this.ctx.fillRect(e,this.mark16ms,1,1),this.ctx.fillStyle="#444",this.ctx.fillRect(e,this.mark33ms,1,1);for(var n in this.clocks){var a=this.clocks[n];if(a.html.textContent=a.avg.toFixed(2),a.color&&a.current>0){this.ctx.fillStyle=a.color;var o=a.current*this.msHeight;s-=o,this.ctx.fillRect(e,s,1,o),a.current=0}}this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.globalAlpha=.5;for(var h=0;h<this.marks.length;h++){var r=this.marks[h];this.ctx.fillStyle=r.color,this.ctx.fillRect(e,0,1,this.height),r.msg&&(this.ctx.fillText(r.msg,e-1,this.textY),this.textY=(this.textY+8)%32)}this.ctx.globalAlpha=1,this.marks=[]}}),ig.debug.addPanel({type:ig.DebugGraphPanel,name:"graph",label:"Performance"})}),ig.baked=!0,ig.module("plusplus.debug.debug").requires("plusplus.debug.pathfinding-panel","plusplus.debug.entities-panel","plusplus.debug.maps-panel","plusplus.debug.graph-panel").defines(function(){"use strict"}),ig.baked=!0,ig.module("game.main").requires("plusplus.core.plusplus","game.managers.connection","game.managers.level","game.managers.ui","game.entities.otherPlayer","game.entities.player","impact.game","impact.font","impact.input","plusplus.debug.debug").defines(function(){var t=ig.CONFIG;MyGame=ig.GameExtended.extend({font:new ig.Font("media/04b03.font.png"),init:function(){this.parent(),this.start()},update:function(){this.parent(),this.player||(this.player=this.getPlayer(),this.player&&(console.log(this.player),this.socket.emit("playerStart"))),ig.input.pressed("start")&&(this.socket=this.connectionManager.init(),this.levelManager.next(),ig.input.unbind(ig.KEY.SPACE,"start"),ig.input.unbind(ig.KEY.MOUSE1,"start"),this.hasStarted=!0,this.socket.emit("gameStart",function(t){this.spawnPlayer(t)}.bind(this)))},spawnPlayer:function(t){var i=this;window.setTimeout(function(){var e=i.getEntityByName("spawn");e?(i.spawnEntity(EntityPlayer,e.pos.x,e.pos.y,{playerNumber:t.playerNumber}),i.uiManager.log("start: player "+t.playerNumber),i.getPlayer().speak("wtf?")):console.error("cannot find spawn point on level")},700)},moveOtherPlayer:function(t){var i=this.getOtherPlayer(t.id);i&&i.animate(t)},getOtherPlayer:function(t){return ig.game.getEntityByName(t)},removeOtherPlayer:function(t){var i=ig.game.getEntityByName(t);i&&(ig.game.uiManager.log("exit: player "+i.playerNumber),i.kill())},spawnOtherPlayer:function(t,i){var e=i?700:0;window.setTimeout(function(){var i,e=ig.game.getEntityByName("spawn");t.pos?i={x:t.pos.x,y:t.pos.y}:e&&(i={x:e.pos.x,y:e.pos.y}),i?(ig.game.uiManager.log("start: player "+t.playerNumber),ig.game.spawnEntity(EntityOtherPlayer,i.x,i.y,{id:t.id,name:t.id,playerNumber:t.playerNumber})):console.error("cannot find spawn point on level")},e)},draw:function(){if(this.parent(),!this.hasStarted){var t=ig.system.width/2,i=ig.system.height/2;if(this.uiManager.clearLogs(),this.gameOver){var e=this.getPlayer();e&&this.removeEntity(e),this.font.draw("Game Over!",t,i,ig.Font.ALIGN.CENTER),this.font.draw("hit space to begin",t,i+20,ig.Font.ALIGN.CENTER),ig.input.bind(ig.KEY.SPACE,"start"),ig.input.bind(ig.KEY.MOUSE1,"start")}else this.font.draw("-- That Bloody Game Again! --",t,i,ig.Font.ALIGN.CENTER),this.font.draw("hit space to begin",t,i+20,ig.Font.ALIGN.CENTER)}},success:function(){console.log("success()"),0===this.levelManager.next()&&this.end()},start:function(){this.connectionManager=new ig.connectionManager,this.levelManager=new ig.levelManager,this.uiManager=new ig.uiManager,this.hasStarted=!1,ig.input.bind(ig.KEY.SPACE,"start"),ig.input.bind(ig.KEY.MOUSE1,"start")},end:function(){this.levelManager.reset(),this.gameOver=!0,this.hasStarted=!1},inputStart:function(){this.parent(),ig.input.bind(ig.KEY.UP_ARROW,"jump")},inputEnd:function(){this.parent(),ig.input.unbind(ig.KEY.UP_ARROW,"jump")},loadLevel:function(t){this.parent(t);for(var i=0;i<this.backgroundMaps.length;i++)this.backgroundMaps[i].preRender=!0}}),ig.main("#canvas",MyGame,60,t.GAME_WIDTH,t.GAME_HEIGHT,t.SCALE,ig.LoaderExtended)});